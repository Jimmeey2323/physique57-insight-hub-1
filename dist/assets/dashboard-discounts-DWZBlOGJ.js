import{r as M,i as xe,w as ae,P as oe,_ as ve,$ as z,U as me,j as e,E as se,M as fe,d as je,c as re,a0 as Te,J as le,T as Re,g as pe,a1 as $e,a2 as ye,e as Ne,W as Ve,a3 as Ke,S as Le,D as Ue,h as Ie}from"./react-vendor-Di6K3Iht.js";import{C as S,j as K,k as L,d as Y,c as B,B as U,T as J,m as Z,n as I,o as k,p as ee,q as d,r as ce,s as ie,t as O,u as F,I as Oe,a1 as ne,Z as Fe,_ as Ee,$ as ze,a0 as He,a2 as qe,a3 as Ye,a4 as We,W as Ge}from"./ui-components-vIyQeg8Q.js";import{f as m,b as $,c as R}from"./utils-w8vrWjz4.js";import{R as H,L as be,C as G,X as Q,Y as W,T as q,b as te,B as de,c as X,a as ue,P as Ce,d as Se,e as Me,S as Qe,g as Xe}from"./chart-vendor-BSHhUw40.js";import{c as ge}from"./dashboard-classes-DXdXVLRz.js";import{A as _e}from"./dashboard-misc-DvnqFqoY.js";const dt=({data:v,selectedLocation:g})=>{const[P,x]=M.useState("overview"),[A,u]=M.useState(!1),j=M.useMemo(()=>!v||v.length===0?[]:!g||g==="all"?v:v.filter(t=>t.calculatedLocation===g),[v,g]),n=M.useMemo(()=>{if(!j||j.length===0)return{totalTransactions:0,discountedTransactions:0,totalRevenue:0,totalDiscounts:0,avgDiscountPercent:0,topDiscountedProducts:[],monthlyTrends:[],locationBreakdown:[],categoryBreakdown:[],customerSegments:[],staffPerformance:[]};const t=j.filter(r=>{const f=(r.discountAmount||0)>0,y=(r.discountPercentage||0)>0,_=r.isPromotional===!0,he=r.discountType&&r.discountType!=="";return f||y||_||he}),l=j.length,w=t.length,p=j.reduce((r,f)=>r+(f.paymentValue||0),0),a=j.reduce((r,f)=>r+(f.discountAmount||0),0),o=t.length>0?t.reduce((r,f)=>{let y=f.discountPercentage||0;if(y===0&&f.discountAmount&&f.paymentValue){const _=f.paymentValue+f.discountAmount;y=_>0?f.discountAmount/_*100:0}return r+y},0)/t.length:0,c=j.reduce((r,f)=>{const y=f.cleanedProduct||"Unknown";return r[y]||(r[y]={name:y,category:f.cleanedCategory||"Unknown",totalDiscount:0,transactions:0,discountedTransactions:0,revenue:0,customers:new Set}),r[y].totalDiscount+=f.discountAmount||0,r[y].transactions+=1,r[y].revenue+=f.paymentValue||0,r[y].customers.add(f.customerEmail),((f.discountAmount||0)>0||(f.discountPercentage||0)>0)&&(r[y].discountedTransactions+=1),r},{}),N=Object.values(c).map(r=>({...r,uniqueCustomers:r.customers.size,discountRate:r.transactions>0?r.discountedTransactions/r.transactions*100:0})).sort((r,f)=>f.totalDiscount-r.totalDiscount).slice(0,10),T=j.reduce((r,f)=>{if(!f.paymentDate)return r;let y;try{if(f.paymentDate.includes("/")){const[_,he,Be]=f.paymentDate.split(" ")[0].split("/");y=`${Be}-${he.padStart(2,"0")}`}else y=f.paymentDate.substring(0,7)}catch{y="Unknown"}return r[y]||(r[y]={month:y,revenue:0,discounts:0,transactions:0,discountedTransactions:0,discountRate:0}),r[y].revenue+=f.paymentValue||0,r[y].discounts+=f.discountAmount||0,r[y].transactions+=1,((f.discountAmount||0)>0||(f.discountPercentage||0)>0)&&(r[y].discountedTransactions+=1),r},{}),E=Object.values(T).map(r=>({...r,discountRate:r.transactions>0?r.discountedTransactions/r.transactions*100:0})).sort((r,f)=>r.month.localeCompare(f.month)),D=j.reduce((r,f)=>{const y=f.calculatedLocation||"Unknown";return r[y]||(r[y]={location:y,revenue:0,discounts:0,transactions:0,discountedTransactions:0,customers:new Set}),r[y].revenue+=f.paymentValue||0,r[y].discounts+=f.discountAmount||0,r[y].transactions+=1,r[y].customers.add(f.customerEmail),(f.discountAmount||0)>0&&(r[y].discountedTransactions+=1),r},{}),C=Object.values(D).map(r=>({...r,uniqueCustomers:r.customers.size,discountRate:r.transactions>0?r.discountedTransactions/r.transactions*100:0,avgDiscountPerTransaction:r.discountedTransactions>0?r.discounts/r.discountedTransactions:0})),i=j.reduce((r,f)=>{const y=f.cleanedCategory||"Unknown";return r[y]||(r[y]={category:y,revenue:0,discounts:0,transactions:0,discountedTransactions:0}),r[y].revenue+=f.paymentValue||0,r[y].discounts+=f.discountAmount||0,r[y].transactions+=1,(f.discountAmount||0)>0&&(r[y].discountedTransactions+=1),r},{}),b=Object.values(i).map(r=>({...r,discountRate:r.transactions>0?r.discountedTransactions/r.transactions*100:0})).sort((r,f)=>f.discounts-r.discounts),h=j.reduce((r,f)=>{const y=f.soldBy||"Unknown";return r[y]||(r[y]={name:y,totalDiscounts:0,transactions:0,discountedTransactions:0,revenue:0}),r[y].totalDiscounts+=f.discountAmount||0,r[y].transactions+=1,r[y].revenue+=f.paymentValue||0,(f.discountAmount||0)>0&&(r[y].discountedTransactions+=1),r},{}),V=Object.values(h).map(r=>({...r,discountRate:r.transactions>0?r.discountedTransactions/r.transactions*100:0,avgDiscountPerTransaction:r.discountedTransactions>0?r.totalDiscounts/r.discountedTransactions:0})).sort((r,f)=>f.totalDiscounts-r.totalDiscounts).slice(0,10);return{totalTransactions:l,discountedTransactions:w,totalRevenue:p,totalDiscounts:a,avgDiscountPercent:o,topDiscountedProducts:N,monthlyTrends:E,locationBreakdown:C,categoryBreakdown:b,staffPerformance:V}},[j]),s=[{title:"Total Revenue",value:m(n.totalRevenue),icon:xe,gradient:"from-green-500 to-emerald-600",description:"Total sales revenue",change:12.5},{title:"Total Discounts",value:m(n.totalDiscounts),icon:ae,gradient:"from-red-500 to-rose-600",description:"Amount saved by customers",change:-8.3},{title:"Discount Rate",value:$(n.totalRevenue>0?n.totalDiscounts/n.totalRevenue*100:0),icon:oe,gradient:"from-blue-500 to-indigo-600",description:"Discount as % of revenue",change:-2.1},{title:"Discounted Sales",value:`${R(n.discountedTransactions)} / ${R(n.totalTransactions)}`,icon:ve,gradient:"from-purple-500 to-violet-600",description:"Sales with discounts applied",change:5.7},{title:"Avg Discount %",value:$(n.avgDiscountPercent),icon:z,gradient:"from-orange-500 to-red-600",description:"Average discount percentage",change:-1.2},{title:"Penetration Rate",value:$(n.totalTransactions>0?n.discountedTransactions/n.totalTransactions*100:0),icon:me,gradient:"from-cyan-500 to-blue-600",description:"Percentage of discounted sales",change:3.4}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(S,{className:"border-0 shadow-xl bg-gradient-to-r from-orange-50 to-red-50",children:e.jsx(K,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-orange-500 to-red-500 rounded-xl flex items-center justify-center",children:e.jsx(oe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx(L,{className:"text-2xl font-bold text-gray-900",children:"Discounts & Promotions Analytics"}),e.jsxs("p",{className:"text-gray-600",children:["Comprehensive discount impact analysis",g!=="all"&&` for ${g}`]})]})]}),e.jsx("div",{className:"flex gap-2",children:["overview","details","analytics"].map(t=>e.jsx(Y,{variant:P===t?"default":"outline",onClick:()=>x(t),className:"capitalize",children:t},t))})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6",children:s.map((t,l)=>e.jsx(S,{className:"bg-white shadow-xl border-0 overflow-hidden hover:shadow-2xl transition-all duration-300 group cursor-pointer",children:e.jsx(B,{className:"p-0",children:e.jsxs("div",{className:`bg-gradient-to-r ${t.gradient} p-6 text-white relative overflow-hidden`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 transform translate-x-8 -translate-y-8 opacity-20",children:e.jsx(t.icon,{className:"w-20 h-20"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(t.icon,{className:"w-6 h-6"}),e.jsx("h3",{className:"font-semibold text-sm",children:t.title})]}),e.jsx("p",{className:"text-3xl font-bold mb-1",children:t.value}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:`text-sm ${t.change>=0?"text-green-200":"text-red-200"}`,children:[t.change>=0?"+":"",t.change.toFixed(1),"%"]}),e.jsx("span",{className:"text-sm opacity-90",children:"vs last period"})]})]})]})})},t.title))}),P==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(S,{className:"bg-white shadow-xl border-0",children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-blue-600"}),"Monthly Discount Trends"]})}),e.jsx(B,{children:e.jsx(H,{width:"100%",height:300,children:e.jsxs(be,{data:n.monthlyTrends,children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"month"}),e.jsx(W,{}),e.jsx(q,{formatter:(t,l)=>[l==="discounts"||l==="revenue"?m(t):l==="discountRate"?$(t):R(t),l]}),e.jsx(te,{type:"monotone",dataKey:"revenue",stroke:"#8884d8",name:"Revenue"}),e.jsx(te,{type:"monotone",dataKey:"discounts",stroke:"#82ca9d",name:"Discounts"}),e.jsx(te,{type:"monotone",dataKey:"discountRate",stroke:"#ffc658",name:"Discount Rate %"})]})})})]}),e.jsxs(S,{className:"bg-white shadow-xl border-0",children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-green-600"}),"Top Discounted Products"]})}),e.jsx(B,{children:e.jsx("div",{className:"space-y-4 max-h-80 overflow-y-auto",children:n.topDiscountedProducts.slice(0,8).map((t,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-orange-500 to-red-500 rounded-full flex items-center justify-center text-white font-bold text-sm",children:l+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 truncate max-w-[200px]",children:t.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{variant:"outline",className:"text-xs",children:t.category}),e.jsxs(U,{variant:"secondary",className:"text-xs",children:[$(t.discountRate)," discount rate"]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-red-600",children:m(t.totalDiscount)}),e.jsxs("p",{className:"text-sm text-gray-600",children:[R(t.transactions)," sales"]})]})]},t.name))})})]})]}),P==="details"&&e.jsxs(S,{className:"bg-white shadow-xl border-0",children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-blue-600"}),"Detailed Discount Transactions"]})}),e.jsx(B,{children:e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs(J,{children:[e.jsx(Z,{children:e.jsxs(I,{children:[e.jsx(k,{children:"Date"}),e.jsx(k,{children:"Customer"}),e.jsx(k,{children:"Product"}),e.jsx(k,{children:"Location"}),e.jsx(k,{children:"Revenue"}),e.jsx(k,{children:"Discount"}),e.jsx(k,{children:"Discount %"}),e.jsx(k,{children:"Sold By"})]})}),e.jsx(ee,{children:j.filter(t=>(t.discountAmount||0)>0).slice(0,50).map((t,l)=>e.jsxs(I,{children:[e.jsx(d,{children:t.paymentDate}),e.jsx(d,{className:"font-medium",children:t.customerName}),e.jsx(d,{children:e.jsx(U,{variant:"outline",children:t.cleanedProduct})}),e.jsx(d,{children:t.calculatedLocation}),e.jsx(d,{children:e.jsx(U,{className:"bg-green-100 text-green-800",children:m(t.paymentValue||0)})}),e.jsx(d,{children:e.jsx(U,{className:"bg-red-100 text-red-800",children:m(t.discountAmount||0)})}),e.jsx(d,{children:e.jsx(U,{className:"bg-blue-100 text-blue-800",children:$(t.discountPercentage||0)})}),e.jsx(d,{children:t.soldBy})]},l))})]})})})]}),P==="analytics"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(S,{className:"bg-white shadow-xl border-0",children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-purple-600"}),"Location Discount Performance"]})}),e.jsx(B,{children:e.jsx(H,{width:"100%",height:300,children:e.jsxs(de,{data:n.locationBreakdown,children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"location"}),e.jsx(W,{}),e.jsx(q,{formatter:t=>m(t)}),e.jsx(X,{dataKey:"discounts",fill:"#8884d8",name:"Discounts"})]})})})]}),e.jsxs(S,{className:"bg-white shadow-xl border-0",children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-orange-600"}),"Category Discount Analysis"]})}),e.jsx(B,{children:e.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:n.categoryBreakdown.map((t,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.category}),e.jsxs("p",{className:"text-sm text-gray-600",children:[R(t.transactions)," transactions • ",$(t.discountRate)," discount rate"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-red-600",children:m(t.discounts)}),e.jsxs("p",{className:"text-sm text-gray-600",children:[m(t.revenue)," revenue"]})]})]},t.category))})})]}),e.jsxs(S,{className:"bg-white shadow-xl border-0",children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5 text-green-600"}),"Staff Discount Performance"]})}),e.jsx(B,{children:e.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:n.staffPerformance.map((t,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center text-white font-bold text-sm",children:l+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[R(t.discountedTransactions)," discounted sales • ",$(t.discountRate)," rate"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-red-600",children:m(t.totalDiscounts)}),e.jsxs("p",{className:"text-sm text-gray-600",children:[m(t.avgDiscountPerTransaction)," avg"]})]})]},t.name))})})]}),e.jsxs(S,{className:"bg-white shadow-xl border-0",children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-blue-600"}),"Monthly Discount Rate Trends"]})}),e.jsx(B,{children:e.jsx(H,{width:"100%",height:300,children:e.jsxs(de,{data:n.monthlyTrends,children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"month"}),e.jsx(W,{}),e.jsx(q,{formatter:(t,l)=>[l==="discountRate"?$(t):R(t),l]}),e.jsx(X,{dataKey:"discountRate",fill:"#ffc658",name:"Discount Rate %"})]})})})]})]})]})},Je={DollarSign:xe,ShoppingCart:ve,Activity:pe,Users:me,Target:Re,Percent:oe,CreditCard:le,ArrowDownRight:Te},Ze=({data:v,onMetricClick:g})=>{const P=v.reduce((c,N)=>c+(N.discountAmount||0),0),x=v.reduce((c,N)=>c+(N.paymentValue||0),0),A=v.length,u=v.filter(c=>(c.discountAmount||0)>0).length,j=new Set(v.map(c=>c.memberId||c.customerEmail)).size,n=new Set(v.filter(c=>(c.discountAmount||0)>0).map(c=>c.memberId||c.customerEmail)).size,s=x>0?P/(x+P)*100:0,t=A>0?u/A*100:0,l=j>0?n/j*100:0,w=u>0?P/u:0,p=n>0?P/n:0,a=[{title:"Total Discounts",value:m(P),description:"Total amount saved by customers",icon:"DollarSign",change:null,trend:"neutral",color:"orange"},{title:"Discount Rate",value:$(s),description:"Percentage of gross revenue",icon:"Percent",change:null,trend:"neutral",color:"orange"},{title:"Transactions with Discounts",value:R(u),description:`${$(t)} of all transactions`,icon:"ShoppingCart",change:null,trend:"neutral",color:"orange"},{title:"Customers with Discounts",value:R(n),description:`${$(l)} of all customers`,icon:"Users",change:null,trend:"neutral",color:"orange"},{title:"Avg Discount per Transaction",value:m(w),description:"Average savings per discounted purchase",icon:"Target",change:null,trend:"neutral",color:"orange"},{title:"Avg Discount per Customer",value:m(p),description:"Average savings per customer",icon:"Activity",change:null,trend:"neutral",color:"orange"}],o=c=>{if(g){const N={title:c.title,name:c.title,type:"metric",totalRevenue:x,totalDiscounts:P,transactions:A,discountedTransactions:u,uniqueCustomers:j,customersWithDiscounts:n,discountRate:s,discountPenetration:t,rawData:v,filteredTransactionData:v,isDynamic:!0,calculatedFromFiltered:!0};g(N)}};return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[a.map((c,N)=>{const T=Je[c.icon]||xe;return e.jsxs(S,{className:ge("group relative overflow-hidden border-0 shadow-lg hover:shadow-xl transition-all duration-300 ease-out cursor-pointer","bg-gradient-to-br from-white via-orange-50/30 to-orange-100/50","hover:scale-105 hover:-translate-y-1"),onClick:()=>o(c),style:{animationDelay:`${N*100}ms`,animation:"slideInUp 0.6s ease-out forwards"},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-500/5 via-transparent to-orange-600/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsxs(B,{className:"relative p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-1",children:c.title}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-1",children:c.value}),e.jsx("p",{className:"text-xs text-gray-500 leading-relaxed",children:c.description})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("div",{className:ge("p-2 rounded-lg transition-colors duration-300","bg-orange-100 text-orange-600","group-hover:bg-orange-200 group-hover:scale-110"),children:e.jsx(T,{className:"w-5 h-5"})}),c.change&&e.jsxs(U,{className:ge("text-xs font-medium px-2 py-1",c.trend==="up"?"bg-green-100 text-green-700 border-green-200":c.trend==="down"?"bg-red-100 text-red-700 border-red-200":"bg-gray-100 text-gray-700 border-gray-200"),children:[c.trend==="up"&&e.jsx($e,{className:"w-3 h-3 mr-1"}),c.trend==="down"&&e.jsx(Te,{className:"w-3 h-3 mr-1"}),c.change]})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-orange-400 to-orange-600 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-left"})]})]},c.title)}),e.jsx("style",{children:`
        @keyframes slideInUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
      `})]})},De=["#8b5cf6","#06b6d4","#10b981","#f59e0b","#ef4444","#6366f1","#ec4899","#84cc16"],we=({data:v,filters:g})=>{const[P,x]=M.useState("trends"),A=M.useMemo(()=>{let u=v.filter(a=>(a.discountAmount||0)>0);g&&(u=u.filter(a=>{if(g.location&&a.calculatedLocation!==g.location||g.category&&a.cleanedCategory!==g.category||g.product&&a.cleanedProduct!==g.product||g.soldBy&&(a.soldBy==="-"?"Online/System":a.soldBy)!==g.soldBy||g.paymentMethod&&a.paymentMethod!==g.paymentMethod||g.minDiscountAmount&&(a.discountAmount||0)<g.minDiscountAmount||g.maxDiscountAmount&&(a.discountAmount||0)>g.maxDiscountAmount||g.minDiscountPercent&&(a.discountPercentage||0)<g.minDiscountPercent||g.maxDiscountPercent&&(a.discountPercentage||0)>g.maxDiscountPercent)return!1;if(g.dateRange?.from||g.dateRange?.to){const o=new Date(a.paymentDate);if(g.dateRange.from&&o<g.dateRange.from||g.dateRange.to&&o>g.dateRange.to)return!1}return!0}));const j=u.reduce((a,o)=>{const c=new Date(o.paymentDate),N=`${c.getFullYear()}-${(c.getMonth()+1).toString().padStart(2,"0")}`;return a[N]||(a[N]={month:N,transactions:0,totalDiscount:0,totalRevenue:0,avgDiscount:0}),a[N].transactions+=1,a[N].totalDiscount+=o.discountAmount||0,a[N].totalRevenue+=o.paymentValue||0,a},{}),n=Object.values(j).map(a=>({...a,avgDiscount:a.transactions>0?a.totalDiscount/a.transactions:0,discountRate:a.totalRevenue>0?a.totalDiscount/(a.totalRevenue+a.totalDiscount)*100:0})).sort((a,o)=>a.month.localeCompare(o.month)),s=u.reduce((a,o)=>{const c=o.cleanedCategory||"Unknown";return a[c]||(a[c]={name:c,value:0,transactions:0}),a[c].value+=o.discountAmount||0,a[c].transactions+=1,a},{}),t=Object.values(s).sort((a,o)=>o.value-a.value).slice(0,8),w=[{min:0,max:100,label:"₹0-100"},{min:100,max:500,label:"₹100-500"},{min:500,max:1e3,label:"₹500-1K"},{min:1e3,max:2500,label:"₹1K-2.5K"},{min:2500,max:5e3,label:"₹2.5K-5K"},{min:5e3,max:1/0,label:"₹5K+"}].map(a=>{const o=u.filter(c=>{const N=c.discountAmount||0;return N>=a.min&&N<a.max});return{range:a.label,transactions:o.length,totalDiscount:o.reduce((c,N)=>c+(N.discountAmount||0),0),avgDiscount:o.length>0?o.reduce((c,N)=>c+(N.discountAmount||0),0)/o.length:0,totalRevenue:o.reduce((c,N)=>c+(N.paymentValue||0),0)}}),p=u.slice(0,200).map(a=>({discountAmount:a.discountAmount||0,discountPercent:a.discountPercentage||0,revenue:a.paymentValue||0,category:a.cleanedCategory||"Unknown"}));return{monthlyTrends:n,categoryDistribution:t,rangeAnalysis:w,scatterData:p}},[v,g]);return e.jsx("div",{className:"space-y-6",children:e.jsxs(ce,{value:P,onValueChange:x,className:"w-full",children:[e.jsxs(ie,{className:"grid w-full grid-cols-4 bg-white border border-slate-200 p-1 rounded-xl shadow-sm h-auto",children:[e.jsxs(O,{value:"trends",className:"text-sm px-4 py-3 data-[state=active]:bg-blue-600 data-[state=active]:text-white",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Trends"]}),e.jsxs(O,{value:"distribution",className:"text-sm px-4 py-3 data-[state=active]:bg-purple-600 data-[state=active]:text-white",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Distribution"]}),e.jsxs(O,{value:"ranges",className:"text-sm px-4 py-3 data-[state=active]:bg-green-600 data-[state=active]:text-white",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Ranges"]}),e.jsxs(O,{value:"correlation",className:"text-sm px-4 py-3 data-[state=active]:bg-orange-600 data-[state=active]:text-white",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Correlation"]})]}),e.jsx(F,{value:"trends",className:"space-y-6",children:e.jsxs(S,{className:"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs(L,{className:"text-xl font-bold bg-gradient-to-r from-blue-700 to-indigo-700 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx(re,{className:"w-6 h-6 text-blue-600"}),"Monthly Discount Trends"]})}),e.jsx(B,{children:e.jsx(H,{width:"100%",height:400,children:e.jsxs(be,{data:A.monthlyTrends,children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"month"}),e.jsx(W,{yAxisId:"left",tickFormatter:u=>m(u)}),e.jsx(W,{yAxisId:"right",orientation:"right",tickFormatter:u=>`${u}%`}),e.jsx(q,{formatter:(u,j)=>[j==="discountRate"?`${u.toFixed(1)}%`:m(u),j==="totalDiscount"?"Total Discount":j==="totalRevenue"?"Revenue":"Discount Rate"]}),e.jsx(ue,{}),e.jsx(X,{yAxisId:"left",dataKey:"totalDiscount",fill:"#3b82f6",name:"Total Discount"}),e.jsx(te,{yAxisId:"right",type:"monotone",dataKey:"discountRate",stroke:"#ef4444",strokeWidth:3,name:"Discount Rate %"})]})})})]})}),e.jsx(F,{value:"distribution",className:"space-y-6",children:e.jsxs(S,{className:"bg-gradient-to-br from-white via-purple-50/30 to-violet-50/20 border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs(L,{className:"text-xl font-bold bg-gradient-to-r from-purple-700 to-violet-700 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx(ye,{className:"w-6 h-6 text-purple-600"}),"Discount Distribution by Category"]})}),e.jsx(B,{children:e.jsx(H,{width:"100%",height:400,children:e.jsxs(Ce,{children:[e.jsx(Se,{data:A.categoryDistribution,cx:"50%",cy:"50%",labelLine:!1,label:({name:u,value:j})=>`${u}: ${m(j)}`,outerRadius:120,fill:"#8884d8",dataKey:"value",children:A.categoryDistribution.map((u,j)=>e.jsx(Me,{fill:De[j%De.length]},`cell-${j}`))}),e.jsx(q,{formatter:u=>m(u)})]})})})]})}),e.jsx(F,{value:"ranges",className:"space-y-6",children:e.jsxs(S,{className:"bg-gradient-to-br from-white via-green-50/30 to-emerald-50/20 border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs(L,{className:"text-xl font-bold bg-gradient-to-r from-green-700 to-emerald-700 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx(Ne,{className:"w-6 h-6 text-green-600"}),"Discount Range Analysis"]})}),e.jsx(B,{children:e.jsx(H,{width:"100%",height:400,children:e.jsxs(de,{data:A.rangeAnalysis,children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"range"}),e.jsx(W,{tickFormatter:u=>m(u)}),e.jsx(q,{formatter:(u,j)=>[m(u),j==="totalDiscount"?"Total Discount":"Average Discount"]}),e.jsx(ue,{}),e.jsx(X,{dataKey:"totalDiscount",fill:"#10b981",name:"Total Discount"}),e.jsx(X,{dataKey:"avgDiscount",fill:"#06b6d4",name:"Average Discount"})]})})})]})}),e.jsx(F,{value:"correlation",className:"space-y-6",children:e.jsxs(S,{className:"bg-gradient-to-br from-white via-orange-50/30 to-amber-50/20 border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs(L,{className:"text-xl font-bold bg-gradient-to-r from-orange-700 to-amber-700 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx(pe,{className:"w-6 h-6 text-orange-600"}),"Discount Amount vs Percentage Correlation"]})}),e.jsx(B,{children:e.jsx(H,{width:"100%",height:400,children:e.jsxs(Qe,{data:A.scatterData,children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"discountPercent",name:"Discount %",tickFormatter:u=>`${u}%`}),e.jsx(W,{dataKey:"discountAmount",name:"Discount Amount",tickFormatter:u=>m(u)}),e.jsx(q,{formatter:(u,j)=>[j==="discountPercent"?`${u}%`:m(u),j==="discountPercent"?"Discount %":"Discount Amount"]}),e.jsx(Xe,{dataKey:"discountAmount",fill:"#f59e0b"})]})})})]})})]})})},et=({data:v,filters:g,onDrillDown:P})=>{const[x,A]=M.useState("desc"),u=M.useMemo(()=>{const n=v.reduce((p,a)=>{const o=a.cleanedCategory||"Unknown";return p[o]||(p[o]={totalDiscount:0,count:0,totalRevenue:0,avgPercent:0}),p[o].totalDiscount+=a.discountAmount||0,p[o].count+=1,p[o].totalRevenue+=a.paymentValue||0,p[o].avgPercent+=a.discountPercentage||0,p},{}),s=v.reduce((p,a)=>{const o=a.cleanedProduct||"Unknown";return p[o]||(p[o]={totalDiscount:0,count:0,totalRevenue:0,avgPercent:0}),p[o].totalDiscount+=a.discountAmount||0,p[o].count+=1,p[o].totalRevenue+=a.paymentValue||0,p[o].avgPercent+=a.discountPercentage||0,p},{}),t=v.reduce((p,a)=>{const o=a.soldBy==="-"?"Online/System":a.soldBy;return p[o]||(p[o]={totalDiscount:0,count:0,totalRevenue:0,avgPercent:0}),p[o].totalDiscount+=a.discountAmount||0,p[o].count+=1,p[o].totalRevenue+=a.paymentValue||0,p[o].avgPercent+=a.discountPercentage||0,p},{}),l=v.reduce((p,a)=>{const o=a.paymentMethod||"Unknown";return p[o]||(p[o]={totalDiscount:0,count:0,totalRevenue:0,avgPercent:0}),p[o].totalDiscount+=a.discountAmount||0,p[o].count+=1,p[o].totalRevenue+=a.paymentValue||0,p[o].avgPercent+=a.discountPercentage||0,p},{}),w=p=>Object.entries(p).map(([a,o])=>({name:a,totalDiscount:o.totalDiscount,count:o.count,totalRevenue:o.totalRevenue,avgPercent:o.count>0?o.avgPercent/o.count:0,avgDiscount:o.count>0?o.totalDiscount/o.count:0})).sort((a,o)=>x==="desc"?o.totalDiscount-a.totalDiscount:a.totalDiscount-o.totalDiscount);return{categories:w(n),products:w(s),soldBy:w(t),paymentMethods:w(l)}},[v,x]),j=(n,s,t,l)=>{const w=n.slice(0,5),p=n.slice(-5).reverse();return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(S,{className:"bg-gradient-to-br from-white via-green-50/30 to-emerald-50/20 border-0 shadow-lg",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(L,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(Ve,{className:"w-5 h-5 text-yellow-600"}),"Top ",t," by Discount",e.jsx(Y,{variant:"ghost",size:"sm",onClick:()=>A(x==="desc"?"asc":"desc"),className:"ml-auto",children:e.jsx(Ke,{className:"w-4 h-4"})})]})}),e.jsx(B,{className:"space-y-3",children:w.map((a,o)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/60 rounded-lg hover:bg-white/80 transition-all duration-300 cursor-pointer hover:scale-102 group",onClick:()=>P?.(`${a.name} - Discount Details`,v.filter(c=>(l==="category"?c.cleanedCategory:l==="product"?c.cleanedProduct:l==="soldBy"?c.soldBy==="-"?"Online/System":c.soldBy:c.paymentMethod)===a.name),l),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm ${o===0?"bg-gradient-to-r from-yellow-500 to-amber-500":o===1?"bg-gradient-to-r from-gray-400 to-gray-500":o===2?"bg-gradient-to-r from-orange-500 to-amber-600":"bg-gradient-to-r from-blue-500 to-purple-600"}`,children:["#",o+1]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm text-slate-800 truncate group-hover:text-slate-900",children:a.name}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-600",children:[e.jsxs("span",{children:[R(a.count)," transactions"]}),e.jsxs(U,{variant:"outline",className:"text-xs bg-green-50 text-green-700 border-green-200",children:[a.avgPercent.toFixed(1),"% avg"]})]})]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("div",{className:"font-bold text-red-600 text-sm",children:m(a.totalDiscount)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[m(a.avgDiscount),"/txn"]})]})]},a.name))})]}),e.jsxs(S,{className:"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 border-0 shadow-lg",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(L,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(Re,{className:"w-5 h-5 text-blue-600"}),"Lowest ",t," by Discount"]})}),e.jsx(B,{className:"space-y-3",children:p.map((a,o)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/60 rounded-lg hover:bg-white/80 transition-all duration-300 cursor-pointer hover:scale-102 group",onClick:()=>P?.(`${a.name} - Discount Details`,v.filter(c=>(l==="category"?c.cleanedCategory:l==="product"?c.cleanedProduct:l==="soldBy"?c.soldBy==="-"?"Online/System":c.soldBy:c.paymentMethod)===a.name),l),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-10 h-10 bg-gradient-to-r from-slate-500 to-gray-600 rounded-full flex items-center justify-center text-white font-bold text-sm",children:["#",p.length-o]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm text-slate-800 truncate group-hover:text-slate-900",children:a.name}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-600",children:[e.jsxs("span",{children:[R(a.count)," transactions"]}),e.jsxs(U,{variant:"outline",className:"text-xs bg-blue-50 text-blue-700 border-blue-200",children:[a.avgPercent.toFixed(1),"% avg"]})]})]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("div",{className:"font-bold text-blue-600 text-sm",children:m(a.totalDiscount)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[m(a.avgDiscount),"/txn"]})]})]},a.name))})]})]})};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Top & Bottom Performers"}),e.jsxs(U,{variant:"outline",className:"text-sm",children:[R(v.length)," total discounted transactions"]})]}),e.jsxs(ce,{defaultValue:"categories",className:"w-full",children:[e.jsxs(ie,{className:"grid w-full grid-cols-4 mb-6 bg-white shadow-sm",children:[e.jsxs(O,{value:"categories",className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"Categories"]}),e.jsxs(O,{value:"products",className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"Products"]}),e.jsxs(O,{value:"soldBy",className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4"}),"Sold By"]}),e.jsxs(O,{value:"payment",className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Payment Method"]})]}),e.jsx(F,{value:"categories",children:j(u.categories,e.jsx(z,{className:"w-5 h-5"}),"Categories","category")}),e.jsx(F,{value:"products",children:j(u.products,e.jsx(z,{className:"w-5 h-5"}),"Products","product")}),e.jsx(F,{value:"soldBy",children:j(u.soldBy,e.jsx(je,{className:"w-5 h-5"}),"Staff","soldBy")}),e.jsx(F,{value:"payment",children:j(u.paymentMethods,e.jsx(le,{className:"w-5 h-5"}),"Payment Methods","paymentMethod")})]})]})},tt=({data:v,onRowClick:g})=>{const[P,x]=M.useState(""),[A,u]=M.useState("paymentDate"),[j,n]=M.useState("desc"),[s,t]=M.useState(1),l=50,w=M.useMemo(()=>{let D=v.filter(C=>{const i=P.toLowerCase();return C.customerName?.toLowerCase().includes(i)||C.customerEmail?.toLowerCase().includes(i)||C.cleanedProduct?.toLowerCase().includes(i)||C.cleanedCategory?.toLowerCase().includes(i)||C.calculatedLocation?.toLowerCase().includes(i)||C.soldBy?.toLowerCase().includes(i)});return D.sort((C,i)=>{let b=C[A],h=i[A];return typeof b=="number"&&typeof h=="number"?j==="asc"?b-h:h-b:typeof b=="string"&&typeof h=="string"?j==="asc"?b.localeCompare(h):h.localeCompare(b):0}),D},[v,P,A,j]),p=Math.ceil(w.length/l),a=w.slice((s-1)*l,s*l),o=M.useMemo(()=>{const D=w.reduce((h,V)=>h+(V.discountAmount||0),0),C=w.reduce((h,V)=>h+(V.paymentValue||0),0),i=w.reduce((h,V)=>h+(V.mrpPostTax||0),0),b=w.length>0?w.reduce((h,V)=>h+(V.discountPercentage||0),0)/w.length:0;return{totalDiscount:D,totalRevenue:C,totalMrp:i,avgDiscountPercentage:b,totalTransactions:w.length}},[w]),c=D=>{A===D?n(j==="asc"?"desc":"asc"):(u(D),n("desc"))},N=D=>{g&&g(`Transaction Details - ${D.customerName}`,[D],"transaction-detail")},T=D=>A!==D?null:j==="asc"?e.jsx(Ie,{className:"w-4 h-4"}):e.jsx(ae,{className:"w-4 h-4"}),E=D=>D>=50?"destructive":D>=25?"secondary":"default";return e.jsxs(S,{className:"shadow-xl border-0 bg-gradient-to-br from-white via-slate-50 to-blue-50/30",children:[e.jsx(K,{className:"bg-gradient-to-r from-slate-800 via-slate-700 to-slate-600 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg backdrop-blur-sm",children:e.jsx(oe,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx(L,{className:"text-2xl font-bold",children:"Detailed Discount Analysis"}),e.jsx("p",{className:"text-slate-200 mt-1",children:"Comprehensive transaction-level discount data with advanced filtering"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(Oe,{placeholder:"Search transactions...",value:P,onChange:D=>x(D.target.value),className:"pl-10 bg-white/10 border-white/20 text-white placeholder:text-slate-300"})]}),e.jsxs(Y,{variant:"outline",size:"sm",className:"bg-white/10 border-white/20 text-white hover:bg-white/20",children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Export"]})]})]})}),e.jsxs(B,{className:"p-0",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 border-b",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-700",children:R(o.totalTransactions)}),e.jsx("div",{className:"text-sm text-slate-500",children:"Total Transactions"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:m(o.totalDiscount)}),e.jsx("div",{className:"text-sm text-slate-500",children:"Total Discount"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:m(o.totalRevenue)}),e.jsx("div",{className:"text-sm text-slate-500",children:"Total Revenue"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:m(o.totalMrp)}),e.jsx("div",{className:"text-sm text-slate-500",children:"Total MRP"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:$(o.avgDiscountPercentage)}),e.jsx("div",{className:"text-sm text-slate-500",children:"Avg Discount %"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(J,{children:[e.jsx(Z,{className:"bg-gradient-to-br from-indigo-800 to-blue-900 ",children:e.jsxs(I,{className:"bg-gradient-to-br from-gray-800 to-indigo-900",children:[e.jsx(k,{className:"cursor-pointer",onClick:()=>c("paymentDate"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Date ",T("paymentDate")]})}),e.jsx(k,{className:"cursor-pointer",onClick:()=>c("customerName"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Customer ",T("customerName")]})}),e.jsx(k,{onClick:()=>c("cleanedProduct"),className:"cursor-pointer bg-gradient-to-br from-gray-800 to-indigo-900 ",children:e.jsxs("div",{className:"flex items-center gap-2",children:["Product ",T("cleanedProduct")]})}),e.jsx(k,{className:"cursor-pointer text-right",onClick:()=>c("mrpPostTax"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:["MRP ",T("mrpPostTax")]})}),e.jsx(k,{className:"cursor-pointer text-right",onClick:()=>c("discountAmount"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:["Discount ",T("discountAmount")]})}),e.jsx(k,{className:"cursor-pointer text-right",onClick:()=>c("discountPercentage"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:["Discount % ",T("discountPercentage")]})}),e.jsx(k,{className:"cursor-pointer text-right",onClick:()=>c("paymentValue"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:["Final Amount ",T("paymentValue")]})}),e.jsx(k,{children:"Location"}),e.jsx(k,{children:"Sold By"}),e.jsx(k,{className:"text-center",children:"Actions"})]})}),e.jsx(ee,{children:a.map((D,C)=>e.jsxs(I,{className:"hover:cursor-pointer",children:[e.jsx(d,{className:"font-medium",children:new Date(D.paymentDate).toLocaleDateString()}),e.jsx(d,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-700",children:D.customerName}),e.jsx("div",{className:"text-sm text-slate-500",children:D.customerEmail})]})}),e.jsx(d,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-700",children:D.cleanedProduct}),e.jsx("div",{className:"text-sm text-slate-500",children:D.cleanedCategory})]})}),e.jsx(d,{className:"text-right font-medium",children:m(D.mrpPostTax||0)}),e.jsx(d,{className:"text-right",children:e.jsxs("span",{className:"font-semibold text-red-600",children:["-",m(D.discountAmount||0)]})}),e.jsx(d,{className:"text-right",children:e.jsx(U,{variant:E(D.discountPercentage||0),children:$(D.discountPercentage||0)})}),e.jsx(d,{className:"text-right font-semibold text-green-600",children:m(D.paymentValue||0)}),e.jsx(d,{children:e.jsx("span",{className:"text-sm text-slate-600",children:D.calculatedLocation})}),e.jsx(d,{children:e.jsx("span",{className:"text-sm text-slate-600",children:D.soldBy})}),e.jsx(d,{className:"text-center",children:e.jsx(Y,{variant:"outline",size:"sm",onClick:()=>N(D),className:"hover:bg-blue-50",children:e.jsx(se,{className:"w-4 h-4"})})})]},`${D.saleItemId}-${C}`))}),e.jsx(ne,{children:e.jsxs(I,{children:[e.jsxs(d,{colSpan:3,className:"font-bold",children:["Summary (",R(o.totalTransactions)," transactions)"]}),e.jsx(d,{className:"text-right font-bold",children:m(o.totalMrp)}),e.jsxs(d,{className:"text-right font-bold text-red-600",children:["-",m(o.totalDiscount)]}),e.jsx(d,{className:"text-right font-bold",children:$(o.avgDiscountPercentage)}),e.jsx(d,{className:"text-right font-bold text-green-600",children:m(o.totalRevenue)}),e.jsx(d,{colSpan:3})]})})]})}),p>1&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-t bg-slate-50",children:[e.jsxs("div",{className:"text-sm text-slate-600",children:["Showing ",(s-1)*l+1," to ",Math.min(s*l,w.length)," of ",w.length," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{variant:"outline",size:"sm",onClick:()=>t(Math.max(1,s-1)),disabled:s===1,children:"Previous"}),e.jsxs("span",{className:"text-sm text-slate-600",children:["Page ",s," of ",p]}),e.jsx(Y,{variant:"outline",size:"sm",onClick:()=>t(Math.min(p,s+1)),disabled:s===p,children:"Next"})]})]})]})]})},st=({data:v,onDrillDown:g})=>{const P=M.useMemo(()=>{const n=v.reduce((s,t)=>{const l=t.cleanedProduct||"Unknown Product";return s[l]||(s[l]={product:l,category:t.cleanedCategory||"Unknown",transactions:0,totalDiscount:0,totalRevenue:0,totalMrp:0,avgDiscountPercentage:0,data:[]}),s[l].transactions+=1,s[l].totalDiscount+=t.discountAmount||0,s[l].totalRevenue+=t.paymentValue||0,s[l].totalMrp+=t.mrpPostTax||0,s[l].data.push(t),s},{});return Object.values(n).map(s=>({...s,avgDiscountPercentage:s.totalMrp>0?s.totalDiscount/s.totalMrp*100:0,discountRate:s.transactions>0?s.totalDiscount/s.transactions:0})).sort((s,t)=>t.totalDiscount-s.totalDiscount)},[v]),x=M.useMemo(()=>{const n=v.reduce((s,t)=>{const l=t.calculatedLocation||"Unknown Location";return s[l]||(s[l]={location:l,transactions:0,totalDiscount:0,totalRevenue:0,totalMrp:0,uniqueCustomers:new Set,data:[]}),s[l].transactions+=1,s[l].totalDiscount+=t.discountAmount||0,s[l].totalRevenue+=t.paymentValue||0,s[l].totalMrp+=t.mrpPostTax||0,s[l].uniqueCustomers.add(t.customerEmail),s[l].data.push(t),s},{});return Object.values(n).map(s=>({...s,uniqueCustomers:s.uniqueCustomers.size,avgDiscountPercentage:s.totalMrp>0?s.totalDiscount/s.totalMrp*100:0,avgDiscountPerTransaction:s.transactions>0?s.totalDiscount/s.transactions:0})).sort((s,t)=>t.totalDiscount-s.totalDiscount)},[v]),A=M.useMemo(()=>{const n=v.reduce((s,t)=>{const l=t.soldBy||"Unknown";return s[l]||(s[l]={staff:l,transactions:0,totalDiscount:0,totalRevenue:0,totalMrp:0,data:[]}),s[l].transactions+=1,s[l].totalDiscount+=t.discountAmount||0,s[l].totalRevenue+=t.paymentValue||0,s[l].totalMrp+=t.mrpPostTax||0,s[l].data.push(t),s},{});return Object.values(n).map(s=>({...s,avgDiscountPercentage:s.totalMrp>0?s.totalDiscount/s.totalMrp*100:0,discountRate:s.transactions>0?s.totalDiscount/s.transactions:0})).sort((s,t)=>t.totalDiscount-s.totalDiscount)},[v]),u=(n,s,t)=>{g&&g(n,s,t)},j=n=>n>=40?{variant:"destructive",label:"High"}:n>=20?{variant:"secondary",label:"Medium"}:{variant:"default",label:"Low"};return e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(S,{className:"shadow-xl border-0 bg-gradient-to-br from-white via-orange-50/30 to-amber-50/20",children:[e.jsx(K,{className:"bg-gradient-to-r from-slate-800 via-slate-700 to-slate-600 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg backdrop-blur-sm",children:e.jsx(z,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx(L,{className:"text-2xl font-bold",children:"Product-wise Discount Breakdown"}),e.jsx("p",{className:"text-slate-200 mt-1",children:"Discount performance analysis by product category"})]})]})}),e.jsx(B,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(J,{children:[e.jsx(Z,{children:e.jsxs(I,{children:[e.jsx(k,{children:"Product"}),e.jsx(k,{children:"Category"}),e.jsx(k,{className:"text-center",children:"Transactions"}),e.jsx(k,{className:"text-right",children:"Total Discount"}),e.jsx(k,{className:"text-right",children:"Avg Discount %"}),e.jsx(k,{className:"text-right",children:"Total Revenue"}),e.jsx(k,{className:"text-right",children:"Discount Impact"}),e.jsx(k,{className:"text-center",children:"Actions"})]})}),e.jsx(ee,{children:P.slice(0,10).map((n,s)=>{const t=j(n.avgDiscountPercentage);return e.jsxs(I,{children:[e.jsx(d,{className:"font-medium",children:e.jsx("div",{className:"max-w-[200px] truncate",title:n.product,children:n.product})}),e.jsx(d,{children:e.jsx("span",{className:"text-sm text-slate-600",children:n.category})}),e.jsx(d,{className:"text-center",children:e.jsx(U,{variant:"outline",children:R(n.transactions)})}),e.jsx(d,{className:"text-right font-semibold text-red-600",children:m(n.totalDiscount)}),e.jsx(d,{className:"text-right",children:e.jsx(U,{variant:t.variant,children:$(n.avgDiscountPercentage)})}),e.jsx(d,{className:"text-right font-semibold text-green-600",children:m(n.totalRevenue)}),e.jsx(d,{className:"text-right",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:m(n.discountRate)}),e.jsx("div",{className:"text-slate-500",children:"per transaction"})]})}),e.jsx(d,{className:"text-center",children:e.jsx(Y,{variant:"outline",size:"sm",onClick:()=>u(`${n.product} - Discount Analysis`,n.data,"product-discount"),className:"hover:bg-orange-50",children:e.jsx(se,{className:"w-4 h-4"})})})]},s)})}),e.jsx(ne,{children:e.jsxs(I,{children:[e.jsx(d,{colSpan:2,className:"font-bold",children:"Total (Top 10)"}),e.jsx(d,{className:"text-center font-bold",children:R(P.slice(0,10).reduce((n,s)=>n+s.transactions,0))}),e.jsx(d,{className:"text-right font-bold text-red-600",children:m(P.slice(0,10).reduce((n,s)=>n+s.totalDiscount,0))}),e.jsx(d,{className:"text-right font-bold",children:$(P.slice(0,10).reduce((n,s)=>n+s.avgDiscountPercentage,0)/Math.min(10,P.length))}),e.jsx(d,{className:"text-right font-bold text-green-600",children:m(P.slice(0,10).reduce((n,s)=>n+s.totalRevenue,0))}),e.jsx(d,{colSpan:2})]})})]})})})]}),e.jsxs(S,{className:"shadow-xl border-0 bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20",children:[e.jsx(K,{className:"bg-gradient-to-r from-slate-800 via-slate-700 to-slate-600 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg backdrop-blur-sm",children:e.jsx(fe,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx(L,{className:"text-2xl font-bold",children:"Location-wise Discount Breakdown"}),e.jsx("p",{className:"text-slate-200 mt-1",children:"Geographic analysis of discount utilization patterns"})]})]})}),e.jsx(B,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(J,{children:[e.jsx(Z,{children:e.jsxs(I,{children:[e.jsx(k,{children:"Location"}),e.jsx(k,{className:"text-center",children:"Transactions"}),e.jsx(k,{className:"text-center",children:"Customers"}),e.jsx(k,{className:"text-right",children:"Total Discount"}),e.jsx(k,{className:"text-right",children:"Avg Discount %"}),e.jsx(k,{className:"text-right",children:"Avg per Transaction"}),e.jsx(k,{className:"text-right",children:"Total Revenue"}),e.jsx(k,{className:"text-center",children:"Actions"})]})}),e.jsx(ee,{children:x.map((n,s)=>{const t=j(n.avgDiscountPercentage);return e.jsxs(I,{children:[e.jsx(d,{className:"font-medium",children:n.location}),e.jsx(d,{className:"text-center",children:e.jsx(U,{variant:"outline",children:R(n.transactions)})}),e.jsx(d,{className:"text-center",children:e.jsx(U,{variant:"secondary",children:R(n.uniqueCustomers)})}),e.jsx(d,{className:"text-right font-semibold text-red-600",children:m(n.totalDiscount)}),e.jsx(d,{className:"text-right",children:e.jsx(U,{variant:t.variant,children:$(n.avgDiscountPercentage)})}),e.jsx(d,{className:"text-right font-medium",children:m(n.avgDiscountPerTransaction)}),e.jsx(d,{className:"text-right font-semibold text-green-600",children:m(n.totalRevenue)}),e.jsx(d,{className:"text-center",children:e.jsx(Y,{variant:"outline",size:"sm",onClick:()=>u(`${n.location} - Discount Analysis`,n.data,"location-discount"),className:"hover:bg-blue-50",children:e.jsx(se,{className:"w-4 h-4"})})})]},s)})}),e.jsx(ne,{children:e.jsxs(I,{children:[e.jsx(d,{className:"font-bold",children:"Total"}),e.jsx(d,{className:"text-center font-bold",children:R(x.reduce((n,s)=>n+s.transactions,0))}),e.jsx(d,{className:"text-center font-bold",children:R(x.reduce((n,s)=>n+s.uniqueCustomers,0))}),e.jsx(d,{className:"text-right font-bold text-red-600",children:m(x.reduce((n,s)=>n+s.totalDiscount,0))}),e.jsx(d,{className:"text-right font-bold",children:$(x.reduce((n,s)=>n+s.avgDiscountPercentage,0)/x.length)}),e.jsx(d,{className:"text-right font-bold",children:m(x.reduce((n,s)=>n+s.avgDiscountPerTransaction,0)/x.length)}),e.jsx(d,{className:"text-right font-bold text-green-600",children:m(x.reduce((n,s)=>n+s.totalRevenue,0))}),e.jsx(d,{})]})})]})})})]}),e.jsxs(S,{className:"shadow-xl border-0 bg-gradient-to-br from-white via-purple-50/30 to-pink-50/20",children:[e.jsx(K,{className:"bg-gradient-to-r from-slate-800 via-slate-700 to-slate-600 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg backdrop-blur-sm",children:e.jsx(me,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx(L,{className:"text-2xl font-bold",children:"Staff-wise Discount Breakdown"}),e.jsx("p",{className:"text-slate-200 mt-1",children:"Analysis of discount authorization by sales staff"})]})]})}),e.jsx(B,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(J,{children:[e.jsx(Z,{children:e.jsxs(I,{children:[e.jsx(k,{children:"Staff Member"}),e.jsx(k,{className:"text-center",children:"Transactions"}),e.jsx(k,{className:"text-right",children:"Total Discount"}),e.jsx(k,{className:"text-right",children:"Avg Discount %"}),e.jsx(k,{className:"text-right",children:"Discount per Sale"}),e.jsx(k,{className:"text-right",children:"Total Revenue"}),e.jsx(k,{className:"text-center",children:"Performance"}),e.jsx(k,{className:"text-center",children:"Actions"})]})}),e.jsx(ee,{children:A.map((n,s)=>{const t=j(n.avgDiscountPercentage);return e.jsxs(I,{children:[e.jsx(d,{className:"font-medium",children:n.staff}),e.jsx(d,{className:"text-center",children:e.jsx(U,{variant:"outline",children:R(n.transactions)})}),e.jsx(d,{className:"text-right font-semibold text-red-600",children:m(n.totalDiscount)}),e.jsx(d,{className:"text-right",children:e.jsx(U,{variant:t.variant,children:$(n.avgDiscountPercentage)})}),e.jsx(d,{className:"text-right font-medium",children:m(n.discountRate)}),e.jsx(d,{className:"text-right font-semibold text-green-600",children:m(n.totalRevenue)}),e.jsx(d,{className:"text-center",children:e.jsx(U,{variant:t.variant,children:t.label})}),e.jsx(d,{className:"text-center",children:e.jsx(Y,{variant:"outline",size:"sm",onClick:()=>u(`${n.staff} - Discount Analysis`,n.data,"staff-discount"),className:"hover:bg-purple-50",children:e.jsx(se,{className:"w-4 h-4"})})})]},s)})}),e.jsx(ne,{children:e.jsxs(I,{children:[e.jsx(d,{className:"font-bold",children:"Total"}),e.jsx(d,{className:"text-center font-bold",children:R(A.reduce((n,s)=>n+s.transactions,0))}),e.jsx(d,{className:"text-right font-bold text-red-600",children:m(A.reduce((n,s)=>n+s.totalDiscount,0))}),e.jsx(d,{className:"text-right font-bold",children:$(A.reduce((n,s)=>n+s.avgDiscountPercentage,0)/A.length)}),e.jsx(d,{className:"text-right font-bold",children:m(A.reduce((n,s)=>n+s.discountRate,0)/A.length)}),e.jsx(d,{className:"text-right font-bold text-green-600",children:m(A.reduce((n,s)=>n+s.totalRevenue,0))}),e.jsx(d,{colSpan:2})]})})]})})})]})]})},ke=["#8b5cf6","#06b6d4","#10b981","#f59e0b","#ef4444","#6366f1","#ec4899","#84cc16"],nt=({isOpen:v,onClose:g,title:P,data:x,type:A})=>{const u=M.useMemo(()=>{if(!x||x.length===0)return null;const t=x.reduce((i,b)=>i+(b.discountAmount||0),0),l=x.reduce((i,b)=>i+(b.paymentValue||0),0),w=x.length,p=new Set(x.map(i=>i.customerEmail)).size,a=t/x.length,o=x.reduce((i,b)=>i+(b.discountPercentage||0),0)/x.length,c=x.reduce((i,b)=>{const h=b.cleanedCategory||"Unknown";return i[h]||(i[h]={discountAmount:0,revenue:0,units:0,customers:new Set}),i[h].discountAmount+=b.discountAmount||0,i[h].revenue+=b.paymentValue||0,i[h].units+=1,i[h].customers.add(b.customerEmail),i},{}),N=x.reduce((i,b)=>{const h=b.cleanedProduct||"Unknown";return i[h]||(i[h]={discountAmount:0,revenue:0,units:0,customers:new Set}),i[h].discountAmount+=b.discountAmount||0,i[h].revenue+=b.paymentValue||0,i[h].units+=1,i[h].customers.add(b.customerEmail),i},{}),T=x.reduce((i,b)=>{const h=b.calculatedLocation||"Unknown";return i[h]||(i[h]={discountAmount:0,revenue:0,units:0,customers:new Set}),i[h].discountAmount+=b.discountAmount||0,i[h].revenue+=b.paymentValue||0,i[h].units+=1,i[h].customers.add(b.customerEmail),i},{}),E=x.reduce((i,b)=>{const h=b.paymentMethod||"Unknown";return i[h]||(i[h]={discountAmount:0,revenue:0,units:0,customers:new Set}),i[h].discountAmount+=b.discountAmount||0,i[h].revenue+=b.paymentValue||0,i[h].units+=1,i[h].customers.add(b.customerEmail),i},{}),D=x.reduce((i,b)=>{if(!b.paymentDate)return i;const h=new Date(b.paymentDate),V=`${h.getFullYear()}-${(h.getMonth()+1).toString().padStart(2,"0")}`,r=h.toLocaleDateString("en-US",{month:"short",year:"numeric"});return i[V]||(i[V]={month:r,discountAmount:0,revenue:0,units:0,customers:new Set}),i[V].discountAmount+=b.discountAmount||0,i[V].revenue+=b.paymentValue||0,i[V].units+=1,i[V].customers.add(b.customerEmail),i},{}),C=i=>Object.entries(i).map(([b,h])=>({name:b,discountAmount:h.discountAmount,revenue:h.revenue,units:h.units,customers:h.customers.size,avgDiscount:h.units>0?h.discountAmount/h.units:0,discountRate:h.revenue>0?h.discountAmount/h.revenue*100:0})).sort((b,h)=>h.discountAmount-b.discountAmount);return{summary:{totalDiscount:t,totalRevenue:l,totalUnits:w,uniqueCustomers:p,avgDiscount:a,avgDiscountPercent:o,discountRate:l>0?t/l*100:0},categoryBreakdown:C(c),productBreakdown:C(N),locationBreakdown:C(T),paymentBreakdown:C(E),monthlyTrend:Object.values(D).map(i=>({...i,customers:i.customers.size,avgDiscount:i.units>0?i.discountAmount/i.units:0,discountRate:i.revenue>0?i.discountAmount/i.revenue*100:0})).sort((i,b)=>i.month.localeCompare(b.month))}},[x]);if(!u)return null;const j=()=>e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(S,{className:"bg-gradient-to-br from-red-50 to-rose-50 border-red-200",children:e.jsxs(B,{className:"p-4 text-center",children:[e.jsx(ae,{className:"w-8 h-8 text-red-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-red-700",children:"Total Discount"}),e.jsx("p",{className:"text-xl font-bold text-red-800",children:m(u.summary.totalDiscount)})]})}),e.jsx(S,{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200",children:e.jsxs(B,{className:"p-4 text-center",children:[e.jsx(ve,{className:"w-8 h-8 text-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-blue-700",children:"Units Sold"}),e.jsx("p",{className:"text-xl font-bold text-blue-800",children:R(u.summary.totalUnits)})]})}),e.jsx(S,{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-green-200",children:e.jsxs(B,{className:"p-4 text-center",children:[e.jsx(xe,{className:"w-8 h-8 text-green-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-green-700",children:"Revenue"}),e.jsx("p",{className:"text-xl font-bold text-green-800",children:m(u.summary.totalRevenue)})]})}),e.jsx(S,{className:"bg-gradient-to-br from-purple-50 to-violet-50 border-purple-200",children:e.jsxs(B,{className:"p-4 text-center",children:[e.jsx(me,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-purple-700",children:"Customers"}),e.jsx("p",{className:"text-xl font-bold text-purple-800",children:R(u.summary.uniqueCustomers)})]})})]}),n=()=>{switch(A){case"categories":return e.jsx(H,{width:"100%",height:300,children:e.jsxs(de,{data:u.categoryBreakdown.slice(0,10),children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name"}),e.jsx(W,{}),e.jsx(q,{formatter:t=>m(t)}),e.jsx(ue,{}),e.jsx(X,{dataKey:"discountAmount",fill:"#ef4444",name:"Discount Amount"}),e.jsx(X,{dataKey:"revenue",fill:"#10b981",name:"Revenue"})]})});case"monthly-trend":return e.jsx(H,{width:"100%",height:300,children:e.jsxs(be,{data:u.monthlyTrend,children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"month"}),e.jsx(W,{}),e.jsx(q,{formatter:t=>m(t)}),e.jsx(ue,{}),e.jsx(te,{type:"monotone",dataKey:"discountAmount",stroke:"#ef4444",name:"Discount Amount"}),e.jsx(te,{type:"monotone",dataKey:"revenue",stroke:"#10b981",name:"Revenue"})]})});case"payment-methods":return e.jsx(H,{width:"100%",height:300,children:e.jsxs(Ce,{children:[e.jsx(Se,{data:u.paymentBreakdown.slice(0,8),cx:"50%",cy:"50%",labelLine:!1,label:({name:t,percent:l})=>`${t} ${(l*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"discountAmount",children:u.paymentBreakdown.slice(0,8).map((t,l)=>e.jsx(Me,{fill:ke[l%ke.length]},`cell-${l}`))}),e.jsx(q,{formatter:t=>m(t)})]})});default:return null}},s=()=>{let t=[],l=[];switch(A){case"categories":t=u.categoryBreakdown,l=[{key:"name",label:"Category",icon:z},{key:"discountAmount",label:"Discount Amount",format:m},{key:"revenue",label:"Revenue",format:m},{key:"units",label:"Units Sold",format:R},{key:"customers",label:"Customers",format:R},{key:"discountRate",label:"Discount Rate",format:w=>`${w.toFixed(1)}%`}];break;case"locations":t=u.locationBreakdown,l=[{key:"name",label:"Location",icon:fe},{key:"discountAmount",label:"Discount Amount",format:m},{key:"revenue",label:"Revenue",format:m},{key:"units",label:"Units Sold",format:R},{key:"customers",label:"Customers",format:R},{key:"discountRate",label:"Discount Rate",format:w=>`${w.toFixed(1)}%`}];break;case"payment-methods":t=u.paymentBreakdown,l=[{key:"name",label:"Payment Method",icon:le},{key:"discountAmount",label:"Discount Amount",format:m},{key:"revenue",label:"Revenue",format:m},{key:"units",label:"Units Sold",format:R},{key:"customers",label:"Customers",format:R},{key:"discountRate",label:"Discount Rate",format:w=>`${w.toFixed(1)}%`}];break;case"monthly-trend":t=u.monthlyTrend,l=[{key:"month",label:"Month",icon:re},{key:"discountAmount",label:"Discount Amount",format:m},{key:"revenue",label:"Revenue",format:m},{key:"units",label:"Units Sold",format:R},{key:"customers",label:"Customers",format:R},{key:"discountRate",label:"Discount Rate",format:w=>`${w.toFixed(1)}%`}];break;default:return null}return e.jsxs(S,{children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"Detailed Breakdown"]})}),e.jsx(B,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(J,{children:[e.jsx(Z,{children:e.jsx(I,{children:l.map(w=>e.jsx(k,{className:"font-semibold",children:e.jsxs("div",{className:"flex items-center gap-2",children:[w.icon&&e.jsx(w.icon,{className:"w-4 h-4"}),w.label]})},w.key))})}),e.jsx(ee,{children:t.slice(0,20).map((w,p)=>e.jsx(I,{className:"hover:bg-gray-50",children:l.map(a=>e.jsx(d,{children:a.format?a.format(w[a.key]):w[a.key]},a.key))},p))})]})})})]})};return e.jsx(Fe,{open:v,onOpenChange:g,children:e.jsxs(Ee,{className:"max-w-6xl max-h-[90vh]",children:[e.jsx(ze,{children:e.jsxs(He,{className:"text-xl font-bold text-gray-900",children:[P," - Detailed Analysis"]})}),e.jsx(qe,{className:"max-h-[calc(90vh-120px)]",children:e.jsxs("div",{className:"space-y-6 pr-4",children:[j(),n()&&e.jsxs(S,{children:[e.jsx(K,{children:e.jsx(L,{children:"Visual Analysis"})}),e.jsx(B,{children:n()})]}),s()]})})]})})},Ae=[{id:"all",name:"All Locations"},{id:"kwality",name:"Kwality House, Kemps Corner"},{id:"supreme",name:"Supreme HQ, Bandra"},{id:"kenkere",name:"Kenkere House"}],Pe=()=>{const v=new Date,g=new Date(v.getFullYear(),v.getMonth(),1),P=new Date(v.getFullYear(),v.getMonth()+1,0),x=A=>A.toISOString().split("T")[0];return{start:x(g),end:x(P)}},ut=({data:v})=>{const[g,P]=M.useState("all"),[x,A]=M.useState({dateRange:{start:null,end:null},category:[],product:[],soldBy:[],paymentMethod:[]}),[u,j]=M.useState({isOpen:!1,title:"",data:[],type:""});M.useEffect(()=>{const o=Pe();A(c=>({...c,dateRange:{start:o.start,end:o.end}}))},[]);const n=(o,c=!1)=>{let N=o.slice();if(g!=="all"&&(N=N.filter(T=>g==="kwality"?T.calculatedLocation==="Kwality House, Kemps Corner":g==="supreme"?T.calculatedLocation==="Supreme HQ, Bandra":T.calculatedLocation?.includes("Kenkere")||T.calculatedLocation==="Kenkere House")),!c&&(x.dateRange.start||x.dateRange.end)){const T=x.dateRange.start?new Date(x.dateRange.start):null,E=x.dateRange.end?(()=>{const D=new Date(x.dateRange.end);return D.setHours(23,59,59,999),D})():null;(T||E)&&(N=N.filter(D=>{if(!D.paymentDate)return!1;let C;if(D.paymentDate.includes("/"))if(D.paymentDate.includes(" ")){const[b]=D.paymentDate.split(" "),[h,V,r]=b.split("/");C=new Date(parseInt(h),parseInt(V)-1,parseInt(r))}else{const[b,h,V]=D.paymentDate.split("/");C=new Date(parseInt(V),parseInt(h)-1,parseInt(b))}else C=new Date(D.paymentDate);return!C||isNaN(C.getTime())?!1:(!T||C>=T)&&(!E||C<=E)}))}return x.category&&x.category.length>0&&(N=N.filter(T=>x.category.includes(T.cleanedCategory||"Uncategorized"))),x.product&&x.product.length>0&&(N=N.filter(T=>x.product.includes(T.cleanedProduct||T.paymentItem||"Unknown"))),x.soldBy&&x.soldBy.length>0&&(N=N.filter(T=>x.soldBy.includes(T.soldBy||"Unknown"))),x.paymentMethod&&x.paymentMethod.length>0&&(N=N.filter(T=>x.paymentMethod.includes(T.paymentMethod||"Unknown"))),N},s=M.useMemo(()=>n(v),[v,x,g]),t=M.useMemo(()=>n(v,!0),[v,g]),l=M.useMemo(()=>s,[s]);M.useMemo(()=>s.filter(c=>(c.discountAmount||0)>0),[s]);const w=o=>{j({isOpen:!0,title:`${o.title} Analysis`,data:o.rawData||s,type:"metric"})},p=(o,c,N)=>{j({isOpen:!0,title:o,data:c,type:N})},a=()=>{const o=Pe();A({dateRange:{start:o.start,end:o.end},category:[],product:[],soldBy:[],paymentMethod:[]})};return e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"container mx-auto px-6",children:e.jsx(Ye,{})}),e.jsx("div",{className:"container mx-auto px-6 space-y-6",children:e.jsxs(ce,{value:g,onValueChange:P,className:"w-full",children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx(ie,{className:"bg-white/90 backdrop-blur-sm p-2 rounded-2xl shadow-xl border-0 grid grid-cols-4 w-full max-w-7xl min-h-24 overflow-hidden",children:Ae.map(o=>e.jsx(O,{value:o.id,className:"relative px-6 py-4 font-semibold text-gray-800 transition-all duration-300 ease-out hover:scale-105 data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-600 data-[state=active]:to-amber-600 data-[state=active]:text-white data-[state=active]:shadow-lg hover:bg-gray-50 text-2xl rounded-2xl",children:e.jsxs("div",{className:"relative z-10 text-center",children:[e.jsx("div",{className:"font-bold",children:o.name.split(",")[0]}),e.jsx("div",{className:"text-xs opacity-80",children:o.name.split(",")[1]?.trim()})]})},o.id))})}),Ae.map(o=>e.jsxs(F,{value:o.id,className:"space-y-8",children:[e.jsx("div",{className:"w-full",children:e.jsx(_e,{filters:x,onFiltersChange:A,onReset:a})}),e.jsx(Ze,{data:l,onMetricClick:w}),e.jsx(we,{data:t}),e.jsx(et,{data:l,onDrillDown:p}),e.jsxs(ce,{defaultValue:"detailed",className:"space-y-6",children:[e.jsxs(ie,{className:"grid w-full grid-cols-3 bg-gradient-to-r from-orange-100 via-amber-100 to-yellow-100 p-1 rounded-xl shadow-lg border border-orange-200/50",children:[e.jsx(O,{value:"detailed",className:"data-[state=active]:bg-white data-[state=active]:shadow-lg data-[state=active]:text-orange-800 font-semibold transition-all duration-300",children:"Data Tables"}),e.jsx(O,{value:"breakdown",className:"data-[state=active]:bg-white data-[state=active]:shadow-lg data-[state=active]:text-orange-800 font-semibold transition-all duration-300",children:"Breakdowns"}),e.jsx(O,{value:"analytics",className:"data-[state=active]:bg-white data-[state=active]:shadow-lg data-[state=active]:text-orange-800 font-semibold transition-all duration-300",children:"Analytics"})]}),e.jsx(F,{value:"analytics",className:"space-y-6",children:e.jsx(we,{data:l})}),e.jsx(F,{value:"detailed",className:"space-y-6",children:e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-xl p-6 border border-orange-200/50",children:e.jsx(tt,{data:l,onRowClick:(c,N,T)=>p(c,N,T)})})}),e.jsx(F,{value:"breakdown",className:"space-y-6",children:e.jsx(st,{data:l,onDrillDown:p})})]})]},o.id))]})}),e.jsx(nt,{isOpen:u.isOpen,onClose:()=>j({isOpen:!1,title:"",data:[],type:""}),title:u.title,data:u.data,type:u.type})]})},xt=({data:v})=>{const g=v.reduce((s,t)=>s+(t.discountAmount||0),0),P=v.length,x=v.filter(s=>(s.discountAmount||0)>0).length,A=v.reduce((s,t)=>s+(t.paymentValue||0),0),u=A>0?g/(A+g)*100:0,j=[{location:"Total Discounts",label:"Amount saved by customers",value:m(g)},{location:"Discount Rate",label:"Percentage of gross revenue",value:$(u)},{location:"Transactions",label:`${x} of ${P} had discounts`,value:R(x)}],n=e.jsx(Ge,{salesData:v,defaultFileName:"discounts-promotions-filtered",size:"sm",variant:"ghost"});return e.jsx(We,{title:"Discounts & Promotions",subtitle:"Comprehensive analysis of discount strategies, promotional effectiveness, and customer savings patterns",variant:"discounts",metrics:j,exportButton:n})};export{xt as D,dt as E,ut as a};
