import{M as X,a9 as Te,g as Z,f as J,U as _,aa as ue,T as Y,O as ge,h as W,j as e,F as ne,X as le,c as K,i as Q,r as C,a8 as q,Z as Ce,E as ve,s as oe,ab as Se,e as z,a2 as ke,C as se,b as ae,R as pe,w as Ve,ac as Re,W as Me,ad as Ae,a7 as $e,v as De}from"./react-vendor-dqSXVcdP.js";import{C as S,j as P,k as E,B as R,d as O,c as k,D as Fe,S as Ie,f as Pe,g as He,h as Ee,i as Oe,I as ie,v as Ge,w as Ue,x as Ye,y as ze,r as be,s as je,t as U,Y as G,u as B,Z as Be,_ as _e,$ as We,a0 as Ke}from"./ui-components-DsfbLwT7.js";import{f as I,c as M}from"./utils-BhCMrGmG.js";import{c as $}from"./dashboard-classes-C0LoPzks.js";import{R as ce,L as Xe,C as de,X as me,Y as xe,T as re,b as Ze,B as Qe,c as Je,P as qe,d as et,e as tt,a as st}from"./chart-vendor-By6BsRZf.js";import{m as A,A as he}from"./animation-vendor-COY9SM-0.js";const ct=({filters:n,onFiltersChange:g,uniqueValues:N})=>{const h=(i,m)=>{const x=[...n[i]],t=x.includes(m)?x.filter(a=>a!==m):[...x,m];g({...n,[i]:t})},v=i=>{g({...n,dateRange:{start:i.from?i.from.toISOString():"",end:i.to?i.to.toISOString():""}})},b=()=>{const i=new Date,m=new Date(i.getFullYear(),i.getMonth()-1,1),x=new Date(i.getFullYear(),i.getMonth(),0),t=s=>{const r=s.getFullYear(),c=String(s.getMonth()+1).padStart(2,"0"),p=String(s.getDate()).padStart(2,"0");return`${r}-${c}-${p}`},a={start:t(m),end:t(x)};g({dateRange:a,location:[],source:[],stage:[],status:[],associate:[],channel:[],trialStatus:[],conversionStatus:[],retentionStatus:[],minLTV:void 0,maxLTV:void 0})},l=(n.location?.length||0)+(n.source?.length||0)+(n.stage?.length||0)+(n.status?.length||0)+(n.associate?.length||0)+(n.channel?.length||0)+(n.trialStatus?.length||0)+(n.conversionStatus?.length||0)+(n.retentionStatus?.length||0)+(n.minLTV?1:0)+(n.maxLTV?1:0),o=[{key:"location",label:"Location",icon:X,options:N.locations,values:n.location},{key:"source",label:"Source",icon:Te,options:N.sources,values:n.source},{key:"stage",label:"Stage",icon:Z,options:N.stages,values:n.stage},{key:"status",label:"Status",icon:J,options:N.statuses,values:n.status},{key:"associate",label:"Associate",icon:_,options:N.associates,values:n.associate},{key:"channel",label:"Channel",icon:ue,options:N.channels,values:n.channel},{key:"trialStatus",label:"Trial Status",icon:Y,options:N.trialStatuses,values:n.trialStatus},{key:"conversionStatus",label:"Conversion",icon:ge,options:N.conversionStatuses,values:n.conversionStatus},{key:"retentionStatus",label:"Retention",icon:W,options:N.retentionStatuses,values:n.retentionStatus}];return e.jsxs(S,{className:"bg-white/95 backdrop-blur-sm border border-slate-200 shadow-lg",children:[e.jsx(P,{className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(E,{className:"flex items-center gap-2 text-white",children:[e.jsx(ne,{className:"w-5 h-5"}),"Lead Filters",l>0&&e.jsxs(R,{className:"bg-white/20 text-white border-white/30",children:[l," Active"]})]}),e.jsxs(O,{variant:"outline",size:"sm",onClick:b,disabled:l===0,className:"bg-white/10 border-white/30 text-white hover:bg-white/20",children:[e.jsx(le,{className:"w-4 h-4 mr-1"}),"Clear All"]})]})}),e.jsxs(k,{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-blue-600"}),"Date Range"]}),e.jsx(Fe,{value:{from:n.dateRange.start?new Date(n.dateRange.start):void 0,to:n.dateRange.end?new Date(n.dateRange.end):void 0},onChange:v})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(i=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(i.icon,{className:"w-4 h-4 text-blue-600"}),i.label,i.values.length>0&&e.jsx(R,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-700",children:i.values.length})]}),e.jsxs(Ie,{value:"",onValueChange:m=>h(i.key,m),children:[e.jsx(Pe,{className:"h-9",children:e.jsx(He,{placeholder:`Select ${i.label.toLowerCase()}`})}),e.jsx(Ee,{className:"bg-white z-50 max-h-48",children:i.options.map(m=>e.jsx(Oe,{value:m,className:"text-sm",children:m},m))})]}),i.values.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[i.values.slice(0,3).map(m=>e.jsxs(R,{variant:"secondary",className:"text-xs cursor-pointer hover:bg-red-100 bg-slate-100 text-slate-700",onClick:()=>h(i.key,m),children:[m,e.jsx(le,{className:"w-3 h-3 ml-1"})]},m)),i.values.length>3&&e.jsxs(R,{variant:"outline",className:"text-xs",children:["+",i.values.length-3," more"]})]})]},i.key))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-slate-200",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-blue-600"}),"Min LTV"]}),e.jsx(ie,{type:"number",placeholder:"₹0",value:n.minLTV||"",onChange:i=>g({...n,minLTV:i.target.value?parseFloat(i.target.value):void 0}),className:"h-9"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-blue-600"}),"Max LTV"]}),e.jsx(ie,{type:"number",placeholder:"₹100000",value:n.maxLTV||"",onChange:i=>g({...n,maxLTV:i.target.value?parseFloat(i.target.value):void 0}),className:"h-9"})]})]})]})]})},dt=({data:n,onCardClick:g})=>{const[N,h]=C.useState(null),v=C.useMemo(()=>{if(!n||!n.length)return{leadsReceived:0,trialsCompleted:0,trialsScheduled:0,proximityIssues:0,convertedLeads:0,trialToMemberConversion:0,leadToTrialConversion:0,leadToMemberConversion:0,avgLTV:0,avgVisitsPerLead:0,pipelineHealth:0};const l=n.length,o=n.filter(T=>T.stage==="Trial Completed").length,i=n.filter(T=>T.stage?.includes("Trial")).length,m=n.filter(T=>T.stage?.includes("Proximity")||T.remarks?.toLowerCase().includes("proximity")).length,x=n.filter(T=>T.conversionStatus==="Converted").length,t=o>0?x/o*100:0,a=l>0?i/l*100:0,s=l>0?x/l*100:0,r=n.reduce((T,d)=>T+(d.ltv||0),0),c=l>0?r/l:0,p=n.reduce((T,d)=>T+(d.visits||0),0),y=l>0?p/l:0,D=Math.min(100,Math.round(a*.3+t*.4+y*10*.2+(l-m)/l*100*.1));return{leadsReceived:l,trialsCompleted:o,trialsScheduled:i,proximityIssues:m,convertedLeads:x,trialToMemberConversion:t,leadToTrialConversion:a,leadToMemberConversion:s,avgLTV:c,avgVisitsPerLead:y,pipelineHealth:D}},[n]),b=({id:l,title:o,value:i,icon:m,color:x,subtitle:t,trend:a,format:s="number",tooltip:r})=>{const c=y=>{switch(s){case"currency":return I(y);case"percentage":return`${y.toFixed(1)}%`;default:return y.toLocaleString("en-IN")}},p=N===l;return e.jsx(Ge,{children:e.jsxs(Ue,{children:[e.jsx(Ye,{asChild:!0,children:e.jsxs(S,{className:$("group relative overflow-hidden transition-all duration-500 cursor-pointer transform-gpu","bg-gradient-to-br from-white via-slate-50 to-white border-0 shadow-lg hover:shadow-2xl",p?"scale-105 -translate-y-2":"hover:scale-102"),onMouseEnter:()=>h(l),onMouseLeave:()=>h(null),onClick:()=>g?.(o,n,l),children:[e.jsx("div",{className:$("absolute inset-0 opacity-0 transition-opacity duration-500",p&&"opacity-10",x.replace("from-","bg-gradient-to-br from-").replace("to-","to-"))}),e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:$("absolute w-2 h-2 rounded-full opacity-20 transition-all duration-1000",p?"animate-bounce":"transform translate-y-0",x.replace("from-","bg-").split(" ")[0].replace("-400","-300")),style:{top:"20%",left:"80%",animationDelay:p?"0s":"unset"}}),e.jsx("div",{className:$("absolute w-1 h-1 rounded-full opacity-30 transition-all duration-1000",p?"animate-pulse":"opacity-20",x.replace("to-","bg-").split(" ")[1].replace("-600","-400")),style:{top:"60%",left:"15%",animationDelay:p?"0.5s":"unset"}}),e.jsx("div",{className:$("absolute w-1.5 h-1.5 rounded-full opacity-25 transition-all duration-1000",p?"animate-ping":"opacity-15",x.replace("from-","bg-").split(" ")[0].replace("-400","-200")),style:{top:"80%",left:"70%",animationDelay:p?"1s":"unset"}})]}),e.jsxs(k,{className:"p-6 relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:$("p-3 rounded-xl transition-all duration-500 shadow-lg",x.replace("from-","bg-").replace("-400","-100").split(" ")[0],x.replace("to-","text-").replace("-600","-600").split(" ")[1],p&&"rotate-12 scale-110"),children:e.jsx(m,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 leading-tight",children:o}),t&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:t})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:$("text-3xl font-black transition-all duration-500",x.replace("to-","text-").replace("-600","-700").split(" ")[1],p&&"scale-110"),children:c(i)}),a!==void 0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:$("w-4 h-4 transition-colors duration-300",a>0?"text-green-600":a<0?"text-red-600":"text-slate-600")}),e.jsxs("span",{className:$("text-sm font-semibold",a>0?"text-green-600":a<0?"text-red-600":"text-slate-600"),children:[a>0?"+":"",a.toFixed(1),"%"]}),e.jsx("span",{className:"text-xs text-slate-500",children:"vs last period"})]})]})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(Se,{className:"w-4 h-4 text-slate-400"})})]}),s==="percentage"&&e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:$("h-2 rounded-full transition-all duration-1000 ease-out",x.replace("from-","bg-gradient-to-r from-").replace("to-","to-")),style:{width:p?`${Math.min(i,100)}%`:"0%",transitionDelay:"200ms"}})})})]})]})}),e.jsx(ze,{side:"top",className:"max-w-xs",children:e.jsx("p",{className:"text-sm",children:r})})]})})};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(b,{id:"leadsReceived",title:"Leads Received",value:v.leadsReceived,icon:_,color:"from-blue-400 to-blue-600",subtitle:"Total incoming leads",tooltip:"Total number of leads received in the selected period"}),e.jsx(b,{id:"trialsCompleted",title:"Trials Completed",value:v.trialsCompleted,icon:q,color:"from-green-400 to-green-600",subtitle:"Successful trial sessions",tooltip:"Number of trial sessions that were successfully completed"}),e.jsx(b,{id:"trialsScheduled",title:"Trials Scheduled",value:v.trialsScheduled,icon:K,color:"from-purple-400 to-purple-600",subtitle:"Scheduled trial sessions",tooltip:"Total number of trial sessions scheduled"}),e.jsx(b,{id:"proximityIssues",title:"Proximity Issues",value:v.proximityIssues,icon:X,color:"from-red-400 to-red-600",subtitle:"Location-related concerns",tooltip:"Leads lost due to location or proximity concerns"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(b,{id:"convertedLeads",title:"Converted Leads",value:v.convertedLeads,icon:Y,color:"from-emerald-400 to-emerald-600",subtitle:"Successfully converted",tooltip:"Number of leads successfully converted to paying members"}),e.jsx(b,{id:"trialToMemberRate",title:"Trial → Member Rate",value:v.trialToMemberConversion,icon:W,color:"from-cyan-400 to-cyan-600",subtitle:"Trial conversion efficiency",format:"percentage",tooltip:"Percentage of completed trials that converted to memberships"}),e.jsx(b,{id:"leadToTrialRate",title:"Lead → Trial Rate",value:v.leadToTrialConversion,icon:Z,color:"from-indigo-400 to-indigo-600",subtitle:"Lead engagement rate",format:"percentage",tooltip:"Percentage of leads that scheduled and completed trials"}),e.jsx(b,{id:"leadToMemberRate",title:"Lead → Member Rate",value:v.leadToMemberConversion,icon:Ce,color:"from-yellow-400 to-yellow-600",subtitle:"Overall conversion rate",format:"percentage",tooltip:"Overall percentage of leads converted to paying members"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(b,{id:"avgLTV",title:"Average LTV",value:v.avgLTV,icon:Q,color:"from-green-400 to-green-600",subtitle:"Lifetime value per lead",format:"currency",tooltip:"Average lifetime value generated per lead"}),e.jsx(b,{id:"avgVisitsPerLead",title:"Avg Visits/Lead",value:v.avgVisitsPerLead,icon:ve,color:"from-orange-400 to-orange-600",subtitle:"Engagement frequency",tooltip:"Average number of visits per lead during the funnel process"}),e.jsx(b,{id:"pipelineHealth",title:"Pipeline Health",value:v.pipelineHealth,icon:v.pipelineHealth>=70?q:v.pipelineHealth>=50?J:oe,color:v.pipelineHealth>=70?"from-green-400 to-green-600":v.pipelineHealth>=50?"from-yellow-400 to-yellow-600":"from-red-400 to-red-600",subtitle:"Overall funnel performance",format:"percentage",tooltip:"Composite score based on conversion rates, engagement, and lead quality"})]})]})},mt=({data:n})=>{const[g,N]=C.useState("source"),[h,v]=C.useState("volume"),b=C.useMemo(()=>{if(!n||!n.length)return[];switch(g){case"source":{const x=n.reduce((t,a)=>{const s=a.source||"Unknown";return t[s]||(t[s]={name:s,leads:0,converted:0,totalLTV:0}),t[s].leads+=1,a.conversionStatus==="Converted"&&(t[s].converted+=1),t[s].totalLTV+=a.ltv||0,t},{});return Object.values(x).map(t=>({name:t.name,volume:t.leads,conversion:t.leads>0?t.converted/t.leads*100:0,ltv:t.leads>0?t.totalLTV/t.leads:0})).sort((t,a)=>a.volume-t.volume).slice(0,10)}case"stage":{const x=n.reduce((t,a)=>{const s=a.stage||"Unknown";return t[s]||(t[s]={name:s,leads:0,converted:0,totalLTV:0}),t[s].leads+=1,a.conversionStatus==="Converted"&&(t[s].converted+=1),t[s].totalLTV+=a.ltv||0,t},{});return Object.values(x).map(t=>({name:t.name,volume:t.leads,conversion:t.leads>0?t.converted/t.leads*100:0,ltv:t.leads>0?t.totalLTV/t.leads:0})).sort((t,a)=>a.volume-t.volume)}case"timeline":{const x=n.reduce((t,a)=>{if(!a.createdAt)return t;const s=new Date(a.createdAt);if(isNaN(s.getTime()))return t;const r=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`;return t[r]||(t[r]={name:r,leads:0,converted:0,totalLTV:0}),t[r].leads+=1,a.conversionStatus==="Converted"&&(t[r].converted+=1),t[r].totalLTV+=a.ltv||0,t},{});return Object.values(x).map(t=>({name:t.name,volume:t.leads,conversion:t.leads>0?t.converted/t.leads*100:0,ltv:t.leads>0?t.totalLTV/t.leads:0})).sort((t,a)=>t.name.localeCompare(a.name)).slice(-12)}default:return[]}},[n,g]),l=C.useMemo(()=>{if(!n||!n.length)return[];const x=n.reduce((a,s)=>{const r=s.conversionStatus||"Unknown";return a[r]=(a[r]||0)+1,a},{}),t=["#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4"];return Object.entries(x).map(([a,s],r)=>({name:a,value:s,percentage:(s/n.length*100).toFixed(1),color:t[r%t.length]})).sort((a,s)=>s.value-a.value)},[n]),o=()=>{switch(h){case"volume":return"Lead Volume";case"conversion":return"Conversion Rate (%)";case"ltv":return"Average LTV (₹)";default:return"Lead Volume"}},i=({active:x,payload:t,label:a})=>x&&t&&t.length?e.jsxs("div",{className:"bg-white p-4 border border-slate-200 rounded-lg shadow-xl backdrop-blur-sm",children:[e.jsx("p",{className:"font-semibold text-slate-800 mb-2",children:a}),e.jsxs("p",{className:"text-sm text-slate-600",children:[o(),": ",h==="ltv"?I(t[0].value):h==="conversion"?`${t[0].value.toFixed(1)}%`:t[0].value.toLocaleString("en-IN")]})]}):null,m=({active:x,payload:t})=>{if(x&&t&&t.length){const a=t[0].payload;return e.jsxs("div",{className:"bg-white p-4 border border-slate-200 rounded-lg shadow-xl backdrop-blur-sm",children:[e.jsx("p",{className:"font-semibold text-slate-800 mb-2",children:a.name}),e.jsxs("p",{className:"text-sm text-slate-600",children:["Count: ",a.value.toLocaleString("en-IN")," (",a.percentage,"%)"]})]})}return null};return!n||!n.length?e.jsx(S,{className:"w-full bg-white/90 backdrop-blur-sm border-0 shadow-xl",children:e.jsx(k,{className:"p-12",children:e.jsxs("div",{className:"text-center py-8 text-slate-500",children:[e.jsx(z,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No data available for charts"}),e.jsx("p",{className:"text-sm",children:"Adjust your filters to see analytics"})]})})}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs(S,{className:"w-full bg-white/95 backdrop-blur-sm border-0 shadow-2xl overflow-hidden",children:[e.jsxs(P,{className:"bg-gradient-to-r from-slate-900 via-blue-900 to-indigo-900 text-white border-0",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs(E,{className:"flex items-center gap-3 text-white text-xl font-bold",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(z,{className:"w-6 h-6 text-white"})}),g==="source"?"Lead Source Analytics":g==="stage"?"Funnel Stage Analytics":"Timeline Trend Analysis"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(O,{variant:g==="source"?"secondary":"outline",size:"sm",onClick:()=>N("source"),className:$("text-xs font-semibold transition-all duration-200",g==="source"?"bg-white/30 text-white border-white/40 hover:bg-white/40":"bg-white/10 text-white/80 border-white/20 hover:bg-white/20"),children:[e.jsx(_,{className:"w-3 h-3 mr-1"}),"Sources"]}),e.jsxs(O,{variant:g==="stage"?"secondary":"outline",size:"sm",onClick:()=>N("stage"),className:$("text-xs font-semibold transition-all duration-200",g==="stage"?"bg-white/30 text-white border-white/40 hover:bg-white/40":"bg-white/10 text-white/80 border-white/20 hover:bg-white/20"),children:[e.jsx(Y,{className:"w-3 h-3 mr-1"}),"Stages"]}),e.jsxs(O,{variant:g==="timeline"?"secondary":"outline",size:"sm",onClick:()=>N("timeline"),className:$("text-xs font-semibold transition-all duration-200",g==="timeline"?"bg-white/30 text-white border-white/40 hover:bg-white/40":"bg-white/10 text-white/80 border-white/20 hover:bg-white/20"),children:[e.jsx(K,{className:"w-3 h-3 mr-1"}),"Timeline"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[e.jsx(R,{variant:h==="volume"?"secondary":"outline",className:$("cursor-pointer transition-all duration-200 hover:scale-105",h==="volume"?"bg-white/30 text-white border-white/40":"bg-white/10 text-white/70 border-white/30 hover:bg-white/20"),onClick:()=>v("volume"),children:"Volume"}),e.jsx(R,{variant:h==="conversion"?"secondary":"outline",className:$("cursor-pointer transition-all duration-200 hover:scale-105",h==="conversion"?"bg-white/30 text-white border-white/40":"bg-white/10 text-white/70 border-white/30 hover:bg-white/20"),onClick:()=>v("conversion"),children:"Conversion"}),e.jsx(R,{variant:h==="ltv"?"secondary":"outline",className:$("cursor-pointer transition-all duration-200 hover:scale-105",h==="ltv"?"bg-white/30 text-white border-white/40":"bg-white/10 text-white/70 border-white/30 hover:bg-white/20"),onClick:()=>v("ltv"),children:"LTV"})]})]}),e.jsx(k,{className:"p-8 bg-gradient-to-br from-slate-50 to-white",children:e.jsxs("div",{className:"h-96 relative",children:[e.jsx("div",{className:"absolute top-0 right-0 text-xs text-slate-500 font-medium",children:o()}),e.jsx(ce,{width:"100%",height:"100%",children:g==="timeline"?e.jsxs(Xe,{data:b,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"lineGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#dc2626",stopOpacity:.4}),e.jsx("stop",{offset:"50%",stopColor:"#ea580c",stopOpacity:.2}),e.jsx("stop",{offset:"95%",stopColor:"#f97316",stopOpacity:.1})]})}),e.jsx(de,{strokeDasharray:"2 4",stroke:"#f1f5f9"}),e.jsx(me,{dataKey:"name",stroke:"#475569",fontSize:11,fontWeight:500,tickFormatter:x=>String(x).slice(-5)}),e.jsx(xe,{stroke:"#475569",fontSize:11,fontWeight:500}),e.jsx(re,{content:e.jsx(i,{})}),e.jsx(Ze,{type:"monotone",dataKey:h,stroke:"#dc2626",strokeWidth:4,dot:{fill:"#dc2626",strokeWidth:3,r:6},activeDot:{r:10,fill:"#b91c1c",stroke:"#ffffff",strokeWidth:3},fill:"url(#lineGradient)"})]}):e.jsxs(Qe,{data:b,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"barGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#dc2626",stopOpacity:.9}),e.jsx("stop",{offset:"50%",stopColor:"#ea580c",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#f97316",stopOpacity:.7})]})}),e.jsx(de,{strokeDasharray:"2 4",stroke:"#f1f5f9"}),e.jsx(me,{dataKey:"name",stroke:"#475569",fontSize:11,fontWeight:500,angle:-45,textAnchor:"end",height:80}),e.jsx(xe,{stroke:"#475569",fontSize:11,fontWeight:500}),e.jsx(re,{content:e.jsx(i,{})}),e.jsx(Je,{dataKey:h,fill:"url(#barGradient)",radius:[8,8,0,0]})]})})]})})]}),e.jsxs(S,{className:"w-full bg-white/95 backdrop-blur-sm border-0 shadow-2xl overflow-hidden",children:[e.jsx(P,{className:"bg-gradient-to-r from-orange-800 via-red-800 to-red-900 text-white border-0",children:e.jsxs(E,{className:"flex items-center gap-3 text-white text-xl font-bold",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(ke,{className:"w-6 h-6 text-white"})}),"Conversion Status Distribution"]})}),e.jsx(k,{className:"p-8 bg-gradient-to-br from-slate-50 to-white",children:e.jsx("div",{className:"h-96",children:e.jsx(ce,{width:"100%",height:"100%",children:e.jsxs(qe,{children:[e.jsx(et,{data:l,cx:"50%",cy:"50%",innerRadius:90,outerRadius:150,paddingAngle:4,dataKey:"value",animationBegin:0,animationDuration:1500,children:l.map((x,t)=>e.jsx(tt,{fill:x.color,stroke:"#ffffff",strokeWidth:3},`cell-${t}`))}),e.jsx(re,{content:e.jsx(m,{})}),e.jsx(st,{verticalAlign:"bottom",height:70,wrapperStyle:{fontSize:"14px",fontWeight:600},formatter:(x,t)=>e.jsxs("span",{style:{color:t.color,fontWeight:700},children:[x," (",t.payload.percentage,"%)"]})})]})})})})]})]})},xt=({data:n})=>{const[g,N]=C.useState("total"),[h,v]=C.useState("desc"),[b,l]=C.useState(null),[o,i]=C.useState(8),m=d=>{g===d?v(h==="asc"?"desc":"asc"):(N(d),v("desc"))},x=d=>new Intl.NumberFormat().format(d),t=d=>`${d>=0?"+":""}${d.toFixed(1)}%`,a=d=>d>0?e.jsx(W,{className:"w-3 h-3 text-green-500"}):d<0?e.jsx(Ve,{className:"w-3 h-3 text-red-500"}):e.jsx(Re,{className:"w-3 h-3 text-gray-400"}),s=d=>d>10||d>0?"text-green-600 bg-green-50":d<-10||d<0?"text-red-600 bg-red-50":"text-gray-600 bg-gray-50",r=C.useMemo(()=>{const d=new Map;return n.forEach(j=>{const f=j.source||"Unknown";d.has(f)||d.set(f,{source:f,months:new Map,total:0});const V=d.get(f),u=`${j.year}-${String(j.month).padStart(2,"0")}`;V.months.set(u,{leads:j.total_leads||0,conversions:j.total_conversions||0,conversionRate:j.conversion_rate||0}),V.total+=j.total_leads||0}),Array.from(d.values()).map(j=>{const f=Array.from(j.months.entries()).sort(),V=f[f.length-1],u=f[f.length-2];let H=0;if(V&&u){const w=V[1].leads,F=u[1].leads;F>0&&(H=(w-F)/F*100)}return{...j,recentLeads:V?V[1].leads:0,monthOnMonthGrowth:H,months:j.months}}).sort((j,f)=>g==="source"?h==="asc"?j.source.localeCompare(f.source):f.source.localeCompare(j.source):g==="total"?h==="asc"?j.total-f.total:f.total-j.total:h==="asc"?j.recentLeads-f.recentLeads:f.recentLeads-j.recentLeads)},[n,g,h]),c=C.useMemo(()=>{const d=new Set;return n.forEach(j=>{const f=`${j.year}-${String(j.month).padStart(2,"0")}`;d.add(f)}),Array.from(d).sort()},[n]),p=r.slice(0,o),y={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6}}},D={hidden:{opacity:0,y:-10},visible:{opacity:1,y:0,transition:{duration:.4,delay:.2}}},T={hidden:{opacity:0,x:-20},visible:{opacity:1,x:0,transition:{duration:.4}}};return e.jsx(A.div,{variants:y,initial:"hidden",animate:"visible",className:"w-full",children:e.jsxs(S,{className:"w-full bg-gradient-to-br from-white via-red-50/30 to-red-100/40 backdrop-blur-sm border-red-200/50 shadow-xl shadow-red-100/20",children:[e.jsxs(P,{className:"pb-4",children:[e.jsxs(A.div,{variants:D,className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-red-500 to-red-600 rounded-lg shadow-lg",children:e.jsx(z,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Funnel Source Performance"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Month-on-month lead generation by source"})]})]}),e.jsxs(R,{variant:"outline",className:"bg-gradient-to-r from-red-500/10 to-orange-500/10 text-red-700 border-red-300/50 backdrop-blur-sm",children:[e.jsx(K,{className:"w-3 h-3 mr-1"}),"Historical Analysis"]})]}),e.jsxs(A.div,{variants:D,className:"flex items-center gap-2 text-xs text-slate-600 mt-2",children:[e.jsx(ne,{className:"w-3 h-3"}),e.jsxs("span",{children:["Showing ",r.length," sources across ",c.length," months"]})]})]}),e.jsxs(k,{className:"pt-0",children:[e.jsx(A.div,{className:"overflow-x-auto",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-red-200/50",children:[e.jsx("th",{className:"text-left py-3 px-4",children:e.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>m("source"),className:"hover:bg-red-50/50 font-medium text-gray-700",children:["Source",g==="source"&&(h==="asc"?e.jsx(se,{className:"w-4 h-4 ml-1"}):e.jsx(ae,{className:"w-4 h-4 ml-1"}))]})}),e.jsx("th",{className:"text-right py-3 px-4",children:e.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>m("total"),className:"hover:bg-red-50/50 font-medium text-gray-700",children:["Total Leads",g==="total"&&(h==="asc"?e.jsx(se,{className:"w-4 h-4 ml-1"}):e.jsx(ae,{className:"w-4 h-4 ml-1"}))]})}),e.jsx("th",{className:"text-right py-3 px-4",children:e.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>m("recent"),className:"hover:bg-red-50/50 font-medium text-gray-700",children:["Recent Month",g==="recent"&&(h==="asc"?e.jsx(se,{className:"w-4 h-4 ml-1"}):e.jsx(ae,{className:"w-4 h-4 ml-1"}))]})}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-700",children:"Month-on-Month"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:e.jsx(he,{children:p.map((d,j)=>e.jsxs(pe.Fragment,{children:[e.jsxs(A.tr,{variants:T,initial:"hidden",animate:"visible",exit:"hidden",className:"hover:bg-red-50/30 transition-colors duration-200 border-b border-red-100/30",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"font-medium text-gray-900",children:d.source})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsx("span",{className:"font-medium text-gray-900",children:x(d.total)})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsx("span",{className:"font-medium text-gray-900",children:x(d.recentLeads)})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[a(d.monthOnMonthGrowth),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s(d.monthOnMonthGrowth)}`,children:t(d.monthOnMonthGrowth)})]})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>l(b===d.source?null:d.source),className:"hover:bg-red-50/50",children:e.jsx(ve,{className:"w-4 h-4"})})})]}),e.jsx(he,{children:b===d.source&&e.jsx(A.tr,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},children:e.jsx("td",{colSpan:5,className:"py-4 px-4 bg-gradient-to-r from-red-50/30 to-orange-50/30",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:c.slice(-6).map(f=>{const V=d.months.get(f);return V?e.jsxs(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},className:"p-3 bg-white rounded-lg border border-red-200/30 shadow-sm",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:new Date(f+"-01").toLocaleDateString("en-US",{month:"short",year:"numeric"})}),e.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:[x(V.leads)," leads"]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[V.conversions," conversions (",V.conversionRate.toFixed(1),"%)"]})]},f):null})})})})})]},d.source))})})]})}),r.length>o&&e.jsx(A.div,{className:"mt-4 text-center",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:e.jsx(O,{variant:"outline",onClick:()=>i(d=>d>=r.length?8:r.length),className:"border-red-200 text-red-700 hover:bg-red-50",children:o>=r.length?"Show Less":`Show All (${r.length})`})})]})]})})},ht=({allData:n,onDrillDown:g})=>{const[N,h]=C.useState("totalLeads"),v={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6}}},b={hidden:{opacity:0,y:-10},visible:{opacity:1,y:0,transition:{duration:.4,delay:.2}}},l=C.useMemo(()=>{if(!n.length)return[];const c=n.reduce((d,j)=>{const f=j.source||"Unknown";if(d[f]||(d[f]={}),j.createdAt){const V=new Date(j.createdAt),u=V.getFullYear(),H=V.getMonth()+1,w=`${u}-${String(H).padStart(2,"0")}`;d[f][w]||(d[f][w]={totalLeads:0,trialsCompleted:0,trialsScheduled:0,proximityIssues:0,convertedLeads:0,totalLTV:0,totalVisits:0});const F=d[f][w];F.totalLeads+=1,j.stage==="Trial Completed"&&(F.trialsCompleted+=1),j.stage?.includes("Trial")&&(F.trialsScheduled+=1),j.stage==="Proximity Issues"&&(F.proximityIssues+=1),j.conversionStatus==="Converted"&&(F.convertedLeads+=1),F.totalLTV+=j.ltv||0,F.totalVisits+=j.visits||0}return d},{}),p=new Date,y=p.getFullYear(),D=p.getMonth()+1,T=[];for(let d=D;d>=1;d--){const j=new Date(2025,d-1).toLocaleString("default",{month:"short"});T.push({month:d,name:j,current:`${y}-${String(d).padStart(2,"0")}`,previous:`${y-1}-${String(d).padStart(2,"0")}`})}return Object.keys(c).map(d=>{const j=c[d],f={source:d};return T.forEach(V=>{const u=j[V.current]||{totalLeads:0,trialsCompleted:0,trialsScheduled:0,proximityIssues:0,convertedLeads:0,totalLTV:0,totalVisits:0},H=j[V.previous]||{totalLeads:0,trialsCompleted:0,trialsScheduled:0,proximityIssues:0,convertedLeads:0,totalLTV:0,totalVisits:0},w=L=>{const te=L.trialsCompleted>0?L.convertedLeads/L.trialsCompleted*100:0,fe=L.totalLeads>0?L.trialsCompleted/L.totalLeads*100:0,Ne=L.totalLeads>0?L.convertedLeads/L.totalLeads*100:0,ye=L.totalLeads>0?L.totalLTV/L.totalLeads:0,we=L.totalLeads>0?L.totalVisits/L.totalLeads:0,Le=L.totalLeads>0?(L.totalLeads-L.proximityIssues)/L.totalLeads*100:0;return{totalLeads:L.totalLeads,trialsCompleted:L.trialsCompleted,trialsScheduled:L.trialsScheduled,proximityIssues:L.proximityIssues,convertedLeads:L.convertedLeads,trialToMemberRate:te,leadToTrialRate:fe,leadToMemberRate:Ne,ltv:ye,avgVisits:we,pipelineHealth:Le}},F=w(u),ee=w(H);f[`${V.name}_${y}`]=F,f[`${V.name}_${y-1}`]=ee}),f}).filter(d=>T.some(j=>d[`${j.name}_${y}`]?.totalLeads>0||d[`${j.name}_${y-1}`]?.totalLeads>0))},[n]),o=C.useMemo(()=>{const c=new Date,p=c.getFullYear(),y=c.getMonth()+1,D=[];for(let d=y;d>=1;d--){const j=new Date(2025,d-1).toLocaleString("default",{month:"short"});D.push({month:d,name:j})}const T={source:"TOTALS"};return D.forEach(d=>{const j=l.reduce((u,H)=>{const w=H[`${d.name}_${p}`]||{};return u.totalLeads+=w.totalLeads||0,u.trialsCompleted+=w.trialsCompleted||0,u.trialsScheduled+=w.trialsScheduled||0,u.proximityIssues+=w.proximityIssues||0,u.convertedLeads+=w.convertedLeads||0,u.totalLTV+=(w.ltv||0)*(w.totalLeads||0),u.totalVisits+=(w.avgVisits||0)*(w.totalLeads||0),u},{totalLeads:0,trialsCompleted:0,trialsScheduled:0,proximityIssues:0,convertedLeads:0,totalLTV:0,totalVisits:0}),f=l.reduce((u,H)=>{const w=H[`${d.name}_${p-1}`]||{};return u.totalLeads+=w.totalLeads||0,u.trialsCompleted+=w.trialsCompleted||0,u.trialsScheduled+=w.trialsScheduled||0,u.proximityIssues+=w.proximityIssues||0,u.convertedLeads+=w.convertedLeads||0,u.totalLTV+=(w.ltv||0)*(w.totalLeads||0),u.totalVisits+=(w.avgVisits||0)*(w.totalLeads||0),u},{totalLeads:0,trialsCompleted:0,trialsScheduled:0,proximityIssues:0,convertedLeads:0,totalLTV:0,totalVisits:0}),V=u=>{const H=u.trialsCompleted>0?u.convertedLeads/u.trialsCompleted*100:0,w=u.totalLeads>0?u.trialsCompleted/u.totalLeads*100:0,F=u.totalLeads>0?u.convertedLeads/u.totalLeads*100:0,ee=u.totalLeads>0?u.totalLTV/u.totalLeads:0,L=u.totalLeads>0?u.totalVisits/u.totalLeads:0,te=u.totalLeads>0?(u.totalLeads-u.proximityIssues)/u.totalLeads*100:0;return{totalLeads:u.totalLeads,trialsCompleted:u.trialsCompleted,trialsScheduled:u.trialsScheduled,proximityIssues:u.proximityIssues,convertedLeads:u.convertedLeads,trialToMemberRate:H,leadToTrialRate:w,leadToMemberRate:F,ltv:ee,avgVisits:L,pipelineHealth:te}};T[`${d.name}_${p}`]=V(j),T[`${d.name}_${p-1}`]=V(f)}),T},[l]),i=(c,p)=>{if(typeof c!="object"||!c)return"-";const y=c[p];if(y===void 0||y===0)return"-";switch(p){case"ltv":return y<1e3?`₹${Math.round(y)}`:I(y);case"trialToMemberRate":case"leadToTrialRate":case"leadToMemberRate":case"pipelineHealth":return`${y.toFixed(1)}%`;case"avgVisits":return y.toFixed(1);default:return y.toLocaleString("en-IN")}},m=[{value:"totalLeads",label:"Total Leads"},{value:"trialsCompleted",label:"Trials Completed"},{value:"trialsScheduled",label:"Trials Scheduled"},{value:"proximityIssues",label:"Proximity Issues"},{value:"convertedLeads",label:"Converted Leads"},{value:"trialToMemberRate",label:"Trial → Member Rate"},{value:"leadToTrialRate",label:"Lead → Trial Rate"},{value:"leadToMemberRate",label:"Lead → Member Rate"},{value:"ltv",label:"Average LTV"},{value:"avgVisits",label:"Avg Visits/Lead"},{value:"pipelineHealth",label:"Pipeline Health"}],x=new Date,t=x.getFullYear(),a=x.getMonth()+1,s=[];for(let c=a;c>=1;c--){const p=new Date(2025,c-1).toLocaleString("default",{month:"short"});s.push({month:c,name:p})}const r=[{key:"source",header:"Source",render:c=>e.jsx("div",{className:"font-semibold text-slate-800 min-w-[120px] truncate",children:c}),align:"left"},...s.flatMap(c=>[{key:`${c.name}_${t}`,header:`${c.name} ${t}`,render:p=>e.jsx("div",{className:"text-center font-medium text-xs my-0 py-0 mx-[20px]",children:i(p,N)}),align:"center"},{key:`${c.name}_${t-1}`,header:`${c.name} ${t-1}`,render:(p,y)=>{const D=y[`${c.name}_${t}`],T=p;let d=null;if(D&&T){const j=D[N],f=T[N];j&&f&&f!==0&&(d=(j-f)/f*100)}return e.jsxs("div",{className:"text-center group",children:[e.jsx("div",{className:"font-medium text-slate-600 text-xs text-center mx-[20px]",children:i(p,N)}),d!==null&&Math.abs(d)>.1]})},align:"center"}])];return e.jsx(A.div,{variants:v,initial:"hidden",animate:"visible",className:"w-full",children:e.jsxs(S,{className:"w-full bg-gradient-to-br from-white via-red-50/30 to-red-100/40 backdrop-blur-sm border-red-200/50 shadow-xl shadow-red-100/20",children:[e.jsxs(P,{className:"pb-4",children:[e.jsxs(A.div,{variants:b,className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-red-500 to-red-600 rounded-lg shadow-lg",children:e.jsx(z,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Year-on-Year Source Performance"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Historical comparison across years by source"})]})]}),e.jsxs(R,{variant:"outline",className:"bg-gradient-to-r from-red-500/10 to-orange-500/10 text-red-700 border-red-300/50 backdrop-blur-sm",children:[e.jsx(K,{className:"w-3 h-3 mr-1"}),"Historical Analysis"]})]}),e.jsxs(A.div,{variants:b,className:"flex items-center gap-2 text-xs text-slate-600 mt-2",children:[e.jsx(ne,{className:"w-3 h-3"}),e.jsxs("span",{children:["Showing ",l.length," sources across ",s.length," months"]})]})]}),e.jsxs(k,{className:"pt-0",children:[e.jsxs(A.div,{className:"p-4 mb-4 border border-red-200/50 rounded-lg bg-gradient-to-r from-red-50/30 to-orange-50/30 backdrop-blur-sm",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},children:[e.jsx(be,{value:N,onValueChange:c=>h(c),children:e.jsx(je,{className:"grid w-full grid-cols-4 lg:grid-cols-6 gap-1 h-auto p-1 bg-white/80 backdrop-blur-sm",children:m.map(c=>e.jsx(U,{value:c.value,className:"text-xs p-2 data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-500 data-[state=active]:to-red-600 data-[state=active]:text-white transition-all duration-200",children:c.label},c.value))})}),e.jsx("div",{className:"mt-3 flex items-center gap-2",children:e.jsxs(R,{variant:"outline",className:"bg-gradient-to-r from-red-500/10 to-orange-500/10 text-red-700 border-red-300/50",children:[e.jsx(z,{className:"w-3 h-3 mr-1"}),m.find(c=>c.value===N)?.label]})})]}),e.jsx(A.div,{className:"max-h-[500px] overflow-auto rounded-lg border border-red-200/50",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:e.jsx(G,{data:l,columns:r,loading:!1,stickyHeader:!0,showFooter:!0,footerData:o,maxHeight:"400px",className:"rounded-lg",headerGradient:"from-red-500 to-red-600",onRowClick:c=>{const p=n.filter(y=>y.source===c.source);g?.(`Source: ${c.source} - Year Analysis`,p,"year-source")}})})]})]})})},ut=({data:n})=>{const g=C.useMemo(()=>{if(!n||n.length===0)return{sources:[],stages:[]};const h=new Map;n.forEach(o=>{const i=o.source||"Unknown";h.has(i)||h.set(i,{name:i,count:0,converted:0,revenue:0,conversionRate:0});const m=h.get(i);m.count+=1,o.conversionStatus==="Converted"&&(m.converted+=1),m.revenue+=o.ltv||0});const v=Array.from(h.values()).map(o=>({...o,conversionRate:o.count>0?o.converted/o.count*100:0,avgRevenue:o.count>0?o.revenue/o.count:0})).sort((o,i)=>i.count-o.count),b=new Map;n.forEach(o=>{const i=o.stage||"Unknown";b.has(i)||b.set(i,{name:i,count:0,converted:0,revenue:0,conversionRate:0});const m=b.get(i);m.count+=1,o.conversionStatus==="Converted"&&(m.converted+=1),m.revenue+=o.ltv||0});const l=Array.from(b.values()).map(o=>({...o,conversionRate:o.count>0?o.converted/o.count*100:0,avgRevenue:o.count>0?o.revenue/o.count:0,percentage:o.count>0?o.count/n.length*100:0})).sort((o,i)=>i.count-o.count);return{sources:v,stages:l}},[n]);n?.length;const N=({title:h,items:v,type:b,icon:l,gradient:o})=>e.jsx(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(S,{className:"bg-white/95 backdrop-blur-sm shadow-xl border-0 overflow-hidden h-full",children:[e.jsx(P,{className:`bg-gradient-to-r ${o} text-white`,children:e.jsxs(E,{className:"flex items-center gap-3 text-lg font-bold",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-xl",children:e.jsx(l,{className:"w-5 h-5"})}),h]})}),e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-slate-800 mb-3 flex items-center gap-2",children:[e.jsx(Me,{className:"w-4 h-4 text-yellow-500"}),"Top Performers"]}),e.jsx("div",{className:"space-y-3",children:v.slice(0,5).map((i,m)=>e.jsxs(A.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:m*.1},className:"flex items-center justify-between p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(R,{variant:"secondary",className:`
                          ${m===0?"bg-yellow-100 text-yellow-800 border-yellow-300":""}
                          ${m===1?"bg-gray-100 text-gray-800 border-gray-300":""}
                          ${m===2?"bg-orange-100 text-orange-800 border-orange-300":""}
                          ${m>2?"bg-blue-100 text-blue-800 border-blue-300":""}
                        `,children:["#",m+1]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-slate-800 text-sm",children:i.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:[i.conversionRate.toFixed(1),"% conversion"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-green-700 text-lg",children:M(i.count)}),e.jsx("div",{className:"text-xs text-slate-500",children:b==="stage"?`${i.percentage.toFixed(1)}% of funnel`:I(i.avgRevenue)})]})]},`top-${i.name}`))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-slate-800 mb-3 flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4 text-red-500"}),"Needs Attention"]}),e.jsx("div",{className:"space-y-3",children:v.slice(-3).reverse().map((i,m)=>e.jsxs(A.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:m*.1},className:"flex items-center justify-between p-3 bg-gradient-to-r from-red-50 to-pink-50 rounded-xl border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(R,{variant:"destructive",className:"bg-red-100 text-red-800 border-red-300",children:["#",v.length-2+m]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-slate-800 text-sm",children:i.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:[i.conversionRate.toFixed(1),"% conversion"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-red-700 text-lg",children:M(i.count)}),e.jsx("div",{className:"text-xs text-slate-500",children:b==="stage"?`${i.percentage.toFixed(1)}% of funnel`:I(i.avgRevenue)})]})]},`bottom-${i.name}`))})]}),e.jsxs("div",{className:"mt-6 p-4 bg-slate-50 rounded-xl",children:[e.jsxs("h4",{className:"font-bold text-slate-800 mb-3 flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-indigo-600"}),"Performance Overview"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:v.length}),e.jsxs("div",{className:"text-xs text-slate-600",children:["Total ",b==="source"?"Sources":"Stages"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[(v.reduce((i,m)=>i+m.conversionRate,0)/v.length).toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-slate-600",children:"Avg Conversion"})]})]})]})]})})]})});return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(A.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},children:e.jsx(S,{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white",children:e.jsxs(k,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:g.sources.length}),e.jsx("div",{className:"text-sm text-blue-100",children:"Active Sources"})]})})}),e.jsx(A.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.1},children:e.jsx(S,{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white",children:e.jsxs(k,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:g.stages.length}),e.jsx("div",{className:"text-sm text-purple-100",children:"Funnel Stages"})]})})}),e.jsx(A.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.2},children:e.jsx(S,{className:"bg-gradient-to-br from-green-500 to-green-600 text-white",children:e.jsxs(k,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-xl font-bold",children:I(g.sources.reduce((h,v)=>h+v.revenue,0))}),e.jsx("div",{className:"text-sm text-green-100",children:"Total Revenue"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsx(N,{title:"Lead Source Rankings",items:g.sources,type:"source",icon:_,gradient:"from-blue-600 to-indigo-700"}),e.jsx(N,{title:"Funnel Stage Rankings",items:g.stages,type:"stage",icon:Y,gradient:"from-purple-600 to-pink-700"})]})]})},gt=({data:n})=>{const g=C.useMemo(()=>{if(!n.length)return[];const l=n.length,o=n.filter(r=>r.stage?.includes("Trial")).length,i=n.filter(r=>r.stage==="Trial Completed").length,m=n.filter(r=>r.conversionStatus==="Converted").length;n.filter(r=>r.status==="Lost").length;const x=n.filter(r=>r.stage==="Proximity Issues").length,t=n.filter(r=>r.followUp1Date||r.followUp2Date||r.followUp3Date).length,a=n.reduce((r,c)=>r+(c.ltv||0),0),s=n.reduce((r,c)=>r+(c.visits||0),0);return[{metric:"Lead Volume Health",value:l,benchmark:1e3,status:l>=1e3?"Excellent":l>=500?"Good":"Needs Attention",description:"Total leads generated in period"},{metric:"Trial Scheduling Rate",value:l>0?o/l*100:0,benchmark:60,status:o/l*100>=60?"Excellent":o/l*100>=40?"Good":"Needs Attention",description:"Percentage of leads scheduling trials"},{metric:"Trial Completion Rate",value:o>0?i/o*100:0,benchmark:80,status:i/o*100>=80?"Excellent":i/o*100>=60?"Good":"Needs Attention",description:"Trials completed vs scheduled"},{metric:"Conversion Efficiency",value:l>0?m/l*100:0,benchmark:25,status:m/l*100>=25?"Excellent":m/l*100>=15?"Good":"Needs Attention",description:"Overall lead to member conversion"},{metric:"Proximity Issue Rate",value:l>0?x/l*100:0,benchmark:10,status:x/l*100<=10?"Excellent":x/l*100<=20?"Good":"Needs Attention",description:"Leads lost due to location issues"},{metric:"Follow-up Coverage",value:l>0?t/l*100:0,benchmark:70,status:t/l*100>=70?"Excellent":t/l*100>=50?"Good":"Needs Attention",description:"Leads receiving follow-up actions"},{metric:"Average LTV",value:l>0?a/l:0,benchmark:5e3,status:a/l>=5e3?"Excellent":a/l>=3e3?"Good":"Needs Attention",description:"Revenue quality per lead"},{metric:"Engagement Level",value:l>0?s/l:0,benchmark:3,status:s/l>=3?"Excellent":s/l>=2?"Good":"Needs Attention",description:"Average visits per lead"}]},[n]),N=l=>l.metric.includes("Rate")||l.metric.includes("Coverage")||l.metric.includes("Efficiency")?`${l.value.toFixed(1)}%`:l.metric.includes("LTV")?I(l.value):l.metric.includes("Volume")?M(l.value):l.value.toFixed(1),h=l=>{switch(l){case"Excellent":return e.jsx(R,{className:"w-24 justify-center bg-green-600 text-white hover:bg-green-700 font-bold",children:"Excellent"});case"Good":return e.jsx(R,{className:"w-24 justify-center bg-yellow-500 text-white hover:bg-yellow-600 font-bold",children:"Good"});default:return e.jsx(R,{className:"w-24 justify-center bg-red-600 text-white hover:bg-red-700 font-bold",children:"Needs Fix"})}},v=[{key:"metric",header:"Health Metric",render:l=>e.jsx("div",{className:"font-semibold text-slate-800 min-w-[200px] text-left",children:l}),align:"left"},{key:"value",header:"Current Value",render:(l,o)=>e.jsx("div",{className:"text-center font-bold text-blue-600",children:N(o)}),align:"center"},{key:"benchmark",header:"Benchmark",render:(l,o)=>e.jsx("div",{className:"text-center font-medium text-slate-600",children:o.metric.includes("Rate")||o.metric.includes("Coverage")||o.metric.includes("Efficiency")?`${l}%`:o.metric.includes("LTV")?I(l):l.toLocaleString("en-IN")}),align:"center"},{key:"status",header:"Status",render:l=>e.jsx("div",{className:"text-center",children:h(l)}),align:"center"},{key:"description",header:"Description",render:l=>e.jsx("div",{className:"text-sm text-slate-600 max-w-[200px]",children:l}),align:"left"}],b=C.useMemo(()=>{const l=g.map(o=>{switch(o.status){case"Excellent":return 100;case"Good":return 70;default:return 30}});return l.length>0?Math.round(l.reduce((o,i)=>o+i,0)/l.length):0},[g]);return e.jsxs(S,{className:"w-full bg-white/90 backdrop-blur-sm border-0 shadow-xl",children:[e.jsx(P,{className:"bg-gradient-to-r from-red-50 to-pink-50 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(E,{className:"flex items-center gap-2 text-slate-800",children:[e.jsx(Ae,{className:"w-6 h-6 text-red-600 animate-pulse"}),"Funnel Health Metrics"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Overall Health:"}),e.jsxs(R,{className:$("text-lg px-4 py-2 font-black",b>=85?"bg-green-600 text-white":b>=70?"bg-yellow-500 text-white":"bg-red-600 text-white"),children:[b,"%"]})]})]})}),e.jsxs(k,{className:"p-0",children:[e.jsx("div",{className:"max-h-[600px] overflow-auto",children:e.jsx(G,{data:g,columns:v,loading:!1,stickyHeader:!0,maxHeight:"500px",className:"rounded-none"})}),e.jsxs("div",{className:"p-6 bg-slate-50 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(q,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"font-semibold text-slate-800",children:"Health Assessment"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(q,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"font-semibold text-green-800",children:"Strengths"})]}),e.jsxs("div",{className:"text-sm text-green-600",children:[g.filter(l=>l.status==="Excellent").length," metrics excellent"]})]}),e.jsxs("div",{className:"p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(W,{className:"w-4 h-4 text-yellow-600"}),e.jsx("span",{className:"font-semibold text-yellow-800",children:"Opportunities"})]}),e.jsxs("div",{className:"text-sm text-yellow-600",children:[g.filter(l=>l.status==="Good").length," metrics good"]})]}),e.jsxs("div",{className:"p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx($e,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"font-semibold text-red-800",children:"Action Needed"})]}),e.jsxs("div",{className:"text-sm text-red-600",children:[g.filter(l=>l.status==="Needs Attention").length," metrics need attention"]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-white rounded-lg border",children:[e.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"Quick Recommendations:"}),e.jsxs("ul",{className:"text-sm text-slate-600 space-y-1",children:[b<70&&e.jsx("li",{children:"• Focus on improving trial completion rates"}),g.find(l=>l.metric==="Proximity Issue Rate"&&l.status==="Needs Attention")&&e.jsx("li",{children:"• Address location accessibility concerns"}),g.find(l=>l.metric==="Follow-up Coverage"&&l.status==="Needs Attention")&&e.jsx("li",{children:"• Implement systematic follow-up processes"}),b>=85&&e.jsx("li",{children:"• Excellent funnel health - maintain current strategies"})]})]})]})]})]})},vt=({data:n,onDrillDown:g})=>{const[N,h]=C.useState(null),v=C.useMemo(()=>{const t=n.reduce((a,s)=>{const r=s.source||"Unknown";return a[r]||(a[r]={totalLeads:0,trialsScheduled:0,trialsCompleted:0,converted:0,totalLTV:0,totalVisits:0,proximityIssues:0}),a[r].totalLeads+=1,s.stage?.includes("Trial")&&(a[r].trialsScheduled+=1),s.stage==="Trial Completed"&&(a[r].trialsCompleted+=1),s.conversionStatus==="Converted"&&(a[r].converted+=1),s.stage?.includes("Proximity")&&(a[r].proximityIssues+=1),a[r].totalLTV+=s.ltv||0,a[r].totalVisits+=s.visits||0,a},{});return Object.entries(t).map(([a,s])=>({source:a,totalLeads:s.totalLeads,trialsScheduled:s.trialsScheduled,trialsCompleted:s.trialsCompleted,converted:s.converted,conversionRate:s.totalLeads>0?s.converted/s.totalLeads*100:0,trialToMemberRate:s.trialsCompleted>0?s.converted/s.trialsCompleted*100:0,avgLTV:s.totalLeads>0?s.totalLTV/s.totalLeads:0,avgVisits:s.totalLeads>0?s.totalVisits/s.totalLeads:0,proximityIssues:s.proximityIssues,leadQuality:(s.converted*.4+s.trialsCompleted*.3+(s.totalLeads-s.proximityIssues)*.3)/s.totalLeads*100})).sort((a,s)=>s.totalLeads-a.totalLeads)},[n]),b=C.useMemo(()=>{const t=n.reduce((a,s)=>{const r=s.stage||"Unknown";return a[r]||(a[r]={totalLeads:0,converted:0,totalLTV:0,avgDaysInStage:0,retained:0}),a[r].totalLeads+=1,s.conversionStatus==="Converted"&&(a[r].converted+=1),s.retentionStatus==="Retained"&&(a[r].retained+=1),a[r].totalLTV+=s.ltv||0,a},{});return Object.entries(t).map(([a,s])=>({stage:a,totalLeads:s.totalLeads,converted:s.converted,conversionRate:s.totalLeads>0?s.converted/s.totalLeads*100:0,retentionRate:s.totalLeads>0?s.retained/s.totalLeads*100:0,avgLTV:s.totalLeads>0?s.totalLTV/s.totalLeads:0,stageEfficiency:(s.converted*.5+s.retained*.3+s.totalLeads*.2)/s.totalLeads*100})).sort((a,s)=>s.totalLeads-a.totalLeads)},[n]),l=C.useMemo(()=>[{label:"0-7 days",min:0,max:7},{label:"8-14 days",min:8,max:14},{label:"15-30 days",min:15,max:30},{label:"31-60 days",min:31,max:60},{label:"60+ days",min:61,max:1/0}].map(a=>{const s=n.filter(c=>{if(!c.createdAt||!c.convertedToCustomerAt)return!1;const p=new Date(c.createdAt),y=new Date(c.convertedToCustomerAt),D=Math.ceil((y.getTime()-p.getTime())/(1e3*60*60*24));return D>=a.min&&D<=a.max}),r=s.filter(c=>c.conversionStatus==="Converted");return{timeRange:a.label,totalLeads:s.length,converted:r.length,conversionRate:s.length>0?r.length/s.length*100:0,avgLTV:r.length>0?r.reduce((c,p)=>c+(p.ltv||0),0)/r.length:0,efficiency:s.length>0?(r.length*.6+s.length*.4)/s.length*100:0}}),[n]),o=C.useMemo(()=>[{label:"₹0",min:0,max:0},{label:"₹1-5k",min:1,max:5e3},{label:"₹5k-15k",min:5001,max:15e3},{label:"₹15k-30k",min:15001,max:3e4},{label:"₹30k+",min:30001,max:1/0}].map(a=>{const s=n.filter(c=>{const p=c.ltv||0;return p>=a.min&&p<=a.max}),r=s.filter(c=>c.conversionStatus==="Converted");return{ltvRange:a.label,totalLeads:s.length,converted:r.length,conversionRate:s.length>0?r.length/s.length*100:0,avgVisits:s.length>0?s.reduce((c,p)=>c+(p.visits||0),0)/s.length:0,totalRevenue:s.reduce((c,p)=>c+(p.ltv||0),0),valueScore:r.length>0?r.reduce((c,p)=>c+(p.ltv||0),0)/r.length*(r.length/s.length):0}}),[n]),i=C.useMemo(()=>{const t=n.reduce((a,s)=>{const r=s.stage||"Unknown";return a[r]||(a[r]={count:0,converted:0,avgLTV:0,totalLTV:0}),a[r].count+=1,s.conversionStatus==="Converted"&&(a[r].converted+=1),a[r].totalLTV+=s.ltv||0,a},{});return Object.entries(t).map(([a,s])=>({stage:a,leadCount:s.count,percentage:s.count/s.length*100,converted:s.converted,conversionRate:s.count>0?s.converted/s.count*100:0,avgLTV:s.count>0?s.totalLTV/s.count:0,stagePopularity:s.count/s.length*100})).sort((a,s)=>s.leadCount-a.leadCount).slice(0,10)},[n]),m=C.useMemo(()=>{const a=n.filter(s=>s.stage?.includes("Proximity")||s.remarks?.toLowerCase().includes("proximity")||s.remarks?.toLowerCase().includes("location")||s.remarks?.toLowerCase().includes("distance")).reduce((s,r)=>{const c=r.center||"Unknown";return s[c]||(s[c]={count:0,totalLeads:0}),s[c].count+=1,s},{});return n.forEach(s=>{const r=s.center||"Unknown";a[r]?a[r].totalLeads+=1:a[r]={count:0,totalLeads:1}}),Object.entries(a).map(([s,r])=>({location:s,proximityIssues:r.count,totalLeads:r.totalLeads,proximityRate:r.totalLeads>0?r.count/r.totalLeads*100:0,impactScore:r.count*(r.count/r.totalLeads)*100})).sort((s,r)=>r.proximityIssues-s.proximityIssues)},[n]),x=(t,a)=>{if(!g)return;let s=[],r="";switch(t){case"source":s=n.filter(c=>c.source===a.source),r=`Source: ${a.source}`;break;case"stage":s=n.filter(c=>c.stage===a.stage),r=`Stage: ${a.stage}`;break;case"ltv":r=`LTV Range: ${a.ltvRange}`,s=n;break;case"proximity":s=n.filter(c=>c.center===a.location),r=`Location: ${a.location}`;break;default:s=n,r="Funnel Analytics"}g(r,s,t)};return e.jsx("div",{className:"space-y-6",children:e.jsxs(be,{defaultValue:"source",className:"w-full",children:[e.jsxs(je,{className:"grid w-full grid-cols-6 bg-gradient-to-r from-red-50 to-orange-50 p-2 rounded-2xl h-auto gap-2",children:[e.jsxs(U,{value:"source",className:"rounded-xl px-4 py-3 font-semibold text-sm",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"By Source"]}),e.jsxs(U,{value:"stage",className:"rounded-xl px-4 py-3 font-semibold text-sm",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"By Stage"]}),e.jsxs(U,{value:"span",className:"rounded-xl px-4 py-3 font-semibold text-sm",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Conv. Span"]}),e.jsxs(U,{value:"ltv",className:"rounded-xl px-4 py-3 font-semibold text-sm",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"LTV Analysis"]}),e.jsxs(U,{value:"stages",className:"rounded-xl px-4 py-3 font-semibold text-sm",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Top Stages"]}),e.jsxs(U,{value:"proximity",className:"rounded-xl px-4 py-3 font-semibold text-sm",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Proximity"]})]}),e.jsx(B,{value:"source",className:"mt-6",children:e.jsxs(S,{className:"bg-white/95 backdrop-blur-sm border-0 shadow-xl",children:[e.jsx(P,{className:"bg-gradient-to-r from-red-600 via-red-700 to-red-800",children:e.jsxs(E,{className:"text-white flex items-center gap-2 text-lg font-bold",children:[e.jsx(Y,{className:"w-5 h-5"}),"Conversion by Source"]})}),e.jsx(k,{className:"p-0",children:e.jsx(G,{data:v,showFooter:!0,footerData:{source:"TOTALS",totalLeads:v.reduce((t,a)=>t+a.totalLeads,0),converted:v.reduce((t,a)=>t+a.converted,0),conversionRate:v.length>0?v.reduce((t,a)=>t+a.converted,0)/v.reduce((t,a)=>t+a.totalLeads,0)*100:0,avgLTV:v.length>0?v.reduce((t,a)=>t+a.avgLTV*a.totalLeads,0)/v.reduce((t,a)=>t+a.totalLeads,0):0},columns:[{key:"source",header:"Source",render:t=>e.jsx("div",{className:"font-semibold text-slate-800 min-w-[120px]",children:t})},{key:"totalLeads",header:"Total Leads",align:"center",render:t=>e.jsx("div",{className:"font-medium text-blue-600",children:M(t)})},{key:"converted",header:"Converted",align:"center",render:t=>e.jsx("div",{className:"font-medium text-green-600",children:M(t)})},{key:"conversionRate",header:"Conv. Rate",align:"center",render:(t,a)=>e.jsxs("div",{className:"relative group",onMouseEnter:()=>h(`${a.source}-conv`),onMouseLeave:()=>h(null),children:[e.jsxs(R,{variant:"outline",className:`${t>=15?"text-green-600 border-green-200":t>=8?"text-yellow-600 border-yellow-200":"text-red-600 border-red-200"}`,children:[t.toFixed(1),"%"]}),N===`${a.source}-conv`&&e.jsx("div",{className:"absolute z-10 -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded",children:t>=15?"🔥 Excellent":t>=8?"👍 Good":"⚠️ Needs Improvement"})]})},{key:"avgLTV",header:"Avg LTV",align:"right",render:t=>e.jsx("span",{className:"font-semibold text-emerald-600",children:I(t)})}],onRowClick:t=>x("source",t),headerGradient:"from-red-600 to-red-700",maxHeight:"400px"})})]})}),e.jsx(B,{value:"stage",className:"mt-6",children:e.jsxs(S,{className:"bg-white/95 backdrop-blur-sm border-0 shadow-xl",children:[e.jsx(P,{className:"bg-gradient-to-r from-red-700 via-red-800 to-orange-700",children:e.jsxs(E,{className:"text-white flex items-center gap-2 text-lg font-bold",children:[e.jsx(Z,{className:"w-5 h-5"}),"Conversion by Stage"]})}),e.jsx(k,{className:"p-0",children:e.jsx(G,{data:b,showFooter:!0,footerData:{stage:"TOTALS",totalLeads:b.reduce((t,a)=>t+a.totalLeads,0),converted:b.reduce((t,a)=>t+a.converted,0),conversionRate:b.length>0?b.reduce((t,a)=>t+a.converted,0)/b.reduce((t,a)=>t+a.totalLeads,0)*100:0,avgLTV:b.length>0?b.reduce((t,a)=>t+a.avgLTV*a.totalLeads,0)/b.reduce((t,a)=>t+a.totalLeads,0):0},columns:[{key:"stage",header:"Stage",render:t=>e.jsx("div",{className:"font-semibold text-slate-800 min-w-[150px]",children:t})},{key:"totalLeads",header:"Total Leads",align:"center",render:t=>M(t)},{key:"converted",header:"Converted",align:"center",render:t=>e.jsx("span",{className:"font-medium text-green-600",children:M(t)})},{key:"conversionRate",header:"Conv. Rate",align:"center",render:t=>e.jsxs(R,{variant:"outline",className:"text-purple-600 border-purple-200",children:[t.toFixed(1),"%"]})},{key:"avgLTV",header:"Avg LTV",align:"right",render:t=>I(t)}],onRowClick:t=>x("stage",t),headerGradient:"from-red-700 to-orange-700",maxHeight:"400px"})})]})}),e.jsx(B,{value:"span",className:"mt-6",children:e.jsxs(S,{className:"bg-white/95 backdrop-blur-sm border-0 shadow-xl",children:[e.jsx(P,{className:"bg-gradient-to-r from-orange-600 via-red-600 to-pink-600",children:e.jsxs(E,{className:"text-white flex items-center gap-2 text-lg font-bold",children:[e.jsx(J,{className:"w-5 h-5"}),"Conversion Span Analysis"]})}),e.jsx(k,{className:"p-0",children:e.jsx(G,{data:l,columns:[{key:"timeRange",header:"Time Range",render:t=>e.jsx("div",{className:"font-semibold text-slate-800",children:t})},{key:"totalLeads",header:"Total Leads",align:"center",render:t=>M(t)},{key:"converted",header:"Converted",align:"center",render:t=>M(t)},{key:"conversionRate",header:"Conv. Rate",align:"center",render:t=>`${t.toFixed(1)}%`},{key:"avgLTV",header:"Avg LTV",align:"right",render:t=>I(t)}],headerGradient:"from-orange-600 to-pink-600",maxHeight:"400px"})})]})}),e.jsx(B,{value:"ltv",className:"mt-6",children:e.jsxs(S,{className:"bg-white/95 backdrop-blur-sm border-0 shadow-xl",children:[e.jsx(P,{className:"bg-gradient-to-r from-green-600 via-emerald-600 to-teal-600",children:e.jsxs(E,{className:"text-white flex items-center gap-2 text-lg font-bold",children:[e.jsx(Q,{className:"w-5 h-5"}),"LTV Analysis"]})}),e.jsx(k,{className:"p-0",children:e.jsx(G,{data:o,columns:[{key:"ltvRange",header:"LTV Range",render:t=>e.jsx("div",{className:"font-semibold text-slate-800",children:t})},{key:"totalLeads",header:"Total Leads",align:"center",render:t=>M(t)},{key:"converted",header:"Converted",align:"center",render:t=>M(t)},{key:"totalRevenue",header:"Total Revenue",align:"right",render:t=>I(t)},{key:"avgVisits",header:"Avg Visits",align:"center",render:t=>t.toFixed(1)}],onRowClick:t=>x("ltv",t),headerGradient:"from-green-600 to-emerald-600",maxHeight:"400px"})})]})}),e.jsx(B,{value:"stages",className:"mt-6",children:e.jsxs(S,{className:"bg-white/95 backdrop-blur-sm border-0 shadow-xl",children:[e.jsx(P,{className:"bg-gradient-to-r from-indigo-600 via-blue-600 to-cyan-600",children:e.jsxs(E,{className:"text-white flex items-center gap-2 text-lg font-bold",children:[e.jsx(z,{className:"w-5 h-5"}),"Most Common Stages"]})}),e.jsx(k,{className:"p-0",children:e.jsx(G,{data:i,columns:[{key:"stage",header:"Stage",render:t=>e.jsx("div",{className:"font-semibold text-slate-800",children:t})},{key:"leadCount",header:"Lead Count",align:"center",render:t=>M(t)},{key:"converted",header:"Converted",align:"center",render:t=>M(t)},{key:"conversionRate",header:"Conv. Rate",align:"center",render:t=>`${t.toFixed(1)}%`},{key:"avgLTV",header:"Avg LTV",align:"right",render:t=>I(t)}],headerGradient:"from-indigo-600 to-blue-600",maxHeight:"400px"})})]})}),e.jsx(B,{value:"proximity",className:"mt-6",children:e.jsxs(S,{className:"bg-white/95 backdrop-blur-sm border-0 shadow-xl",children:[e.jsx(P,{className:"bg-gradient-to-r from-red-600 via-orange-600 to-yellow-600",children:e.jsxs(E,{className:"text-white flex items-center gap-2 text-lg font-bold",children:[e.jsx(oe,{className:"w-5 h-5"}),"Proximity Issues Analysis"]})}),e.jsx(k,{className:"p-0",children:e.jsx(G,{data:m,columns:[{key:"location",header:"Location",render:t=>e.jsxs("div",{className:"font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-gray-400"}),t]})},{key:"proximityIssues",header:"Proximity Issues",align:"center",render:t=>e.jsx("span",{className:"font-medium text-red-600",children:M(t)})},{key:"totalLeads",header:"Total Leads",align:"center",render:t=>M(t)},{key:"proximityRate",header:"Proximity Rate",align:"center",render:t=>e.jsxs(R,{variant:"outline",className:`${t>=20?"text-red-600 border-red-200":t>=10?"text-yellow-600 border-yellow-200":"text-green-600 border-green-200"}`,children:[t.toFixed(1),"%"]})},{key:"impactScore",header:"Impact Score",align:"right",render:t=>e.jsx("span",{className:"font-medium text-orange-600",children:t.toFixed(1)})}],onRowClick:t=>x("proximity",t),headerGradient:"from-red-600 to-orange-600",maxHeight:"400px"})})]})})]})})},pt=({isOpen:n,onClose:g,title:N,data:h,type:v})=>{const b=[{key:"fullName",header:"Name",className:"min-w-[150px]",render:(o,i)=>e.jsxs("div",{className:"font-medium text-gray-900",children:[e.jsx("div",{className:"text-sm font-semibold",children:o}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(ue,{className:"w-3 h-3"}),i.phone]})]})},{key:"email",header:"Email",className:"min-w-[200px]",render:o=>e.jsx("div",{className:"text-sm text-gray-600 truncate",title:o,children:o})},{key:"source",header:"Source",align:"center",render:o=>e.jsx(R,{variant:"outline",className:"text-blue-600 border-blue-200 bg-blue-50",children:o||"Unknown"})},{key:"stage",header:"Stage",align:"center",render:o=>e.jsx(R,{variant:"outline",className:`${o?.includes("Trial")?"text-purple-600 border-purple-200 bg-purple-50":o?.includes("Proximity")?"text-red-600 border-red-200 bg-red-50":"text-gray-600 border-gray-200 bg-gray-50"}`,children:o||"Unknown"})},{key:"conversionStatus",header:"Conversion",align:"center",render:o=>e.jsx(R,{variant:o?.toLowerCase().includes("converted")?"default":"secondary",className:o?.toLowerCase().includes("converted")?"bg-green-100 text-green-800":"",children:o||"Pending"})},{key:"ltv",header:"LTV",align:"right",render:o=>e.jsx("span",{className:"font-semibold text-emerald-600",children:I(o||0)})},{key:"visits",header:"Visits",align:"center",render:o=>e.jsx("div",{className:"text-sm font-medium text-gray-700",children:M(o||0)})},{key:"center",header:"Location",className:"min-w-[150px]",render:o=>e.jsxs("div",{className:"text-sm text-gray-600 truncate flex items-center gap-1",title:o,children:[e.jsx(X,{className:"w-3 h-3 text-gray-400"}),o||"Unknown"]})}],l=pe.useMemo(()=>{const o=h.length,i=h.filter(r=>r.stage==="Trial Completed").length,m=h.filter(r=>r.stage?.includes("Trial")).length,x=h.filter(r=>r.conversionStatus==="Converted").length,t=h.filter(r=>r.stage?.includes("Proximity")||r.remarks?.toLowerCase().includes("proximity")).length,a=h.reduce((r,c)=>r+(c.ltv||0),0),s=h.reduce((r,c)=>r+(c.visits||0),0);return{totalLeads:o,trialsCompleted:i,trialsScheduled:m,convertedLeads:x,proximityIssues:t,conversionRate:o>0?x/o*100:0,trialConversionRate:i>0?x/i*100:0,avgLTV:o>0?a/o:0,avgVisits:o>0?s/o:0,totalLTV:a}},[h]);return e.jsx(Be,{open:n,onOpenChange:g,children:e.jsxs(_e,{className:"max-w-7xl max-h-[90vh] overflow-y-auto",children:[e.jsx(We,{className:"pb-4 border-b bg-gradient-to-r from-blue-50 to-purple-50 -m-6 p-6 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Ke,{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-blue-600"}),N," - Detailed Analysis"]}),e.jsx(O,{variant:"ghost",size:"sm",onClick:g,className:"hover:bg-white/50",children:e.jsx(le,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:[e.jsx(S,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:M(l.totalLeads)}),e.jsx("div",{className:"text-xs text-blue-600",children:"Total Leads"})]})]})})}),e.jsx(S,{className:"bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-700",children:M(l.convertedLeads)}),e.jsx("div",{className:"text-xs text-green-600",children:"Converted"})]})]})})}),e.jsx(S,{className:"bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-purple-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-700",children:[l.conversionRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-purple-600",children:"Conv. Rate"})]})]})})}),e.jsx(S,{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 border-emerald-200",children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-emerald-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-700",children:I(l.avgLTV)}),e.jsx("div",{className:"text-xs text-emerald-600",children:"Avg LTV"})]})]})})}),e.jsx(S,{className:"bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-700",children:l.avgVisits.toFixed(1)}),e.jsx("div",{className:"text-xs text-orange-600",children:"Avg Visits"})]})]})})})]}),e.jsxs(S,{children:[e.jsx(P,{children:e.jsxs(E,{className:"text-lg flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5 text-blue-600"}),"Lead Details (",M(h.length)," leads)"]})}),e.jsx(k,{className:"p-0",children:e.jsx(G,{data:h,columns:b,headerGradient:"from-blue-600 to-purple-600",maxHeight:"400px"})})]})]})})};export{ut as E,ct as F,dt as a,mt as b,vt as c,xt as d,ht as e,gt as f,pt as g};
