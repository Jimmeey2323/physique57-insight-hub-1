import{r as P,M as te,U as $,T as F,J as ve,j as e,F as re,b as be,K as ge,C as ue,c as H,S as pe,i as A,N as fe,v as _,O as we,h as I,f as Ne,Q as ne,R,V as X,u as le,W as ae,s as oe,g as je,e as se,w as ce,Y as ye,X as Me,Z as Ce}from"./react-vendor-Di6K3Iht.js";import{C as y,c as M,B as j,d as Y,j as S,k,D as Te,I as Z,Y as W,T as de,m as me,n as z,o as T,p as xe,q as N,Z as Re,_ as Ve,$ as Le,a0 as Se,r as ke,s as De,t as q,u as J}from"./ui-components-5QhQq56U.js";import{c as f,f as V,a as L}from"./utils-pQyXRPC2.js";import{R as K,P as $e,d as Pe,e as Ae,T as O,A as Ye,C as G,X as U,Y as E,f as Fe,B as ee,c as B,L as Ie,b as ie}from"./chart-vendor-BSHhUw40.js";import{m as he}from"./animation-vendor-BAkK5ra0.js";const ze=({filters:c,onFiltersChange:w,locations:b,trainers:u,membershipTypes:o})=>{const[r,n]=P.useState(!1),[a,g]=P.useState(""),d=(t,x)=>{const v=[...c[t]],C=v.includes(x)?v.filter(D=>D!==x):[...v,x];w({...c,[t]:C})},m=t=>{const x=v=>{const C=v.getFullYear(),D=String(v.getMonth()+1).padStart(2,"0"),Q=String(v.getDate()).padStart(2,"0");return`${C}-${D}-${Q}`};w({...c,dateRange:{start:t.from?x(t.from):"",end:t.to?x(t.to):""}})},s=()=>{w({dateRange:{start:"",end:""},location:[],homeLocation:[],trainer:[],paymentMethod:[],retentionStatus:[],conversionStatus:[],isNew:[],minLTV:void 0,maxLTV:void 0}),g("")},l=c.location.length+c.trainer.length+c.retentionStatus.length+c.conversionStatus.length+c.paymentMethod.length+c.isNew.length+(c.dateRange.start||c.dateRange.end?1:0)+(c.minLTV?1:0)+(c.maxLTV?1:0),h=["Kwality House, Kemps Corner","Supreme HQ, Bandra","Kenkere House, Bengaluru"],p=b.filter(t=>h.includes(t)),i=[{title:"Location & Geography",icon:te,filters:[{key:"location",label:"Visit Locations",options:p,values:c.location}]},{title:"Trainer & Service",icon:$,filters:[{key:"trainer",label:"Trainers",options:u.slice(0,12),values:c.trainer}]},{title:"Conversion & Status",icon:F,filters:[{key:"conversionStatus",label:"Conversion Status",options:["Converted","Not Converted","Pending"],values:c.conversionStatus},{key:"retentionStatus",label:"Retention Status",options:["Retained","Not Retained","At Risk"],values:c.retentionStatus},{key:"isNew",label:"Client Type",options:["New","Existing","Returning"],values:c.isNew}]},{title:"Payment & Membership",icon:ve,filters:[{key:"paymentMethod",label:"Payment Methods",options:["Online","Cash","Card","UPI","Bank Transfer"],values:c.paymentMethod}]}];return r?e.jsxs(y,{className:"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 border-0 shadow-xl overflow-hidden",children:[e.jsx(S,{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white",children:e.jsxs(k,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Advanced Client Filters"}),e.jsx("p",{className:"text-blue-100 text-sm",children:"Customize your analysis view"})]}),e.jsxs(j,{className:"bg-white/20 text-white border-white/30",children:[l," Active"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Y,{variant:"outline",size:"sm",onClick:s,disabled:l===0,className:"bg-white/10 border-white/30 text-white hover:bg-white/20",children:[e.jsx(ge,{className:"w-4 h-4 mr-1"}),"Reset"]}),e.jsx(Y,{variant:"ghost",size:"sm",onClick:()=>n(!1),className:"text-white hover:bg-white/20",children:e.jsx(ue,{className:"w-4 h-4"})})]})]})}),e.jsxs(M,{className:"p-8 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-bold text-slate-700 flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-blue-600"}),"Date Range"]}),e.jsx(Te,{value:{from:c.dateRange.start?new Date(c.dateRange.start):void 0,to:c.dateRange.end?new Date(c.dateRange.end):void 0},onChange:m})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-bold text-slate-700 flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-blue-600"}),"Quick Search"]}),e.jsx(Z,{placeholder:"Search trainers, locations...",value:a,onChange:t=>g(t.target.value),className:"bg-white border-slate-200"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"text-sm font-bold text-slate-700 flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-blue-600"}),"Lifetime Value Range"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Z,{type:"number",placeholder:"Min LTV (₹)",value:c.minLTV||"",onChange:t=>w({...c,minLTV:t.target.value?parseFloat(t.target.value):void 0}),className:"bg-white border-slate-200"}),e.jsx(Z,{type:"number",placeholder:"Max LTV (₹)",value:c.maxLTV||"",onChange:t=>w({...c,maxLTV:t.target.value?parseFloat(t.target.value):void 0}),className:"bg-white border-slate-200"})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:i.map(t=>e.jsxs(y,{className:"bg-white/70 border-slate-200 shadow-lg",children:[e.jsx(S,{className:"pb-4",children:e.jsxs(k,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(t.icon,{className:"w-5 h-5 text-blue-600"}),t.title]})}),e.jsx(M,{className:"space-y-4",children:t.filters.map(x=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-medium text-slate-700",children:[x.label,x.values.length>0&&e.jsxs(j,{variant:"secondary",className:"ml-2 text-xs bg-blue-100 text-blue-700",children:[x.values.length," selected"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 max-h-32 overflow-y-auto",children:x.options.filter(v=>!a||v.toLowerCase().includes(a.toLowerCase())).map(v=>e.jsx(Y,{variant:x.values.includes(v)?"default":"outline",size:"sm",onClick:()=>d(x.key,v),className:`text-xs transition-all duration-200 ${x.values.includes(v)?"bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-md":"hover:bg-blue-50 border-slate-200 hover:border-blue-300"}`,children:v},v))})]},x.key))})]},t.title))})]})]}):e.jsx(y,{className:"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 border-0 shadow-xl",children:e.jsx(M,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg",children:e.jsx(re,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-800",children:"Advanced Filters"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Refine your client analysis"})]}),l>0&&e.jsxs(j,{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white",children:[l," active"]})]}),e.jsxs(Y,{variant:"outline",onClick:()=>n(!0),className:"gap-2 border-blue-200 text-blue-700 hover:bg-blue-50",children:[e.jsx(be,{className:"w-4 h-4"}),"Expand Filters"]})]})})})},He=({data:c,onCardClick:w})=>{const b=c.length,u=c.filter(i=>String(i.isNew||"").toLowerCase().includes("new")).length,o=c.filter(i=>i.conversionStatus==="Converted").length,r=c.filter(i=>i.retentionStatus==="Retained").length,n=c.length,a=n>0?o/n*100:0,g=u>0?o/u*100:0,d=u>0?r/u*100:0,m=c.reduce((i,t)=>i+(t.ltv||0),0),s=b>0?m/b:0,l=c.filter(i=>i.conversionStatus==="Converted"&&i.firstPurchase&&i.firstVisitDate),h=l.length>0?l.reduce((i,t)=>{const x=new Date(t.firstVisitDate),v=new Date(t.firstPurchase);if(!isNaN(x.getTime())&&!isNaN(v.getTime())){const C=v.getTime()-x.getTime(),D=Math.ceil(C/(1e3*60*60*24));return i+Math.max(0,D)}return i},0)/l.length:0,p=[{title:"New Members",value:f(u),icon:fe,gradient:"from-blue-500 to-indigo-600",description:"Recently acquired clients",change:12.5,isPositive:!0,previousValue:f(u-Math.round(u*.125)),period:"vs last month",metricType:"new_members",filterData:()=>c.filter(i=>String(i.isNew||"").toLowerCase().includes("new"))},{title:"Converted Members",value:f(o),icon:_,gradient:"from-green-500 to-teal-600",description:"Trial to paid conversions",change:8.3,isPositive:!0,previousValue:f(o-Math.round(o*.083)),period:"vs last month",metricType:"converted_members",filterData:()=>c.filter(i=>i.conversionStatus==="Converted")},{title:"Retained Members",value:f(r),icon:we,gradient:"from-purple-500 to-violet-600",description:"Active retained clients",change:15.2,isPositive:!0,previousValue:f(r-Math.round(r*.152)),period:"vs last month",metricType:"retained_members",filterData:()=>c.filter(i=>i.retentionStatus==="Retained")},{title:"Conversion Rate",value:`${g.toFixed(1)}%`,icon:I,gradient:"from-orange-500 to-red-600",description:"New to converted rate",change:4.8,isPositive:!0,previousValue:`${(g-4.8).toFixed(1)}%`,period:"vs last month",metricType:"conversion_rate",filterData:()=>c.filter(i=>String(i.isNew||"").includes("New")||i.conversionStatus==="Converted")},{title:"Retention Rate",value:`${d.toFixed(1)}%`,icon:F,gradient:"from-cyan-500 to-blue-600",description:"Member retention rate",change:"+3.1%",isPositive:!0,metricType:"retention_rate",filterData:()=>c.filter(i=>i.retentionStatus==="Retained")},{title:"Avg LTV",value:V(s),icon:A,gradient:"from-pink-500 to-rose-600",description:"Average lifetime value",change:"+7.2%",isPositive:!0,metricType:"avg_ltv",filterData:()=>c.filter(i=>(i.ltv||0)>0)},{title:"Avg Conv. Time",value:`${h.toFixed(0)} days`,icon:Ne,gradient:"from-emerald-500 to-green-600",description:"Average conversion time",change:"-2.1 days",isPositive:!0,metricType:"avg_conv_time",filterData:()=>c.filter(i=>i.conversionStatus==="Converted"&&i.firstPurchase&&i.firstVisitDate)},{title:"Trial → Member",value:`${a.toFixed(1)}%`,icon:ne,gradient:"from-indigo-500 to-purple-600",description:"Trial conversion rate",change:"+5.4%",isPositive:!0,metricType:"trial_to_member",filterData:()=>c.filter(i=>(i.visitsPostTrial||0)>0)}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:p.map((i,t)=>e.jsxs(y,{className:"group relative overflow-hidden bg-white border border-slate-200 shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1 cursor-pointer",onClick:()=>w?.(i.title,i.filterData(),i.metricType),children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${i.gradient} opacity-3 group-hover:opacity-8 transition-opacity duration-300`}),e.jsxs(M,{className:"relative p-6 z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-xl bg-gradient-to-br ${i.gradient} shadow-lg group-hover:scale-110 transition-transform duration-300`,children:e.jsx(i.icon,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"text-right",children:[e.jsxs(j,{className:`text-xs px-3 py-1 font-medium transition-all duration-300 mb-1 ${i.isPositive?"bg-green-100 text-green-800 border-green-200 group-hover:bg-green-200":"bg-red-100 text-red-800 border-red-200 group-hover:bg-red-200"}`,children:[i.isPositive?"+":"",i.change]}),i.previousValue&&e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[e.jsxs("div",{children:["From: ",i.previousValue]}),e.jsx("div",{className:"text-xs opacity-75",children:i.period})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 group-hover:text-slate-800 transition-colors",children:i.title}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsx("span",{className:"text-3xl font-bold text-slate-900 group-hover:text-slate-800 transition-colors",children:i.value})}),e.jsx("p",{className:"text-xs text-slate-500 group-hover:text-slate-600 transition-colors leading-relaxed",children:i.description}),e.jsx("div",{className:"pt-3 border-t border-slate-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`flex-1 h-1 bg-gradient-to-r ${i.gradient} rounded-full opacity-30 group-hover:opacity-50 transition-opacity`}),e.jsx(ne,{className:"w-4 h-4 text-slate-400 ml-3 group-hover:text-slate-600 transition-colors"})]})})]})]})]},i.title))})},Be=({data:c})=>{const[w,b]=P.useState("trainer-conversion"),u=R.useMemo(()=>{const i=new Map;return c.forEach(t=>{const x=t.trainerName||"Unknown";i.has(x)||i.set(x,{name:x,totalClients:0,newMembers:0,converted:0,retained:0,totalLTV:0,trialsCompleted:0});const v=i.get(x);v.totalClients++,v.totalLTV+=t.ltv||0,String(t.isNew||"").includes("New")&&v.newMembers++,t.conversionStatus==="Converted"&&v.converted++,t.retentionStatus==="Retained"&&v.retained++,(t.visitsPostTrial||0)>0&&v.trialsCompleted++}),Array.from(i.values()).map(t=>({...t,conversionRate:t.newMembers>0?t.converted/t.newMembers*100:0,retentionRate:t.converted>0?t.retained/t.converted*100:0,avgLTV:t.totalClients>0?t.totalLTV/t.totalClients:0,trialConversionRate:t.trialsCompleted>0?t.converted/t.trialsCompleted*100:0}))},[c]),o=R.useMemo(()=>{const i=new Map;return c.forEach(t=>{const x=t.firstVisitLocation||t.homeLocation||"Unknown";i.has(x)||i.set(x,{name:x,totalClients:0,newMembers:0,converted:0,retained:0,totalLTV:0,trialsCompleted:0});const v=i.get(x);v.totalClients++,v.totalLTV+=t.ltv||0,String(t.isNew||"").includes("New")&&v.newMembers++,t.conversionStatus==="Converted"&&v.converted++,t.retentionStatus==="Retained"&&v.retained++,(t.visitsPostTrial||0)>0&&v.trialsCompleted++}),Array.from(i.values()).map(t=>({...t,conversionRate:t.newMembers>0?t.converted/t.newMembers*100:0,retentionRate:t.converted>0?t.retained/t.converted*100:0,avgLTV:t.totalClients>0?t.totalLTV/t.totalClients:0,trialConversionRate:t.trialsCompleted>0?t.converted/t.trialsCompleted*100:0}))},[c]),r=R.useMemo(()=>{const i=new Map;return c.forEach(t=>{const x=t.firstVisitEntityName||"Unknown Class";i.has(x)||i.set(x,{name:x,totalClients:0,newMembers:0,converted:0,retained:0,totalLTV:0,trialsCompleted:0});const v=i.get(x);v.totalClients++,v.totalLTV+=t.ltv||0,String(t.isNew||"").includes("New")&&v.newMembers++,t.conversionStatus==="Converted"&&v.converted++,t.retentionStatus==="Retained"&&v.retained++,(t.visitsPostTrial||0)>0&&v.trialsCompleted++}),Array.from(i.values()).map(t=>({...t,conversionRate:t.newMembers>0?t.converted/t.newMembers*100:0,retentionRate:t.converted>0?t.retained/t.converted*100:0,avgLTV:t.totalClients>0?t.totalLTV/t.totalClients:0,trialConversionRate:t.trialsCompleted>0?t.converted/t.trialsCompleted*100:0}))},[c]),n=R.useMemo(()=>{const i=new Map;return c.forEach(t=>{const x=t.membershipUsed||"Unknown Membership";i.has(x)||i.set(x,{name:x,totalClients:0,newMembers:0,converted:0,retained:0,totalLTV:0,trialsCompleted:0});const v=i.get(x);v.totalClients++,v.totalLTV+=t.ltv||0,String(t.isNew||"").includes("New")&&v.newMembers++,t.conversionStatus==="Converted"&&v.converted++,t.retentionStatus==="Retained"&&v.retained++,(t.visitsPostTrial||0)>0&&v.trialsCompleted++}),Array.from(i.values()).map(t=>({...t,conversionRate:t.newMembers>0?t.converted/t.newMembers*100:0,retentionRate:t.converted>0?t.retained/t.converted*100:0,avgLTV:t.totalClients>0?t.totalLTV/t.totalClients:0,trialConversionRate:t.trialsCompleted>0?t.converted/t.trialsCompleted*100:0}))},[c]),a=R.useMemo(()=>{const i=new Map;return c.forEach(t=>{const x=`${t.trainerName||"Unknown"} - ${t.firstVisitEntityName||"Unknown Class"}`;i.has(x)||i.set(x,{name:x,trainer:t.trainerName||"Unknown",className:t.firstVisitEntityName||"Unknown Class",totalClients:0,newMembers:0,converted:0,retained:0,totalLTV:0,trialsCompleted:0});const v=i.get(x);v.totalClients++,v.totalLTV+=t.ltv||0,String(t.isNew||"").includes("New")&&v.newMembers++,t.conversionStatus==="Converted"&&v.converted++,t.retentionStatus==="Retained"&&v.retained++,(t.visitsPostTrial||0)>0&&v.trialsCompleted++}),Array.from(i.values()).map(t=>({...t,conversionRate:t.newMembers>0?t.converted/t.newMembers*100:0,retentionRate:t.converted>0?t.retained/t.converted*100:0,avgLTV:t.totalClients>0?t.totalLTV/t.totalClients:0,trialConversionRate:t.trialsCompleted>0?t.converted/t.trialsCompleted*100:0}))},[c]),g=[{id:"trainer-conversion",label:"Trainer Conversion",icon:X,type:"trainer",metric:"conversionRate"},{id:"trainer-retention",label:"Trainer Retention",icon:F,type:"trainer",metric:"retentionRate"},{id:"trainer-ltv",label:"Trainer LTV",icon:A,type:"trainer",metric:"avgLTV"},{id:"trainer-volume",label:"Trainer Volume",icon:$,type:"trainer",metric:"totalClients"},{id:"location-conversion",label:"Location Conversion",icon:te,type:"location",metric:"conversionRate"},{id:"location-retention",label:"Location Retention",icon:_,type:"location",metric:"retentionRate"},{id:"location-ltv",label:"Location LTV",icon:I,type:"location",metric:"avgLTV"},{id:"location-volume",label:"Location Volume",icon:$,type:"location",metric:"totalClients"},{id:"class-conversion",label:"Class Conversion",icon:H,type:"class",metric:"conversionRate"},{id:"class-retention",label:"Class Retention",icon:le,type:"class",metric:"retentionRate"},{id:"class-ltv",label:"Class LTV",icon:A,type:"class",metric:"avgLTV"},{id:"class-volume",label:"Class Volume",icon:$,type:"class",metric:"totalClients"},{id:"membership-conversion",label:"Membership Conversion",icon:_,type:"membership",metric:"conversionRate"},{id:"membership-retention",label:"Membership Retention",icon:F,type:"membership",metric:"retentionRate"},{id:"membership-ltv",label:"Membership LTV",icon:A,type:"membership",metric:"avgLTV"},{id:"membership-volume",label:"Membership Volume",icon:$,type:"membership",metric:"totalClients"},{id:"hosted-conversion",label:"Hosted Class Conversion",icon:X,type:"hosted",metric:"conversionRate"},{id:"hosted-retention",label:"Hosted Class Retention",icon:F,type:"hosted",metric:"retentionRate"},{id:"hosted-ltv",label:"Hosted Class LTV",icon:A,type:"hosted",metric:"avgLTV"},{id:"hosted-volume",label:"Hosted Class Volume",icon:$,type:"hosted",metric:"totalClients"}],d=()=>{const i=g.find(D=>D.id===w);if(!i)return{top:[],bottom:[]};let t;switch(i.type){case"trainer":t=u;break;case"location":t=o;break;case"class":t=r;break;case"membership":t=n;break;case"hosted":t=a;break;default:t=u}const x=i.type==="hosted"?1:i.type==="trainer"?3:1,C=[...t.filter(D=>i.metric==="totalClients"?D.totalClients>=1:D.newMembers>=x)].sort((D,Q)=>Q[i.metric]-D[i.metric]);return{top:C.slice(0,5),bottom:C.slice(-5).reverse()}},{top:m,bottom:s}=d(),l=g.find(i=>i.id===w),h=(i,t)=>t==="avgLTV"?V(i):t==="totalClients"?f(i):`${i.toFixed(1)}%`,p=({title:i,data:t,isTop:x=!0})=>e.jsxs(y,{className:"group bg-white shadow-lg border-0 overflow-hidden hover:shadow-2xl transition-all duration-500 hover:scale-105",children:[e.jsxs(S,{className:`bg-gradient-to-r ${x?"from-emerald-500 to-teal-600":"from-orange-500 to-red-600"} text-white relative overflow-hidden`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 transform translate-x-8 -translate-y-8 opacity-20",children:x?e.jsx(ae,{className:"w-20 h-20"}):e.jsx(oe,{className:"w-20 h-20"})}),e.jsxs(k,{className:"flex items-center gap-3 relative z-10",children:[x?e.jsx(ae,{className:"w-6 h-6"}):e.jsx(oe,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold",children:i}),e.jsx("p",{className:"text-sm opacity-90 font-normal",children:x?"Top performers":"Needs attention"})]})]})]}),e.jsx(M,{className:"p-6 space-y-4",children:t.map((v,C)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-slate-50 to-slate-100 rounded-xl hover:from-slate-100 hover:to-slate-200 transition-all duration-300 group-hover:scale-105",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full font-bold text-sm transition-all duration-300 ${C===0&&x?"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white shadow-lg":C===1&&x?"bg-gradient-to-r from-gray-300 to-gray-500 text-white shadow-lg":C===2&&x?"bg-gradient-to-r from-orange-400 to-orange-600 text-white shadow-lg":"bg-gradient-to-r from-slate-200 to-slate-300 text-slate-600"}`,children:C+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900 truncate max-w-[140px]",title:v.name,children:v.name}),e.jsxs("p",{className:"text-sm text-slate-500",children:[f(v.totalClients)," clients",v.trainer&&e.jsxs("span",{className:"block text-xs",children:["by ",v.trainer]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(j,{className:`font-bold text-sm px-3 py-1 ${x?"bg-emerald-100 text-emerald-800 border border-emerald-200":"bg-orange-100 text-orange-800 border border-orange-200"}`,children:h(v[l?.metric||"conversionRate"],l?.metric||"conversionRate")}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[V(v.avgLTV)," LTV"]})]})]},v.name))})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(y,{className:"bg-white shadow-lg border-0",children:[e.jsx(S,{children:e.jsxs(k,{className:"flex items-center gap-3 text-slate-800",children:[e.jsx(X,{className:"w-6 h-6 text-yellow-600"}),"Performance Rankings"]})}),e.jsx(M,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3",children:g.map(i=>e.jsxs(Y,{variant:w===i.id?"default":"ghost",size:"sm",onClick:()=>b(i.id),className:`flex flex-col items-center gap-2 h-auto py-3 px-2 transition-all duration-300 hover:scale-105 ${w===i.id?"bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg":"hover:bg-slate-100"}`,children:[e.jsx(i.icon,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium text-center leading-tight",children:i.label})]},i.id))})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(p,{title:`Top ${l?.label||"Performance"}`,data:m,isTop:!0}),e.jsx(p,{title:`Bottom ${l?.label||"Performance"}`,data:s,isTop:!1})]})]})},_e=({data:c})=>{const[w,b]=P.useState("monthly-trends"),u=[{id:"monthly-trends",label:"Monthly Trends",icon:I,type:"line"},{id:"conversion-funnel",label:"Conversion Funnel",icon:F,type:"bar"},{id:"location-performance",label:"Location Performance",icon:te,type:"bar"},{id:"trainer-performance",label:"Trainer Performance",icon:$,type:"bar"},{id:"retention-analysis",label:"Retention Analysis",icon:je,type:"area"},{id:"ltv-distribution",label:"LTV Distribution",icon:A,type:"pie"}],o=R.useMemo(()=>{const m=new Map;return c.forEach(s=>{if(!s.firstVisitDate)return;let l;if(s.firstVisitDate.includes("/")){const[i,t,x]=s.firstVisitDate.split(" ")[0].split("/");l=new Date(parseInt(x),parseInt(t)-1,parseInt(i))}else l=new Date(s.firstVisitDate);if(isNaN(l.getTime()))return;const h=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}`;m.has(h)||m.set(h,{month:h,newMembers:0,converted:0,retained:0,revenue:0});const p=m.get(h);String(s.isNew||"").includes("New")&&p.newMembers++,s.conversionStatus==="Converted"&&p.converted++,s.retentionStatus==="Retained"&&p.retained++,p.revenue+=s.ltv||0}),Array.from(m.values()).sort((s,l)=>s.month.localeCompare(l.month)).map(s=>({...s,conversionRate:s.newMembers>0?s.converted/s.newMembers*100:0,retentionRate:s.converted>0?s.retained/s.converted*100:0}))},[c]),r=R.useMemo(()=>{const m=new Map;return c.forEach(s=>{const l=s.firstVisitLocation||s.homeLocation||"Unknown";m.has(l)||m.set(l,{location:l,newMembers:0,converted:0,retained:0,revenue:0});const h=m.get(l);String(s.isNew||"").includes("New")&&h.newMembers++,s.conversionStatus==="Converted"&&h.converted++,s.retentionStatus==="Retained"&&h.retained++,h.revenue+=s.ltv||0}),Array.from(m.values()).map(s=>({...s,conversionRate:s.newMembers>0?s.converted/s.newMembers*100:0,retentionRate:s.converted>0?s.retained/s.converted*100:0})).sort((s,l)=>l.revenue-s.revenue)},[c]),n=R.useMemo(()=>{const m=new Map;return c.forEach(s=>{const l=s.trainerName||"Unknown";m.has(l)||m.set(l,{trainer:l,newMembers:0,converted:0,retained:0,revenue:0});const h=m.get(l);String(s.isNew||"").includes("New")&&h.newMembers++,s.conversionStatus==="Converted"&&h.converted++,s.retentionStatus==="Retained"&&h.retained++,h.revenue+=s.ltv||0}),Array.from(m.values()).filter(s=>s.newMembers>=3).map(s=>({...s,conversionRate:s.newMembers>0?s.converted/s.newMembers*100:0,retentionRate:s.converted>0?s.retained/s.converted*100:0})).sort((s,l)=>l.conversionRate-s.conversionRate).slice(0,10)},[c]),a=R.useMemo(()=>{const m=[{name:"₹0-5K",min:0,max:5e3,count:0,color:"#ef4444"},{name:"₹5K-15K",min:5e3,max:15e3,count:0,color:"#f97316"},{name:"₹15K-30K",min:15e3,max:3e4,count:0,color:"#eab308"},{name:"₹30K-50K",min:3e4,max:5e4,count:0,color:"#22c55e"},{name:"₹50K+",min:5e4,max:1/0,count:0,color:"#3b82f6"}];return c.forEach(s=>{const l=s.ltv||0,h=m.find(p=>l>=p.min&&l<p.max);h&&h.count++}),m.filter(s=>s.count>0)},[c]),g=()=>{switch(u.find(m=>m.id===w),w){case"monthly-trends":return e.jsx(K,{width:"100%",height:400,children:e.jsxs(Ie,{data:o,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(G,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(U,{dataKey:"month",stroke:"#64748b",fontSize:12,tickFormatter:s=>{const[l,h]=s.split("-");return`${h}/${l.slice(2)}`}}),e.jsx(E,{stroke:"#64748b",fontSize:12}),e.jsx(O,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:(s,l)=>[l.includes("Rate")?`${s.toFixed(1)}%`:f(s),l]}),e.jsx(ie,{type:"monotone",dataKey:"newMembers",stroke:"#3b82f6",strokeWidth:3,dot:{fill:"#3b82f6",strokeWidth:2,r:6},name:"New Members"}),e.jsx(ie,{type:"monotone",dataKey:"conversionRate",stroke:"#22c55e",strokeWidth:3,dot:{fill:"#22c55e",strokeWidth:2,r:6},name:"Conversion Rate"})]})});case"conversion-funnel":const m=[{name:"New Members",value:c.filter(s=>String(s.isNew||"").includes("New")).length,color:"#3b82f6"},{name:"Trials Completed",value:c.filter(s=>(s.visitsPostTrial||0)>0).length,color:"#8b5cf6"},{name:"Converted",value:c.filter(s=>s.conversionStatus==="Converted").length,color:"#22c55e"},{name:"Retained",value:c.filter(s=>s.retentionStatus==="Retained").length,color:"#f97316"}];return e.jsx(K,{width:"100%",height:400,children:e.jsxs(ee,{data:m,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(G,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(U,{dataKey:"name",stroke:"#64748b",fontSize:12}),e.jsx(E,{stroke:"#64748b",fontSize:12}),e.jsx(O,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:s=>[f(s),"Count"]}),e.jsx(B,{dataKey:"value",fill:"#3b82f6",radius:[4,4,0,0]})]})});case"location-performance":return e.jsx(K,{width:"100%",height:400,children:e.jsxs(ee,{data:r,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(G,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(U,{dataKey:"location",stroke:"#64748b",fontSize:12,angle:-45,textAnchor:"end",height:80,tickFormatter:s=>s.length>15?`${s.slice(0,15)}...`:s}),e.jsx(E,{stroke:"#64748b",fontSize:12}),e.jsx(O,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:(s,l)=>[l.includes("Rate")?`${s.toFixed(1)}%`:f(s),l]}),e.jsx(B,{dataKey:"conversionRate",fill:"#22c55e",radius:[4,4,0,0],name:"Conversion Rate"})]})});case"trainer-performance":return e.jsx(K,{width:"100%",height:400,children:e.jsxs(ee,{data:n,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(G,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(U,{dataKey:"trainer",stroke:"#64748b",fontSize:12,angle:-45,textAnchor:"end",height:80,tickFormatter:s=>s.length>10?`${s.slice(0,10)}...`:s}),e.jsx(E,{stroke:"#64748b",fontSize:12}),e.jsx(O,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:(s,l)=>[l.includes("Rate")?`${s.toFixed(1)}%`:f(s),l]}),e.jsx(B,{dataKey:"conversionRate",fill:"#8b5cf6",radius:[4,4,0,0],name:"Conversion Rate"}),e.jsx(B,{dataKey:"retentionRate",fill:"#06b6d4",radius:[4,4,0,0],name:"Retention Rate"})]})});case"retention-analysis":return e.jsx(K,{width:"100%",height:400,children:e.jsxs(Ye,{data:o,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(G,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(U,{dataKey:"month",stroke:"#64748b",fontSize:12,tickFormatter:s=>{const[l,h]=s.split("-");return`${h}/${l.slice(2)}`}}),e.jsx(E,{stroke:"#64748b",fontSize:12}),e.jsx(O,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:(s,l)=>[l.includes("Rate")?`${s.toFixed(1)}%`:f(s),l]}),e.jsx(Fe,{type:"monotone",dataKey:"retentionRate",stackId:"1",stroke:"#f97316",fill:"url(#retentionGradient)",name:"Retention Rate"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"retentionGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#f97316",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#f97316",stopOpacity:.1})]})})]})});case"ltv-distribution":return e.jsx(K,{width:"100%",height:400,children:e.jsxs($e,{children:[e.jsx(Pe,{data:a,cx:"50%",cy:"50%",outerRadius:150,fill:"#8884d8",dataKey:"count",label:({name:s,percent:l})=>`${s} (${(l*100).toFixed(1)}%)`,children:a.map((s,l)=>e.jsx(Ae,{fill:s.color},`cell-${l}`))}),e.jsx(O,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:s=>[f(s),"Clients"]})]})});default:return null}},d=u.find(m=>m.id===w);return e.jsxs(y,{className:"bg-white shadow-lg border-0 overflow-hidden",children:[e.jsx(S,{className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white",children:e.jsxs(k,{className:"flex items-center gap-3",children:[e.jsx(se,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-sm opacity-90",children:"Interactive charts and visualizations"})]})]})}),e.jsxs(M,{className:"p-6",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3 mb-6",children:u.map(m=>e.jsxs(Y,{variant:w===m.id?"default":"ghost",size:"sm",onClick:()=>b(m.id),className:`flex flex-col items-center gap-2 h-auto py-4 px-3 transition-all duration-300 hover:scale-105 ${w===m.id?"bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg":"hover:bg-slate-100"}`,children:[e.jsx(m.icon,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium text-center leading-tight",children:m.label})]},m.id))}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[d&&e.jsx(d.icon,{className:"w-5 h-5 text-slate-600"}),e.jsx("h4",{className:"text-lg font-semibold text-slate-800",children:d?.label})]}),e.jsxs(j,{className:"bg-blue-100 text-blue-800",children:[c.length," records"]})]}),g()]})]})]})},We=({activeTable:c,onTableChange:w,dataLength:b})=>{const u=[{key:"monthonmonthbytype",label:"By Client Type",description:"Monthly breakdown by client type",icon:$,gradient:"from-purple-500 to-pink-600"},{key:"monthonmonth",label:"Month on Month",description:"Monthly trends and comparisons",icon:H,gradient:"from-blue-500 to-indigo-600"},{key:"yearonyear",label:"Year on Year",description:"Annual performance comparison",icon:I,gradient:"from-green-500 to-emerald-600"},{key:"hostedclasses",label:"Hosted Classes",description:"Class performance metrics",icon:$,gradient:"from-purple-500 to-violet-600"},{key:"memberships",label:"Membership Analysis",description:"Membership type breakdown",icon:se,gradient:"from-orange-500 to-red-600"}];return e.jsxs("div",{className:"bg-gradient-to-r from-slate-50 to-gray-100 p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Data Analysis Tables"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Select a table to view detailed metrics"})]}),e.jsxs(j,{className:"bg-blue-100 text-blue-800 border-blue-200",children:[b," Records"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:u.map(o=>e.jsxs(Y,{variant:c===o.key?"default":"outline",className:`h-auto p-4 flex-col items-start gap-2 transition-all duration-300 ${c===o.key?`bg-gradient-to-r ${o.gradient} text-white shadow-lg hover:shadow-xl`:"bg-white hover:bg-gray-50 border-gray-200 hover:border-gray-300"}`,onClick:()=>w(o.key),children:[e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx(o.icon,{className:`w-5 h-5 ${c===o.key?"text-white":"text-gray-600"}`}),e.jsx("span",{className:`font-semibold text-sm ${c===o.key?"text-white":"text-gray-900"}`,children:o.label})]}),e.jsx("p",{className:`text-xs text-left w-full ${c===o.key?"text-white/90":"text-gray-500"}`,children:o.description})]},o.key))})]})},Qe=({data:c,onRowClick:w})=>{const b=R.useMemo(()=>{const a=(()=>{const d=[],m=new Date,s=m.getMonth(),l=m.getFullYear();for(let h=l;h>=2024;h--){const p=h===l?s:11,i=0;for(let t=p;t>=i;t--){const x=`${h}-${(t+1).toString().padStart(2,"0")}`,v=new Date(h,t).toLocaleDateString("en-US",{month:"short",year:"numeric"});d.push({key:x,name:v})}}return d})().reduce((d,m)=>(d[m.key]={month:m.name,sortKey:m.key,totalMembers:0,newMembers:0,converted:0,retained:0,totalLTV:0,conversionIntervals:[],visitsPostTrial:[],clients:[]},d),{});return c.forEach(d=>{const m=d.firstVisitDate;let s;if(m.includes("/")){const h=m.split(" ")[0].split("/");if(h.length===3){const[p,i,t]=h;s=new Date(parseInt(t),parseInt(i)-1,parseInt(p)),isNaN(s.getTime())&&(s=new Date(parseInt(t),parseInt(p)-1,parseInt(i)))}else s=new Date(m)}else s=new Date(m);if(isNaN(s.getTime()))return;const l=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`;if(a[l]){if(a[l].totalMembers++,a[l].clients.push(d),(d.isNew||"").toLowerCase().includes("new")&&a[l].newMembers++,d.conversionStatus==="Converted"&&a[l].converted++,d.retentionStatus==="Retained"&&a[l].retained++,a[l].totalLTV+=d.ltv||0,d.firstPurchase&&d.firstVisitDate){const h=new Date(d.firstVisitDate),p=new Date(d.firstPurchase);if(!isNaN(h.getTime())&&!isNaN(p.getTime())){const i=Math.ceil((p.getTime()-h.getTime())/864e5);i>=0&&a[l].conversionIntervals.push(i)}}d.visitsPostTrial&&d.visitsPostTrial>0&&a[l].visitsPostTrial.push(d.visitsPostTrial)}}),Object.values(a).map(d=>({...d,trialsCompleted:d.visitsPostTrial.length,conversionRate:d.newMembers>0?d.converted/d.newMembers*100:0,retentionRate:d.newMembers>0?d.retained/d.newMembers*100:0,avgLTV:d.totalMembers>0?d.totalLTV/d.totalMembers:0,avgConversionInterval:d.conversionIntervals.length>0?d.conversionIntervals.reduce((m,s)=>m+s,0)/d.conversionIntervals.length:0,avgVisitsPostTrial:d.visitsPostTrial.length>0?d.visitsPostTrial.reduce((m,s)=>m+s,0)/d.visitsPostTrial.length:0})).sort((d,m)=>m.sortKey.localeCompare(d.sortKey))},[c]),u=[{key:"month",header:"Month",className:"font-semibold min-w-[100px]",render:r=>e.jsx("div",{className:"font-bold text-slate-800 bg-gradient-to-r from-blue-50 to-purple-50 px-3 py-2 rounded-lg",children:r})},{key:"totalMembers",header:"Total Members",align:"center",render:r=>e.jsx("span",{className:"text-base font-bold text-blue-600",children:f(r)})},{key:"newMembers",header:"New Members",align:"center",render:r=>e.jsx("span",{className:"text-base font-bold text-green-600",children:f(r)})},{key:"converted",header:"Converted",align:"center",render:r=>e.jsx("span",{className:"text-base font-bold text-emerald-600",children:f(r)})},{key:"conversionRate",header:"Conv. Rate",align:"center",render:r=>e.jsxs("span",{className:`text-base font-bold ${r>25?"text-green-600":r<10?"text-red-600":"text-slate-600"}`,children:[r.toFixed(1),"%"]})},{key:"retained",header:"Retained",align:"center",render:r=>e.jsx("span",{className:"text-base font-bold text-purple-600",children:f(r)})},{key:"retentionRate",header:"Ret. Rate",align:"center",render:r=>e.jsxs("span",{className:`text-base font-bold ${r>70?"text-purple-600":r<40?"text-red-600":"text-slate-600"}`,children:[r.toFixed(1),"%"]})},{key:"totalLTV",header:"Total LTV",align:"right",render:r=>e.jsx("span",{className:"text-base font-bold text-emerald-600",children:V(r)})},{key:"avgLTV",header:"Avg LTV",align:"right",render:r=>e.jsx("span",{className:"text-base font-bold text-teal-600",children:V(r)})},{key:"avgConversionInterval",header:"Conv. Days",align:"center",render:r=>e.jsx("span",{className:"text-base font-bold text-orange-600",children:Math.round(r)})},{key:"avgVisitsPostTrial",header:"Avg Visits",align:"center",render:r=>e.jsx("span",{className:"text-base font-bold text-blue-600",children:r.toFixed(1)})}],o={month:"TOTAL",totalMembers:b.reduce((r,n)=>r+n.totalMembers,0),newMembers:b.reduce((r,n)=>r+n.newMembers,0),converted:b.reduce((r,n)=>r+n.converted,0),conversionRate:0,retained:b.reduce((r,n)=>r+n.retained,0),retentionRate:0,totalLTV:b.reduce((r,n)=>r+n.totalLTV,0),avgLTV:b.reduce((r,n)=>r+n.totalLTV,0)/Math.max(b.reduce((r,n)=>r+n.totalMembers,0),1),avgConversionInterval:b.reduce((r,n)=>r+n.avgConversionInterval*n.totalMembers,0)/Math.max(b.reduce((r,n)=>r+n.totalMembers,0),1),avgVisitsPostTrial:b.reduce((r,n)=>r+n.avgVisitsPostTrial*n.totalMembers,0)/Math.max(b.reduce((r,n)=>r+n.totalMembers,0),1)};return o.conversionRate=o.newMembers>0?o.converted/o.newMembers*100:0,o.retentionRate=o.newMembers>0?o.retained/o.newMembers*100:0,e.jsx(he.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs(y,{className:"bg-white shadow-xl border-0 overflow-hidden hover:shadow-2xl transition-all duration-300",children:[e.jsx(S,{className:"border-b border-gray-100 bg-gradient-to-r from-blue-600 to-cyan-600 text-white",children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Month-on-Month Client Conversion Analysis",e.jsxs(j,{variant:"secondary",className:"bg-white/20 text-white",children:[b.length," Months"]})]})}),e.jsx(M,{className:"p-0",children:e.jsx(W,{data:b,columns:u,headerGradient:"from-blue-600 to-cyan-600",showFooter:!0,footerData:o,maxHeight:"600px",onRowClick:w})})]})})},Xe=({data:c,onRowClick:w})=>{const b=P.useMemo(()=>{[...new Set(c.map(a=>a.conversionStatus).filter(Boolean))],[...new Set(c.map(a=>a.retentionStatus).filter(Boolean))],[...new Set(c.map(a=>a.isNew||"Unknown").filter(Boolean))];const n={};return c.forEach(a=>{const g=a.firstVisitDate;if(!g)return;let d;if(g.includes("/")){const t=g.split(" ")[0].split("/");if(t.length===3){const[x,v,C]=t;d=new Date(parseInt(C),parseInt(v)-1,parseInt(x)),isNaN(d.getTime())&&(d=new Date(parseInt(C),parseInt(x)-1,parseInt(v)))}else d=new Date(g)}else d=new Date(g);if(isNaN(d.getTime()))return;const m=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}`,s=d.toLocaleDateString("en-US",{month:"short",year:"numeric"}),l=a.isNew||"Unknown",h=`${m}-${l}`;n[h]||(n[h]={month:s,sortKey:m,type:l,totalMembers:0,newMembers:0,converted:0,retained:0,totalLTV:0,conversionIntervals:[],visitsPostTrial:[],clients:[]});const p=n[h];p.totalMembers++,p.clients.push(a),(a.isNew||"").toLowerCase().includes("new")&&p.newMembers++,a.conversionStatus==="Converted"&&p.converted++,a.retentionStatus==="Retained"&&p.retained++,p.totalLTV+=a.ltv||0,a.conversionSpan&&a.conversionSpan>0&&p.conversionIntervals.push(a.conversionSpan),a.visitsPostTrial&&a.visitsPostTrial>0&&p.visitsPostTrial.push(a.visitsPostTrial)}),Object.values(n).sort((a,g)=>{const d=a.sortKey.localeCompare(g.sortKey);return d!==0?d:a.type.toLowerCase().includes("new")&&!g.type.toLowerCase().includes("new")?-1:!a.type.toLowerCase().includes("new")&&g.type.toLowerCase().includes("new")?1:a.type.localeCompare(g.type)})},[c]),u=P.useMemo(()=>b.map(n=>{const a=n.newMembers>0?n.converted/n.newMembers*100:0,g=n.newMembers>0?n.retained/n.newMembers*100:0,d=n.totalMembers>0?n.totalLTV/n.totalMembers:0,m=n.conversionIntervals.length>0?n.conversionIntervals.reduce((l,h)=>l+h,0)/n.conversionIntervals.length:0,s=n.visitsPostTrial.length>0?n.visitsPostTrial.reduce((l,h)=>l+h,0)/n.visitsPostTrial.length:0;return{...n,conversionRate:a,retentionRate:g,avgLTV:d,avgConversionDays:m,avgVisits:s}}),[b]),o=P.useMemo(()=>u.reduce((n,a)=>({totalMembers:n.totalMembers+a.totalMembers,newMembers:n.newMembers+a.newMembers,converted:n.converted+a.converted,retained:n.retained+a.retained,totalLTV:n.totalLTV+a.totalLTV,conversionIntervals:[...n.conversionIntervals,...a.conversionIntervals],visitsPostTrial:[...n.visitsPostTrial,...a.visitsPostTrial]}),{totalMembers:0,newMembers:0,converted:0,retained:0,totalLTV:0,conversionIntervals:[],visitsPostTrial:[]}),[u]),r=P.useMemo(()=>{const n=o.newMembers>0?o.converted/o.newMembers*100:0,a=o.newMembers>0?o.retained/o.newMembers*100:0,g=o.totalMembers>0?o.totalLTV/o.totalMembers:0,d=o.conversionIntervals.length>0?o.conversionIntervals.reduce((s,l)=>s+l,0)/o.conversionIntervals.length:0,m=o.visitsPostTrial.length>0?o.visitsPostTrial.reduce((s,l)=>s+l,0)/o.visitsPostTrial.length:0;return{month:"TOTALS",type:"All Types",totalMembers:o.totalMembers,newMembers:o.newMembers,converted:o.converted,retained:o.retained,conversionRate:n,retentionRate:a,avgLTV:g,avgConversionDays:d,avgVisits:m}},[o]);return e.jsxs(y,{className:"bg-white shadow-lg border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx(S,{className:"bg-gradient-to-r from-indigo-700 to-purple-900 text-white pb-4",children:e.jsxs(k,{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Month-on-Month Analysis by Client Type",e.jsxs(j,{variant:"secondary",className:"ml-2 bg-white/20 text-white border-white/30",children:[Object.keys(b).length," Entries"]})]})}),e.jsx(M,{className:"p-0 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto max-h-[600px]",children:e.jsxs(de,{className:"w-full",children:[e.jsx(me,{className:`sticky top-0 z-20 ${L("retention")}`,children:e.jsxs(z,{className:`border-b h-12 ${L("retention")}`,children:[e.jsx(T,{className:`font-bold text-white text-xs px-4 sticky left-0 z-10 min-w-[100px] ${L("retention")}`,children:"Month"}),e.jsx(T,{className:`font-bold text-white text-xs px-3 text-center min-w-[80px] ${L("retention")}`,children:"Type"}),e.jsx(T,{className:`font-bold text-white text-xs px-3 text-center min-w-[80px] ${L("retention")}`,children:"Members"}),e.jsx(T,{className:`font-bold text-white text-xs px-3 text-center min-w-[80px] ${L("retention")}`,children:"New"}),e.jsx(T,{className:`font-bold text-white text-xs px-3 text-center min-w-[90px] ${L("retention")}`,children:"Converted"}),e.jsx(T,{className:`font-bold text-white text-xs px-3 text-center min-w-[80px] ${L("retention")}`,children:"Conv Rate"}),e.jsx(T,{className:`font-bold text-white text-xs px-3 text-center min-w-[80px] ${L("retention")}`,children:"Retained"}),e.jsx(T,{className:`font-bold text-white text-xs px-3 text-center min-w-[80px] ${L("retention")}`,children:"Ret Rate"}),e.jsx(T,{className:`font-bold text-white text-xs px-3 text-center min-w-[80px] ${L("retention")}`,children:"Avg LTV"}),e.jsx(T,{className:`font-bold text-white text-xs px-3 text-center min-w-[80px] ${L("retention")}`,children:"Avg Conv Days"}),e.jsx(T,{className:`font-bold text-white text-xs px-3 text-center min-w-[80px] ${L("retention")}`,children:"Avg Visits"})]})}),e.jsxs(xe,{children:[u.map((n,a)=>e.jsxs(z,{className:"hover:bg-gray-50 transition-colors cursor-pointer border-b border-gray-100 h-10",onClick:()=>w?.(n),children:[e.jsx(N,{className:"font-semibold text-gray-900 text-xs px-4 sticky left-0 bg-slate-100 z-10 border-r",children:n.month}),e.jsx(N,{className:"text-xs px-3 text-left",children:e.jsx(j,{variant:n.type.toLowerCase().includes("new")?"default":"secondary",className:"text-xs rounded-t rounded-b py-2 min-w-52 bg-indigo-900 text-white font-medium rounded-lg",children:n.type})}),e.jsx(N,{className:"text-xs px-3 text-center font-medium",children:f(n.totalMembers)}),e.jsx(N,{className:"text-xs px-3 text-center font-medium",children:f(n.newMembers)}),e.jsx(N,{className:"text-xs px-3 text-center font-medium",children:f(n.converted)}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsxs("span",{className:`font-semibold ${n.conversionRate>=50?"text-green-600":n.conversionRate>=30?"text-orange-600":"text-red-600"}`,children:[n.conversionRate.toFixed(1),"%"]})}),e.jsx(N,{className:"text-xs px-3 text-center font-medium",children:f(n.retained)}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsxs("span",{className:`font-semibold ${n.retentionRate>=70?"text-green-600":n.retentionRate>=50?"text-orange-600":"text-red-600"}`,children:[n.retentionRate.toFixed(1),"%"]})}),e.jsx(N,{className:"text-xs px-3 text-right font-semibold text-emerald-600",children:V(n.avgLTV)}),e.jsxs(N,{className:"text-xs px-3 text-center font-medium",children:[n.avgConversionDays.toFixed(0)," days"]}),e.jsx(N,{className:"text-xs px-3 text-center font-medium",children:n.avgVisits.toFixed(1)})]},`${n.month}-${n.type}`)),e.jsxs(z,{className:"border-t-4 border-gray-800 text-gray-900",children:[e.jsx(N,{className:"border-t-4 border-gray-800 text-gray-900",children:r.month}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsx(j,{variant:"outline",className:"text-xs font-bold",children:r.type})}),e.jsx(N,{className:"text-xs px-3 text-center font-bold",children:f(r.totalMembers)}),e.jsx(N,{className:"text-xs px-3 text-center font-bold",children:f(r.newMembers)}),e.jsx(N,{className:"text-xs px-3 text-center font-bold",children:f(r.converted)}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsxs("span",{className:`font-bold ${r.conversionRate>=50?"text-green-600":r.conversionRate>=30?"text-orange-600":"text-red-600"}`,children:[r.conversionRate.toFixed(1),"%"]})}),e.jsx(N,{className:"text-xs px-3 text-center font-bold",children:f(r.retained)}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsxs("span",{className:`font-bold ${r.retentionRate>=70?"text-green-600":r.retentionRate>=50?"text-orange-600":"text-red-600"}`,children:[r.retentionRate.toFixed(1),"%"]})}),e.jsx(N,{className:"text-xs px-3 text-right font-bold text-emerald-600",children:V(r.avgLTV)}),e.jsxs(N,{className:"text-xs px-3 text-center font-bold",children:[r.avgConversionDays.toFixed(0)," days"]}),e.jsx(N,{className:"text-xs px-3 text-center font-bold",children:r.avgVisits.toFixed(1)})]})]})]})})})]})},Ze=({data:c,onRowClick:w})=>{const b=R.useMemo(()=>{const a=new Date().getFullYear(),g=a-1,m=Array.from({length:12},(s,l)=>{const h=l+1,p=new Date(2024,l).toLocaleDateString("en-US",{month:"short"});return{monthName:p,monthNumber:h,key:p}}).reduce((s,l)=>(s[l.key]={month:l.monthName,sortOrder:l.monthNumber,currentYear:{totalMembers:0,newMembers:0,converted:0,retained:0,totalLTV:0,clients:[]},previousYear:{totalMembers:0,newMembers:0,converted:0,retained:0,totalLTV:0,clients:[]}},s),{});return c.forEach(s=>{const l=s.firstVisitDate;let h;if(l.includes("/")){const t=l.split(" ")[0].split("/");if(t.length===3){const[x,v,C]=t;h=new Date(parseInt(C),parseInt(v)-1,parseInt(x)),isNaN(h.getTime())&&(h=new Date(parseInt(C),parseInt(x)-1,parseInt(v)))}else h=new Date(l)}else h=new Date(l);if(isNaN(h.getTime()))return;const p=h.getFullYear();h.getMonth()+1;const i=h.toLocaleDateString("en-US",{month:"short"});if((p===a||p===g)&&m[i]){const t=p===a?m[i].currentYear:m[i].previousYear;t.totalMembers++,t.clients.push(s),(s.isNew||"").toLowerCase().includes("new")&&t.newMembers++,s.conversionStatus==="Converted"&&t.converted++,s.retentionStatus==="Retained"&&t.retained++,t.totalLTV+=s.ltv||0}}),Object.values(m).map(s=>{const l=s.currentYear.newMembers>0?s.currentYear.converted/s.currentYear.newMembers*100:0,h=s.previousYear.newMembers>0?s.previousYear.converted/s.previousYear.newMembers*100:0,p=s.currentYear.newMembers>0?s.currentYear.retained/s.currentYear.newMembers*100:0,i=s.previousYear.newMembers>0?s.previousYear.retained/s.previousYear.newMembers*100:0,t=s.currentYear.totalMembers>0?s.currentYear.totalLTV/s.currentYear.totalMembers:0,x=s.previousYear.totalMembers>0?s.previousYear.totalLTV/s.previousYear.totalMembers:0;return{month:s.month,sortOrder:s.sortOrder,currentTotalMembers:s.currentYear.totalMembers,previousTotalMembers:s.previousYear.totalMembers,totalMembersGrowth:s.previousYear.totalMembers>0?(s.currentYear.totalMembers-s.previousYear.totalMembers)/s.previousYear.totalMembers*100:0,currentNewMembers:s.currentYear.newMembers,previousNewMembers:s.previousYear.newMembers,newMembersGrowth:s.previousYear.newMembers>0?(s.currentYear.newMembers-s.previousYear.newMembers)/s.previousYear.newMembers*100:0,currentConverted:s.currentYear.converted,previousConverted:s.previousYear.converted,currentConversionRate:l,previousConversionRate:h,conversionRateGrowth:h>0?l-h:0,currentRetained:s.currentYear.retained,previousRetained:s.previousYear.retained,currentRetentionRate:p,previousRetentionRate:i,retentionRateGrowth:i>0?p-i:0,currentTotalLTV:s.currentYear.totalLTV,previousTotalLTV:s.previousYear.totalLTV,currentAvgLTV:t,previousAvgLTV:x,avgLTVGrowth:x>0?(t-x)/x*100:0,currentClients:s.currentYear.clients,previousClients:s.previousYear.clients}}).sort((s,l)=>s.sortOrder-l.sortOrder)},[c]),u=[{key:"month",header:"Month",className:"font-semibold min-w-[80px]"},{key:"currentTotalMembers",header:`${new Date().getFullYear()} Total`,align:"center",render:a=>e.jsx("span",{className:"text-base font-bold text-blue-600",children:f(a)})},{key:"previousTotalMembers",header:`${new Date().getFullYear()-1} Total`,align:"center",render:a=>e.jsx("span",{className:"text-base font-bold text-slate-600",children:f(a)})},{key:"totalMembersGrowth",header:"Total Growth %",align:"center",render:a=>e.jsxs("span",{className:`text-base font-bold ${(a||0)>0?"text-green-600":(a||0)<0?"text-red-600":"text-slate-600"}`,children:[(a||0)>0?"+":"",(a||0).toFixed(1),"%"]})},{key:"currentNewMembers",header:`${new Date().getFullYear()} New`,align:"center",render:a=>e.jsx("span",{className:"text-base font-bold text-green-600",children:f(a)})},{key:"previousNewMembers",header:`${new Date().getFullYear()-1} New`,align:"center",render:a=>e.jsx("span",{className:"text-base font-bold text-slate-600",children:f(a)})},{key:"newMembersGrowth",header:"Growth %",align:"center",render:a=>e.jsxs("span",{className:`text-base font-bold ${(a||0)>0?"text-green-600":(a||0)<0?"text-red-600":"text-slate-600"}`,children:[(a||0)>0?"+":"",(a||0).toFixed(1),"%"]})},{key:"currentConversionRate",header:`${new Date().getFullYear()} Conv.`,align:"center",render:a=>e.jsxs("span",{className:"text-base font-bold text-green-600",children:[(a||0).toFixed(1),"%"]})},{key:"previousConversionRate",header:`${new Date().getFullYear()-1} Conv.`,align:"center",render:a=>e.jsxs("span",{className:"text-base font-bold text-slate-600",children:[(a||0).toFixed(1),"%"]})},{key:"conversionRateGrowth",header:"Conv. Δ",align:"center",render:a=>e.jsxs("span",{className:`text-base font-bold ${(a||0)>0?"text-green-600":(a||0)<0?"text-red-600":"text-slate-600"}`,children:[(a||0)>0?"+":"",(a||0).toFixed(1),"pp"]})},{key:"currentAvgLTV",header:`${new Date().getFullYear()} LTV`,align:"right",render:a=>e.jsx("span",{className:"text-base font-bold text-purple-600",children:V(a||0)})},{key:"previousAvgLTV",header:`${new Date().getFullYear()-1} LTV`,align:"right",render:a=>e.jsx("span",{className:"text-base font-bold text-slate-600",children:V(a||0)})},{key:"avgLTVGrowth",header:"LTV Growth",align:"center",render:a=>e.jsxs("span",{className:`text-base font-bold ${(a||0)>0?"text-green-600":(a||0)<0?"text-red-600":"text-slate-600"}`,children:[(a||0)>0?"+":"",(a||0).toFixed(1),"%"]})}],o={month:"TOTAL",currentTotalMembers:b.reduce((a,g)=>a+(g.currentTotalMembers||0),0),previousTotalMembers:b.reduce((a,g)=>a+(g.previousTotalMembers||0),0),totalMembersGrowth:0,currentNewMembers:b.reduce((a,g)=>a+(g.currentNewMembers||0),0),previousNewMembers:b.reduce((a,g)=>a+(g.previousNewMembers||0),0),newMembersGrowth:0,currentConversionRate:0,previousConversionRate:0,conversionRateGrowth:0,currentAvgLTV:b.reduce((a,g)=>a+(g.currentTotalLTV||0),0)/Math.max(b.reduce((a,g)=>a+(g.currentTotalMembers||0),0),1),previousAvgLTV:b.reduce((a,g)=>a+(g.previousTotalLTV||0),0)/Math.max(b.reduce((a,g)=>a+(g.previousTotalMembers||0),0),1),avgLTVGrowth:0},r=b.reduce((a,g)=>a+(g.currentConverted||0),0),n=b.reduce((a,g)=>a+(g.previousConverted||0),0);return o.totalMembersGrowth=o.previousTotalMembers>0?(o.currentTotalMembers-o.previousTotalMembers)/o.previousTotalMembers*100:0,o.newMembersGrowth=o.previousNewMembers>0?(o.currentNewMembers-o.previousNewMembers)/o.previousNewMembers*100:0,o.currentConversionRate=o.currentNewMembers>0?r/o.currentNewMembers*100:0,o.previousConversionRate=o.previousNewMembers>0?n/o.previousNewMembers*100:0,o.conversionRateGrowth=o.previousConversionRate>0?o.currentConversionRate-o.previousConversionRate:0,o.avgLTVGrowth=o.previousAvgLTV>0?(o.currentAvgLTV-o.previousAvgLTV)/o.previousAvgLTV*100:0,e.jsxs(y,{className:"bg-white shadow-lg border-0",children:[e.jsx(S,{className:"border-b border-gray-100 bg-gradient-to-r from-emerald-600 to-teal-600 text-white",children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5"}),"Year-on-Year Client Conversion Comparison",e.jsxs(j,{variant:"secondary",className:"bg-white/20 text-white",children:[new Date().getFullYear()," vs ",new Date().getFullYear()-1]})]})}),e.jsx(M,{className:"p-0",children:e.jsx(W,{data:b,columns:u,headerGradient:"from-emerald-600 to-teal-600",showFooter:!0,footerData:o,maxHeight:"600px",onRowClick:w})})]})},qe=({data:c})=>{const w=R.useMemo(()=>{const o=c.reduce((r,n)=>{const a=n.membershipUsed||"No Membership";return r[a]||(r[a]={membershipType:a,totalMembers:0,newMembers:0,converted:0,retained:0,totalLTV:0,totalVisits:0,conversionSpans:[]}),r[a].totalMembers++,(n.isNew||"").includes("New")&&r[a].newMembers++,n.conversionStatus==="Converted"&&r[a].converted++,n.retentionStatus==="Retained"&&r[a].retained++,r[a].totalLTV+=n.ltv||0,r[a].totalVisits+=n.visitsPostTrial||0,n.conversionSpan&&n.conversionSpan>0&&r[a].conversionSpans.push(n.conversionSpan),r},{});return Object.values(o).map(r=>({...r,conversionRate:r.newMembers>0?r.converted/r.newMembers*100:0,retentionRate:r.totalMembers>0?r.retained/r.totalMembers*100:0,avgLTV:r.totalMembers>0?r.totalLTV/r.totalMembers:0,avgVisits:r.totalMembers>0?r.totalVisits/r.totalMembers:0,avgConversionSpan:r.conversionSpans.length>0?r.conversionSpans.reduce((n,a)=>n+a,0)/r.conversionSpans.length:0})).filter(r=>r.totalMembers>0).sort((r,n)=>n.totalMembers-r.totalMembers)},[c]),b=[{key:"membershipType",header:"Membership Type",className:"font-medium text-xs min-w-[200px]",render:o=>e.jsx("span",{className:"text-xs font-medium text-gray-800 truncate max-w-[200px]",title:o,children:o.length>25?`${o.substring(0,25)}...`:o})},{key:"totalMembers",header:"Total Members",align:"center",render:o=>e.jsx("span",{className:"text-xs font-semibold text-blue-600",children:f(o)})},{key:"newMembers",header:"New Members",align:"center",render:o=>e.jsx("span",{className:"text-xs font-semibold text-green-600",children:f(o)})},{key:"converted",header:"Converted",align:"center",render:o=>e.jsx("span",{className:"text-xs font-semibold text-green-600",children:f(o)})},{key:"conversionRate",header:"Conv. Rate",align:"center",render:o=>e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[o>50?e.jsx(I,{className:"w-3 h-3 text-green-500"}):o<20?e.jsx(ce,{className:"w-3 h-3 text-red-500"}):null,e.jsxs("span",{className:`text-xs font-semibold ${o>50?"text-green-600":o<20?"text-red-600":"text-gray-600"}`,children:[o.toFixed(1),"%"]})]})},{key:"retained",header:"Retained",align:"center",render:o=>e.jsx("span",{className:"text-xs font-semibold text-purple-600",children:f(o)})},{key:"retentionRate",header:"Ret. Rate",align:"center",render:o=>e.jsxs("span",{className:"text-xs font-semibold",children:[o.toFixed(1),"%"]})},{key:"avgLTV",header:"Avg LTV",align:"right",render:o=>e.jsx("span",{className:"text-xs font-semibold",children:V(o)})}],u={membershipType:"TOTAL",totalMembers:w.reduce((o,r)=>o+r.totalMembers,0),newMembers:w.reduce((o,r)=>o+r.newMembers,0),converted:w.reduce((o,r)=>o+r.converted,0),conversionRate:0,retained:w.reduce((o,r)=>o+r.retained,0),retentionRate:0,avgLTV:w.reduce((o,r)=>o+r.totalLTV,0)/Math.max(w.reduce((o,r)=>o+r.totalMembers,0),1)};return u.conversionRate=u.newMembers>0?u.converted/u.newMembers*100:0,u.retentionRate=u.totalMembers>0?u.retained/u.totalMembers*100:0,e.jsxs(y,{className:"bg-white shadow-lg border-0",children:[e.jsx(S,{className:"border-b border-gray-100 bg-gradient-to-r from-purple-600 to-indigo-600 text-white",children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),"Membership Type Performance Analysis",e.jsxs(j,{variant:"secondary",className:"bg-white/20 text-white",children:[w.length," Types"]})]})}),e.jsx(M,{className:"p-0",children:e.jsx(W,{data:w,columns:b,headerGradient:"from-purple-600 to-indigo-600",showFooter:!0,footerData:u,maxHeight:"500px"})})]})},Je=({data:c,onRowClick:w})=>{const b=R.useMemo(()=>{const r=c.reduce((n,a)=>{const g=a.firstVisitEntityName||"Unknown Class";let d="Unknown";if(a.firstVisitDate){let s;if(a.firstVisitDate.includes("/")){const l=a.firstVisitDate.split(",")[0].trim(),[h,p,i]=l.split("/");s=new Date(parseInt(i),parseInt(p)-1,parseInt(h))}else s=new Date(a.firstVisitDate);isNaN(s.getTime())||(d=s.toLocaleDateString("en-US",{month:"short",year:"numeric"}))}const m=`${d}-${g}`;if(n[m]||(n[m]={month:d,className:g,totalMembers:0,newMembers:0,converted:0,retained:0,totalLTV:0,conversionIntervals:[],clients:[]}),n[m].totalMembers++,n[m].clients.push(a),(a.isNew||"").toLowerCase().includes("new")&&n[m].newMembers++,a.conversionStatus==="Converted"&&n[m].converted++,a.retentionStatus==="Retained"&&n[m].retained++,n[m].totalLTV+=a.ltv||0,a.firstPurchase&&a.firstVisitDate){const s=new Date(a.firstVisitDate),l=new Date(a.firstPurchase);if(!isNaN(s.getTime())&&!isNaN(l.getTime())){const h=Math.ceil((l.getTime()-s.getTime())/864e5);h>=0&&n[m].conversionIntervals.push(h)}}return n},{});return Object.values(r).map(n=>({...n,conversionRate:n.newMembers>0?n.converted/n.newMembers*100:0,retentionRate:n.converted>0?n.retained/n.converted*100:0,avgLTV:n.totalMembers>0?n.totalLTV/n.totalMembers:0,avgConversionInterval:n.conversionIntervals.length>0?n.conversionIntervals.reduce((a,g)=>a+g,0)/n.conversionIntervals.length:0})).sort((n,a)=>a.totalMembers-n.totalMembers)},[c]),u=[{key:"month",header:"Month",className:"font-semibold min-w-[100px]",render:r=>e.jsx("div",{className:"font-bold text-slate-800 bg-gradient-to-r from-purple-50 to-pink-50 px-3 py-2 rounded-lg",children:r})},{key:"className",header:"Class Name",className:"font-medium min-w-[200px]",render:r=>e.jsx("div",{className:"font-semibold text-slate-700 truncate",title:r,children:r.length>30?`${r.substring(0,30)}...`:r})},{key:"totalMembers",header:"Total Members",align:"center",render:r=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:f(r)}),e.jsx("div",{className:"text-xs text-slate-500",children:"members"})]})},{key:"newMembers",header:"New Members",align:"center",render:r=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:f(r)}),e.jsx("div",{className:"text-xs text-slate-500",children:"new"})]})},{key:"converted",header:"Converted",align:"center",render:r=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:f(r)}),e.jsx("div",{className:"text-xs text-slate-500",children:"converted"})]})},{key:"conversionRate",header:"Conv. Rate",align:"center",render:r=>e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[r>25?e.jsx(I,{className:"w-3 h-3 text-green-500"}):r<10?e.jsx(ce,{className:"w-3 h-3 text-red-500"}):null,e.jsxs(j,{className:`font-bold ${r>25?"bg-green-100 text-green-800":r<10?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:[r.toFixed(1),"%"]})]})},{key:"retained",header:"Retained",align:"center",render:r=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-purple-600",children:f(r)}),e.jsx("div",{className:"text-xs text-slate-500",children:"retained"})]})},{key:"avgLTV",header:"Avg LTV",align:"right",render:r=>e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold text-emerald-600",children:V(r)}),e.jsx("div",{className:"text-xs text-slate-500",children:"per client"})]})},{key:"avgConversionInterval",header:"Avg Conv. Interval",align:"center",render:r=>e.jsxs(j,{variant:"outline",className:"bg-orange-50 text-orange-700 border-orange-200 font-bold",children:[Math.round(r)," days"]})}],o={month:"TOTAL",className:`${b.length} Classes`,totalMembers:b.reduce((r,n)=>r+n.totalMembers,0),newMembers:b.reduce((r,n)=>r+n.newMembers,0),converted:b.reduce((r,n)=>r+n.converted,0),conversionRate:0,retained:b.reduce((r,n)=>r+n.retained,0),avgLTV:b.reduce((r,n)=>r+n.totalLTV,0)/Math.max(b.reduce((r,n)=>r+n.totalMembers,0),1),avgConversionInterval:b.reduce((r,n)=>r+n.avgConversionInterval*n.totalMembers,0)/Math.max(b.reduce((r,n)=>r+n.totalMembers,0),1)};return o.conversionRate=o.newMembers>0?o.converted/o.newMembers*100:0,e.jsx(he.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs(y,{className:"bg-white shadow-xl border-0 overflow-hidden hover:shadow-2xl transition-all duration-300",children:[e.jsx(S,{className:"border-b border-gray-100 bg-gradient-to-r from-purple-600 to-pink-600 text-white",children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"}),"Hosted Classes Performance Analysis",e.jsxs(j,{variant:"secondary",className:"bg-white/20 text-white",children:[b.length," Classes"]})]})}),e.jsx(M,{className:"p-0",children:e.jsx(W,{data:b,columns:u,headerGradient:"from-purple-600 to-pink-600",showFooter:!0,footerData:o,maxHeight:"600px",onRowClick:w})})]})})},et=({isOpen:c,onClose:w,title:b,data:u,type:o})=>{if(!u)return null;const r=R.useMemo(()=>u?o==="metric"&&u.clients||(o==="month"||o==="year")&&u.clients?u.clients:Array.isArray(u)?u:[]:[],[u,o]),n=R.useMemo(()=>{const d=r.length,m=r.filter(t=>(t.isNew||"").toLowerCase().includes("new")).length,s=r.filter(t=>(t.conversionStatus||"").toLowerCase().includes("converted")).length,l=r.filter(t=>(t.retentionStatus||"").toLowerCase().includes("retained")).length,h=r.reduce((t,x)=>t+(x.ltv||0),0),p=r.filter(t=>t.conversionSpan>0).reduce((t,x)=>t+(x.conversionSpan||0),0),i=r.filter(t=>t.conversionSpan>0).length;return{totalMembers:d,newMembers:m,convertedMembers:s,retainedMembers:l,conversionRate:m>0?s/m*100:0,retentionRate:d>0?l/d*100:0,avgLTV:d>0?h/d:0,totalLTV:h,avgConversionTime:i>0?p/i:0}},[r]),a=()=>e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(y,{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white border-0 shadow-lg",children:e.jsxs(M,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx($,{className:"w-5 h-5 text-blue-100"}),e.jsx(j,{className:"bg-white/20 text-white border-0",children:"Total"})]}),e.jsx("div",{className:"text-2xl font-bold",children:f(n.totalMembers)}),e.jsx("div",{className:"text-blue-100 text-sm",children:"Total Members"})]})}),e.jsx(y,{className:"bg-gradient-to-br from-green-500 to-green-600 text-white border-0 shadow-lg",children:e.jsxs(M,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(F,{className:"w-5 h-5 text-green-100"}),e.jsx(j,{className:"bg-white/20 text-white border-0",children:"New"})]}),e.jsx("div",{className:"text-2xl font-bold",children:f(n.newMembers)}),e.jsx("div",{className:"text-green-100 text-sm",children:"New Members"})]})}),e.jsx(y,{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white border-0 shadow-lg",children:e.jsxs(M,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(I,{className:"w-5 h-5 text-purple-100"}),e.jsx(j,{className:"bg-white/20 text-white border-0",children:"Rate"})]}),e.jsxs("div",{className:"text-2xl font-bold",children:[n.conversionRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-purple-100 text-sm",children:"Conversion Rate"})]})}),e.jsx(y,{className:"bg-gradient-to-br from-orange-500 to-orange-600 text-white border-0 shadow-lg",children:e.jsxs(M,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(A,{className:"w-5 h-5 text-orange-100"}),e.jsx(j,{className:"bg-white/20 text-white border-0",children:"LTV"})]}),e.jsx("div",{className:"text-2xl font-bold",children:V(n.avgLTV)}),e.jsx("div",{className:"text-orange-100 text-sm",children:"Avg LTV"})]})})]}),g=()=>r.length===0?e.jsx(y,{children:e.jsxs(M,{className:"p-8 text-center",children:[e.jsx($,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No client data available for this selection."})]})}):e.jsxs(y,{children:[e.jsx(S,{children:e.jsxs(k,{className:"text-lg",children:["Client Details (",f(r.length)," members)"]})}),e.jsx(M,{className:"p-0",children:e.jsxs("div",{className:"max-h-96 overflow-y-auto",children:[e.jsxs(de,{children:[e.jsx(me,{className:"sticky top-0 bg-gray-50 z-10",children:e.jsxs(z,{children:[e.jsx(T,{className:"font-semibold text-gray-900 text-xs px-3",children:"Name"}),e.jsx(T,{className:"font-semibold text-gray-900 text-xs px-3",children:"Email"}),e.jsx(T,{className:"font-semibold text-gray-900 text-xs px-3 text-center",children:"Type"}),e.jsx(T,{className:"font-semibold text-gray-900 text-xs px-3 text-center",children:"Status"}),e.jsx(T,{className:"font-semibold text-gray-900 text-xs px-3 text-center",children:"Conversion"}),e.jsx(T,{className:"font-semibold text-gray-900 text-xs px-3 text-right",children:"LTV"}),e.jsx(T,{className:"font-semibold text-gray-900 text-xs px-3 text-center",children:"Location"})]})}),e.jsx(xe,{children:r.slice(0,50).map((d,m)=>e.jsxs(z,{className:"hover:bg-gray-50 transition-colors h-10",children:[e.jsxs(N,{className:"text-xs px-3 font-medium",children:[d.firstName," ",d.lastName]}),e.jsx(N,{className:"text-xs px-3 text-gray-600 truncate max-w-[150px]",title:d.email,children:d.email}),e.jsx(N,{className:"text-xs px-3 text-left rounded-t rounded-none",children:e.jsx(j,{variant:d.isNew?.toLowerCase().includes("new")?"default":"secondary",className:"text-xs rounded min-w-44",children:d.isNew||"Unknown"})}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsx(j,{variant:d.retentionStatus?.toLowerCase().includes("retained")?"default":"secondary",className:`text-xs ${d.retentionStatus?.toLowerCase().includes("retained")?"bg-purple-100 text-purple-800":""}`,children:d.retentionStatus||"Pending"})}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsx(j,{variant:d.conversionStatus?.toLowerCase().includes("converted")?"default":"secondary",className:`text-xs ${d.conversionStatus?.toLowerCase().includes("converted")?"bg-green-100 text-green-800":""}`,children:d.conversionStatus||"Pending"})}),e.jsx(N,{className:"text-xs px-3 text-right font-semibold text-emerald-600",children:V(d.ltv||0)}),e.jsx(N,{className:"text-xs px-3 text-center text-gray-600 truncate max-w-[120px]",title:d.firstVisitLocation,children:d.firstVisitLocation||"Unknown"})]},m))})]}),r.length>50&&e.jsxs("div",{className:"p-4 text-center text-sm text-gray-600 bg-gray-50 border-t",children:["Showing 50 of ",r.length," clients. Drill down shows only targeted data for this selection."]})]})})]});return e.jsx(Re,{open:c,onOpenChange:w,children:e.jsxs(Ve,{className:"max-w-7xl max-h-[95vh] overflow-y-auto bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-2xl",children:[e.jsx(Le,{className:"pb-6 border-b border-slate-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(Se,{className:"text-3xl font-bold bg-gradient-to-r from-slate-800 via-blue-600 to-purple-600 bg-clip-text text-transparent",children:[b," - Detailed Analysis"]}),e.jsx("p",{className:"text-slate-600 mt-2 text-lg",children:"Targeted client conversion and retention analysis"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"bg-blue-100 text-blue-800 border-0",children:o==="month"?"Monthly":o==="year"?"Yearly":o==="metric"?"Metric Analysis":"Analytics"}),e.jsx(Y,{variant:"outline",onClick:w,children:e.jsx(Me,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"pt-6 space-y-8",children:[a(),e.jsxs(ke,{defaultValue:"overview",className:"w-full",children:[e.jsxs(De,{className:"grid w-full grid-cols-3 bg-slate-100",children:[e.jsxs(q,{value:"overview",className:"gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Overview"]}),e.jsxs(q,{value:"clients",className:"gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"Client Details"]}),e.jsxs(q,{value:"insights",className:"gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Insights"]})]}),e.jsx(J,{value:"overview",className:"space-y-6",children:e.jsxs(y,{className:"bg-gradient-to-br from-indigo-50 to-indigo-100 border-indigo-200",children:[e.jsx(S,{children:e.jsx(k,{className:"text-indigo-800",children:"Summary Statistics"})}),e.jsx(M,{children:e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:f(n.totalMembers)}),e.jsx("div",{className:"text-sm text-indigo-600",children:"Total Members"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:f(n.convertedMembers)}),e.jsx("div",{className:"text-sm text-green-600",children:"Converted"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[n.conversionRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-purple-600",children:"Conversion Rate"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:n.avgConversionTime>0?`${n.avgConversionTime.toFixed(0)} days`:"N/A"}),e.jsx("div",{className:"text-sm text-orange-600",children:"Avg Conv. Time"})]})]})})]})}),e.jsx(J,{value:"clients",children:g()}),e.jsx(J,{value:"insights",children:e.jsxs(y,{className:"bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx(S,{children:e.jsx(k,{className:"text-purple-800",children:"AI-Powered Insights"})}),e.jsx(M,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-white rounded-lg border-l-4 border-purple-400",children:[e.jsx("h4",{className:"font-medium text-purple-800 mb-2",children:"Key Metrics"}),e.jsxs("ul",{className:"text-sm text-purple-600 space-y-1",children:[e.jsxs("li",{children:["• Total Revenue: ",V(n.totalLTV)]}),e.jsxs("li",{children:["• Conversion Rate: ",n.conversionRate.toFixed(1),"%"]}),e.jsxs("li",{children:["• Retention Rate: ",n.retentionRate.toFixed(1),"%"]}),e.jsxs("li",{children:["• Average Customer Value: ",V(n.avgLTV)]})]})]}),e.jsxs("div",{className:"p-4 bg-white rounded-lg border-l-4 border-orange-400",children:[e.jsx("h4",{className:"font-medium text-orange-800 mb-2",children:"Performance Analysis"}),e.jsxs("ul",{className:"text-sm text-orange-600 space-y-1",children:[e.jsxs("li",{children:["• ",n.conversionRate>30?"Strong":n.conversionRate>15?"Moderate":"Needs improvement"," conversion performance"]}),e.jsxs("li",{children:["• ",n.retentionRate>70?"Excellent":n.retentionRate>50?"Good":"Needs attention"," retention rate"]}),e.jsxs("li",{children:["• Customer lifetime value is ",n.avgLTV>1e4?"high":n.avgLTV>5e3?"moderate":"developing"]}),e.jsx("li",{children:"• This selection shows targeted analytics for clicked data only"})]})]})]})})]})})]})]})]})})};export{He as C,ze as E,Be as a,_e as b,We as c,Xe as d,Qe as e,Ze as f,Je as g,qe as h,et as i};
