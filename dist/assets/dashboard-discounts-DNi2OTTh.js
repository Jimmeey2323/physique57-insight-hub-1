import{r as P,i as Ae,w as ae,P as de,_ as ze,$ as H,U as Re,j as e,E as oe,M as je,d as fe,c as ne,R as Ee,B as He,F as be,X as Je,J as Ne,a0 as We,T as Pe,Z as Xe,v as Ze,a1 as Be,e as Ve,g as $e,C as ve,b as pe,h as qe,a2 as _e,W as Qe,a3 as et,S as tt,D as st}from"./react-vendor-CYideCN0.js";import{C as $,j as O,k as K,d as U,c as F,B as L,T as re,m as le,n as E,o as T,p as ie,q as v,S as ue,f as xe,g as me,h as he,i as W,D as at,I as ge,a2 as nt,r as ke,s as Te,t as Y,u as I,Z as ot,_ as rt,$ as lt,a0 as it,a1 as ct,a3 as dt,a4 as ye,a as ut,b as xt,e as mt,a5 as ht}from"./ui-components-Cek3D08m.js";import{f as p,a as z,b as V,D as G,g as gt}from"./utils-Bswz-ULp.js";import{R as X,L as Se,C as Q,X as ee,Y as _,T as Z,b as ce,B as De,c as se,a as we,P as Ie,d as Ye,e as Ge,S as jt,g as vt}from"./chart-vendor-DyOsfj4e.js";import{m as q,A as Fe}from"./animation-vendor-CHdCv3BV.js";const St=({data:w,selectedLocation:j})=>{const[B,u]=P.useState("overview"),[D,s]=P.useState(!1),h=P.useMemo(()=>!w||w.length===0?[]:!j||j==="all"?w:w.filter(t=>t.calculatedLocation===j),[w,j]),r=P.useMemo(()=>{if(!h||h.length===0)return{totalTransactions:0,discountedTransactions:0,totalRevenue:0,totalDiscounts:0,avgDiscountPercent:0,topDiscountedProducts:[],monthlyTrends:[],locationBreakdown:[],categoryBreakdown:[],customerSegments:[],staffPerformance:[]};const t=h.filter(c=>{const N=(c.discountAmount||0)>0,A=(c.discountPercentage||0)>0,J=c.isPromotional===!0,te=c.discountType&&c.discountType!=="";return N||A||J||te}),n=h.length,m=t.length,x=h.reduce((c,N)=>c+(N.paymentValue||0),0),o=h.reduce((c,N)=>c+(N.discountAmount||0),0),i=t.length>0?t.reduce((c,N)=>{let A=N.discountPercentage||0;if(A===0&&N.discountAmount&&N.paymentValue){const J=N.paymentValue+N.discountAmount;A=J>0?N.discountAmount/J*100:0}return c+A},0)/t.length:0,R=h.reduce((c,N)=>{const A=N.cleanedProduct||"Unknown";return c[A]||(c[A]={name:A,category:N.cleanedCategory||"Unknown",totalDiscount:0,transactions:0,discountedTransactions:0,revenue:0,customers:new Set}),c[A].totalDiscount+=N.discountAmount||0,c[A].transactions+=1,c[A].revenue+=N.paymentValue||0,c[A].customers.add(N.customerEmail),((N.discountAmount||0)>0||(N.discountPercentage||0)>0)&&(c[A].discountedTransactions+=1),c},{}),S=Object.values(R).map(c=>({...c,uniqueCustomers:c.customers.size,discountRate:c.transactions>0?c.discountedTransactions/c.transactions*100:0})).sort((c,N)=>N.totalDiscount-c.totalDiscount).slice(0,10),C=h.reduce((c,N)=>{if(!N.paymentDate)return c;let A;try{if(N.paymentDate.includes("/")){const[J,te,Ce]=N.paymentDate.split(" ")[0].split("/");A=`${Ce}-${te.padStart(2,"0")}`}else A=N.paymentDate.substring(0,7)}catch{A="Unknown"}return c[A]||(c[A]={month:A,revenue:0,discounts:0,transactions:0,discountedTransactions:0,discountRate:0}),c[A].revenue+=N.paymentValue||0,c[A].discounts+=N.discountAmount||0,c[A].transactions+=1,((N.discountAmount||0)>0||(N.discountPercentage||0)>0)&&(c[A].discountedTransactions+=1),c},{}),y=Object.values(C).map(c=>({...c,discountRate:c.transactions>0?c.discountedTransactions/c.transactions*100:0})).sort((c,N)=>c.month.localeCompare(N.month)),f=h.reduce((c,N)=>{const A=N.calculatedLocation||"Unknown";return c[A]||(c[A]={location:A,revenue:0,discounts:0,transactions:0,discountedTransactions:0,customers:new Set}),c[A].revenue+=N.paymentValue||0,c[A].discounts+=N.discountAmount||0,c[A].transactions+=1,c[A].customers.add(N.customerEmail),(N.discountAmount||0)>0&&(c[A].discountedTransactions+=1),c},{}),M=Object.values(f).map(c=>({...c,uniqueCustomers:c.customers.size,discountRate:c.transactions>0?c.discountedTransactions/c.transactions*100:0,avgDiscountPerTransaction:c.discountedTransactions>0?c.discounts/c.discountedTransactions:0})),l=h.reduce((c,N)=>{const A=N.cleanedCategory||"Unknown";return c[A]||(c[A]={category:A,revenue:0,discounts:0,transactions:0,discountedTransactions:0}),c[A].revenue+=N.paymentValue||0,c[A].discounts+=N.discountAmount||0,c[A].transactions+=1,(N.discountAmount||0)>0&&(c[A].discountedTransactions+=1),c},{}),g=Object.values(l).map(c=>({...c,discountRate:c.transactions>0?c.discountedTransactions/c.transactions*100:0})).sort((c,N)=>N.discounts-c.discounts),d=h.reduce((c,N)=>{const A=N.soldBy||"Unknown";return c[A]||(c[A]={name:A,totalDiscounts:0,transactions:0,discountedTransactions:0,revenue:0}),c[A].totalDiscounts+=N.discountAmount||0,c[A].transactions+=1,c[A].revenue+=N.paymentValue||0,(N.discountAmount||0)>0&&(c[A].discountedTransactions+=1),c},{}),b=Object.values(d).map(c=>({...c,discountRate:c.transactions>0?c.discountedTransactions/c.transactions*100:0,avgDiscountPerTransaction:c.discountedTransactions>0?c.totalDiscounts/c.discountedTransactions:0})).sort((c,N)=>N.totalDiscounts-c.totalDiscounts).slice(0,10);return{totalTransactions:n,discountedTransactions:m,totalRevenue:x,totalDiscounts:o,avgDiscountPercent:i,topDiscountedProducts:S,monthlyTrends:y,locationBreakdown:M,categoryBreakdown:g,staffPerformance:b}},[h]),a=[{title:"Total Revenue",value:p(r.totalRevenue),icon:Ae,gradient:"from-green-500 to-emerald-600",description:"Total sales revenue",change:12.5},{title:"Total Discounts",value:p(r.totalDiscounts),icon:ae,gradient:"from-red-500 to-rose-600",description:"Amount saved by customers",change:-8.3},{title:"Discount Rate",value:z(r.totalRevenue>0?r.totalDiscounts/r.totalRevenue*100:0),icon:de,gradient:"from-blue-500 to-indigo-600",description:"Discount as % of revenue",change:-2.1},{title:"Discounted Sales",value:`${V(r.discountedTransactions)} / ${V(r.totalTransactions)}`,icon:ze,gradient:"from-purple-500 to-violet-600",description:"Sales with discounts applied",change:5.7},{title:"Avg Discount %",value:z(r.avgDiscountPercent),icon:H,gradient:"from-orange-500 to-red-600",description:"Average discount percentage",change:-1.2},{title:"Penetration Rate",value:z(r.totalTransactions>0?r.discountedTransactions/r.totalTransactions*100:0),icon:Re,gradient:"from-cyan-500 to-blue-600",description:"Percentage of discounted sales",change:3.4}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx($,{className:"border-0 shadow-xl bg-gradient-to-r from-orange-50 to-red-50",children:e.jsx(O,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-orange-500 to-red-500 rounded-xl flex items-center justify-center",children:e.jsx(de,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx(K,{className:"text-2xl font-bold text-gray-900",children:"Discounts & Promotions Analytics"}),e.jsxs("p",{className:"text-gray-600",children:["Comprehensive discount impact analysis",j!=="all"&&` for ${j}`]})]})]}),e.jsx("div",{className:"flex gap-2",children:["overview","details","analytics"].map(t=>e.jsx(U,{variant:B===t?"default":"outline",onClick:()=>u(t),className:"capitalize",children:t},t))})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6",children:a.map((t,n)=>e.jsx($,{className:"bg-white shadow-xl border-0 overflow-hidden hover:shadow-2xl transition-all duration-300 group cursor-pointer",children:e.jsx(F,{className:"p-0",children:e.jsxs("div",{className:`bg-gradient-to-r ${t.gradient} p-6 text-white relative overflow-hidden`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 transform translate-x-8 -translate-y-8 opacity-20",children:e.jsx(t.icon,{className:"w-20 h-20"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(t.icon,{className:"w-6 h-6"}),e.jsx("h3",{className:"font-semibold text-sm",children:t.title})]}),e.jsx("p",{className:"text-3xl font-bold mb-1",children:t.value}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:`text-sm ${t.change>=0?"text-green-200":"text-red-200"}`,children:[t.change>=0?"+":"",t.change.toFixed(1),"%"]}),e.jsx("span",{className:"text-sm opacity-90",children:"vs last period"})]})]})]})})},t.title))}),B==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs($,{className:"bg-white shadow-xl border-0",children:[e.jsx(O,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-blue-600"}),"Monthly Discount Trends"]})}),e.jsx(F,{children:e.jsx(X,{width:"100%",height:300,children:e.jsxs(Se,{data:r.monthlyTrends,children:[e.jsx(Q,{strokeDasharray:"3 3"}),e.jsx(ee,{dataKey:"month"}),e.jsx(_,{}),e.jsx(Z,{formatter:(t,n)=>[n==="discounts"||n==="revenue"?p(t):n==="discountRate"?z(t):V(t),n]}),e.jsx(ce,{type:"monotone",dataKey:"revenue",stroke:"#8884d8",name:"Revenue"}),e.jsx(ce,{type:"monotone",dataKey:"discounts",stroke:"#82ca9d",name:"Discounts"}),e.jsx(ce,{type:"monotone",dataKey:"discountRate",stroke:"#ffc658",name:"Discount Rate %"})]})})})]}),e.jsxs($,{className:"bg-white shadow-xl border-0",children:[e.jsx(O,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-green-600"}),"Top Discounted Products"]})}),e.jsx(F,{children:e.jsx("div",{className:"space-y-4 max-h-80 overflow-y-auto",children:r.topDiscountedProducts.slice(0,8).map((t,n)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-orange-500 to-red-500 rounded-full flex items-center justify-center text-white font-bold text-sm",children:n+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 truncate max-w-[200px]",children:t.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{variant:"outline",className:"text-xs",children:t.category}),e.jsxs(L,{variant:"secondary",className:"text-xs",children:[z(t.discountRate)," discount rate"]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-red-600",children:p(t.totalDiscount)}),e.jsxs("p",{className:"text-sm text-gray-600",children:[V(t.transactions)," sales"]})]})]},t.name))})})]})]}),B==="details"&&e.jsxs($,{className:"bg-white shadow-xl border-0",children:[e.jsx(O,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-blue-600"}),"Detailed Discount Transactions"]})}),e.jsx(F,{children:e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs(re,{children:[e.jsx(le,{children:e.jsxs(E,{children:[e.jsx(T,{children:"Date"}),e.jsx(T,{children:"Customer"}),e.jsx(T,{children:"Product"}),e.jsx(T,{children:"Location"}),e.jsx(T,{children:"Revenue"}),e.jsx(T,{children:"Discount"}),e.jsx(T,{children:"Discount %"}),e.jsx(T,{children:"Sold By"})]})}),e.jsx(ie,{children:h.filter(t=>(t.discountAmount||0)>0).slice(0,50).map((t,n)=>e.jsxs(E,{children:[e.jsx(v,{children:t.paymentDate}),e.jsx(v,{className:"font-medium",children:t.customerName}),e.jsx(v,{children:e.jsx(L,{variant:"outline",children:t.cleanedProduct})}),e.jsx(v,{children:t.calculatedLocation}),e.jsx(v,{children:e.jsx(L,{className:"bg-green-100 text-green-800",children:p(t.paymentValue||0)})}),e.jsx(v,{children:e.jsx(L,{className:"bg-red-100 text-red-800",children:p(t.discountAmount||0)})}),e.jsx(v,{children:e.jsx(L,{className:"bg-blue-100 text-blue-800",children:z(t.discountPercentage||0)})}),e.jsx(v,{children:t.soldBy})]},n))})]})})})]}),B==="analytics"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs($,{className:"bg-white shadow-xl border-0",children:[e.jsx(O,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5 text-purple-600"}),"Location Discount Performance"]})}),e.jsx(F,{children:e.jsx(X,{width:"100%",height:300,children:e.jsxs(De,{data:r.locationBreakdown,children:[e.jsx(Q,{strokeDasharray:"3 3"}),e.jsx(ee,{dataKey:"location"}),e.jsx(_,{}),e.jsx(Z,{formatter:t=>p(t)}),e.jsx(se,{dataKey:"discounts",fill:"#8884d8",name:"Discounts"})]})})})]}),e.jsxs($,{className:"bg-white shadow-xl border-0",children:[e.jsx(O,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-orange-600"}),"Category Discount Analysis"]})}),e.jsx(F,{children:e.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:r.categoryBreakdown.map((t,n)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.category}),e.jsxs("p",{className:"text-sm text-gray-600",children:[V(t.transactions)," transactions • ",z(t.discountRate)," discount rate"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-red-600",children:p(t.discounts)}),e.jsxs("p",{className:"text-sm text-gray-600",children:[p(t.revenue)," revenue"]})]})]},t.category))})})]}),e.jsxs($,{className:"bg-white shadow-xl border-0",children:[e.jsx(O,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-green-600"}),"Staff Discount Performance"]})}),e.jsx(F,{children:e.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:r.staffPerformance.map((t,n)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center text-white font-bold text-sm",children:n+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[V(t.discountedTransactions)," discounted sales • ",z(t.discountRate)," rate"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-red-600",children:p(t.totalDiscounts)}),e.jsxs("p",{className:"text-sm text-gray-600",children:[p(t.avgDiscountPerTransaction)," avg"]})]})]},t.name))})})]}),e.jsxs($,{className:"bg-white shadow-xl border-0",children:[e.jsx(O,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-blue-600"}),"Monthly Discount Rate Trends"]})}),e.jsx(F,{children:e.jsx(X,{width:"100%",height:300,children:e.jsxs(De,{data:r.monthlyTrends,children:[e.jsx(Q,{strokeDasharray:"3 3"}),e.jsx(ee,{dataKey:"month"}),e.jsx(_,{}),e.jsx(Z,{formatter:(t,n)=>[n==="discountRate"?z(t):V(t),n]}),e.jsx(se,{dataKey:"discountRate",fill:"#ffc658",name:"Discount Rate %"})]})})})]})]})]})},pt=({data:w,selectedLocation:j,onLocationChange:B})=>{const u=Ee.useMemo(()=>{const D=w.reduce((t,n)=>{const m=n.calculatedLocation||"Unknown";return t[m]||(t[m]={total:0,discounted:0,totalDiscount:0}),t[m].total+=1,(n.discountAmount||0)>0&&(t[m].discounted+=1,t[m].totalDiscount+=n.discountAmount||0),t},{}),s=Object.entries(D).map(([t,n])=>({location:t,...n,discountRate:n.total>0?n.discounted/n.total*100:0})),h=w.length,r=w.filter(t=>(t.discountAmount||0)>0).length,a=w.reduce((t,n)=>t+(n.discountAmount||0),0);return[{location:"all",total:h,discounted:r,totalDiscount:a,discountRate:h>0?r/h*100:0},...s.sort((t,n)=>n.discounted-t.discounted)]},[w]);return e.jsx($,{className:"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 border-0 shadow-xl",children:e.jsxs(F,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-xl flex items-center justify-center",children:e.jsx(je,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold bg-gradient-to-r from-blue-700 to-indigo-700 bg-clip-text text-transparent",children:"Location Analysis"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Select a location to filter discount analysis"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:u.map(D=>e.jsxs(U,{variant:j===D.location?"default":"outline",onClick:()=>B(D.location),className:`
                h-auto p-4 flex flex-col items-start space-y-2 text-left transition-all duration-300 hover:scale-105
                ${j===D.location?"bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-lg":"bg-white hover:bg-blue-50 border-blue-200"}
              `,children:[e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx(He,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"font-semibold text-sm truncate",children:D.location==="all"?"All Locations":D.location})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 w-full text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-75",children:"Total:"}),e.jsx("div",{className:"font-bold",children:V(D.total)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-75",children:"Discounted:"}),e.jsx("div",{className:"font-bold",children:V(D.discounted)})]})]}),e.jsx("div",{className:"flex items-center justify-between w-full",children:e.jsxs(L,{variant:j===D.location?"secondary":"outline",className:`text-xs ${j===D.location?"bg-white/20 text-white border-white/30":"border-blue-300 text-blue-700"}`,children:[D.discountRate.toFixed(1),"% rate"]})})]},D.location))})]})})},yt=({data:w,onFiltersChange:j,isCollapsed:B,onToggleCollapse:u})=>{const[D,s]=P.useState("all"),[h,r]=P.useState("all"),[a,t]=P.useState("all"),[n,m]=P.useState("all"),[x,o]=P.useState("all"),[i,R]=P.useState(""),[S,C]=P.useState(""),[y,f]=P.useState(""),[M,l]=P.useState(""),[g,d]=P.useState({}),b=w.filter(k=>(k.discountAmount||0)>0),c=Array.from(new Set(b.map(k=>k.calculatedLocation))).filter(Boolean),N=Array.from(new Set(b.map(k=>k.cleanedCategory))).filter(Boolean),A=Array.from(new Set(b.map(k=>k.cleanedProduct))).filter(Boolean),J=Array.from(new Set(b.map(k=>k.soldBy==="-"?"Online/System":k.soldBy))).filter(Boolean),te=Array.from(new Set(b.map(k=>k.paymentMethod))).filter(Boolean);P.useEffect(()=>{j({location:D==="all"?"":D,category:h==="all"?"":h,product:a==="all"?"":a,soldBy:n==="all"?"":n,paymentMethod:x==="all"?"":x,minDiscountAmount:i?parseFloat(i):void 0,maxDiscountAmount:S?parseFloat(S):void 0,minDiscountPercent:y?parseFloat(y):void 0,maxDiscountPercent:M?parseFloat(M):void 0,dateRange:g})},[D,h,a,n,x,i,S,y,M,g,j]);const Ce=()=>{s("all"),r("all"),t("all"),m("all"),o("all"),R(""),C(""),f(""),l(""),d({})},Me=D!=="all"||h!=="all"||a!=="all"||n!=="all"||x!=="all"||i||S||y||M||g.from||g.to;return B?e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-br from-white via-indigo-50/30 to-white rounded-lg border shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4 text-indigo-600"}),e.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Discount Filters"}),Me&&e.jsxs(L,{variant:"secondary",className:"text-xs bg-indigo-100 text-indigo-700",children:[[D,h,a,n,x].filter(k=>k!=="all").length+[i,S,y,M].filter(k=>k).length+(g.from||g.to?1:0)," active"]})]}),e.jsx(U,{variant:"ghost",size:"sm",onClick:u,className:"text-indigo-600 hover:text-indigo-700",children:"Show Filters"})]})}):e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"bg-gradient-to-br from-white via-indigo-50/30 to-white rounded-lg border shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Discount Filters & Analytics"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Me&&e.jsxs(U,{variant:"outline",size:"sm",onClick:Ce,className:"text-slate-600 hover:text-slate-700",children:[e.jsx(Je,{className:"w-3 h-3 mr-1"}),"Clear All"]}),e.jsx(U,{variant:"ghost",size:"sm",onClick:u,className:"text-indigo-600 hover:text-indigo-700",children:"Hide Filters"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4 mb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-slate-700 flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4 text-indigo-600"}),"Location"]}),e.jsxs(ue,{value:D,onValueChange:s,children:[e.jsx(xe,{children:e.jsx(me,{placeholder:"All Locations"})}),e.jsxs(he,{children:[e.jsx(W,{value:"all",children:"All Locations"}),c.map(k=>e.jsx(W,{value:k,children:k},k))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-slate-700 flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-indigo-600"}),"Category"]}),e.jsxs(ue,{value:h,onValueChange:r,children:[e.jsx(xe,{children:e.jsx(me,{placeholder:"All Categories"})}),e.jsxs(he,{children:[e.jsx(W,{value:"all",children:"All Categories"}),N.map(k=>e.jsx(W,{value:k,children:k},k))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-slate-700 flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-indigo-600"}),"Product"]}),e.jsxs(ue,{value:a,onValueChange:t,children:[e.jsx(xe,{children:e.jsx(me,{placeholder:"All Products"})}),e.jsxs(he,{children:[e.jsx(W,{value:"all",children:"All Products"}),A.map(k=>e.jsx(W,{value:k,children:k},k))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-slate-700 flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4 text-indigo-600"}),"Sold By"]}),e.jsxs(ue,{value:n,onValueChange:m,children:[e.jsx(xe,{children:e.jsx(me,{placeholder:"All Staff"})}),e.jsxs(he,{children:[e.jsx(W,{value:"all",children:"All Staff"}),J.map(k=>e.jsx(W,{value:k,children:k},k))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-slate-700 flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-indigo-600"}),"Payment Method"]}),e.jsxs(ue,{value:x,onValueChange:o,children:[e.jsx(xe,{children:e.jsx(me,{placeholder:"All Methods"})}),e.jsxs(he,{children:[e.jsx(W,{value:"all",children:"All Methods"}),te.map(k=>e.jsx(W,{value:k,children:k},k))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-slate-700 flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-indigo-600"}),"Date Range"]}),e.jsx(at,{value:g,onChange:d})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Min Discount Amount"}),e.jsx(ge,{type:"number",placeholder:"₹0",value:i,onChange:k=>R(k.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Max Discount Amount"}),e.jsx(ge,{type:"number",placeholder:"₹10000",value:S,onChange:k=>C(k.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Min Discount %"}),e.jsx(ge,{type:"number",placeholder:"0%",value:y,onChange:k=>f(k.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Max Discount %"}),e.jsx(ge,{type:"number",placeholder:"100%",value:M,onChange:k=>l(k.target.value)})]})]})]})})},ft=({data:w,onCardClick:j})=>{const B=P.useMemo(()=>{const s=w.filter(d=>(d.discountAmount||0)>0),h=w;if(s.length===0)return[];const r=s.reduce((d,b)=>d+(b.discountAmount||0),0),a=s.reduce((d,b)=>d+(b.paymentValue||0),0),t=s.reduce((d,b)=>d+(b.mrpPostTax||b.paymentValue||0),0),n=s.length,m=new Set(s.map(d=>d.customerEmail)).size,x=r/n,o=s.reduce((d,b)=>d+(b.discountPercentage||0),0)/n,i=t>0?r/t*100:0,R=t>0?(t-a)/t*100:0,S=new Date,C=new Date(S.getFullYear(),S.getMonth()-1,1),y=s.filter(d=>{const b=new Date(d.paymentDate);return b.getMonth()===S.getMonth()&&b.getFullYear()===S.getFullYear()}),f=s.filter(d=>{const b=new Date(d.paymentDate);return b.getMonth()===C.getMonth()&&b.getFullYear()===C.getFullYear()}),M=y.reduce((d,b)=>d+(b.discountAmount||0),0),l=f.reduce((d,b)=>d+(b.discountAmount||0),0),g=l>0?(M-l)/l*100:0;return[{title:"Total Discount Amount",value:r,change:g,changeLabel:"vs last month",icon:e.jsx(Ae,{className:"w-5 h-5"}),subtitle:"Total discounts given",formatter:"currency",drillDownData:s},{title:"Average Discount %",value:o,icon:e.jsx(de,{className:"w-5 h-5"}),subtitle:"Per transaction",formatter:"percentage",drillDownData:s},{title:"Discount Rate",value:i,icon:e.jsx(ae,{className:"w-5 h-5"}),subtitle:"Of total potential revenue",formatter:"percentage",drillDownData:s},{title:"Discounted Transactions",value:n,change:(y.length-f.length)/(f.length||1)*100,changeLabel:"vs last month",icon:e.jsx(We,{className:"w-5 h-5"}),subtitle:"With discounts applied",formatter:"number",drillDownData:s},{title:"Unique Customers",value:m,icon:e.jsx(Re,{className:"w-5 h-5"}),subtitle:"Received discounts",formatter:"number",drillDownData:s},{title:"Avg Discount Amount",value:x,icon:e.jsx(Pe,{className:"w-5 h-5"}),subtitle:"Per transaction",formatter:"currency",drillDownData:s},{title:"Revenue Impact",value:R,icon:e.jsx(Xe,{className:"w-5 h-5"}),subtitle:"Lost revenue %",formatter:"percentage",drillDownData:s},{title:"Conversion Rate",value:h.length>0?n/h.length*100:0,icon:e.jsx(Ze,{className:"w-5 h-5"}),subtitle:"Transactions with discounts",formatter:"percentage",drillDownData:s}]},[w]),u={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},D={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6}}};return e.jsx(q.div,{variants:u,initial:"hidden",animate:"visible",className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:B.map((s,h)=>e.jsx(q.div,{variants:D,children:e.jsx(nt,{title:s.title,value:s.value,change:s.change,changeLabel:s.changeLabel,icon:s.icon,tabName:"discounts",subtitle:s.subtitle,formatter:s.formatter,onClick:()=>j?.(s.title,s.drillDownData)})},h))})},Le=["#8b5cf6","#06b6d4","#10b981","#f59e0b","#ef4444","#6366f1","#ec4899","#84cc16"],Oe=({data:w,filters:j})=>{const[B,u]=P.useState("trends"),D=P.useMemo(()=>{let s=w.filter(o=>(o.discountAmount||0)>0);j&&(s=s.filter(o=>{if(j.location&&o.calculatedLocation!==j.location||j.category&&o.cleanedCategory!==j.category||j.product&&o.cleanedProduct!==j.product||j.soldBy&&(o.soldBy==="-"?"Online/System":o.soldBy)!==j.soldBy||j.paymentMethod&&o.paymentMethod!==j.paymentMethod||j.minDiscountAmount&&(o.discountAmount||0)<j.minDiscountAmount||j.maxDiscountAmount&&(o.discountAmount||0)>j.maxDiscountAmount||j.minDiscountPercent&&(o.discountPercentage||0)<j.minDiscountPercent||j.maxDiscountPercent&&(o.discountPercentage||0)>j.maxDiscountPercent)return!1;if(j.dateRange?.from||j.dateRange?.to){const i=new Date(o.paymentDate);if(j.dateRange.from&&i<j.dateRange.from||j.dateRange.to&&i>j.dateRange.to)return!1}return!0}));const h=s.reduce((o,i)=>{const R=new Date(i.paymentDate),S=`${R.getFullYear()}-${(R.getMonth()+1).toString().padStart(2,"0")}`;return o[S]||(o[S]={month:S,transactions:0,totalDiscount:0,totalRevenue:0,avgDiscount:0}),o[S].transactions+=1,o[S].totalDiscount+=i.discountAmount||0,o[S].totalRevenue+=i.paymentValue||0,o},{}),r=Object.values(h).map(o=>({...o,avgDiscount:o.transactions>0?o.totalDiscount/o.transactions:0,discountRate:o.totalRevenue>0?o.totalDiscount/(o.totalRevenue+o.totalDiscount)*100:0})).sort((o,i)=>o.month.localeCompare(i.month)),a=s.reduce((o,i)=>{const R=i.cleanedCategory||"Unknown";return o[R]||(o[R]={name:R,value:0,transactions:0}),o[R].value+=i.discountAmount||0,o[R].transactions+=1,o},{}),t=Object.values(a).sort((o,i)=>i.value-o.value).slice(0,8),m=[{min:0,max:100,label:"₹0-100"},{min:100,max:500,label:"₹100-500"},{min:500,max:1e3,label:"₹500-1K"},{min:1e3,max:2500,label:"₹1K-2.5K"},{min:2500,max:5e3,label:"₹2.5K-5K"},{min:5e3,max:1/0,label:"₹5K+"}].map(o=>{const i=s.filter(R=>{const S=R.discountAmount||0;return S>=o.min&&S<o.max});return{range:o.label,transactions:i.length,totalDiscount:i.reduce((R,S)=>R+(S.discountAmount||0),0),avgDiscount:i.length>0?i.reduce((R,S)=>R+(S.discountAmount||0),0)/i.length:0,totalRevenue:i.reduce((R,S)=>R+(S.paymentValue||0),0)}}),x=s.slice(0,200).map(o=>({discountAmount:o.discountAmount||0,discountPercent:o.discountPercentage||0,revenue:o.paymentValue||0,category:o.cleanedCategory||"Unknown"}));return{monthlyTrends:r,categoryDistribution:t,rangeAnalysis:m,scatterData:x}},[w,j]);return e.jsx("div",{className:"space-y-6",children:e.jsxs(ke,{value:B,onValueChange:u,className:"w-full",children:[e.jsxs(Te,{className:"grid w-full grid-cols-4 bg-white border border-slate-200 p-1 rounded-xl shadow-sm h-auto",children:[e.jsxs(Y,{value:"trends",className:"text-sm px-4 py-3 data-[state=active]:bg-blue-600 data-[state=active]:text-white",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Trends"]}),e.jsxs(Y,{value:"distribution",className:"text-sm px-4 py-3 data-[state=active]:bg-purple-600 data-[state=active]:text-white",children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Distribution"]}),e.jsxs(Y,{value:"ranges",className:"text-sm px-4 py-3 data-[state=active]:bg-green-600 data-[state=active]:text-white",children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"Ranges"]}),e.jsxs(Y,{value:"correlation",className:"text-sm px-4 py-3 data-[state=active]:bg-orange-600 data-[state=active]:text-white",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Correlation"]})]}),e.jsx(I,{value:"trends",className:"space-y-6",children:e.jsxs($,{className:"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 border-0 shadow-xl",children:[e.jsx(O,{children:e.jsxs(K,{className:"text-xl font-bold bg-gradient-to-r from-blue-700 to-indigo-700 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx(ne,{className:"w-6 h-6 text-blue-600"}),"Monthly Discount Trends"]})}),e.jsx(F,{children:e.jsx(X,{width:"100%",height:400,children:e.jsxs(Se,{data:D.monthlyTrends,children:[e.jsx(Q,{strokeDasharray:"3 3"}),e.jsx(ee,{dataKey:"month"}),e.jsx(_,{yAxisId:"left",tickFormatter:s=>p(s)}),e.jsx(_,{yAxisId:"right",orientation:"right",tickFormatter:s=>`${s}%`}),e.jsx(Z,{formatter:(s,h)=>[h==="discountRate"?`${s.toFixed(1)}%`:p(s),h==="totalDiscount"?"Total Discount":h==="totalRevenue"?"Revenue":"Discount Rate"]}),e.jsx(we,{}),e.jsx(se,{yAxisId:"left",dataKey:"totalDiscount",fill:"#3b82f6",name:"Total Discount"}),e.jsx(ce,{yAxisId:"right",type:"monotone",dataKey:"discountRate",stroke:"#ef4444",strokeWidth:3,name:"Discount Rate %"})]})})})]})}),e.jsx(I,{value:"distribution",className:"space-y-6",children:e.jsxs($,{className:"bg-gradient-to-br from-white via-purple-50/30 to-violet-50/20 border-0 shadow-xl",children:[e.jsx(O,{children:e.jsxs(K,{className:"text-xl font-bold bg-gradient-to-r from-purple-700 to-violet-700 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx(Be,{className:"w-6 h-6 text-purple-600"}),"Discount Distribution by Category"]})}),e.jsx(F,{children:e.jsx(X,{width:"100%",height:400,children:e.jsxs(Ie,{children:[e.jsx(Ye,{data:D.categoryDistribution,cx:"50%",cy:"50%",labelLine:!1,label:({name:s,value:h})=>`${s}: ${p(h)}`,outerRadius:120,fill:"#8884d8",dataKey:"value",children:D.categoryDistribution.map((s,h)=>e.jsx(Ge,{fill:Le[h%Le.length]},`cell-${h}`))}),e.jsx(Z,{formatter:s=>p(s)})]})})})]})}),e.jsx(I,{value:"ranges",className:"space-y-6",children:e.jsxs($,{className:"bg-gradient-to-br from-white via-green-50/30 to-emerald-50/20 border-0 shadow-xl",children:[e.jsx(O,{children:e.jsxs(K,{className:"text-xl font-bold bg-gradient-to-r from-green-700 to-emerald-700 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx(Ve,{className:"w-6 h-6 text-green-600"}),"Discount Range Analysis"]})}),e.jsx(F,{children:e.jsx(X,{width:"100%",height:400,children:e.jsxs(De,{data:D.rangeAnalysis,children:[e.jsx(Q,{strokeDasharray:"3 3"}),e.jsx(ee,{dataKey:"range"}),e.jsx(_,{tickFormatter:s=>p(s)}),e.jsx(Z,{formatter:(s,h)=>[p(s),h==="totalDiscount"?"Total Discount":"Average Discount"]}),e.jsx(we,{}),e.jsx(se,{dataKey:"totalDiscount",fill:"#10b981",name:"Total Discount"}),e.jsx(se,{dataKey:"avgDiscount",fill:"#06b6d4",name:"Average Discount"})]})})})]})}),e.jsx(I,{value:"correlation",className:"space-y-6",children:e.jsxs($,{className:"bg-gradient-to-br from-white via-orange-50/30 to-amber-50/20 border-0 shadow-xl",children:[e.jsx(O,{children:e.jsxs(K,{className:"text-xl font-bold bg-gradient-to-r from-orange-700 to-amber-700 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx($e,{className:"w-6 h-6 text-orange-600"}),"Discount Amount vs Percentage Correlation"]})}),e.jsx(F,{children:e.jsx(X,{width:"100%",height:400,children:e.jsxs(jt,{data:D.scatterData,children:[e.jsx(Q,{strokeDasharray:"3 3"}),e.jsx(ee,{dataKey:"discountPercent",name:"Discount %",tickFormatter:s=>`${s}%`}),e.jsx(_,{dataKey:"discountAmount",name:"Discount Amount",tickFormatter:s=>p(s)}),e.jsx(Z,{formatter:(s,h)=>[h==="discountPercent"?`${s}%`:p(s),h==="discountPercent"?"Discount %":"Discount Amount"]}),e.jsx(vt,{dataKey:"discountAmount",fill:"#f59e0b"})]})})})]})})]})})},bt=({data:w})=>{const[j,B]=P.useState("month"),[u,D]=P.useState("desc"),[s,h]=P.useState(null),[r,a]=P.useState(8),t=y=>{j===y?D(u==="asc"?"desc":"asc"):(B(y),D("desc"))},n=P.useMemo(()=>{const f=w.filter(l=>(l.discountAmount||0)>0).reduce((l,g)=>{const d=new Date(g.paymentDate),b=`${d.getFullYear()}-${(d.getMonth()+1).toString().padStart(2,"0")}`,c=d.toLocaleDateString("en-US",{year:"numeric",month:"long"});return l[b]||(l[b]={month:c,monthKey:b,transactions:0,totalDiscount:0,totalRevenue:0,totalPotentialRevenue:0,uniqueCustomers:new Set,discountPercentages:[]}),l[b].transactions+=1,l[b].totalDiscount+=g.discountAmount||0,l[b].totalRevenue+=g.paymentValue||0,l[b].totalPotentialRevenue+=g.mrpPostTax||g.paymentValue||0,l[b].uniqueCustomers.add(g.customerEmail),l[b].discountPercentages.push(g.discountPercentage||0),l},{}),M=Object.keys(f).sort();return M.map((l,g)=>{const d=f[l],b=g>0?f[M[g-1]]:null,c=d.discountPercentages.length>0?d.discountPercentages.reduce((J,te)=>J+te,0)/d.discountPercentages.length:0;let N=0,A=0;return b&&(N=b.totalDiscount>0?(d.totalDiscount-b.totalDiscount)/b.totalDiscount*100:0,A=b.totalRevenue>0?(d.totalRevenue-b.totalRevenue)/b.totalRevenue*100:0),{...d,uniqueCustomers:d.uniqueCustomers.size,avgDiscountPercent:c,momGrowth:N,revenueGrowth:A,discountRate:d.totalPotentialRevenue>0?d.totalDiscount/d.totalPotentialRevenue*100:0}}).sort((l,g)=>j==="month"?u==="asc"?l.monthKey.localeCompare(g.monthKey):g.monthKey.localeCompare(l.monthKey):j==="total"?u==="asc"?l.totalDiscount-g.totalDiscount:g.totalDiscount-l.totalDiscount:u==="asc"?l.transactions-g.transactions:g.transactions-l.transactions)},[w,j,u]),m=y=>y>0?e.jsx(qe,{className:"w-3 h-3 text-green-500"}):y<0?e.jsx(ae,{className:"w-3 h-3 text-red-500"}):e.jsx(_e,{className:"w-3 h-3 text-gray-400"}),x=y=>y>10||y>0?"text-green-600 bg-green-50 border-green-200":y<-10||y<0?"text-red-600 bg-red-50 border-red-200":"text-gray-600 bg-gray-50 border-gray-200",o=n.slice(0,r),i=G.tabColors.discounts,R={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6}}},S={hidden:{opacity:0,y:-10},visible:{opacity:1,y:0,transition:{duration:.4,delay:.2}}},C={hidden:{opacity:0,x:-20},visible:{opacity:1,x:0,transition:{duration:.4}}};return e.jsx(q.div,{variants:R,initial:"hidden",animate:"visible",className:"w-full",children:e.jsxs($,{className:"w-full bg-gradient-to-br from-white via-orange-50/30 to-amber-100/40 backdrop-blur-sm border-orange-200/50 shadow-xl shadow-orange-100/20",children:[e.jsxs(O,{className:`bg-gradient-to-r ${i.gradients.dark} text-white relative overflow-hidden`,children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-r ${i.gradients.dark} backdrop-blur-sm`}),e.jsxs(q.div,{variants:S,className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-3 bg-gradient-to-br ${i.gradients.accent} rounded-xl shadow-lg`,children:e.jsx(de,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Discount Performance"}),e.jsx("p",{className:"text-sm text-white/90",children:"Month-on-month discount analysis"})]})]}),e.jsxs(L,{variant:"outline",className:"bg-white/20 text-white border-white/20 backdrop-blur-sm",children:[e.jsx(ne,{className:"w-3 h-3 mr-1"}),"Historical Analysis"]})]}),e.jsxs(q.div,{variants:S,className:"relative z-10 flex items-center gap-2 text-xs text-white/80 mt-2",children:[e.jsx(be,{className:"w-3 h-3"}),e.jsxs("span",{children:["Showing ",n.length," months of discount data"]})]})]}),e.jsxs(F,{className:"pt-6",children:[e.jsx(q.div,{className:"overflow-x-auto",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-orange-200/50",children:[e.jsx("th",{className:"text-left py-3 px-4",children:e.jsxs(U,{variant:"ghost",size:"sm",onClick:()=>t("month"),className:"hover:bg-orange-50/50 font-medium text-gray-700",children:["Month",j==="month"&&(u==="asc"?e.jsx(ve,{className:"w-4 h-4 ml-1"}):e.jsx(pe,{className:"w-4 h-4 ml-1"}))]})}),e.jsx("th",{className:"text-right py-3 px-4",children:e.jsxs(U,{variant:"ghost",size:"sm",onClick:()=>t("total"),className:"hover:bg-orange-50/50 font-medium text-gray-700",children:["Total Discount",j==="total"&&(u==="asc"?e.jsx(ve,{className:"w-4 h-4 ml-1"}):e.jsx(pe,{className:"w-4 h-4 ml-1"}))]})}),e.jsx("th",{className:"text-right py-3 px-4",children:e.jsxs(U,{variant:"ghost",size:"sm",onClick:()=>t("recent"),className:"hover:bg-orange-50/50 font-medium text-gray-700",children:["Transactions",j==="recent"&&(u==="asc"?e.jsx(ve,{className:"w-4 h-4 ml-1"}):e.jsx(pe,{className:"w-4 h-4 ml-1"}))]})}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-700",children:"Month-on-Month"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:e.jsx(Fe,{children:o.map((y,f)=>e.jsxs(Ee.Fragment,{children:[e.jsxs(q.tr,{variants:C,initial:"hidden",animate:"visible",exit:"hidden",className:"hover:bg-orange-50/30 transition-colors duration-200 border-b border-orange-100/30",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"font-medium text-gray-900",children:y.month})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsx("span",{className:"font-medium text-gray-900",children:G.formatters.currency(y.totalDiscount)})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsx("span",{className:"font-medium text-gray-900",children:G.formatters.number(y.transactions)})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[m(y.momGrowth),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${x(y.momGrowth)}`,children:[y.momGrowth>0?"+":"",G.formatters.percentage(Math.abs(y.momGrowth))]})]})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx(U,{variant:"ghost",size:"sm",onClick:()=>h(s===y.monthKey?null:y.monthKey),className:"hover:bg-orange-50/50",children:e.jsx(oe,{className:"w-4 h-4"})})})]}),e.jsx(Fe,{children:s===y.monthKey&&e.jsx(q.tr,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},children:e.jsx("td",{colSpan:5,className:`py-4 px-4 bg-gradient-to-r ${i.gradients.light}`,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(q.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},className:"p-3 bg-white rounded-lg border border-orange-200/30 shadow-sm",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Revenue"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:G.formatters.currency(y.totalRevenue)}),e.jsxs("div",{className:"text-xs text-gray-600",children:[y.revenueGrowth>0?"+":"",G.formatters.percentage(y.revenueGrowth)," vs prev month"]})]}),e.jsxs(q.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2,delay:.1},className:"p-3 bg-white rounded-lg border border-orange-200/30 shadow-sm",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Discount Rate"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:G.formatters.percentage(y.discountRate)}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Avg: ",G.formatters.percentage(y.avgDiscountPercent)]})]}),e.jsxs(q.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2,delay:.2},className:"p-3 bg-white rounded-lg border border-orange-200/30 shadow-sm",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Customers"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:G.formatters.number(y.uniqueCustomers)}),e.jsx("div",{className:"text-xs text-gray-600",children:"Unique customers"})]})]})})})})]},y.monthKey))})})]})}),n.length>r&&e.jsx(q.div,{className:"mt-4 text-center",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:e.jsx(U,{variant:"outline",onClick:()=>a(y=>y>=n.length?8:n.length),className:"border-orange-200 text-orange-700 hover:bg-orange-50",children:r>=n.length?"Show Less":`Show All (${n.length})`})}),e.jsxs(q.div,{className:`mt-6 p-6 bg-gradient-to-r ${i.gradients.light} border-t border-orange-200/50 rounded-lg`,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.6},children:[e.jsx("h4",{className:`font-semibold ${i.text} mb-3`,children:"Key Insights"}),e.jsx("ul",{className:"space-y-2",children:[`Total discount amount across all months: ${G.formatters.currency(n.reduce((y,f)=>y+f.totalDiscount,0))}`,`Average monthly transactions: ${G.formatters.number(n.reduce((y,f)=>y+f.transactions,0)/n.length)}`,`Highest discount month: ${n.sort((y,f)=>f.totalDiscount-y.totalDiscount)[0]?.month||"N/A"}`,`Best performing discount rate: ${G.formatters.percentage(Math.min(...n.map(y=>y.discountRate)))}`].map((y,f)=>e.jsxs(q.li,{className:"flex items-center gap-2 text-sm text-gray-600",initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.7+f*.1},children:[e.jsx("div",{className:`w-2 h-2 rounded-full bg-gradient-to-r ${i.gradients.accent}`}),y]},f))})]})]})]})})},Nt=({data:w,filters:j})=>{const B=P.useMemo(()=>{const h=w.filter(a=>(a.discountAmount||0)>0).reduce((a,t)=>{const n=new Date(t.paymentDate),m=n.getFullYear();n.getMonth()+1;const x=n.toLocaleDateString("en-US",{month:"long"}),o=`${x}`;return a[o]||(a[o]={month:x,years:{}}),a[o].years[m]||(a[o].years[m]={transactions:0,totalDiscount:0,totalRevenue:0,totalPotentialRevenue:0,uniqueCustomers:new Set,discountPercentages:[]}),a[o].years[m].transactions+=1,a[o].years[m].totalDiscount+=t.discountAmount||0,a[o].years[m].totalRevenue+=t.paymentValue||0,a[o].years[m].totalPotentialRevenue+=t.mrpPostTax||t.paymentValue||0,a[o].years[m].uniqueCustomers.add(t.customerEmail),a[o].years[m].discountPercentages.push(t.discountPercentage||0),a},{});return["January","February","March","April","May","June","July","August","September","October","November","December"].map(a=>{const t=h[a];if(!t)return{month:a,year2024:{transactions:0,totalDiscount:0,totalRevenue:0,discountRate:0,avgDiscount:0,atv:0,auv:0,customers:0},year2025:{transactions:0,totalDiscount:0,totalRevenue:0,discountRate:0,avgDiscount:0,atv:0,auv:0,customers:0},yoyChange:{transactions:0,discount:0,revenue:0,atv:0}};const n=t.years[2024]||{transactions:0,totalDiscount:0,totalRevenue:0,totalPotentialRevenue:0,uniqueCustomers:new Set},m=t.years[2025]||{transactions:0,totalDiscount:0,totalRevenue:0,totalPotentialRevenue:0,uniqueCustomers:new Set},x={transactions:n.transactions,totalDiscount:n.totalDiscount,totalRevenue:n.totalRevenue,discountRate:n.totalPotentialRevenue>0?n.totalDiscount/n.totalPotentialRevenue*100:0,avgDiscount:n.transactions>0?n.totalDiscount/n.transactions:0,atv:n.transactions>0?n.totalRevenue/n.transactions:0,auv:n.transactions>0?n.totalRevenue/n.transactions:0,customers:n.uniqueCustomers.size},o={transactions:m.transactions,totalDiscount:m.totalDiscount,totalRevenue:m.totalRevenue,discountRate:m.totalPotentialRevenue>0?m.totalDiscount/m.totalPotentialRevenue*100:0,avgDiscount:m.transactions>0?m.totalDiscount/m.transactions:0,atv:m.transactions>0?m.totalRevenue/m.transactions:0,auv:m.transactions>0?m.totalRevenue/m.transactions:0,customers:m.uniqueCustomers.size},i={transactions:x.transactions>0?(o.transactions-x.transactions)/x.transactions*100:0,discount:x.totalDiscount>0?(o.totalDiscount-x.totalDiscount)/x.totalDiscount*100:0,revenue:x.totalRevenue>0?(o.totalRevenue-x.totalRevenue)/x.totalRevenue*100:0,atv:x.atv>0?(o.atv-x.atv)/x.atv*100:0};return{month:a,year2024:x,year2025:o,yoyChange:i}})},[w]),u=P.useMemo(()=>B.reduce((s,h)=>({year2024:{transactions:s.year2024.transactions+h.year2024.transactions,totalDiscount:s.year2024.totalDiscount+h.year2024.totalDiscount,totalRevenue:s.year2024.totalRevenue+h.year2024.totalRevenue,customers:s.year2024.customers+h.year2024.customers},year2025:{transactions:s.year2025.transactions+h.year2025.transactions,totalDiscount:s.year2025.totalDiscount+h.year2025.totalDiscount,totalRevenue:s.year2025.totalRevenue+h.year2025.totalRevenue,customers:s.year2025.customers+h.year2025.customers}}),{year2024:{transactions:0,totalDiscount:0,totalRevenue:0,customers:0},year2025:{transactions:0,totalDiscount:0,totalRevenue:0,customers:0}}),[B]),D=[{key:"month",header:"Month",align:"left",render:s=>e.jsx("span",{className:"font-semibold text-slate-800",children:s})},{key:"year2024",header:"2024 Transactions",align:"center",render:s=>e.jsx("span",{className:"font-medium",children:V(s.transactions)})},{key:"year2025",header:"2025 Transactions",align:"center",render:s=>e.jsx("span",{className:"font-medium",children:V(s.transactions)})},{key:"yoyChange",header:"Transaction Change",align:"center",render:s=>e.jsxs(L,{variant:s.transactions>=0?"default":"destructive",className:"min-w-[70px] justify-center",children:[s.transactions>0?"+":"",s.transactions.toFixed(1),"%"]})},{key:"year2024",header:"2024 Discount",align:"center",render:s=>e.jsx("span",{className:"text-red-600 font-medium",children:p(s.totalDiscount)})},{key:"year2025",header:"2025 Discount",align:"center",render:s=>e.jsx("span",{className:"text-red-600 font-medium",children:p(s.totalDiscount)})},{key:"yoyChange",header:"Discount Change",align:"center",render:s=>e.jsxs(L,{variant:s.discount<=0?"default":"destructive",className:"min-w-[70px] justify-center",children:[s.discount>0?"+":"",s.discount.toFixed(1),"%"]})},{key:"year2024",header:"2024 ATV",align:"center",render:s=>e.jsx("span",{className:"text-blue-600 font-medium",children:p(s.atv)})},{key:"year2025",header:"2025 ATV",align:"center",render:s=>e.jsx("span",{className:"text-blue-600 font-medium",children:p(s.atv)})},{key:"yoyChange",header:"ATV Change",align:"center",render:s=>e.jsxs(L,{variant:s.atv>=0?"default":"destructive",className:"min-w-[70px] justify-center",children:[s.atv>0?"+":"",s.atv.toFixed(1),"%"]})}];return e.jsxs($,{className:"bg-gradient-to-br from-white via-purple-50/30 to-blue-50/20 border-0 shadow-xl",children:[e.jsx(O,{children:e.jsxs(K,{className:"text-xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(ne,{className:"w-6 h-6 text-purple-600"}),"Year-on-Year Discount Comparison (2024 vs 2025)"]})}),e.jsxs(F,{children:[e.jsx(ot,{data:B,columns:D,showFooter:!0,footerData:{month:"TOTAL",year2024:u.year2024,year2025:u.year2025,yoyChange:{transactions:u.year2024.transactions>0?(u.year2025.transactions-u.year2024.transactions)/u.year2024.transactions*100:0,discount:u.year2024.totalDiscount>0?(u.year2025.totalDiscount-u.year2024.totalDiscount)/u.year2024.totalDiscount*100:0,revenue:u.year2024.totalRevenue>0?(u.year2025.totalRevenue-u.year2024.totalRevenue)/u.year2024.totalRevenue*100:0,atv:u.year2024.totalRevenue>0&&u.year2024.transactions>0&&u.year2025.totalRevenue>0&&u.year2025.transactions>0?(u.year2025.totalRevenue/u.year2025.transactions-u.year2024.totalRevenue/u.year2024.transactions)/(u.year2024.totalRevenue/u.year2024.transactions)*100:0}},maxHeight:"500px",stickyHeader:!0}),e.jsxs("div",{className:"mt-4 p-4 bg-slate-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"Year-on-Year Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"2024 Total Discount:"}),e.jsx("div",{className:"font-semibold text-red-600",children:p(u.year2024.totalDiscount)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"2025 Total Discount:"}),e.jsx("div",{className:"font-semibold text-red-600",children:p(u.year2025.totalDiscount)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"Discount Change:"}),e.jsx("div",{className:`font-semibold ${u.year2024.totalDiscount>0?(u.year2025.totalDiscount-u.year2024.totalDiscount)/u.year2024.totalDiscount*100>0?"text-red-600":"text-green-600":"text-slate-600"}`,children:u.year2024.totalDiscount>0?`${(u.year2025.totalDiscount-u.year2024.totalDiscount)/u.year2024.totalDiscount*100>0?"+":""}${((u.year2025.totalDiscount-u.year2024.totalDiscount)/u.year2024.totalDiscount*100).toFixed(1)}%`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"Revenue Impact:"}),e.jsx("div",{className:"font-semibold",children:p(u.year2025.totalRevenue-u.year2024.totalRevenue)})]})]})]})]})]})},Ke=({data:w,filters:j,onDrillDown:B})=>{const[u,D]=P.useState("desc"),s=P.useMemo(()=>{const r=w.reduce((x,o)=>{const i=o.cleanedCategory||"Unknown";return x[i]||(x[i]={totalDiscount:0,count:0,totalRevenue:0,avgPercent:0}),x[i].totalDiscount+=o.discountAmount||0,x[i].count+=1,x[i].totalRevenue+=o.paymentValue||0,x[i].avgPercent+=o.discountPercentage||0,x},{}),a=w.reduce((x,o)=>{const i=o.cleanedProduct||"Unknown";return x[i]||(x[i]={totalDiscount:0,count:0,totalRevenue:0,avgPercent:0}),x[i].totalDiscount+=o.discountAmount||0,x[i].count+=1,x[i].totalRevenue+=o.paymentValue||0,x[i].avgPercent+=o.discountPercentage||0,x},{}),t=w.reduce((x,o)=>{const i=o.soldBy==="-"?"Online/System":o.soldBy;return x[i]||(x[i]={totalDiscount:0,count:0,totalRevenue:0,avgPercent:0}),x[i].totalDiscount+=o.discountAmount||0,x[i].count+=1,x[i].totalRevenue+=o.paymentValue||0,x[i].avgPercent+=o.discountPercentage||0,x},{}),n=w.reduce((x,o)=>{const i=o.paymentMethod||"Unknown";return x[i]||(x[i]={totalDiscount:0,count:0,totalRevenue:0,avgPercent:0}),x[i].totalDiscount+=o.discountAmount||0,x[i].count+=1,x[i].totalRevenue+=o.paymentValue||0,x[i].avgPercent+=o.discountPercentage||0,x},{}),m=x=>Object.entries(x).map(([o,i])=>({name:o,totalDiscount:i.totalDiscount,count:i.count,totalRevenue:i.totalRevenue,avgPercent:i.count>0?i.avgPercent/i.count:0,avgDiscount:i.count>0?i.totalDiscount/i.count:0})).sort((o,i)=>u==="desc"?i.totalDiscount-o.totalDiscount:o.totalDiscount-i.totalDiscount);return{categories:m(r),products:m(a),soldBy:m(t),paymentMethods:m(n)}},[w,u]),h=(r,a,t,n)=>{const m=r.slice(0,5),x=r.slice(-5).reverse();return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs($,{className:"bg-gradient-to-br from-white via-green-50/30 to-emerald-50/20 border-0 shadow-lg",children:[e.jsx(O,{className:"pb-3",children:e.jsxs(K,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(Qe,{className:"w-5 h-5 text-yellow-600"}),"Top ",t," by Discount",e.jsx(U,{variant:"ghost",size:"sm",onClick:()=>D(u==="desc"?"asc":"desc"),className:"ml-auto",children:e.jsx(et,{className:"w-4 h-4"})})]})}),e.jsx(F,{className:"space-y-3",children:m.map((o,i)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/60 rounded-lg hover:bg-white/80 transition-all duration-300 cursor-pointer hover:scale-102 group",onClick:()=>B?.(`${o.name} - Discount Details`,w.filter(R=>(n==="category"?R.cleanedCategory:n==="product"?R.cleanedProduct:n==="soldBy"?R.soldBy==="-"?"Online/System":R.soldBy:R.paymentMethod)===o.name),n),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm ${i===0?"bg-gradient-to-r from-yellow-500 to-amber-500":i===1?"bg-gradient-to-r from-gray-400 to-gray-500":i===2?"bg-gradient-to-r from-orange-500 to-amber-600":"bg-gradient-to-r from-blue-500 to-purple-600"}`,children:["#",i+1]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm text-slate-800 truncate group-hover:text-slate-900",children:o.name}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-600",children:[e.jsxs("span",{children:[V(o.count)," transactions"]}),e.jsxs(L,{variant:"outline",className:"text-xs bg-green-50 text-green-700 border-green-200",children:[o.avgPercent.toFixed(1),"% avg"]})]})]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("div",{className:"font-bold text-red-600 text-sm",children:p(o.totalDiscount)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[p(o.avgDiscount),"/txn"]})]})]},o.name))})]}),e.jsxs($,{className:"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 border-0 shadow-lg",children:[e.jsx(O,{className:"pb-3",children:e.jsxs(K,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5 text-blue-600"}),"Lowest ",t," by Discount"]})}),e.jsx(F,{className:"space-y-3",children:x.map((o,i)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/60 rounded-lg hover:bg-white/80 transition-all duration-300 cursor-pointer hover:scale-102 group",onClick:()=>B?.(`${o.name} - Discount Details`,w.filter(R=>(n==="category"?R.cleanedCategory:n==="product"?R.cleanedProduct:n==="soldBy"?R.soldBy==="-"?"Online/System":R.soldBy:R.paymentMethod)===o.name),n),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-10 h-10 bg-gradient-to-r from-slate-500 to-gray-600 rounded-full flex items-center justify-center text-white font-bold text-sm",children:["#",x.length-i]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm text-slate-800 truncate group-hover:text-slate-900",children:o.name}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-600",children:[e.jsxs("span",{children:[V(o.count)," transactions"]}),e.jsxs(L,{variant:"outline",className:"text-xs bg-blue-50 text-blue-700 border-blue-200",children:[o.avgPercent.toFixed(1),"% avg"]})]})]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("div",{className:"font-bold text-blue-600 text-sm",children:p(o.totalDiscount)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[p(o.avgDiscount),"/txn"]})]})]},o.name))})]})]})};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Top & Bottom Performers"}),e.jsxs(L,{variant:"outline",className:"text-sm",children:[V(w.length)," total discounted transactions"]})]}),e.jsxs(ke,{defaultValue:"categories",className:"w-full",children:[e.jsxs(Te,{className:"grid w-full grid-cols-4 mb-6 bg-white shadow-sm",children:[e.jsxs(Y,{value:"categories",className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),"Categories"]}),e.jsxs(Y,{value:"products",className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),"Products"]}),e.jsxs(Y,{value:"soldBy",className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),"Sold By"]}),e.jsxs(Y,{value:"payment",className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Payment Method"]})]}),e.jsx(I,{value:"categories",children:h(s.categories,e.jsx(H,{className:"w-5 h-5"}),"Categories","category")}),e.jsx(I,{value:"products",children:h(s.products,e.jsx(H,{className:"w-5 h-5"}),"Products","product")}),e.jsx(I,{value:"soldBy",children:h(s.soldBy,e.jsx(fe,{className:"w-5 h-5"}),"Staff","soldBy")}),e.jsx(I,{value:"payment",children:h(s.paymentMethods,e.jsx(Ne,{className:"w-5 h-5"}),"Payment Methods","paymentMethod")})]})]})},Ue=["#8b5cf6","#06b6d4","#10b981","#f59e0b","#ef4444","#6366f1","#ec4899","#84cc16"],Dt=({isOpen:w,onClose:j,title:B,data:u,type:D})=>{const s=P.useMemo(()=>{if(!u||u.length===0)return null;const t=u.reduce((l,g)=>l+(g.discountAmount||0),0),n=u.reduce((l,g)=>l+(g.paymentValue||0),0),m=u.length,x=new Set(u.map(l=>l.customerEmail)).size,o=t/u.length,i=u.reduce((l,g)=>l+(g.discountPercentage||0),0)/u.length,R=u.reduce((l,g)=>{const d=g.cleanedCategory||"Unknown";return l[d]||(l[d]={discountAmount:0,revenue:0,units:0,customers:new Set}),l[d].discountAmount+=g.discountAmount||0,l[d].revenue+=g.paymentValue||0,l[d].units+=1,l[d].customers.add(g.customerEmail),l},{}),S=u.reduce((l,g)=>{const d=g.cleanedProduct||"Unknown";return l[d]||(l[d]={discountAmount:0,revenue:0,units:0,customers:new Set}),l[d].discountAmount+=g.discountAmount||0,l[d].revenue+=g.paymentValue||0,l[d].units+=1,l[d].customers.add(g.customerEmail),l},{}),C=u.reduce((l,g)=>{const d=g.calculatedLocation||"Unknown";return l[d]||(l[d]={discountAmount:0,revenue:0,units:0,customers:new Set}),l[d].discountAmount+=g.discountAmount||0,l[d].revenue+=g.paymentValue||0,l[d].units+=1,l[d].customers.add(g.customerEmail),l},{}),y=u.reduce((l,g)=>{const d=g.paymentMethod||"Unknown";return l[d]||(l[d]={discountAmount:0,revenue:0,units:0,customers:new Set}),l[d].discountAmount+=g.discountAmount||0,l[d].revenue+=g.paymentValue||0,l[d].units+=1,l[d].customers.add(g.customerEmail),l},{}),f=u.reduce((l,g)=>{if(!g.paymentDate)return l;const d=new Date(g.paymentDate),b=`${d.getFullYear()}-${(d.getMonth()+1).toString().padStart(2,"0")}`,c=d.toLocaleDateString("en-US",{month:"short",year:"numeric"});return l[b]||(l[b]={month:c,discountAmount:0,revenue:0,units:0,customers:new Set}),l[b].discountAmount+=g.discountAmount||0,l[b].revenue+=g.paymentValue||0,l[b].units+=1,l[b].customers.add(g.customerEmail),l},{}),M=l=>Object.entries(l).map(([g,d])=>({name:g,discountAmount:d.discountAmount,revenue:d.revenue,units:d.units,customers:d.customers.size,avgDiscount:d.units>0?d.discountAmount/d.units:0,discountRate:d.revenue>0?d.discountAmount/d.revenue*100:0})).sort((g,d)=>d.discountAmount-g.discountAmount);return{summary:{totalDiscount:t,totalRevenue:n,totalUnits:m,uniqueCustomers:x,avgDiscount:o,avgDiscountPercent:i,discountRate:n>0?t/n*100:0},categoryBreakdown:M(R),productBreakdown:M(S),locationBreakdown:M(C),paymentBreakdown:M(y),monthlyTrend:Object.values(f).map(l=>({...l,customers:l.customers.size,avgDiscount:l.units>0?l.discountAmount/l.units:0,discountRate:l.revenue>0?l.discountAmount/l.revenue*100:0})).sort((l,g)=>l.month.localeCompare(g.month))}},[u]);if(!s)return null;const h=()=>e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx($,{className:"bg-gradient-to-br from-red-50 to-rose-50 border-red-200",children:e.jsxs(F,{className:"p-4 text-center",children:[e.jsx(ae,{className:"w-8 h-8 text-red-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-red-700",children:"Total Discount"}),e.jsx("p",{className:"text-xl font-bold text-red-800",children:p(s.summary.totalDiscount)})]})}),e.jsx($,{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200",children:e.jsxs(F,{className:"p-4 text-center",children:[e.jsx(ze,{className:"w-8 h-8 text-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-blue-700",children:"Units Sold"}),e.jsx("p",{className:"text-xl font-bold text-blue-800",children:V(s.summary.totalUnits)})]})}),e.jsx($,{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-green-200",children:e.jsxs(F,{className:"p-4 text-center",children:[e.jsx(Ae,{className:"w-8 h-8 text-green-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-green-700",children:"Revenue"}),e.jsx("p",{className:"text-xl font-bold text-green-800",children:p(s.summary.totalRevenue)})]})}),e.jsx($,{className:"bg-gradient-to-br from-purple-50 to-violet-50 border-purple-200",children:e.jsxs(F,{className:"p-4 text-center",children:[e.jsx(Re,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-purple-700",children:"Customers"}),e.jsx("p",{className:"text-xl font-bold text-purple-800",children:V(s.summary.uniqueCustomers)})]})})]}),r=()=>{switch(D){case"categories":return e.jsx(X,{width:"100%",height:300,children:e.jsxs(De,{data:s.categoryBreakdown.slice(0,10),children:[e.jsx(Q,{strokeDasharray:"3 3"}),e.jsx(ee,{dataKey:"name"}),e.jsx(_,{}),e.jsx(Z,{formatter:t=>p(t)}),e.jsx(we,{}),e.jsx(se,{dataKey:"discountAmount",fill:"#ef4444",name:"Discount Amount"}),e.jsx(se,{dataKey:"revenue",fill:"#10b981",name:"Revenue"})]})});case"monthly-trend":return e.jsx(X,{width:"100%",height:300,children:e.jsxs(Se,{data:s.monthlyTrend,children:[e.jsx(Q,{strokeDasharray:"3 3"}),e.jsx(ee,{dataKey:"month"}),e.jsx(_,{}),e.jsx(Z,{formatter:t=>p(t)}),e.jsx(we,{}),e.jsx(ce,{type:"monotone",dataKey:"discountAmount",stroke:"#ef4444",name:"Discount Amount"}),e.jsx(ce,{type:"monotone",dataKey:"revenue",stroke:"#10b981",name:"Revenue"})]})});case"payment-methods":return e.jsx(X,{width:"100%",height:300,children:e.jsxs(Ie,{children:[e.jsx(Ye,{data:s.paymentBreakdown.slice(0,8),cx:"50%",cy:"50%",labelLine:!1,label:({name:t,percent:n})=>`${t} ${(n*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"discountAmount",children:s.paymentBreakdown.slice(0,8).map((t,n)=>e.jsx(Ge,{fill:Ue[n%Ue.length]},`cell-${n}`))}),e.jsx(Z,{formatter:t=>p(t)})]})});default:return null}},a=()=>{let t=[],n=[];switch(D){case"categories":t=s.categoryBreakdown,n=[{key:"name",label:"Category",icon:H},{key:"discountAmount",label:"Discount Amount",format:p},{key:"revenue",label:"Revenue",format:p},{key:"units",label:"Units Sold",format:V},{key:"customers",label:"Customers",format:V},{key:"discountRate",label:"Discount Rate",format:m=>`${m.toFixed(1)}%`}];break;case"locations":t=s.locationBreakdown,n=[{key:"name",label:"Location",icon:je},{key:"discountAmount",label:"Discount Amount",format:p},{key:"revenue",label:"Revenue",format:p},{key:"units",label:"Units Sold",format:V},{key:"customers",label:"Customers",format:V},{key:"discountRate",label:"Discount Rate",format:m=>`${m.toFixed(1)}%`}];break;case"payment-methods":t=s.paymentBreakdown,n=[{key:"name",label:"Payment Method",icon:Ne},{key:"discountAmount",label:"Discount Amount",format:p},{key:"revenue",label:"Revenue",format:p},{key:"units",label:"Units Sold",format:V},{key:"customers",label:"Customers",format:V},{key:"discountRate",label:"Discount Rate",format:m=>`${m.toFixed(1)}%`}];break;case"monthly-trend":t=s.monthlyTrend,n=[{key:"month",label:"Month",icon:ne},{key:"discountAmount",label:"Discount Amount",format:p},{key:"revenue",label:"Revenue",format:p},{key:"units",label:"Units Sold",format:V},{key:"customers",label:"Customers",format:V},{key:"discountRate",label:"Discount Rate",format:m=>`${m.toFixed(1)}%`}];break;default:return null}return e.jsxs($,{children:[e.jsx(O,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Detailed Breakdown"]})}),e.jsx(F,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(re,{children:[e.jsx(le,{children:e.jsx(E,{children:n.map(m=>e.jsx(T,{className:"font-semibold",children:e.jsxs("div",{className:"flex items-center gap-2",children:[m.icon&&e.jsx(m.icon,{className:"w-4 h-4"}),m.label]})},m.key))})}),e.jsx(ie,{children:t.slice(0,20).map((m,x)=>e.jsx(E,{className:"hover:bg-gray-50",children:n.map(o=>e.jsx(v,{children:o.format?o.format(m[o.key]):m[o.key]},o.key))},x))})]})})})]})};return e.jsx(rt,{open:w,onOpenChange:j,children:e.jsxs(lt,{className:"max-w-6xl max-h-[90vh]",children:[e.jsx(it,{children:e.jsxs(ct,{className:"text-xl font-bold text-gray-900",children:[B," - Detailed Analysis"]})}),e.jsx(dt,{className:"max-h-[calc(90vh-120px)]",children:e.jsxs("div",{className:"space-y-6 pr-4",children:[h(),r()&&e.jsxs($,{children:[e.jsx(O,{children:e.jsx(K,{children:"Visual Analysis"})}),e.jsx(F,{children:r()})]}),a()]})})]})})},wt=({data:w,onDrillDown:j})=>{const B=P.useMemo(()=>{const r=w.reduce((a,t)=>{const n=t.cleanedProduct||"Unknown Product";return a[n]||(a[n]={product:n,category:t.cleanedCategory||"Unknown",transactions:0,totalDiscount:0,totalRevenue:0,totalMrp:0,avgDiscountPercentage:0,data:[]}),a[n].transactions+=1,a[n].totalDiscount+=t.discountAmount||0,a[n].totalRevenue+=t.paymentValue||0,a[n].totalMrp+=t.mrpPostTax||0,a[n].data.push(t),a},{});return Object.values(r).map(a=>({...a,avgDiscountPercentage:a.totalMrp>0?a.totalDiscount/a.totalMrp*100:0,discountRate:a.transactions>0?a.totalDiscount/a.transactions:0})).sort((a,t)=>t.totalDiscount-a.totalDiscount)},[w]),u=P.useMemo(()=>{const r=w.reduce((a,t)=>{const n=t.calculatedLocation||"Unknown Location";return a[n]||(a[n]={location:n,transactions:0,totalDiscount:0,totalRevenue:0,totalMrp:0,uniqueCustomers:new Set,data:[]}),a[n].transactions+=1,a[n].totalDiscount+=t.discountAmount||0,a[n].totalRevenue+=t.paymentValue||0,a[n].totalMrp+=t.mrpPostTax||0,a[n].uniqueCustomers.add(t.customerEmail),a[n].data.push(t),a},{});return Object.values(r).map(a=>({...a,uniqueCustomers:a.uniqueCustomers.size,avgDiscountPercentage:a.totalMrp>0?a.totalDiscount/a.totalMrp*100:0,avgDiscountPerTransaction:a.transactions>0?a.totalDiscount/a.transactions:0})).sort((a,t)=>t.totalDiscount-a.totalDiscount)},[w]),D=P.useMemo(()=>{const r=w.reduce((a,t)=>{const n=t.soldBy||"Unknown";return a[n]||(a[n]={staff:n,transactions:0,totalDiscount:0,totalRevenue:0,totalMrp:0,data:[]}),a[n].transactions+=1,a[n].totalDiscount+=t.discountAmount||0,a[n].totalRevenue+=t.paymentValue||0,a[n].totalMrp+=t.mrpPostTax||0,a[n].data.push(t),a},{});return Object.values(r).map(a=>({...a,avgDiscountPercentage:a.totalMrp>0?a.totalDiscount/a.totalMrp*100:0,discountRate:a.transactions>0?a.totalDiscount/a.transactions:0})).sort((a,t)=>t.totalDiscount-a.totalDiscount)},[w]),s=(r,a,t)=>{j&&j(r,a,t)},h=r=>r>=40?{variant:"destructive",label:"High"}:r>=20?{variant:"secondary",label:"Medium"}:{variant:"default",label:"Low"};return e.jsxs("div",{className:"grid gap-6",children:[e.jsxs($,{className:"shadow-xl border-0 bg-gradient-to-br from-white via-orange-50/30 to-amber-50/20",children:[e.jsx(O,{className:"bg-gradient-to-r from-slate-800 via-slate-700 to-slate-600 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg backdrop-blur-sm",children:e.jsx(H,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx(K,{className:"text-2xl font-bold",children:"Product-wise Discount Breakdown"}),e.jsx("p",{className:"text-slate-200 mt-1",children:"Discount performance analysis by product category"})]})]})}),e.jsx(F,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(re,{children:[e.jsx(le,{children:e.jsxs(E,{children:[e.jsx(T,{children:"Product"}),e.jsx(T,{children:"Category"}),e.jsx(T,{className:"text-center",children:"Transactions"}),e.jsx(T,{className:"text-right",children:"Total Discount"}),e.jsx(T,{className:"text-right",children:"Avg Discount %"}),e.jsx(T,{className:"text-right",children:"Total Revenue"}),e.jsx(T,{className:"text-right",children:"Discount Impact"}),e.jsx(T,{className:"text-center",children:"Actions"})]})}),e.jsx(ie,{children:B.slice(0,10).map((r,a)=>{const t=h(r.avgDiscountPercentage);return e.jsxs(E,{children:[e.jsx(v,{className:"font-medium",children:e.jsx("div",{className:"max-w-[200px] truncate",title:r.product,children:r.product})}),e.jsx(v,{children:e.jsx("span",{className:"text-sm text-slate-600",children:r.category})}),e.jsx(v,{className:"text-center",children:e.jsx(L,{variant:"outline",children:V(r.transactions)})}),e.jsx(v,{className:"text-right font-semibold text-red-600",children:p(r.totalDiscount)}),e.jsx(v,{className:"text-right",children:e.jsx(L,{variant:t.variant,children:z(r.avgDiscountPercentage)})}),e.jsx(v,{className:"text-right font-semibold text-green-600",children:p(r.totalRevenue)}),e.jsx(v,{className:"text-right",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:p(r.discountRate)}),e.jsx("div",{className:"text-slate-500",children:"per transaction"})]})}),e.jsx(v,{className:"text-center",children:e.jsx(U,{variant:"outline",size:"sm",onClick:()=>s(`${r.product} - Discount Analysis`,r.data,"product-discount"),className:"hover:bg-orange-50",children:e.jsx(oe,{className:"w-4 h-4"})})})]},a)})}),e.jsx(ye,{children:e.jsxs(E,{children:[e.jsx(v,{colSpan:2,className:"font-bold",children:"Total (Top 10)"}),e.jsx(v,{className:"text-center font-bold",children:V(B.slice(0,10).reduce((r,a)=>r+a.transactions,0))}),e.jsx(v,{className:"text-right font-bold text-red-600",children:p(B.slice(0,10).reduce((r,a)=>r+a.totalDiscount,0))}),e.jsx(v,{className:"text-right font-bold",children:z(B.slice(0,10).reduce((r,a)=>r+a.avgDiscountPercentage,0)/Math.min(10,B.length))}),e.jsx(v,{className:"text-right font-bold text-green-600",children:p(B.slice(0,10).reduce((r,a)=>r+a.totalRevenue,0))}),e.jsx(v,{colSpan:2})]})})]})})})]}),e.jsxs($,{className:"shadow-xl border-0 bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20",children:[e.jsx(O,{className:"bg-gradient-to-r from-slate-800 via-slate-700 to-slate-600 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg backdrop-blur-sm",children:e.jsx(je,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx(K,{className:"text-2xl font-bold",children:"Location-wise Discount Breakdown"}),e.jsx("p",{className:"text-slate-200 mt-1",children:"Geographic analysis of discount utilization patterns"})]})]})}),e.jsx(F,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(re,{children:[e.jsx(le,{children:e.jsxs(E,{children:[e.jsx(T,{children:"Location"}),e.jsx(T,{className:"text-center",children:"Transactions"}),e.jsx(T,{className:"text-center",children:"Customers"}),e.jsx(T,{className:"text-right",children:"Total Discount"}),e.jsx(T,{className:"text-right",children:"Avg Discount %"}),e.jsx(T,{className:"text-right",children:"Avg per Transaction"}),e.jsx(T,{className:"text-right",children:"Total Revenue"}),e.jsx(T,{className:"text-center",children:"Actions"})]})}),e.jsx(ie,{children:u.map((r,a)=>{const t=h(r.avgDiscountPercentage);return e.jsxs(E,{children:[e.jsx(v,{className:"font-medium",children:r.location}),e.jsx(v,{className:"text-center",children:e.jsx(L,{variant:"outline",children:V(r.transactions)})}),e.jsx(v,{className:"text-center",children:e.jsx(L,{variant:"secondary",children:V(r.uniqueCustomers)})}),e.jsx(v,{className:"text-right font-semibold text-red-600",children:p(r.totalDiscount)}),e.jsx(v,{className:"text-right",children:e.jsx(L,{variant:t.variant,children:z(r.avgDiscountPercentage)})}),e.jsx(v,{className:"text-right font-medium",children:p(r.avgDiscountPerTransaction)}),e.jsx(v,{className:"text-right font-semibold text-green-600",children:p(r.totalRevenue)}),e.jsx(v,{className:"text-center",children:e.jsx(U,{variant:"outline",size:"sm",onClick:()=>s(`${r.location} - Discount Analysis`,r.data,"location-discount"),className:"hover:bg-blue-50",children:e.jsx(oe,{className:"w-4 h-4"})})})]},a)})}),e.jsx(ye,{children:e.jsxs(E,{children:[e.jsx(v,{className:"font-bold",children:"Total"}),e.jsx(v,{className:"text-center font-bold",children:V(u.reduce((r,a)=>r+a.transactions,0))}),e.jsx(v,{className:"text-center font-bold",children:V(u.reduce((r,a)=>r+a.uniqueCustomers,0))}),e.jsx(v,{className:"text-right font-bold text-red-600",children:p(u.reduce((r,a)=>r+a.totalDiscount,0))}),e.jsx(v,{className:"text-right font-bold",children:z(u.reduce((r,a)=>r+a.avgDiscountPercentage,0)/u.length)}),e.jsx(v,{className:"text-right font-bold",children:p(u.reduce((r,a)=>r+a.avgDiscountPerTransaction,0)/u.length)}),e.jsx(v,{className:"text-right font-bold text-green-600",children:p(u.reduce((r,a)=>r+a.totalRevenue,0))}),e.jsx(v,{})]})})]})})})]}),e.jsxs($,{className:"shadow-xl border-0 bg-gradient-to-br from-white via-purple-50/30 to-pink-50/20",children:[e.jsx(O,{className:"bg-gradient-to-r from-slate-800 via-slate-700 to-slate-600 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg backdrop-blur-sm",children:e.jsx(Re,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx(K,{className:"text-2xl font-bold",children:"Staff-wise Discount Breakdown"}),e.jsx("p",{className:"text-slate-200 mt-1",children:"Analysis of discount authorization by sales staff"})]})]})}),e.jsx(F,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(re,{children:[e.jsx(le,{children:e.jsxs(E,{children:[e.jsx(T,{children:"Staff Member"}),e.jsx(T,{className:"text-center",children:"Transactions"}),e.jsx(T,{className:"text-right",children:"Total Discount"}),e.jsx(T,{className:"text-right",children:"Avg Discount %"}),e.jsx(T,{className:"text-right",children:"Discount per Sale"}),e.jsx(T,{className:"text-right",children:"Total Revenue"}),e.jsx(T,{className:"text-center",children:"Performance"}),e.jsx(T,{className:"text-center",children:"Actions"})]})}),e.jsx(ie,{children:D.map((r,a)=>{const t=h(r.avgDiscountPercentage);return e.jsxs(E,{children:[e.jsx(v,{className:"font-medium",children:r.staff}),e.jsx(v,{className:"text-center",children:e.jsx(L,{variant:"outline",children:V(r.transactions)})}),e.jsx(v,{className:"text-right font-semibold text-red-600",children:p(r.totalDiscount)}),e.jsx(v,{className:"text-right",children:e.jsx(L,{variant:t.variant,children:z(r.avgDiscountPercentage)})}),e.jsx(v,{className:"text-right font-medium",children:p(r.discountRate)}),e.jsx(v,{className:"text-right font-semibold text-green-600",children:p(r.totalRevenue)}),e.jsx(v,{className:"text-center",children:e.jsx(L,{variant:t.variant,children:t.label})}),e.jsx(v,{className:"text-center",children:e.jsx(U,{variant:"outline",size:"sm",onClick:()=>s(`${r.staff} - Discount Analysis`,r.data,"staff-discount"),className:"hover:bg-purple-50",children:e.jsx(oe,{className:"w-4 h-4"})})})]},a)})}),e.jsx(ye,{children:e.jsxs(E,{children:[e.jsx(v,{className:"font-bold",children:"Total"}),e.jsx(v,{className:"text-center font-bold",children:V(D.reduce((r,a)=>r+a.transactions,0))}),e.jsx(v,{className:"text-right font-bold text-red-600",children:p(D.reduce((r,a)=>r+a.totalDiscount,0))}),e.jsx(v,{className:"text-right font-bold",children:z(D.reduce((r,a)=>r+a.avgDiscountPercentage,0)/D.length)}),e.jsx(v,{className:"text-right font-bold",children:p(D.reduce((r,a)=>r+a.discountRate,0)/D.length)}),e.jsx(v,{className:"text-right font-bold text-green-600",children:p(D.reduce((r,a)=>r+a.totalRevenue,0))}),e.jsx(v,{colSpan:2})]})})]})})})]})]})},At=({data:w,onRowClick:j})=>{const[B,u]=P.useState(""),[D,s]=P.useState("paymentDate"),[h,r]=P.useState("desc"),[a,t]=P.useState(1),n=50,m=P.useMemo(()=>{let f=w.filter(M=>{const l=B.toLowerCase();return M.customerName?.toLowerCase().includes(l)||M.customerEmail?.toLowerCase().includes(l)||M.cleanedProduct?.toLowerCase().includes(l)||M.cleanedCategory?.toLowerCase().includes(l)||M.calculatedLocation?.toLowerCase().includes(l)||M.soldBy?.toLowerCase().includes(l)});return f.sort((M,l)=>{let g=M[D],d=l[D];return typeof g=="number"&&typeof d=="number"?h==="asc"?g-d:d-g:typeof g=="string"&&typeof d=="string"?h==="asc"?g.localeCompare(d):d.localeCompare(g):0}),f},[w,B,D,h]),x=Math.ceil(m.length/n),o=m.slice((a-1)*n,a*n),i=P.useMemo(()=>{const f=m.reduce((d,b)=>d+(b.discountAmount||0),0),M=m.reduce((d,b)=>d+(b.paymentValue||0),0),l=m.reduce((d,b)=>d+(b.mrpPostTax||0),0),g=m.length>0?m.reduce((d,b)=>d+(b.discountPercentage||0),0)/m.length:0;return{totalDiscount:f,totalRevenue:M,totalMrp:l,avgDiscountPercentage:g,totalTransactions:m.length}},[m]),R=f=>{D===f?r(h==="asc"?"desc":"asc"):(s(f),r("desc"))},S=f=>{j&&j(`Transaction Details - ${f.customerName}`,[f],"transaction-detail")},C=f=>D!==f?null:h==="asc"?e.jsx(qe,{className:"w-4 h-4"}):e.jsx(ae,{className:"w-4 h-4"}),y=f=>f>=50?"destructive":f>=25?"secondary":"default";return e.jsxs($,{className:"shadow-xl border-0 bg-gradient-to-br from-white via-slate-50 to-blue-50/30",children:[e.jsx(O,{className:"bg-gradient-to-r from-slate-800 via-slate-700 to-slate-600 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg backdrop-blur-sm",children:e.jsx(de,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx(K,{className:"text-2xl font-bold",children:"Detailed Discount Analysis"}),e.jsx("p",{className:"text-slate-200 mt-1",children:"Comprehensive transaction-level discount data with advanced filtering"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(tt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(ge,{placeholder:"Search transactions...",value:B,onChange:f=>u(f.target.value),className:"pl-10 bg-white/10 border-white/20 text-white placeholder:text-slate-300"})]}),e.jsxs(U,{variant:"outline",size:"sm",className:"bg-white/10 border-white/20 text-white hover:bg-white/20",children:[e.jsx(st,{className:"w-4 h-4 mr-2"}),"Export"]})]})]})}),e.jsxs(F,{className:"p-0",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 border-b",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-700",children:V(i.totalTransactions)}),e.jsx("div",{className:"text-sm text-slate-500",children:"Total Transactions"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:p(i.totalDiscount)}),e.jsx("div",{className:"text-sm text-slate-500",children:"Total Discount"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:p(i.totalRevenue)}),e.jsx("div",{className:"text-sm text-slate-500",children:"Total Revenue"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:p(i.totalMrp)}),e.jsx("div",{className:"text-sm text-slate-500",children:"Total MRP"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:z(i.avgDiscountPercentage)}),e.jsx("div",{className:"text-sm text-slate-500",children:"Avg Discount %"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(re,{children:[e.jsx(le,{className:"bg-gradient-to-br from-indigo-800 to-blue-900 ",children:e.jsxs(E,{className:"bg-gradient-to-br from-gray-800 to-indigo-900",children:[e.jsx(T,{className:"cursor-pointer",onClick:()=>R("paymentDate"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Date ",C("paymentDate")]})}),e.jsx(T,{className:"cursor-pointer",onClick:()=>R("customerName"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Customer ",C("customerName")]})}),e.jsx(T,{onClick:()=>R("cleanedProduct"),className:"cursor-pointer bg-gradient-to-br from-gray-800 to-indigo-900 ",children:e.jsxs("div",{className:"flex items-center gap-2",children:["Product ",C("cleanedProduct")]})}),e.jsx(T,{className:"cursor-pointer text-right",onClick:()=>R("mrpPostTax"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:["MRP ",C("mrpPostTax")]})}),e.jsx(T,{className:"cursor-pointer text-right",onClick:()=>R("discountAmount"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:["Discount ",C("discountAmount")]})}),e.jsx(T,{className:"cursor-pointer text-right",onClick:()=>R("discountPercentage"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:["Discount % ",C("discountPercentage")]})}),e.jsx(T,{className:"cursor-pointer text-right",onClick:()=>R("paymentValue"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:["Final Amount ",C("paymentValue")]})}),e.jsx(T,{children:"Location"}),e.jsx(T,{children:"Sold By"}),e.jsx(T,{className:"text-center",children:"Actions"})]})}),e.jsx(ie,{children:o.map((f,M)=>e.jsxs(E,{className:"hover:cursor-pointer",children:[e.jsx(v,{className:"font-medium",children:new Date(f.paymentDate).toLocaleDateString()}),e.jsx(v,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-700",children:f.customerName}),e.jsx("div",{className:"text-sm text-slate-500",children:f.customerEmail})]})}),e.jsx(v,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-700",children:f.cleanedProduct}),e.jsx("div",{className:"text-sm text-slate-500",children:f.cleanedCategory})]})}),e.jsx(v,{className:"text-right font-medium",children:p(f.mrpPostTax||0)}),e.jsx(v,{className:"text-right",children:e.jsxs("span",{className:"font-semibold text-red-600",children:["-",p(f.discountAmount||0)]})}),e.jsx(v,{className:"text-right",children:e.jsx(L,{variant:y(f.discountPercentage||0),children:z(f.discountPercentage||0)})}),e.jsx(v,{className:"text-right font-semibold text-green-600",children:p(f.paymentValue||0)}),e.jsx(v,{children:e.jsx("span",{className:"text-sm text-slate-600",children:f.calculatedLocation})}),e.jsx(v,{children:e.jsx("span",{className:"text-sm text-slate-600",children:f.soldBy})}),e.jsx(v,{className:"text-center",children:e.jsx(U,{variant:"outline",size:"sm",onClick:()=>S(f),className:"hover:bg-blue-50",children:e.jsx(oe,{className:"w-4 h-4"})})})]},`${f.saleItemId}-${M}`))}),e.jsx(ye,{children:e.jsxs(E,{children:[e.jsxs(v,{colSpan:3,className:"font-bold",children:["Summary (",V(i.totalTransactions)," transactions)"]}),e.jsx(v,{className:"text-right font-bold",children:p(i.totalMrp)}),e.jsxs(v,{className:"text-right font-bold text-red-600",children:["-",p(i.totalDiscount)]}),e.jsx(v,{className:"text-right font-bold",children:z(i.avgDiscountPercentage)}),e.jsx(v,{className:"text-right font-bold text-green-600",children:p(i.totalRevenue)}),e.jsx(v,{colSpan:3})]})})]})}),x>1&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-t bg-slate-50",children:[e.jsxs("div",{className:"text-sm text-slate-600",children:["Showing ",(a-1)*n+1," to ",Math.min(a*n,m.length)," of ",m.length," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{variant:"outline",size:"sm",onClick:()=>t(Math.max(1,a-1)),disabled:a===1,children:"Previous"}),e.jsxs("span",{className:"text-sm text-slate-600",children:["Page ",a," of ",x]}),e.jsx(U,{variant:"outline",size:"sm",onClick:()=>t(Math.min(x,a+1)),disabled:a===x,children:"Next"})]})]})]})]})},Mt=({data:w})=>{const[j,B]=P.useState("all"),[u,D]=P.useState(!0),[s,h]=P.useState({}),[r,a]=P.useState({isOpen:!1,title:"",data:[],type:""});P.useEffect(()=>{const C=gt();h({dateRange:{from:new Date(C.start),to:new Date(C.end)}})},[]);const t=P.useMemo(()=>w.filter(C=>{if(j!=="all"&&C.calculatedLocation!==j||s.location&&C.calculatedLocation!==s.location||s.category&&C.cleanedCategory!==s.category||s.product&&C.cleanedProduct!==s.product||s.soldBy&&(C.soldBy==="-"?"Online/System":C.soldBy)!==s.soldBy||s.paymentMethod&&C.paymentMethod!==s.paymentMethod)return!1;if(s.dateRange?.from||s.dateRange?.to){const y=new Date(C.paymentDate),f=new Date(y.getFullYear(),y.getMonth(),y.getDate());if(s.dateRange.from){const M=new Date(s.dateRange.from),l=new Date(M.getFullYear(),M.getMonth(),M.getDate());if(f<l)return!1}if(s.dateRange.to){const M=new Date(s.dateRange.to),l=new Date(M.getFullYear(),M.getMonth(),M.getDate());if(f>l)return!1}}return!(s.minDiscountAmount&&(C.discountAmount||0)<s.minDiscountAmount||s.maxDiscountAmount&&(C.discountAmount||0)>s.maxDiscountAmount||s.minDiscountPercent&&(C.discountPercentage||0)<s.minDiscountPercent||s.maxDiscountPercent&&(C.discountPercentage||0)>s.maxDiscountPercent)}),[w,j,s]),n=P.useMemo(()=>w.filter(C=>!(j!=="all"&&C.calculatedLocation!==j)),[w,j]),m=P.useMemo(()=>n.filter(C=>(C.discountAmount||0)>0),[n]),x=P.useMemo(()=>t.filter(C=>(C.discountAmount||0)>0),[t]),o=(C,y,f)=>{a({isOpen:!0,title:C,data:y,type:f})},i=()=>{a({isOpen:!1,title:"",data:[],type:""})},R=C=>{h(C)},S=()=>{D(!u)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(pt,{data:w,selectedLocation:j,onLocationChange:B}),e.jsx(ut,{open:!u,onOpenChange:()=>D(!u),children:e.jsxs($,{className:"border-0 shadow-xl bg-gradient-to-r from-indigo-50 via-purple-50 to-slate-50 backdrop-blur-sm",children:[e.jsx(xt,{asChild:!0,children:e.jsxs(U,{variant:"ghost",className:"w-full justify-between p-6 h-auto hover:bg-indigo-100/40 transition-all duration-300",onClick:S,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(be,{className:"w-6 h-6 text-indigo-700"}),e.jsxs("span",{className:"text-xl font-bold text-indigo-900",children:["Advanced Filters ",Object.keys(s).length>0&&`(${Object.keys(s).length} active)`]})]}),u?e.jsx(pe,{className:"w-6 h-6 text-indigo-700"}):e.jsx(ve,{className:"w-6 h-6 text-indigo-700"})]})}),e.jsx(mt,{children:e.jsx("div",{className:"px-6 pb-6 border-t border-indigo-200/50 bg-white/30 backdrop-blur-sm",children:e.jsx(yt,{data:w,onFiltersChange:R,isCollapsed:!1,onToggleCollapse:S})})})]})}),e.jsx(ft,{data:x,onCardClick:(C,y)=>o(C,y,"metric")}),e.jsxs(ke,{defaultValue:"detailed",className:"space-y-6",children:[e.jsxs(Te,{className:"grid w-full grid-cols-5 bg-gradient-to-r from-indigo-100 via-purple-100 to-slate-100 p-1 rounded-xl shadow-lg border border-indigo-200/50",children:[e.jsx(Y,{value:"detailed",className:"data-[state=active]:bg-white data-[state=active]:shadow-lg data-[state=active]:text-indigo-800 font-semibold transition-all duration-300",children:"Data Tables"}),e.jsx(Y,{value:"breakdown",className:"data-[state=active]:bg-white data-[state=active]:shadow-lg data-[state=active]:text-indigo-800 font-semibold transition-all duration-300",children:"Breakdowns"}),e.jsx(Y,{value:"trends",className:"data-[state=active]:bg-white data-[state=active]:shadow-lg data-[state=active]:text-indigo-800 font-semibold transition-all duration-300",children:"Trends"}),e.jsx(Y,{value:"analytics",className:"data-[state=active]:bg-white data-[state=active]:shadow-lg data-[state=active]:text-indigo-800 font-semibold transition-all duration-300",children:"Analytics"}),e.jsx(Y,{value:"overview",className:"data-[state=active]:bg-white data-[state=active]:shadow-lg data-[state=active]:text-indigo-800 font-semibold transition-all duration-300",children:"Overview"})]}),e.jsxs(I,{value:"overview",className:"space-y-6",children:[e.jsx(Oe,{data:x}),e.jsx(Ke,{data:x,onDrillDown:o})]}),e.jsx(I,{value:"analytics",className:"space-y-6",children:e.jsx(Oe,{data:x})}),e.jsx(I,{value:"trends",className:"space-y-6",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsx(bt,{data:m}),e.jsx(Nt,{data:m})]})}),e.jsx(I,{value:"rankings",className:"space-y-6",children:e.jsx(Ke,{data:x,onDrillDown:o})}),e.jsx(I,{value:"detailed",className:"space-y-6",children:e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-xl p-6 border border-indigo-200/50",children:e.jsx(At,{data:x,onRowClick:(C,y,f)=>o(C,y,f)})})}),e.jsx(I,{value:"breakdown",className:"space-y-6",children:e.jsx(wt,{data:x,onDrillDown:o})})]}),e.jsx(Dt,{isOpen:r.isOpen,onClose:i,title:r.title,data:r.data,type:r.type})]})},Bt=({children:w})=>{const j=[{icon:e.jsx(de,{className:"w-full h-full text-white p-2"}),size:"lg",position:{top:"20%",left:"10%"},delay:.5},{icon:e.jsx(Ae,{className:"w-full h-full text-white p-2"}),size:"md",position:{top:"15%",right:"15%"},delay:.8},{icon:e.jsx(ae,{className:"w-full h-full text-white p-2"}),size:"sm",position:{bottom:"25%",left:"15%"},delay:1.1},{icon:e.jsx(Pe,{className:"w-full h-full text-white p-2"}),size:"md",position:{bottom:"30%",right:"20%"},delay:1.4},{icon:e.jsx("div",{className:"w-full h-full rounded-full bg-gradient-to-br from-orange-400/30 to-amber-500/30 backdrop-blur-sm border border-white/10 flex items-center justify-center",children:e.jsx("div",{className:"text-xs font-bold text-white",children:"%"})}),size:"sm",position:{top:"50%",left:"5%"},delay:1.7},{icon:e.jsx("div",{className:"w-full h-full rounded-full bg-gradient-to-br from-amber-400/30 to-orange-500/30 backdrop-blur-sm border border-white/10 flex items-center justify-center",children:e.jsx("div",{className:"text-xs font-bold text-white",children:"₹"})}),size:"sm",position:{top:"40%",right:"8%"},delay:2}];return e.jsx(ht,{title:"Discount Analytics",subtitle:"Comprehensive analysis of discounts, promotions, and their impact on revenue performance",tabName:"discounts",floatingElements:j,children:w})};export{St as E,Bt as M,Mt as a};
