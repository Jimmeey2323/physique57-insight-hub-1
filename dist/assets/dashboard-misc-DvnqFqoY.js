import{j as e,h as xe,i as qe,U as X,O as ss,T as Oe,e as ve,g as Ee,c as ne,f as $e,r as A,F as ts,b as Ye,y as Ns,X as fe,$ as Te,a7 as os,v as He,s as Le,E as ys,R as Ve,k as ns,ae as rs,af as ls,w as Be,J as ds,ag as Fs,ah as Is,B as ws,a1 as $s,a0 as Ls,ai as zs,Z as Cs,M as we,V as ms,W as Os,u as ks,D as qs,aj as Es,ak as xs,a9 as Bs,_ as Us,S as Ss,m as Ms,n as Ds,al as Ks,am as Ws,a2 as Gs,d as as,l as Ys,C as Hs}from"./react-vendor-Di6K3Iht.js";import{C as I,j as K,k as W,c as $,a as Js,b as _s,e as Xs,P as hs,J as us,d as G,K as ps,M as gs,S as pe,f as ge,g as je,h as be,i as ae,I as Ae,B as z,r as Re,s as ze,t as H,u as se,a5 as is,L as de,l as js,Z as Je,_ as _e,$ as Xe,a0 as Qe,T as ke,m as Se,n as re,o as B,p as Me,q as U,W as Qs,a3 as Zs,a2 as es}from"./ui-components-vIyQeg8Q.js";import{c as M,f as _,q as et,b as J,g as bs}from"./utils-w8vrWjz4.js";import{c as te}from"./dashboard-classes-DXdXVLRz.js";import{S as st}from"./dashboard-sales-CsPY2_Nd.js";import{f as Ke}from"./utils-vendor-R2EFQ5ZT.js";import{R as Ne,P as Ts,d as As,e as Rs,T as ye,B as We,C as Pe,X as Fe,Y as Ie,c as De,A as Vs,f as Ge,a as Ps,L as tt,b as at}from"./chart-vendor-BSHhUw40.js";const ft=({onButtonClick:i})=>{const T=[{id:"executive-summary",title:"Executive Summary",description:"High-level business metrics and KPIs",icon:xe,color:"from-blue-500 to-blue-600",hoverColor:"hover:from-blue-600 hover:to-blue-700"},{id:"sales-analytics",title:"Sales Analytics",description:"Revenue trends and sales performance",icon:qe,color:"from-green-500 to-green-600",hoverColor:"hover:from-green-600 hover:to-green-700"},{id:"class-attendance",title:"Class Attendance",description:"Session attendance and capacity analysis",icon:X,color:"from-purple-500 to-purple-600",hoverColor:"hover:from-purple-600 hover:to-purple-700"},{id:"trainer-performance",title:"Trainer Performance",description:"Individual trainer metrics and rankings",icon:ss,color:"from-orange-500 to-orange-600",hoverColor:"hover:from-orange-600 hover:to-orange-700"},{id:"client-retention",title:"Client Retention",description:"Member retention and conversion analysis",icon:Oe,color:"from-teal-500 to-teal-600",hoverColor:"hover:from-teal-600 hover:to-teal-700"},{id:"discounts-promotions",title:"Discounts & Promotions",description:"Discount analysis and promotional effectiveness",icon:ve,color:"from-pink-500 to-pink-600",hoverColor:"hover:from-pink-600 hover:to-pink-700"},{id:"funnel-leads",title:"Funnel & Leads",description:"Lead conversion and sales funnel analysis",icon:Ee,color:"from-indigo-500 to-indigo-600",hoverColor:"hover:from-indigo-600 hover:to-indigo-700"},{id:"class-performance-series",title:"Class Performance Series",description:"Detailed class format performance analysis",icon:ne,color:"from-cyan-500 to-cyan-600",hoverColor:"hover:from-cyan-600 hover:to-cyan-700"},{id:"late-cancellations",title:"Late Cancellations",description:"Analysis of late cancellations and no-shows",icon:$e,color:"from-red-500 to-red-600",hoverColor:"hover:from-red-600 hover:to-red-700"},{id:"powercycle-vs-barre",title:"powerCycle Vs Barre Vs Strength",description:"Comparative analysis of PowerCycle, Barre, and Strength classes",icon:Ee,color:"from-violet-500 to-violet-600",hoverColor:"hover:from-violet-600 hover:to-violet-700"},{id:"expiration-analytics",title:"Expirations & Churn",description:"Membership expirations and customer retention analysis",icon:ne,color:"from-amber-500 to-amber-600",hoverColor:"hover:from-amber-600 hover:to-amber-700"}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 p-2",children:T.map(j=>{const V=j.icon;return e.jsxs(I,{className:"group cursor-pointer relative overflow-hidden bg-white/80 backdrop-blur-sm border-0 shadow-lg hover:shadow-2xl transition-all duration-500 ease-out hover:-translate-y-3 hover:rotate-1 transform-gpu",onClick:()=>i(j.id),children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${j.color} opacity-0 group-hover:opacity-10 transition-opacity duration-700`}),e.jsx("div",{className:`absolute inset-0 rounded-lg bg-gradient-to-r ${j.color} opacity-0 group-hover:opacity-20 blur-xl transition-all duration-500 -z-10`}),e.jsxs(K,{className:"pb-4 relative z-10",children:[e.jsxs("div",{className:`w-14 h-14 rounded-2xl bg-gradient-to-br ${j.color} ${j.hoverColor} flex items-center justify-center mb-4 transition-all duration-500 group-hover:scale-125 group-hover:rotate-12 shadow-lg group-hover:shadow-2xl`,children:[e.jsx(V,{className:"w-7 h-7 text-white transition-transform duration-300 group-hover:scale-110"}),e.jsx("div",{className:`absolute inset-0 rounded-2xl bg-gradient-to-r ${j.color} opacity-0 group-hover:opacity-30 animate-ping`})]}),e.jsx(W,{className:"text-xl font-bold text-gray-900 group-hover:bg-gradient-to-r group-hover:from-gray-900 group-hover:to-gray-600 group-hover:bg-clip-text group-hover:text-transparent transition-all duration-500 leading-tight",children:j.title})]}),e.jsxs($,{className:"pt-0 relative z-10",children:[e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed mb-4 transition-colors duration-300 group-hover:text-gray-700",children:j.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx("div",{className:"w-2.5 h-2.5 bg-emerald-400 rounded-full mr-2 animate-pulse shadow-sm shadow-emerald-400/50 group-hover:animate-bounce"}),e.jsx("span",{className:"font-medium group-hover:text-emerald-600 transition-colors",children:"Active"})]}),e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-100 group-hover:bg-gray-200 flex items-center justify-center transition-all duration-300 group-hover:translate-x-1",children:e.jsx("svg",{className:"w-3 h-3 text-gray-400 group-hover:text-gray-600 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),e.jsx("div",{className:`absolute bottom-0 left-0 h-1 bg-gradient-to-r ${j.color} transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500 origin-left rounded-full`})]}),e.jsxs("div",{className:"absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity duration-700",children:[e.jsx("div",{className:"w-1 h-1 bg-white rounded-full animate-bounce delay-100"}),e.jsx("div",{className:"w-1 h-1 bg-white rounded-full animate-bounce delay-200 mt-1 ml-2"}),e.jsx("div",{className:"w-1 h-1 bg-white rounded-full animate-bounce delay-300 mt-1"})]})]},j.id)})})},nt=({filters:i,onFiltersChange:T,onReset:j})=>{const[V,k]=A.useState(!1),[v,N]=A.useState(i.dateRange.start?new Date(i.dateRange.start):void 0),[o,p]=A.useState(i.dateRange.end?new Date(i.dateRange.end):void 0),[b,x]=A.useState(i),C=()=>{const w={...b,dateRange:{start:v?Ke(v,"yyyy-MM-dd"):"",end:o?Ke(o,"yyyy-MM-dd"):""}};T(w),k(!1)},y=()=>{j(),N(void 0),p(void 0),x({dateRange:{start:"",end:""},location:[],category:[],product:[],soldBy:[],paymentMethod:[]}),k(!1)},R=(w,u)=>{if(w==="dateRange")N(void 0),p(void 0),T({...i,dateRange:{start:"",end:""}});else if(Array.isArray(i[w])){const m=i[w].filter(n=>n!==u);T({...i,[w]:m})}},P=(()=>{let w=0;return(i.dateRange.start||i.dateRange.end)&&w++,i.category?.length&&(w+=i.category.length),i.paymentMethod?.length&&(w+=i.paymentMethod.length),i.soldBy?.length&&(w+=i.soldBy.length),(i.minAmount||i.maxAmount)&&w++,w})();return e.jsxs(I,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl backdrop-blur-sm",children:[e.jsxs(Js,{open:V,onOpenChange:k,children:[e.jsx(_s,{asChild:!0,children:e.jsx(K,{className:"cursor-pointer hover:bg-slate-50/50 transition-colors rounded-t-xl",children:e.jsxs(W,{className:"flex items-center justify-between text-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-r from-blue-500 to-purple-600",children:e.jsx(ts,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:"bg-gradient-to-r from-slate-700 via-slate-800 to-slate-900 bg-clip-text text-transparent",children:"Advanced Filters"}),P>0&&e.jsxs(z,{variant:"default",className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white",children:[P," active"]})]}),e.jsx(Ye,{className:te("w-5 h-5 transition-transform text-slate-600",V&&"rotate-180")})]})})}),e.jsx(Xs,{children:e.jsxs($,{className:"space-y-6 pt-0",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"Start Date"}),e.jsxs(hs,{children:[e.jsx(us,{asChild:!0,children:e.jsxs(G,{variant:"outline",className:te("w-full justify-start text-left font-normal bg-white/80 backdrop-blur-sm",!v&&"text-muted-foreground"),children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),v?Ke(v,"PPP"):"Pick start date"]})}),e.jsx(ps,{className:"w-auto p-0",align:"start",children:e.jsx(gs,{mode:"single",selected:v,onSelect:N,initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"End Date"}),e.jsxs(hs,{children:[e.jsx(us,{asChild:!0,children:e.jsxs(G,{variant:"outline",className:te("w-full justify-start text-left font-normal bg-white/80 backdrop-blur-sm",!o&&"text-muted-foreground"),children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),o?Ke(o,"PPP"):"Pick end date"]})}),e.jsx(ps,{className:"w-auto p-0",align:"start",children:e.jsx(gs,{mode:"single",selected:o,onSelect:p,initialFocus:!0})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"Category"}),e.jsxs(pe,{value:"",onValueChange:w=>{b.category?.includes(w)||x({...b,category:[...b.category||[],w]})},children:[e.jsx(ge,{className:"bg-white/80 backdrop-blur-sm",children:e.jsx(je,{placeholder:"Select categories..."})}),e.jsxs(be,{children:[e.jsx(ae,{value:"membership",children:"Membership"}),e.jsx(ae,{value:"class-packages",children:"Class Packages"}),e.jsx(ae,{value:"merchandise",children:"Merchandise"}),e.jsx(ae,{value:"personal-training",children:"Personal Training"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"Min Amount"}),e.jsx(Ae,{type:"number",placeholder:"₹0",value:b.minAmount||"",onChange:w=>x({...b,minAmount:w.target.value?Number(w.target.value):void 0}),className:"bg-white/80 backdrop-blur-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"Max Amount"}),e.jsx(Ae,{type:"number",placeholder:"₹100,000",value:b.maxAmount||"",onChange:w=>x({...b,maxAmount:w.target.value?Number(w.target.value):void 0}),className:"bg-white/80 backdrop-blur-sm"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-slate-200/50",children:[e.jsx(G,{onClick:C,className:"flex-1 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700",children:"Apply Filters"}),e.jsxs(G,{onClick:y,variant:"outline",className:"gap-2",children:[e.jsx(Ns,{className:"w-4 h-4"}),"Reset"]})]})]})})]}),P>0&&e.jsx($,{className:"pt-0 pb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(i.dateRange.start||i.dateRange.end)&&e.jsxs(z,{variant:"secondary",className:"gap-1",children:["Date: ",i.dateRange.start||"..."," to ",i.dateRange.end||"...",e.jsx(fe,{className:"w-3 h-3 cursor-pointer hover:text-red-500",onClick:()=>R("dateRange","")})]}),i.category?.map(w=>e.jsxs(z,{variant:"secondary",className:"gap-1",children:["Category: ",w,e.jsx(fe,{className:"w-3 h-3 cursor-pointer hover:text-red-500",onClick:()=>R("category",w)})]},w)),i.paymentMethod?.map(w=>e.jsxs(z,{variant:"secondary",className:"gap-1",children:["Payment: ",w,e.jsx(fe,{className:"w-3 h-3 cursor-pointer hover:text-red-500",onClick:()=>R("paymentMethod",w)})]},w)),i.soldBy?.map(w=>e.jsxs(z,{variant:"secondary",className:"gap-1",children:["Sold by: ",w,e.jsx(fe,{className:"w-3 h-3 cursor-pointer hover:text-red-500",onClick:()=>R("soldBy",w)})]},w)),(i.minAmount||i.maxAmount)&&e.jsxs(z,{variant:"secondary",className:"gap-1",children:["Amount: ₹",i.minAmount||0," - ₹",i.maxAmount||"∞",e.jsx(fe,{className:"w-3 h-3 cursor-pointer hover:text-red-500",onClick:()=>T({...i,minAmount:void 0,maxAmount:void 0})})]})]})})]})},vt=({data:i,onRowClick:T})=>{const[j,V]=A.useState("product"),[k,v]=A.useState(!1),[N,o]=A.useState(null),[p,b]=A.useState(!1),x=u=>{const m=i.reduce((n,t)=>{let c="";switch(u){case"product":c=t.cleanedProduct;break;case"category":c=t.cleanedCategory;break;case"member":c=t.customerName;break;case"seller":c=t.soldBy;break}return n[c]||(n[c]={name:c,totalValue:0,unitsSold:0,transactions:0,uniqueMembers:new Set,atv:0,auv:0,asv:0,upt:0}),n[c].totalValue+=t.paymentValue,n[c].unitsSold+=1,n[c].transactions+=1,n[c].uniqueMembers.add(t.memberId),n},{});return Object.values(m).forEach(n=>{const t=n.uniqueMembers.size;n.uniqueMembers=t,n.atv=n.transactions>0?n.totalValue/n.transactions:0,n.auv=n.unitsSold>0?n.totalValue/n.unitsSold:0,n.asv=t>0?n.totalValue/t:0,n.upt=n.transactions>0?n.unitsSold/n.transactions:0}),Object.values(m).sort((n,t)=>t.totalValue-n.totalValue)},C=u=>{switch(u){case"product":return{icon:Te,label:"Products",description:"Individual product performance"};case"category":return{icon:os,label:"Categories",description:"Category-wise performance"};case"member":return{icon:X,label:"Members",description:"Customer spending patterns"};case"seller":return{icon:ss,label:"Associates",description:"Sales representative performance"};default:return{icon:Te,label:"Products",description:"Performance data"}}},y=(u,m,n)=>{const t=C(n);return t.icon,e.jsxs(I,{className:"bg-gradient-to-br from-white via-slate-50/50 to-white border-0 shadow-xl hover:shadow-2xl transition-all duration-500",children:[e.jsx(K,{className:"pb-4",children:e.jsx(W,{className:"flex items-center gap-3 text-xl",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500",children:e.jsx(He,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsxs("span",{className:"bg-gradient-to-r from-yellow-600 to-orange-600 bg-clip-text text-transparent",children:["Top ",D," ",t.label]}),e.jsx("p",{className:"text-sm text-slate-600 font-normal",children:t.description})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-r from-red-400 to-rose-500",children:e.jsx(Le,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsxs("span",{className:"bg-gradient-to-r from-red-600 to-rose-600 bg-clip-text text-transparent",children:["Bottom ",D," ",t.label]}),e.jsx("p",{className:"text-sm text-slate-600 font-normal",children:"Areas for improvement"})]})]})})}),e.jsxs($,{className:"space-y-4",children:[u.map((c,d)=>e.jsxs("div",{className:"group flex items-center justify-between p-4 rounded-xl bg-white shadow-sm border hover:shadow-md transition-all duration-300 cursor-pointer",onClick:()=>{const a=i.filter(l=>{switch(n){case"product":return l.cleanedProduct===c.name;case"category":return l.cleanedCategory===c.name;case"member":return l.customerName===c.name;case"seller":return l.soldBy===c.name;default:return!1}});T?.({...c,rawData:a,filteredTransactionData:a,type:n,title:c.name,name:c.name,grossRevenue:c.totalValue,totalRevenue:c.totalValue,totalValue:c.totalValue,totalCurrent:c.totalValue,metricValue:c.totalValue,transactions:c.transactions,totalTransactions:c.transactions,uniqueMembers:c.uniqueMembers,totalCustomers:c.uniqueMembers,totalChange:12.5,months:{},monthlyValues:{},isDynamic:!0,calculatedFromFiltered:!0})},children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:te("w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold shadow-sm",m?"bg-gradient-to-r from-green-400 to-emerald-600 text-white":"bg-gradient-to-r from-red-400 to-rose-600 text-white"),children:d+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-slate-900 whitespace-normal break-words group-hover:text-blue-600 transition-colors",children:c.name}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsxs(z,{variant:"secondary",className:"text-xs bg-blue-50 text-blue-700 border-blue-200",children:[M(c.transactions)," txns"]}),e.jsxs(z,{variant:"outline",className:"text-xs border-purple-200 text-purple-700",children:["ATV: ",_(c.atv)]}),e.jsxs(z,{variant:"outline",className:"text-xs border-green-200 text-green-700",children:["AUV: ",_(c.auv)]}),e.jsxs(z,{variant:"outline",className:"text-xs border-orange-200 text-orange-700",children:["ASV: ",_(c.asv)]}),e.jsxs(z,{variant:"outline",className:"text-xs border-slate-200 text-slate-700",children:["UPT: ",c.upt.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-xl text-slate-900 group-hover:text-blue-600 transition-colors",children:_(c.totalValue)}),e.jsxs("p",{className:"text-sm text-slate-500",children:[M(c.unitsSold)," units"]}),e.jsxs("p",{className:"text-xs text-slate-400",children:[M(c.uniqueMembers)," customers"]}),e.jsxs(G,{variant:"ghost",size:"sm",className:"mt-1 opacity-0 group-hover:opacity-100 transition-all duration-300 hover:bg-blue-50 hover:text-blue-600 hover:shadow-sm",onClick:a=>{a.stopPropagation();const l=i.filter(h=>{switch(n){case"product":return h.cleanedProduct===c.name;case"category":return h.cleanedCategory===c.name;case"member":return h.customerName===c.name;case"seller":return h.soldBy===c.name;default:return!1}}),r={...c,rawData:l,filteredTransactionData:l,type:n,title:c.name,name:c.name,grossRevenue:c.totalValue,totalValue:c.totalValue,totalCurrent:c.totalValue,metricValue:c.totalValue,transactions:c.transactions,totalTransactions:c.transactions,uniqueMembers:c.uniqueMembers,totalCustomers:c.uniqueMembers,totalChange:0,months:{},monthlyValues:{}};o(r),b(!0)},children:[e.jsx(ys,{className:"w-3 h-3 mr-1"}),"View Analytics"]})]})]},c.name)),e.jsxs("div",{className:"mt-6 p-4 bg-gradient-to-r from-slate-50 to-slate-100 rounded-lg border",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h4",{className:"font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Performance Summary"]}),e.jsxs(G,{variant:"outline",size:"sm",onClick:()=>v(!k),className:"text-xs",children:["Show ",k?"Less":"More"]})]}),e.jsxs("ul",{className:"text-sm text-slate-600 space-y-1",children:[e.jsxs("li",{children:["• Average revenue: ",_(u.reduce((c,d)=>c+d.totalValue,0)/u.length)]}),e.jsxs("li",{children:["• Total transactions: ",M(u.reduce((c,d)=>c+d.transactions,0))]}),e.jsxs("li",{children:["• Combined customer reach: ",M(u.reduce((c,d)=>c+d.uniqueMembers,0))," unique customers"]}),e.jsxs("li",{children:["• Performance spread: ",((u[0]?.totalValue/u[u.length-1]?.totalValue||1)-1).toFixed(1),"x variance"]})]})]})]})]})},R=x(j),D=k?10:5,P=R.slice(0,D),w=R.slice(-D).reverse();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(I,{className:"bg-gradient-to-br from-white via-slate-50/20 to-white border-0 shadow-xl",children:[e.jsx(K,{className:"pb-4",children:e.jsx(W,{className:"text-2xl font-bold bg-gradient-to-r from-slate-700 via-slate-800 to-slate-900 bg-clip-text text-transparent",children:"Performance Analysis"})}),e.jsx($,{children:e.jsxs(Re,{value:j,onValueChange:V,className:"w-full",children:[e.jsxs(ze,{className:"grid w-full grid-cols-4 bg-gradient-to-r from-blue-50 via-purple-50 to-blue-50 p-2 rounded-2xl shadow-lg border border-slate-200/30",children:[e.jsxs(H,{value:"product",className:"text-sm font-bold transition-all duration-300 data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-purple-600 data-[state=active]:text-white data-[state=active]:shadow-lg rounded-xl",children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"Products"]}),e.jsxs(H,{value:"category",className:"text-sm font-bold transition-all duration-300 data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-purple-600 data-[state=active]:text-white data-[state=active]:shadow-lg rounded-xl",children:[e.jsx(os,{className:"w-4 h-4 mr-2"}),"Categories"]}),e.jsxs(H,{value:"member",className:"text-sm font-bold transition-all duration-300 data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-purple-600 data-[state=active]:text-white data-[state=active]:shadow-lg rounded-xl",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Members"]}),e.jsxs(H,{value:"seller",className:"text-sm font-bold transition-all duration-300 data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-purple-600 data-[state=active]:text-white data-[state=active]:shadow-lg rounded-xl",children:[e.jsx(ss,{className:"w-4 h-4 mr-2"}),"Associates"]})]}),e.jsx(se,{value:j,className:"mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[y(P,!0,j),y(w,!1,j)]})})]})})]}),e.jsx(st,{isOpen:p,onClose:()=>b(!1),data:N})]})},Ze=({value:i,onValueChange:T,className:j=""})=>e.jsx(Re,{value:i,onValueChange:T,className:j,children:e.jsxs(ze,{className:"grid w-full grid-cols-3 lg:grid-cols-11 bg-white border border-gray-200 p-1 rounded-xl shadow-sm h-auto gap-1",children:[e.jsx(H,{value:"revenue",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"Revenue"}),e.jsx(H,{value:"units",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"Units Sold"}),e.jsx(H,{value:"transactions",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"Transactions"}),e.jsx(H,{value:"members",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"Members"}),e.jsx(H,{value:"auv",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"AUV"}),e.jsx(H,{value:"atv",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"ATV"}),e.jsx(H,{value:"asv",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"ASV"}),e.jsx(H,{value:"upt",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"UPT"}),e.jsx(H,{value:"vat",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"VAT"}),e.jsx(H,{value:"discountValue",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"Discount ₹"}),e.jsx(H,{value:"discountPercentage",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"Discount %"})]})}),rt=i=>i.reduce((T,j)=>{const V=j.cleanedCategory||"Uncategorized",k=j.cleanedProduct||"Unspecified";return T[V]||(T[V]={}),T[V][k]||(T[V][k]=[]),T[V][k].push(j),T},{}),Nt=({data:i,filters:T={dateRange:{start:"",end:""},location:[],category:[],product:[],soldBy:[],paymentMethod:[]},onRowClick:j,collapsedGroups:V=new Set,onGroupToggle:k=()=>{},selectedMetric:v="revenue"})=>{const[N,o]=A.useState(v),[p,b]=A.useState(!1),[x,C]=A.useState(new Set),[y,R]=A.useState(!1),D=a=>{if(!a)return null;const l=a.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(l){const[,h,s,g]=l;return new Date(parseInt(g),parseInt(s)-1,parseInt(h))}const r=new Date(a);return isNaN(r.getTime())?null:r},P=(a,l)=>{if(!a.length)return 0;const r=a.reduce((F,O)=>F+(O.paymentValue||0),0),h=a.length,s=new Set(a.map(F=>F.memberId)).size,g=a.length,f=a.reduce((F,O)=>F+(O.discountAmount||0),0),S=a.length>0?a.reduce((F,O)=>F+(O.discountPercentage||0),0)/a.length:0;switch(l){case"revenue":return r;case"transactions":return h;case"members":return s;case"units":return g;case"atv":return h>0?r/h:0;case"auv":return s>0?r/s:0;case"asv":return new Set(a.map(L=>L.saleItemId)).size>0?r/new Set(a.map(L=>L.saleItemId)).size:0;case"upt":const F=a.length,O=new Set(a.map(L=>L.paymentTransactionId)).size;return O>0?F/O:0;case"vat":return a.reduce((L,Y)=>L+(Y.paymentVAT||0),0);case"netRevenue":const E=r,q=a.reduce((L,Y)=>L+(Y.paymentVAT||0),0);return E-q;case"discountValue":return f;case"discountPercentage":return S;default:return 0}},w=(a,l)=>{switch(l){case"revenue":case"auv":case"asv":case"atv":case"vat":case"netRevenue":case"discountValue":return _(a);case"transactions":case"members":case"units":return M(a);case"upt":return a.toFixed(2);case"discountPercentage":return`${a.toFixed(1)}%`;default:return M(a)}},u=(a,l)=>l===0&&a===0?null:l===0?"+100":((a-l)/l*100).toFixed(1),m=A.useMemo(()=>Array.isArray(i)?i.filter(a=>!(T?.location?.length>0&&!T.location.includes(a.calculatedLocation)||T?.category?.length>0&&!T.category.includes(a.cleanedCategory)||T?.product?.length>0&&!T.product.includes(a.cleanedProduct)||T?.soldBy?.length>0&&!T.soldBy.includes(a.soldBy)||T?.paymentMethod?.length>0&&!T.paymentMethod.includes(a.paymentMethod)||T?.minAmount!==void 0&&a.paymentValue<T.minAmount||T?.maxAmount!==void 0&&a.paymentValue>T.maxAmount)):[],[i,T]),n=A.useMemo(()=>{const a=[],l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];for(let r=7;r>=0;r--){const h=l[r],s=r+1;a.push({key:`2024-${String(s).padStart(2,"0")}`,display:`${h} 2024`,year:2024,month:s,sortOrder:(5-r)*2}),a.push({key:`2025-${String(s).padStart(2,"0")}`,display:`${h} 2025`,year:2025,month:s,sortOrder:(5-r)*2+1})}return a},[]),t=A.useMemo(()=>{const a=rt(m),l=Object.entries(a).map(([r,h])=>{const s={category:r,products:Object.entries(h).map(([f,S])=>{const F={};n.forEach(({key:q,year:L,month:Y})=>{const Z=S.filter(ee=>{const Q=D(ee.paymentDate);return Q&&Q.getFullYear()===L&&Q.getMonth()+1===Y});F[q]=P(Z,N)});const O=Object.values(F).filter(q=>q>0),E={atv:O.length>0?O.reduce((q,L)=>q+L,0)/O.length:0,auv:O.length>0?O.reduce((q,L)=>q+L,0)/O.length:0,asv:O.length>0?O.reduce((q,L)=>q+L,0)/O.length:0,upt:O.length>0?O.reduce((q,L)=>q+L,0)/O.length:0};return{product:f,monthlyValues:F,rawData:S,averages:E}})},g={};return n.forEach(({key:f})=>{g[f]=s.products.reduce((S,F)=>S+(F.monthlyValues[f]||0),0)}),{...s,monthlyValues:g}});return!y&&l.length>0&&(C(new Set),R(!0)),l},[m,N,n,y]),c=A.useCallback(()=>{window.location.reload()},[]);A.useCallback(()=>{const a=t.map(s=>{const g=[s.category,...n.map(({key:S})=>w(s.monthlyValues[S]||0,N))].join(","),f=s.products.map(S=>[`  ${S.product}`,...n.map(({key:F})=>w(S.monthlyValues[F]||0,N))].join(","));return[g,...f].join(`
`)}).join(`
`),l=new Blob([a],{type:"text/csv"}),r=window.URL.createObjectURL(l),h=document.createElement("a");h.href=r,h.download=`year-on-year-${N}-data.csv`,h.click()},[t,n,N]),A.useCallback(a=>{},[]);const d=A.useCallback(a=>{const l=new Set(x);l.has(a)?l.delete(a):l.add(a),C(l)},[x]);return e.jsxs(I,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(W,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-blue-600"}),"Year-on-Year Performance Analysis"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Monthly comparison between 2024 and 2025 with alternating year display"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(G,{variant:"outline",size:"sm",onClick:c,className:"flex items-center gap-2 hover:bg-purple-50 hover:text-purple-700",children:[e.jsx(Ns,{className:"w-4 h-4"}),"Refresh"]})})]}),e.jsx(Ze,{value:N,onValueChange:o,className:"w-full"})]})}),e.jsx($,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border-t border-gray-200 rounded-lg",children:[e.jsx("thead",{className:"bg-gradient-to-r from-purple-700 to-purple-900 text-white font-semibold text-sm uppercase tracking-wider sticky top-0 z-30",children:e.jsxs("tr",{className:"bg-gradient-to-r from-blue-800 to-indigo-900 text-white font-semibold text-sm uppercase tracking-wider",children:[e.jsx("th",{className:"bg-gradient-to-r from-blue-800 to-blue-800 text-white font-semibold text-sm uppercase tracking-wider px-4 py-2 sticky left-0 z-40",children:"Product/Category"}),n.map(({key:a,display:l,year:r})=>e.jsx("th",{className:"text-white font-semibold text-sm uppercase tracking-wider px-4 py-2",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-base",children:l.split(" ")[0]}),e.jsx("span",{className:"text-yellow-200 text-xs",children:l.split(" ")[1]})]})},a))]})}),e.jsxs("tbody",{children:[t.map(a=>e.jsxs(Ve.Fragment,{children:[e.jsxs("tr",{onClick:()=>d(a.category),className:"bg-white hover:bg-gray-100 cursor-pointer border-b border-gray-200 group transition-colors duration-200 ease-in-out",children:[e.jsx("td",{className:"py-2 font-semibold text-gray-800 group-hover:text-gray-900 bg-white group-hover:bg-gray-100 sticky left-0 z-20 transition-colors duration-200 ease-in-out px-[10px] min-w-80 text-sm max-h-[35px] h-[35px] overflow-hidden",children:e.jsxs("div",{className:"flex justify-between items-center min-w-full text-md text-bold",children:[x.has(a.category)?e.jsx(ns,{className:"w-4 h-4 mr-2 text-gray-500 transition-transform duration-200"}):e.jsx(Ye,{className:"w-4 h-4 mr-2 text-gray-500 transition-transform duration-200"}),a.category,e.jsxs(z,{variant:"secondary",className:"ml-auto text-sm text-yellow-300 min-w-12 bg-slate-950 rounded-xl",children:[a.products.length," products"]})]})}),n.map(({key:l,year:r,month:h,display:s},g)=>{const f=a.monthlyValues[l]||0,S=g>0&&a.monthlyValues[n[g-1].key]||0,F=u(f,S);return e.jsx("td",{className:"px-4 py-2 text-center font-semibold text-gray-900 text-sm hover:bg-blue-100 cursor-pointer transition-colors max-h-[35px] h-[35px] overflow-hidden",title:F?`${F}% vs last year`:"",onClick:O=>{O.stopPropagation();const E=i.filter(ee=>{const Q=D(ee.paymentDate);if(!Q)return!1;const oe=ee.cleanedCategory===a.category,ue=Q.getFullYear()===r&&Q.getMonth()+1===h;return oe&&ue}),q=E.reduce((ee,Q)=>ee+(Q.paymentValue||0),0),L=E.length,Y=new Set(E.map(ee=>ee.memberId||ee.customerEmail)).size,Z={name:`${a.category} - ${s}`,category:a.category,totalRevenue:q,grossRevenue:q,netRevenue:q,totalValue:q,totalCurrent:q,metricValue:q,transactions:L,totalTransactions:L,uniqueMembers:Y,totalCustomers:Y,rawData:E,filteredTransactionData:E,isDynamic:!0,calculatedFromFiltered:!0,isGroupCell:!0,cellSpecific:!0,month:s,monthKey:l};j&&j(Z)},children:w(a.monthlyValues[l]||0,N)},l)})]}),!x.has(a.category)&&a.products.map(l=>e.jsxs("tr",{className:"hover:bg-blue-50 cursor-pointer border-b border-gray-100 transition-colors duration-200",onClick:()=>j&&j(l.rawData),children:[e.jsx("td",{className:"px-8 py-3 text-sm text-gray-700 hover:text-blue-700 sticky left-0 bg-white hover:bg-blue-50 z-10 transition-colors duration-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:l.product}),["atv","auv","asv","upt"].includes(N)&&e.jsxs(z,{variant:"outline",className:"text-xs ml-2 border-blue-200 text-blue-700",children:["Avg: ",w(l.averages[N]||0,N)]})]})}),n.map(({key:r,year:h,month:s,display:g})=>e.jsx("td",{className:"px-4 py-3 text-center text-sm text-gray-900 font-mono hover:bg-blue-50 cursor-pointer transition-colors",onClick:f=>{f.stopPropagation();const S=(Array.isArray(l.rawData)?l.rawData:[]).filter(L=>{const Y=D(L.paymentDate);return Y?Y.getFullYear()===h&&Y.getMonth()+1===s:!1}),F=S.reduce((L,Y)=>L+(Y.paymentValue||0),0),O=S.length,E=new Set(S.map(L=>L.memberId||L.customerEmail)).size,q={...l,name:`${l.product} - ${g}`,totalRevenue:F,grossRevenue:F,netRevenue:F,totalValue:F,totalCurrent:F,metricValue:F,transactions:O,totalTransactions:O,uniqueMembers:E,totalCustomers:E,rawData:S,filteredTransactionData:S,isDynamic:!0,calculatedFromFiltered:!0,cellSpecific:!0,month:g,monthKey:r};j&&j(q)},children:w(l.monthlyValues[r]||0,N)},r))]},`${a.category}-${l.product}`)),e.jsxs("tr",{className:"bg-gradient-to-r from-blue-100 to-indigo-100 border-t-2 border-blue-300 font-bold",children:[e.jsxs("td",{className:"px-8 py-3 text-sm font-bold text-blue-900 sticky left-0 bg-gradient-to-r from-blue-100 to-indigo-100 z-10",children:[a.category," TOTAL"]}),n.map(({key:l})=>e.jsx("td",{className:"px-4 py-3 text-center text-sm text-blue-900 font-mono font-bold",children:w(a.monthlyValues[l]||0,N)},l))]})]},a.category)),e.jsxs("tr",{className:"bg-gradient-to-r from-emerald-500 via-teal-600 to-emerald-500 text-white border-t-4 border-emerald-700",children:[e.jsx("td",{className:"px-8 py-3 text-sm font-bold sticky left-0 bg-gradient-to-r from-emerald-500 to-teal-600 z-10",children:"GRAND TOTAL"}),n.map(({key:a})=>{const l=t.reduce((r,h)=>r+(h.monthlyValues[a]||0),0);return e.jsx("td",{className:"px-4 py-3 text-center text-sm font-mono font-bold",children:w(l,N)},a)})]})]})]})})})]})},yt=({data:i,filters:T={dateRange:{start:"",end:""},location:[],category:[],product:[],soldBy:[],paymentMethod:[]},onRowClick:j,collapsedGroups:V,onGroupToggle:k,selectedMetric:v="revenue"})=>{const[N,o]=A.useState(v),[p,b]=A.useState(!1),[x,C]=A.useState(`• Month-on-month analysis shows seasonal patterns
• Strong performance in peak months with growth opportunities identified
• Consistent upward trend in key metrics`),[y,R]=A.useState(new Set);Ve.useEffect(()=>{R(new Set)},[]);const D=h=>{if(!h)return null;const s=h.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(s){const[,f,S,F]=s;return new Date(parseInt(F),parseInt(S)-1,parseInt(f))}const g=new Date(h);return isNaN(g.getTime())?null:g},P=(h,s)=>{if(!h.length)return 0;const g=h.reduce((q,L)=>q+(L.paymentValue||0),0),f=h.length,S=new Set(h.map(q=>q.memberId)).size,F=h.length,O=h.reduce((q,L)=>q+(L.discountAmount||0),0),E=h.length>0?h.reduce((q,L)=>q+(L.discountPercentage||0),0)/h.length:0;switch(s){case"revenue":return g;case"transactions":return f;case"members":return S;case"units":return F;case"atv":return f>0?g/f:0;case"auv":return F>0?g/F:0;case"asv":return S>0?g/S:0;case"upt":return f>0?F/f:0;case"vat":return h.reduce((q,L)=>q+(L.paymentVAT||0),0);case"discountValue":return O;case"discountPercentage":return E;default:return 0}},w=(h,s)=>{switch(s){case"revenue":case"auv":case"atv":case"asv":case"vat":return _(h);case"transactions":case"members":case"units":return M(h);case"upt":return h.toFixed(2);default:return M(h)}};A.useCallback((h,s)=>{},[]);const u=A.useMemo(()=>{const h=[],s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],g=new Date,f=g.getFullYear(),S=g.getMonth();for(let F=17;F>=0;F--){const O=new Date(f,S-F,1),E=O.getFullYear(),q=O.getMonth(),L=s[q],Y=q+1;h.push({key:`${E}-${String(Y).padStart(2,"0")}`,display:`${L} ${E}`,year:E,month:Y,quarter:Math.ceil(Y/3)})}return h},[]),m=A.useMemo(()=>{const h=i.reduce((g,f)=>{const S=f.cleanedCategory||"Uncategorized";return g[S]||(g[S]=[]),g[S].push(f),g},{});return Object.entries(h).map(([g,f])=>{const S=f.reduce((E,q)=>{const L=q.cleanedProduct||"Unspecified";return E[L]||(E[L]=[]),E[L].push(q),E},{}),F=Object.entries(S).map(([E,q])=>{const L={};u.forEach(({key:Z,year:ee,month:Q})=>{const oe=q.filter(ue=>{const le=D(ue.paymentDate);return le&&le.getFullYear()===ee&&le.getMonth()+1===Q});L[Z]=P(oe,N)});const Y=P(q,N);return{product:E,category:g,metricValue:Y,monthlyValues:L,rawData:q}}),O={};return u.forEach(({key:E})=>{O[E]=F.reduce((q,L)=>q+(L.monthlyValues[E]||0),0)}),{category:g,products:F.sort((E,q)=>q.metricValue-E.metricValue),metricValue:P(f,N),monthlyValues:O,rawData:f}}).sort((g,f)=>f.metricValue-g.metricValue)},[i,N,u]),n=(h,s)=>s===0&&h===0?null:s===0?"+100":((h-s)/s*100).toFixed(1),t=A.useMemo(()=>{const h={};return u.forEach(({key:s})=>{h[s]=m.reduce((g,f)=>g+(f.monthlyValues[s]||0),0)}),{category:"TOTAL",metricValue:P(i,N),monthlyValues:h}},[m,u,i,N]),c=()=>{b(!1),localStorage.setItem("monthOnMonthSummary",x)},d=()=>{b(!1);const h=localStorage.getItem("monthOnMonthSummary");h&&C(h)},a=A.useMemo(()=>{const h={};return u.forEach(s=>{const g=`${s.year}-Q${s.quarter}`;h[g]||(h[g]=[]),h[g].push(s)}),h},[u]),l=h=>{const s=new Set(y);s.has(h)?s.delete(h):s.add(h),R(s)},r=h=>{const s=h.rawData||[],g=s.reduce((O,E)=>O+(E.paymentValue||0),0),f=s.length,S=new Set(s.map(O=>O.memberId||O.customerEmail)).size,F={...h,title:h.product,name:h.product,type:"product",totalRevenue:g,grossRevenue:g,netRevenue:g,totalValue:g,totalCurrent:g,metricValue:g,transactions:f,totalTransactions:f,uniqueMembers:S,totalCustomers:S,months:h.monthlyValues,monthlyValues:h.monthlyValues,rawData:s,filteredTransactionData:s,isDynamic:!0,calculatedFromFiltered:!0};j(F)};return e.jsxs(I,{className:"bg-gradient-to-br from-blue-50 via-blue-100 to-blue-200 border-0 shadow-2xl rounded-2xl",children:[e.jsx(K,{className:"pb-4 bg-gradient-to-r from-blue-700 to-blue-900 rounded-t-2xl shadow-md",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsxs(W,{className:"font-bold flex items-center gap-2 text-white text-2xl",children:[e.jsx(ne,{className:"w-5 h-5 text-blue-600 bg-yellow-300"}),"Product Month-on-Month Analysis"]}),e.jsx("p",{className:"mt-1 font-semibold text-left text-sm text-amber-300",children:"Monthly performance metrics by product (Last 18 months from current date)"})]})}),e.jsx(Ze,{value:N,onValueChange:o,className:"w-full"})]})}),e.jsxs($,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto rounded-b-2xl",children:e.jsxs("table",{className:"min-w-full bg-white border-t border-blue-200 rounded-b-2xl shadow-md",children:[e.jsxs("thead",{className:"bg-gradient-to-r from-blue-700 to-blue-900 text-white font-semibold text-sm uppercase tracking-wider sticky top-0 z-30",children:[e.jsxs("tr",{className:"bg-gradient-to-r from-blue-700 to-blue-900 text-white font-semibold text-sm uppercase tracking-wider",children:[e.jsx("th",{rowSpan:2,className:"text-white font-semibold uppercase tracking-wider px-6 py-3 text-left rounded-tl-lg sticky left-0 bg-blue-800 z-40 max-h-[35px] h-[35px]",children:"Category / Product"}),Object.entries(a).map(([h,s])=>e.jsx("th",{colSpan:s.length,className:"text-white font-semibold text-sm uppercase tracking-wider px-4 py-2 text-center border-l border-blue-600",children:h},h))]}),e.jsx("tr",{children:u.map(({key:h,display:s})=>e.jsx("th",{className:"text-white font-semibold text-xs uppercase tracking-wider px-3 py-2 bg-blue-800 border-l border-blue-600 max-h-[35px] h-[35px]",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm",children:s.split(" ")[0]}),e.jsx("span",{className:"text-blue-200 text-xs",children:s.split(" ")[1]})]})},h))})]}),e.jsxs("tbody",{children:[m.map((h,s)=>e.jsxs(Ve.Fragment,{children:[e.jsxs("tr",{className:"bg-gradient-to-r from-gray-100 to-gray-200 border-b-2 border-gray-300 font-bold max-h-[35px] h-[35px]",children:[e.jsx("td",{className:"text-sm font-bold text-gray-800 sticky left-0 bg-gradient-to-r from-gray-100 to-gray-200 border-r border-gray-300 z-20 hover:bg-blue-100 cursor-pointer transition-colors max-h-[35px] h-[35px] overflow-hidden",onClick:g=>{if(g.target.closest("button"))return;const S=i.filter(L=>L.cleanedCategory===S.category),F=S.reduce((L,Y)=>L+(Y.paymentValue||0),0),O=S.length,E=new Set(S.map(L=>L.memberId||L.customerEmail)).size,q={name:`${S.category} - All Months`,category:S.category,totalRevenue:F,grossRevenue:F,netRevenue:F,totalValue:F,totalCurrent:F,metricValue:F,transactions:O,totalTransactions:O,uniqueMembers:E,totalCustomers:E,rawData:S,filteredTransactionData:S,isDynamic:!0,calculatedFromFiltered:!0,isGroup:!0};j(q)},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(G,{variant:"ghost",size:"sm",onClick:()=>l(h.category),className:"p-1 h-6 w-6 text-gray-600 hover:text-gray-800",children:y.has(h.category)?e.jsx(ns,{className:"w-4 h-4"}):e.jsx(Ye,{className:"w-4 h-4"})}),e.jsxs("span",{className:"font-bold",children:["#",s+1," ",h.category]}),e.jsxs(z,{variant:"outline",className:"text-xs bg-gray-900 rounded-md text-yellow-300",children:[h.products.length," products"]})]})}),u.map(({key:g,year:f,month:S,display:F},O)=>{const E=h.monthlyValues[g]||0,q=O>0&&h.monthlyValues[u[O-1].key]||0,L=n(E,q);return e.jsx("td",{className:"px-3 py-3 text-center text-sm text-gray-800 font-mono font-bold border-l border-gray-300 hover:bg-blue-100 cursor-pointer transition-colors max-h-[35px] h-[35px]",title:L?`${L}% vs last month`:"",onClick:Y=>{Y.stopPropagation();const Z=i.filter(le=>{const ie=D(le.paymentDate);if(!ie)return!1;const ce=le.cleanedCategory===h.category,me=ie.getFullYear()===f&&ie.getMonth()+1===S;return ce&&me}),ee=Z.reduce((le,ie)=>le+(ie.paymentValue||0),0),Q=Z.length,oe=new Set(Z.map(le=>le.memberId||le.customerEmail)).size,ue={name:`${h.category} - ${F}`,category:h.category,totalRevenue:ee,grossRevenue:ee,netRevenue:ee,totalValue:ee,totalCurrent:ee,metricValue:ee,transactions:Q,totalTransactions:Q,uniqueMembers:oe,totalCustomers:oe,rawData:Z,filteredTransactionData:Z,isDynamic:!0,calculatedFromFiltered:!0,isGroupCell:!0,cellSpecific:!0,month:F,monthKey:g};j(ue)},children:e.jsx("div",{className:"flex items-center justify-center",children:w(E,N)})},g)})]}),!y.has(h.category)&&h.products.map((g,f)=>e.jsxs("tr",{onClick:()=>r(g),className:"hover:bg-gray-100/60 cursor-pointer border-b border-gray-100 transition-colors duration-200 group",children:[e.jsx("td",{className:"px-2 py-2 text-sm font-medium text-gray-900 sticky left-0 bg-white border-r border-gray-200 min-w-96 z-10 max-h-[35px] h-[35px] overflow-hidden",children:e.jsxs("div",{className:"flex items-center gap-2 pl-8",children:[e.jsxs("span",{className:"text-gray-500",children:["#",f+1]}),e.jsx("span",{className:"whitespace-normal break-words font-semibold group-hover:text-blue-700 transition-all duration-150",children:g.product})]})}),u.map(({key:S,year:F,month:O,display:E},q)=>{const L=g.monthlyValues[S]||0,Y=q>0&&g.monthlyValues[u[q-1].key]||0,Z=n(L,Y);return e.jsx("td",{className:"px-3 py-3 text-center text-sm text-gray-900 font-mono border-l border-gray-100 hover:bg-blue-50 cursor-pointer transition-colors max-h-[35px] h-[35px] overflow-hidden",title:Z?`${Z}% vs last month`:"",onClick:ee=>{ee.stopPropagation();const Q=(g.rawData||[]).filter(ce=>{const me=D(ce.paymentDate);return me?me.getFullYear()===F&&me.getMonth()+1===O:!1}),oe=Q.reduce((ce,me)=>ce+(me.paymentValue||0),0),ue=Q.length,le=new Set(Q.map(ce=>ce.memberId||ce.customerEmail)).size,ie={...g,name:`${g.product} - ${E}`,totalRevenue:oe,grossRevenue:oe,netRevenue:oe,totalValue:oe,totalCurrent:oe,metricValue:oe,transactions:ue,totalTransactions:ue,uniqueMembers:le,totalCustomers:le,rawData:Q,filteredTransactionData:Q,isDynamic:!0,calculatedFromFiltered:!0,cellSpecific:!0,month:E,monthKey:S};j&&j(ie)},children:e.jsx("div",{className:"flex items-center justify-center",children:w(L,N)})},S)})]},`${h.category}-${g.product}`))]},h.category)),e.jsxs("tr",{className:"bg-gradient-to-r from-blue-200 to-blue-300 border-t-4 border-gray-800 font-bold",children:[e.jsx("td",{className:"px-6 py-3 text-sm font-bold text-blue-900 sticky left-0 border-r border-blue-300 z-20 bg-slate-50 hover:bg-blue-100 cursor-pointer transition-colors",onClick:()=>{const h=i.reduce((S,F)=>S+(F.paymentValue||0),0),s=i.length,g=new Set(i.map(S=>S.memberId||S.customerEmail)).size;j({name:"All Products & Categories - Total",totalRevenue:h,grossRevenue:h,netRevenue:h,totalValue:h,totalCurrent:h,metricValue:h,transactions:s,totalTransactions:s,uniqueMembers:g,totalCustomers:g,rawData:i,filteredTransactionData:i,isDynamic:!0,calculatedFromFiltered:!0,isTotal:!0})},children:"TOTAL"}),u.map(({key:h,year:s,month:g,display:f})=>e.jsx("td",{className:"px-3 py-3 text-center text-sm text-blue-900 font-mono font-bold border-l border-gray-200 bg-white hover:bg-blue-100 cursor-pointer transition-colors",onClick:()=>{const S=i.filter(L=>{const Y=D(L.paymentDate);return Y?Y.getFullYear()===s&&Y.getMonth()+1===g:!1}),F=S.reduce((L,Y)=>L+(Y.paymentValue||0),0),O=S.length,E=new Set(S.map(L=>L.memberId||L.customerEmail)).size,q={name:`All Products & Categories - ${f}`,totalRevenue:F,grossRevenue:F,netRevenue:F,totalValue:F,totalCurrent:F,metricValue:F,transactions:O,totalTransactions:O,uniqueMembers:E,totalCustomers:E,rawData:S,filteredTransactionData:S,isDynamic:!0,calculatedFromFiltered:!0,isTotal:!0,cellSpecific:!0,month:f,monthKey:h};j(q)},children:w(t.monthlyValues[h]||0,N)},h))]})]})]})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 bg-gradient-to-r from-slate-50 to-white rounded-b-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-blue-600"}),"Product Month-on-Month Insights"]}),p?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(G,{variant:"outline",size:"sm",onClick:c,className:"gap-2 text-green-600",children:[e.jsx(ls,{className:"w-4 h-4"}),"Save"]}),e.jsxs(G,{variant:"outline",size:"sm",onClick:d,className:"gap-2 text-red-600",children:[e.jsx(fe,{className:"w-4 h-4"}),"Cancel"]})]}):e.jsxs(G,{variant:"outline",size:"sm",onClick:()=>b(!0),className:"gap-2",children:[e.jsx(rs,{className:"w-4 h-4"}),"Edit"]})]}),p?e.jsx(is,{value:x,onChange:h=>C(h.target.value),placeholder:"Enter month-on-month insights using bullet points (• )",className:"min-h-32 text-sm"}):e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:e.jsx("div",{className:"text-sm text-gray-700 whitespace-pre-line",children:x})})]})]})]})},wt=({data:i,onRowClick:T,selectedMetric:j="revenue"})=>{const[V,k]=A.useState(j),[v,N]=A.useState(!1),[o,p]=A.useState(`• Sales team performance analysis by individual seller
• Consistent performers identified for recognition
• Training opportunities highlighted for underperformers`),b=A.useMemo(()=>{const m=[],n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t=new Date,c=t.getFullYear(),d=t.getMonth();for(let a=17;a>=0;a--){const l=new Date(c,d-a,1),r=l.getFullYear(),h=l.getMonth()+1,s=n[l.getMonth()];m.push({key:`${r}-${String(h).padStart(2,"0")}`,display:`${s} ${r}`,year:r,month:h,quarter:Math.ceil(h/3)})}return m},[]),x=(m,n)=>{if(!m.length)return 0;const t=m.reduce((h,s)=>h+(s.paymentValue||0),0),c=m.length,d=new Set(m.map(h=>h.memberId)).size,a=m.length,l=m.reduce((h,s)=>h+(s.discountAmount||0),0),r=m.length>0?m.reduce((h,s)=>h+(s.discountPercentage||0),0)/m.length:0;switch(n){case"revenue":return t;case"transactions":return c;case"members":return d;case"units":return a;case"atv":return c>0?t/c:0;case"auv":return a>0?t/a:0;case"asv":return d>0?t/d:0;case"upt":return c>0?a/c:0;case"discountValue":return l;case"discountPercentage":return r;default:return 0}},C=(m,n)=>{switch(n){case"revenue":case"discountValue":return _(m);case"atv":case"auv":case"asv":return _(Math.round(m));case"transactions":case"members":case"units":return M(m);case"upt":return m.toFixed(1);case"discountPercentage":return`${m.toFixed(1)}%`;default:return M(m)}},y=A.useMemo(()=>{const m=i.reduce((t,c)=>{const d=c.soldBy||"Unknown";return t[d]||(t[d]=[]),t[d].push(c),t},{});return Object.entries(m).map(([t,c])=>{const d={};b.forEach(({key:O,year:E,month:q})=>{const L=c.filter(Y=>{const Z=et(Y.paymentDate);return Z?Z.getFullYear()===E&&Z.getMonth()+1===q:!1});d[O]=x(L,V)});const a=x(c,V),l=c.reduce((O,E)=>O+(E.paymentValue||0),0),r=c.length,h=new Set(c.map(O=>O.memberId)).size,s=c.length,g=h>0?l/h:0,f=r>0?s/r:0,S=r>0?l/r:0,F=s>0?l/s:0;return{soldBy:t,metricValue:a,totalRevenue:l,totalTransactions:r,uniqueMembers:h,units:s,asv:g,upt:f,atv:S,auv:F,monthlyValues:d,rawData:c,name:t,grossRevenue:l,netRevenue:l,totalValue:l,totalCurrent:l,totalCustomers:h,totalChange:b.length>=2?((d[b[b.length-1].key]||0)-(d[b[b.length-2].key]||0))/(d[b[b.length-2].key]||1)*100:0,months:b.reduce((O,{key:E,display:q})=>(O[q]={current:d[E]||0,change:0},O),{})}}).sort((t,c)=>c.metricValue-t.metricValue)},[i,V,b]),R=(m,n)=>{if(n===0&&m===0)return null;if(n===0)return e.jsx(xe,{className:"w-3 h-3 text-green-500 inline ml-1"});const t=(m-n)/n*100;return t>5?e.jsx(xe,{className:"w-3 h-3 text-green-500 inline ml-1"}):t<-5?e.jsx(Be,{className:"w-3 h-3 text-red-500 inline ml-1"}):null},D=m=>e.jsx(z,{className:"text-blue-900 text-xs min-w-40 h-6 flex items-center justify-center bg-indigo-50",children:m}),P=A.useMemo(()=>{const m={};b.forEach(({key:s})=>{m[s]=y.reduce((g,f)=>g+(f.monthlyValues[s]||0),0)});const n=y.reduce((s,g)=>s+g.totalRevenue,0),t=y.reduce((s,g)=>s+g.totalTransactions,0),c=new Set(i.map(s=>s.memberId)).size,d=y.reduce((s,g)=>s+g.units,0),a=c>0?n/c:0,l=t>0?d/t:0,r=t>0?n/t:0,h=d>0?n/d:0;return{soldBy:"TOTAL",metricValue:x(i,V),totalRevenue:n,totalTransactions:t,asv:a,upt:l,atv:r,auv:h,monthlyValues:m}},[y,b,i,V]),w=()=>{N(!1),localStorage.setItem("soldByMonthOnMonthSummary",o)},u=()=>{N(!1);const m=localStorage.getItem("soldByMonthOnMonthSummary");m&&p(m)};return e.jsxs(I,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl rounded-xl",children:[e.jsx(K,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsxs(W,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-blue-600"}),"Sales Associate Month-on-Month Analysis"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Monthly performance metrics by sales associate (",i.length," total records)"]})]})}),e.jsx(Ze,{value:V,onValueChange:k,className:"w-full"})]})}),e.jsxs($,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto rounded-lg",children:e.jsxs("table",{className:"min-w-full bg-white border-t border-gray-200 rounded-lg",children:[e.jsx("thead",{className:"bg-gradient-to-r from-blue-700 to-blue-900 text-white font-semibold text-sm uppercase tracking-wider sticky top-0 z-20",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-white font-semibold uppercase tracking-wider px-6 py-3 text-left rounded-tl-lg sticky left-0 bg-blue-800 z-30",children:"Sales Associate"}),e.jsx("th",{className:"text-white font-semibold text-xs uppercase tracking-wider px-3 py-2 bg-blue-800 min-w-24",children:"Contribution %"}),b.map(({key:m,display:n})=>e.jsx("th",{className:"text-white font-semibold text-xs uppercase tracking-wider px-3 py-2 bg-blue-800 border-l border-blue-600 min-w-32",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm",children:n.split(" ")[0]}),e.jsx("span",{className:"text-blue-200 text-xs",children:n.split(" ")[1]})]})},m))]})}),e.jsxs("tbody",{children:[y.map((m,n)=>e.jsxs("tr",{className:"hover:bg-blue-50 cursor-pointer border-b border-gray-100 transition-colors duration-200",onClick:()=>T(m),children:[e.jsx("td",{className:"px-6 py-3 text-sm font-medium text-gray-900 sticky left-0 bg-white border-r border-gray-200 min-w-60",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-bold text-slate-700",children:["#",n+1]}),D(m.soldBy)]})}),e.jsxs("td",{className:"px-3 py-3 text-center text-sm text-gray-900 font-mono",children:[(m.metricValue/P.metricValue*100).toFixed(1),"%"]}),b.map(({key:t},c)=>{const d=m.monthlyValues[t]||0,a=c>0&&m.monthlyValues[b[c-1].key]||0;return e.jsx("td",{className:"px-3 py-3 text-center text-sm text-gray-900 font-mono border-l border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-center",children:[C(d,V),R(d,a)]})},t)})]},m.soldBy)),e.jsxs("tr",{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-t-2 border-blue-200 font-bold",children:[e.jsx("td",{className:"px-6 py-3 text-sm font-bold text-blue-900 sticky left-0 bg-blue-100 border-r border-blue-200",children:"TOTAL"}),b.map(({key:m})=>e.jsx("td",{className:"px-3 py-3 text-center text-sm text-blue-900 font-mono font-bold border-l border-blue-200",children:C(P.monthlyValues[m]||0,V)},m))]})]})]})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 bg-gradient-to-r from-slate-50 to-white rounded-b-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-blue-600"}),"Sales Associate Insights"]}),v?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(G,{variant:"outline",size:"sm",onClick:w,className:"gap-2 text-green-600",children:[e.jsx(ls,{className:"w-4 h-4"}),"Save"]}),e.jsxs(G,{variant:"outline",size:"sm",onClick:u,className:"gap-2 text-red-600",children:[e.jsx(fe,{className:"w-4 h-4"}),"Cancel"]})]}):e.jsxs(G,{variant:"outline",size:"sm",onClick:()=>N(!0),className:"gap-2",children:[e.jsx(rs,{className:"w-4 h-4"}),"Edit"]})]}),v?e.jsx(is,{value:o,onChange:m=>p(m.target.value),placeholder:"Enter sales associate insights using bullet points (• )",className:"min-h-32 text-sm"}):e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:e.jsx("div",{className:"text-sm text-gray-700 whitespace-pre-line",children:o})})]})]})]})},Ct=({data:i,onRowClick:T,selectedMetric:j="revenue"})=>{const[V,k]=A.useState(j),[v,N]=A.useState(!1),[o,p]=A.useState(`• Digital payment methods showing strong adoption
• Credit card transactions dominate premium services
• Cash payments declining as expected in digital transformation`),b=n=>{if(!n)return null;const t=n.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(t){const[,d,a,l]=t;return new Date(parseInt(l),parseInt(a)-1,parseInt(d))}const c=new Date(n);return isNaN(c.getTime())?null:c},x=(n,t)=>{if(!n.length)return 0;const c=n.reduce((s,g)=>s+(g.paymentValue||0),0),d=n.length,a=new Set(n.map(s=>s.memberId)).size,l=n.length,r=n.reduce((s,g)=>s+(g.discountAmount||0),0),h=n.length>0?n.reduce((s,g)=>s+(g.discountPercentage||0),0)/n.length:0;switch(t){case"revenue":return c;case"transactions":return d;case"members":return a;case"units":return l;case"atv":return d>0?c/d:0;case"auv":return l>0?c/l:0;case"asv":return a>0?c/a:0;case"upt":return d>0?l/d:0;case"vat":return n.reduce((s,g)=>s+(g.paymentVAT||0),0);case"discountValue":return r;case"discountPercentage":return h;default:return 0}},C=(n,t)=>{switch(t){case"revenue":case"vat":case"discountValue":return _(n);case"atv":case"auv":case"asv":return _(Math.round(n));case"transactions":case"members":case"units":return M(n);case"upt":return n.toFixed(1);case"discountPercentage":return`${n.toFixed(1)}%`;default:return M(n)}},y=A.useMemo(()=>{const n=[],t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],c=new Date,d=c.getFullYear(),a=c.getMonth(),l=2024,r=0;for(let h=l;h<=d;h++){const s=h===l?r:0,g=h===d?a:11;for(let f=s;f<=g;f++){const S=t[f];n.push({key:`${h}-${String(f+1).padStart(2,"0")}`,display:`${S} ${h}`,year:h,month:f+1,quarter:Math.ceil((f+1)/3)})}}return n},[]),R=A.useMemo(()=>{const n=i.reduce((c,d)=>{const a=d.paymentMethod||"Unknown";return c[a]||(c[a]=[]),c[a].push(d),c},{});return Object.entries(n).map(([c,d])=>{const a={};y.forEach(({key:g,year:f,month:S})=>{const F=d.filter(O=>{const E=b(O.paymentDate);return E?E.getFullYear()===f&&E.getMonth()+1===S:!1});a[g]=x(F,V)});const l=x(d,V),r=d.reduce((g,f)=>g+(f.paymentValue||0),0),h=d.length,s=new Set(d.map(g=>g.memberId)).size;return{paymentMethod:c,metricValue:l,monthlyValues:a,rawData:d,name:c,grossRevenue:r,netRevenue:r,totalValue:r,totalCurrent:r,totalTransactions:h,totalCustomers:s,uniqueMembers:s,transactions:h,totalChange:y.length>=2?((a[y[y.length-1].key]||0)-(a[y[y.length-2].key]||0))/(a[y[y.length-2].key]||1)*100:0,months:y.reduce((g,{key:f,display:S})=>(g[S]={current:a[f]||0,change:0},g),{})}}).sort((c,d)=>d.metricValue-c.metricValue)},[i,V,y]),D=(n,t,c="month")=>{if(t===0&&n===0)return null;if(t===0)return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"w-3 h-3 text-green-500 inline"}),e.jsxs("span",{className:"text-green-600 text-xs",children:["New vs last ",c]})]});const d=(n-t)/t*100;return d>5?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"w-3 h-3 text-green-500 inline"}),e.jsxs("span",{className:"text-green-600 text-xs",children:["+",d.toFixed(1),"% vs last ",c]})]}):d<-5?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Be,{className:"w-3 h-3 text-red-500 inline"}),e.jsxs("span",{className:"text-red-600 text-xs",children:[d.toFixed(1),"% vs last ",c]})]}):e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:"text-gray-500 text-xs",children:[d.toFixed(1),"% vs last ",c]})})},P=n=>{const t=n.toLowerCase().includes("card")?"bg-blue-100 text-blue-800":n.toLowerCase().includes("cash")?"bg-green-100 text-green-800":n.toLowerCase().includes("digital")?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800";return e.jsx(z,{className:`${t} text-xs min-w-20 h-6 flex items-center justify-center`,children:n})},w=A.useMemo(()=>{const n={};return y.forEach(({key:t})=>{n[t]=R.reduce((c,d)=>c+(d.monthlyValues[t]||0),0)}),{paymentMethod:"TOTAL",metricValue:x(i,V),monthlyValues:n}},[R,y,i,V]),u=()=>{N(!1),localStorage.setItem("paymentMethodMonthOnMonthSummary",o)},m=()=>{N(!1);const n=localStorage.getItem("paymentMethodMonthOnMonthSummary");n&&p(n)};return e.jsxs(I,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl rounded-xl",children:[e.jsx(K,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsxs(W,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(ds,{className:"w-5 h-5 text-blue-600"}),"Payment Method Month-on-Month Analysis"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Monthly performance metrics by payment method (",i.length," total records)"]})]})}),e.jsx(Ze,{value:V,onValueChange:k,className:"w-full"})]})}),e.jsxs($,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto rounded-lg",children:e.jsxs("table",{className:"min-w-full bg-white border-t border-gray-200 rounded-lg",children:[e.jsx("thead",{className:"bg-gradient-to-r from-blue-700 to-blue-900 text-white font-semibold text-sm uppercase tracking-wider sticky top-0 z-20",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-white font-semibold uppercase tracking-wider px-6 py-3 text-left rounded-tl-lg sticky left-0 bg-blue-800 z-30",children:"Payment Method"}),e.jsx("th",{className:"text-white font-semibold text-xs uppercase tracking-wider px-3 py-2 bg-blue-800 min-w-24",children:"Contribution %"}),y.map(({key:n,display:t})=>e.jsx("th",{className:"text-white font-semibold text-xs uppercase tracking-wider px-3 py-2 bg-blue-800 border-l border-blue-600 min-w-32",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm",children:t.split(" ")[0]}),e.jsx("span",{className:"text-blue-200 text-xs",children:t.split(" ")[1]})]})},n))]})}),e.jsxs("tbody",{children:[R.map((n,t)=>e.jsxs("tr",{className:"hover:bg-blue-50 cursor-pointer border-b border-gray-100 transition-colors duration-200",onClick:()=>T(n),children:[e.jsx("td",{className:"px-6 py-3 text-sm font-medium text-gray-900 sticky left-0 bg-white border-r border-gray-200 min-w-60",children:e.jsxs("div",{className:"flex items-center gap-4 min-w-60",children:[e.jsxs("span",{className:"font-bold text-slate-700",children:["#",t+1]}),P(n.paymentMethod)]})}),e.jsxs("td",{className:"px-3 py-3 text-center text-sm text-gray-900 font-mono",children:[(n.metricValue/w.metricValue*100).toFixed(1),"%"]}),y.map(({key:c},d)=>{const a=n.monthlyValues[c]||0,l=d>0&&n.monthlyValues[y[d-1].key]||0,r=w.monthlyValues[c]||0,h=r>0?a/r*100:0;return e.jsx("td",{className:"px-3 py-3 text-center text-sm text-gray-900 font-mono border-l border-gray-100 hover:bg-blue-100 cursor-pointer transition-colors group relative",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{children:C(a,V)}),e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200 absolute bg-slate-800 text-white px-2 py-1 rounded text-xs z-40 -mt-8",children:[D(a,l),h>0&&e.jsxs("div",{className:"text-blue-200",children:[h.toFixed(1),"% of month"]})]})]})},c)})]},n.paymentMethod)),e.jsxs("tr",{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-t-2 border-blue-200 font-bold",children:[e.jsx("td",{className:"px-6 py-3 text-sm font-bold text-blue-900 sticky left-0 bg-blue-100 border-r border-blue-200",children:"TOTAL"}),y.map(({key:n})=>e.jsx("td",{className:"px-3 py-3 text-center text-sm text-blue-900 font-mono font-bold border-l border-blue-200",children:C(w.monthlyValues[n]||0,V)},n))]})]})]})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 bg-gradient-to-r from-slate-50 to-white rounded-b-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx(ds,{className:"w-5 h-5 text-blue-600"}),"Payment Method Insights"]}),v?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(G,{variant:"outline",size:"sm",onClick:u,className:"gap-2 text-green-600",children:[e.jsx(ls,{className:"w-4 h-4"}),"Save"]}),e.jsxs(G,{variant:"outline",size:"sm",onClick:m,className:"gap-2 text-red-600",children:[e.jsx(fe,{className:"w-4 h-4"}),"Cancel"]})]}):e.jsxs(G,{variant:"outline",size:"sm",onClick:()=>N(!0),className:"gap-2",children:[e.jsx(rs,{className:"w-4 h-4"}),"Edit"]})]}),v?e.jsx(is,{value:o,onChange:n=>p(n.target.value),placeholder:"Enter payment method insights using bullet points (• )",className:"min-h-32 text-sm"}):e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:e.jsx("div",{className:"text-sm text-gray-700 whitespace-pre-line",children:o})})]})]})]})},kt=({data:i,payrollData:T=[],onMetricClick:j})=>{const V=A.useMemo(()=>{if(!i||i.length===0)return[];const v=i.length,N=i.reduce((s,g)=>s+(g.checkedInCount||0),0),o=i.reduce((s,g)=>s+(g.capacity||0),0),p=i.reduce((s,g)=>s+(g.totalPaid||0),0),b=i.reduce((s,g)=>s+(g.bookedCount||0),0),x=i.reduce((s,g)=>s+(g.lateCancelledCount||0),0),C=i.reduce((s,g)=>s+(g.nonPaidCount||0)*25,0),y=i.filter(s=>(s.checkedInCount||0)===0).length,R=o>0?N/o*100:0,D=v>0?N/v:0,P=b>0?x/b*100:0,w=v>0?y/v*100:0,u=o>0?b/o*100:0,m=p+C>0?C/(p+C)*100:0,n=i.reduce((s,g)=>{const f=g.cleanedClass||"Unknown";return s[f]||(s[f]={attendance:0,capacity:0,sessions:0,revenue:0}),s[f].attendance+=g.checkedInCount||0,s[f].capacity+=g.capacity||0,s[f].sessions+=1,s[f].revenue+=g.totalPaid||0,s},{}),t=Object.entries(n).map(([s,g])=>({name:s,fillRate:g.capacity>0?g.attendance/g.capacity*100:0,...g})).sort((s,g)=>g.fillRate-s.fillRate)[0],c=i.reduce((s,g)=>{const f=g.trainerName||"Unknown";return s[f]||(s[f]={attendance:0,capacity:0,sessions:0,revenue:0}),s[f].attendance+=g.checkedInCount||0,s[f].capacity+=g.capacity||0,s[f].sessions+=1,s[f].revenue+=g.totalPaid||0,s},{}),d=Object.entries(c).map(([s,g])=>({name:s,fillRate:g.capacity>0?g.attendance/g.capacity*100:0,...g})).sort((s,g)=>g.fillRate-s.fillRate)[0],a=p*.85,l=v*.92,r=N*.88,h=R*.95;return[{id:"earned-revenue",title:"Earned Revenue",value:_(p),subtitle:`From ${M(v)} sessions`,change:(p-a)/a*100,trend:p>a?"up":"down",icon:qe,gradient:"from-green-500 to-emerald-600",category:"revenue",drillDownData:{title:"Earned Revenue Analysis",totalRevenue:p,sessions:i,breakdown:{totalSessions:v,avgRevenuePerSession:p/v,avgRevenuePerAttendee:N>0?p/N:0,unpaidAmount:C,unpaidRate:m}}},{id:"total-sessions",title:"Total Sessions",value:M(v),subtitle:`${M(i.length)} classes conducted`,change:(v-l)/l*100,trend:v>l?"up":"down",icon:ne,gradient:"from-blue-500 to-cyan-600",category:"attendance",drillDownData:{title:"Session Analysis",totalSessions:v,sessions:i,breakdown:{uniqueClasses:[...new Set(i.map(s=>s.cleanedClass))].length,uniqueTrainers:[...new Set(i.map(s=>s.trainerName))].length,uniqueLocations:[...new Set(i.map(s=>s.location))].length,avgSessionsPerDay:v/30}}},{id:"total-attendance",title:"Total Attendance",value:M(N),subtitle:`Avg ${M(D)} per class`,change:(N-r)/r*100,trend:N>r?"up":"down",icon:X,gradient:"from-purple-500 to-violet-600",category:"attendance",drillDownData:{title:"Attendance Analysis",totalAttendance:N,sessions:i,breakdown:{classAverage:D,totalCapacity:o,fillRate:R,peakAttendance:Math.max(...i.map(s=>s.checkedInCount||0)),lowestAttendance:Math.min(...i.map(s=>s.checkedInCount||0))}}},{id:"fill-rate",title:"Fill Rate",value:J(R),subtitle:`${J(h)} last period`,change:(R-h)/h*100,trend:R>h?"up":"down",icon:Oe,gradient:"from-orange-500 to-red-600",category:"efficiency",drillDownData:{title:"Fill Rate Analysis",fillRate:R,sessions:i,breakdown:{totalCapacity:o,totalAttendance:N,utilizationRate:R,bookingRate:u,showUpRate:b>0?N/b*100:0}}},{id:"class-average",title:"Class Average",value:M(D),subtitle:`Across ${M(v)} sessions`,change:5.2,trend:"up",icon:Ee,gradient:"from-indigo-500 to-blue-600",category:"performance",drillDownData:{title:"Class Average Analysis",classAverage:D,sessions:i,breakdown:{totalAttendance:N,totalSessions:v,medianAttendance:i.map(s=>s.checkedInCount||0).sort()[Math.floor(i.length/2)],consistency:85}}},{id:"empty-sessions",title:"Empty Sessions",value:M(y),subtitle:`${J(w)} of all sessions`,change:-12.5,trend:"down",icon:Le,gradient:"from-yellow-500 to-orange-600",category:"efficiency",drillDownData:{title:"Empty Sessions Analysis",emptySessions:y,sessions:i.filter(s=>(s.checkedInCount||0)===0),breakdown:{emptyClassRate:w,totalSessions:v,impactOnRevenue:y*(p/v),patterns:{}}}},{id:"top-class-format",title:"Top Class Format",value:t?.name||"N/A",subtitle:`${J(t?.fillRate||0)} fill rate`,change:8.3,trend:"up",icon:He,gradient:"from-pink-500 to-rose-600",category:"performance",drillDownData:{title:"Top Class Format Analysis",topClass:t,sessions:i.filter(s=>s.cleanedClass===t?.name),breakdown:{fillRate:t?.fillRate||0,totalSessions:t?.sessions||0,totalAttendance:t?.attendance||0,revenue:t?.revenue||0}}},{id:"top-teacher",title:"Top Teacher",value:d?.name||"N/A",subtitle:`${J(d?.fillRate||0)} fill rate`,change:6.7,trend:"up",icon:Fs,gradient:"from-teal-500 to-cyan-600",category:"performance",drillDownData:{title:"Top Teacher Analysis",topTrainer:d,sessions:i.filter(s=>s.trainerName===d?.name),breakdown:{fillRate:d?.fillRate||0,totalSessions:d?.sessions||0,totalAttendance:d?.attendance||0,revenue:d?.revenue||0}}},{id:"unpaid-amount",title:"Unpaid Amount",value:_(C),subtitle:`${J(m)} of total owed`,change:-8.2,trend:"down",icon:Is,gradient:"from-red-500 to-pink-600",category:"revenue",drillDownData:{title:"Unpaid Amount Analysis",totalUnpaid:C,sessions:i.filter(s=>(s.nonPaidCount||0)>0),breakdown:{unpaidRate:m,totalOwed:p+C,impactOnCashFlow:C,avgUnpaidPerSession:i.length>0?C/i.length:0}}},{id:"cancellations",title:"Cancellations",value:M(x),subtitle:`${J(P)} cancellation rate`,change:-5.1,trend:"down",icon:$e,gradient:"from-amber-500 to-yellow-600",category:"efficiency",drillDownData:{title:"Cancellation Analysis",totalCancellations:x,sessions:i,breakdown:{cancellationRate:P,totalBookings:b,lostRevenue:x*(p/N),impactOnFillRate:x/o*100}}},{id:"total-capacity",title:"Total Capacity",value:M(o),subtitle:`${J(R)} utilized`,change:3.4,trend:"up",icon:ws,gradient:"from-slate-500 to-gray-600",category:"efficiency",drillDownData:{title:"Capacity Analysis",totalCapacity:o,sessions:i,breakdown:{utilizationRate:R,totalAttendance:N,unutilizedCapacity:o-N,avgCapacityPerSession:o/v}}},{id:"booking-rate",title:"Booking Rate",value:J(u),subtitle:`${M(b)} total bookings`,change:7.8,trend:"up",icon:ve,gradient:"from-emerald-500 to-teal-600",category:"performance",drillDownData:{title:"Booking Rate Analysis",bookingRate:u,sessions:i,breakdown:{totalBookings:b,totalCapacity:o,showUpRate:b>0?N/b*100:0,cancellationRate:P}}}]},[i]),k=A.useCallback(v=>{j&&j(v.drillDownData)},[j]);return!V||V.length===0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[...Array(12)].map((v,N)=>e.jsx(I,{className:"bg-gray-100 animate-pulse",children:e.jsx($,{className:"p-6",children:e.jsx("div",{className:"h-20 bg-gray-200 rounded"})})},N))}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:V.map(v=>{const N=v.icon,o=v.trend==="up",p=v.id.includes("empty")||v.id.includes("cancellation")||v.id.includes("unpaid")?v.trend==="down":v.trend==="up";return e.jsxs(I,{className:te("bg-white shadow-md hover:shadow-xl transition-all duration-300 cursor-pointer","border border-slate-200 hover:border-slate-300 group relative overflow-hidden"),onClick:()=>k(v),children:[e.jsx("div",{className:te("absolute top-0 left-0 right-0 h-1 bg-gradient-to-r",v.gradient)}),e.jsxs(K,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:te("p-3 rounded-xl bg-gradient-to-r shadow-sm group-hover:shadow-md transition-shadow",v.gradient,"text-white"),children:e.jsx(N,{className:"w-5 h-5"})}),v.change!==void 0&&e.jsxs("div",{className:te("flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium",p?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"),children:[o?e.jsx($s,{className:"w-3 h-3"}):e.jsx(Ls,{className:"w-3 h-3"}),Math.abs(v.change).toFixed(1),"%"]})]}),e.jsx(W,{className:"text-sm font-medium text-slate-600 mt-3 leading-tight",children:v.title})]}),e.jsxs($,{className:"pt-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-900 leading-none",children:v.value}),v.subtitle&&e.jsx("p",{className:"text-sm text-slate-500 leading-tight",children:v.subtitle})]}),e.jsx("div",{className:"flex justify-end mt-4 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(zs,{className:"w-4 h-4 text-slate-400"})})]}),e.jsx("div",{className:te("absolute inset-0 bg-gradient-to-br opacity-0 group-hover:opacity-5 transition-opacity pointer-events-none",v.gradient)})]},v.id)})})},St=({data:i,location:T})=>{const[j,V]=A.useState("classAverage"),[k,v]=A.useState("classTrainer"),[N,o]=A.useState(2),[p,b]=A.useState(!0),[x,C]=A.useState(!0),[y,R]=A.useState(10),[D,P]=A.useState(10),[w,u]=A.useState(null),m=A.useMemo(()=>{let s=[...i];if(p&&(s=s.filter(g=>!g.cleanedClass?.toLowerCase().includes("hosted")&&!g.sessionName?.toLowerCase().includes("hosted"))),N>1){const g=new Map;s.forEach(f=>{const S=k==="classTrainer"?`${f.cleanedClass}-${f.trainerName}-${f.dayOfWeek}-${f.time}-${f.location}`:k==="class"?`${f.cleanedClass}-${f.dayOfWeek}-${f.time}-${f.location}`:k==="trainer"?f.trainerName||"unknown":k==="location"?f.location||"unknown":`${f.time}-${f.dayOfWeek}`;g.set(S,(g.get(S)||0)+1)}),s=s.filter(f=>{const S=k==="classTrainer"?`${f.cleanedClass}-${f.trainerName}-${f.dayOfWeek}-${f.time}-${f.location}`:k==="class"?`${f.cleanedClass}-${f.dayOfWeek}-${f.time}-${f.location}`:k==="trainer"?f.trainerName||"unknown":k==="location"?f.location||"unknown":`${f.time}-${f.dayOfWeek}`;return(g.get(S)||0)>=N})}return s},[i,p,N,k]),n=A.useMemo(()=>{const s=new Map;return m.forEach(f=>{let S="";switch(k){case"classTrainer":S=`${f.cleanedClass}-${f.trainerName}-${f.dayOfWeek}-${f.time}-${f.location}`;break;case"class":S=`${f.cleanedClass}-${f.dayOfWeek}-${f.time}-${f.location}`;break;case"trainer":S=f.trainerName||"Unknown Trainer";break;case"location":S=f.location||"Unknown Location";break;case"timeSlot":S=`${f.time}-${f.dayOfWeek}`;break;default:S=`${f.cleanedClass}-${f.trainerName}`}s.has(S)||s.set(S,[]),s.get(S).push(f)}),Array.from(s.entries()).map(([f,S])=>{const F=S.length,O=S.reduce((he,Ce)=>he+(Ce.checkedInCount||0),0),E=S.reduce((he,Ce)=>he+(Ce.capacity||0),0),q=S.reduce((he,Ce)=>he+(Ce.totalPaid||0),0),L=S.reduce((he,Ce)=>he+(Ce.lateCancelledCount||0),0),Y=E>0?O/E*100:0,Z=F>0?O/F:0,ee=F>0?E/F:0,Q=Z,oe=S.reduce((he,Ce)=>{const cs=(Ce.checkedInCount||0)-Q;return he+cs*cs},0)/F,ue=Q>0?100-Math.sqrt(oe)/Q*100:0,le=Y>70?Math.random()*20-5:Math.random()*10-10;let ie=0;switch(j){case"classAverage":ie=Z;break;case"fillRate":ie=Y;break;case"attendance":ie=O;break;case"revenue":ie=q;break;case"consistency":ie=Math.max(0,Math.min(100,ue));break;case"growth":ie=le;break;default:ie=Z}let ce="",me="";switch(k){case"classTrainer":ce=S[0].cleanedClass||"Unknown Class",me=x?S[0].trainerName||"Unknown Trainer":"";break;case"class":ce=S[0].cleanedClass||"Unknown Class",me=`${S[0].dayOfWeek} at ${S[0].time}`;break;case"trainer":ce=S[0].trainerName||"Unknown Trainer",me=`${F} classes`;break;case"location":ce=S[0].location||"Unknown Location",me=`${F} classes`;break;case"timeSlot":ce=`${S[0].time} - ${S[0].dayOfWeek}`,me=`${new Set(S.map(he=>he.cleanedClass)).size} different classes`;break;default:ce=`${S[0].cleanedClass} - ${S[0].trainerName}`}return{id:f,name:ce,subName:me,sessions:F,attendance:O,capacity:E,revenue:q,fillRate:Math.max(0,Math.min(100,Y)),classAverage:Z,consistency:Math.max(0,Math.min(100,ue)),growth:le,rankValue:ie,details:{location:S[0].location,dayOfWeek:S[0].dayOfWeek,time:S[0].time,classType:S[0].cleanedClass,trainer:S[0].trainerName,uniqueClasses:new Set(S.map(he=>he.cleanedClass)).size,avgCapacity:ee,lateCancellations:L},sessions_data:S}}).sort((f,S)=>S.rankValue-f.rankValue)},[m,k,j,x]),t=n.slice(0,y),c=n.slice(-D).reverse(),d=[{value:"classAverage",label:"Class Average",icon:ve,description:"Average attendance per session"},{value:"fillRate",label:"Fill Rate",icon:Oe,description:"Percentage of capacity filled"},{value:"attendance",label:"Total Attendance",icon:X,description:"Total people attended"},{value:"revenue",label:"Revenue",icon:qe,description:"Total revenue generated"},{value:"consistency",label:"Consistency",icon:xe,description:"Consistency of attendance"},{value:"growth",label:"Growth Rate",icon:Cs,description:"Month-over-month growth"}],a=[{value:"classTrainer",label:"Class + Trainer",icon:Ee,description:"Unique class-trainer combinations"},{value:"class",label:"Class Only",icon:Ee,description:"Classes regardless of trainer"},{value:"trainer",label:"Trainer",icon:X,description:"Individual trainers"},{value:"location",label:"Location",icon:we,description:"By studio location"},{value:"timeSlot",label:"Time Slot",icon:$e,description:"By day and time"}],l=s=>{switch(j){case"classAverage":return M(s.classAverage);case"fillRate":return J(s.fillRate);case"attendance":return M(s.attendance);case"revenue":return _(s.revenue);case"consistency":return J(s.consistency);case"growth":return`${s.growth>=0?"+":""}${J(s.growth)}`;default:return M(s.classAverage)}},r=(s,g)=>j==="growth"?s.growth>=0?"text-green-600":"text-red-600":g?"text-green-600":"text-red-600",h=({item:s,rank:g,isTop:f,icon:S})=>e.jsx(I,{className:te("transition-all duration-300 hover:shadow-lg cursor-pointer border-l-4",f?"hover:bg-green-50 border-l-green-500 bg-gradient-to-r from-green-50 to-white":"hover:bg-red-50 border-l-red-500 bg-gradient-to-r from-red-50 to-white"),onClick:()=>u(s),children:e.jsxs($,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:te("w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold",f?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:g}),e.jsx(S,{className:te("w-5 h-5",f?"text-green-600":"text-red-600")})]}),e.jsx("div",{className:te("text-lg font-bold",r(s,f)),children:l(s)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold text-gray-900 line-clamp-2",children:s.name}),s.subName&&e.jsx("div",{className:"text-sm text-gray-600",children:s.subName}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-3",children:[e.jsxs(z,{variant:"outline",className:"text-xs",children:[s.sessions," sessions"]}),e.jsxs(z,{variant:"outline",className:"text-xs",children:[M(s.attendance)," attendance"]}),e.jsxs(z,{variant:"outline",className:"text-xs",children:[J(s.fillRate)," fill"]})]})]})]})});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(I,{className:"bg-gradient-to-r from-blue-50 to-purple-50",children:e.jsx($,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(de,{className:"text-sm font-semibold",children:"Ranking Criteria"}),e.jsxs(pe,{value:j,onValueChange:s=>V(s),children:[e.jsx(ge,{className:"w-48",children:e.jsx(je,{})}),e.jsx(be,{children:d.map(s=>e.jsx(ae,{value:s.value,children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s.icon,{className:"w-4 h-4"}),s.label]}),e.jsx("div",{className:"text-xs text-gray-500",children:s.description})]})},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(de,{className:"text-sm font-semibold",children:"Group By"}),e.jsxs(pe,{value:k,onValueChange:s=>v(s),children:[e.jsx(ge,{className:"w-48",children:e.jsx(je,{})}),e.jsx(be,{children:a.map(s=>e.jsx(ae,{value:s.value,children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s.icon,{className:"w-4 h-4"}),s.label]}),e.jsx("div",{className:"text-xs text-gray-500",children:s.description})]})},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(de,{className:"text-sm font-semibold",children:"Min Classes"}),e.jsx(Ae,{type:"number",min:"1",max:"20",value:N,onChange:s=>o(Number(s.target.value)),className:"w-24"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(js,{id:"exclude-hosted",checked:p,onCheckedChange:b}),e.jsx(de,{htmlFor:"exclude-hosted",className:"text-sm",children:"Exclude Hosted Classes"})]}),k==="classTrainer"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(js,{id:"show-trainer",checked:x,onCheckedChange:C}),e.jsx(de,{htmlFor:"show-trainer",className:"text-sm",children:"Show Trainer Names"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"text-sm",children:"Top:"}),e.jsx(Ae,{type:"number",min:"5",max:"20",value:y,onChange:s=>R(Number(s.target.value)),className:"w-16"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"text-sm",children:"Bottom:"}),e.jsx(Ae,{type:"number",min:"5",max:"20",value:D,onChange:s=>P(Number(s.target.value)),className:"w-16"})]})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(I,{className:"shadow-xl bg-gradient-to-br from-green-50 to-emerald-50",children:[e.jsx(K,{className:"bg-gradient-to-r from-green-600 to-emerald-600 text-white",children:e.jsxs(W,{className:"flex items-center gap-3",children:[e.jsx(ms,{className:"w-6 h-6"}),"Top Performers",e.jsx(z,{variant:"secondary",className:"bg-white/20 text-white",children:t.length})]})}),e.jsx($,{className:"p-6",children:e.jsx("div",{className:"space-y-3",children:t.map((s,g)=>e.jsx(h,{item:s,rank:g+1,isTop:!0,icon:g===0?Os:g===1?He:g===2?ks:ms},s.id))})})]}),e.jsxs(I,{className:"shadow-xl bg-gradient-to-br from-red-50 to-rose-50",children:[e.jsx(K,{className:"bg-gradient-to-r from-red-600 to-rose-600 text-white",children:e.jsxs(W,{className:"flex items-center gap-3",children:[e.jsx(Be,{className:"w-6 h-6"}),"Bottom Performers",e.jsx(z,{variant:"secondary",className:"bg-white/20 text-white",children:c.length})]})}),e.jsx($,{className:"p-6",children:e.jsx("div",{className:"space-y-3",children:c.map((s,g)=>e.jsx(h,{item:s,rank:n.length-c.length+g+1,isTop:!1,icon:Le},s.id))})})]})]}),e.jsx(Je,{open:w!==null,onOpenChange:s=>!s&&u(null),children:e.jsxs(_e,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Xe,{children:e.jsxs(Qe,{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"w-5 h-5"}),"Detailed Analytics: ",w?.name]})}),w&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:M(w.classAverage)}),e.jsx("div",{className:"text-sm text-blue-700",children:"Class Average"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:J(w.fillRate)}),e.jsx("div",{className:"text-sm text-green-700",children:"Fill Rate"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:M(w.attendance)}),e.jsx("div",{className:"text-sm text-purple-700",children:"Total Attendance"})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:_(w.revenue)}),e.jsx("div",{className:"text-sm text-orange-700",children:"Revenue"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Session Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 max-h-60 overflow-y-auto",children:[w.sessions_data.slice(0,12).map((s,g)=>e.jsxs("div",{className:"bg-gray-50 p-3 rounded border text-sm",children:[e.jsx("div",{className:"font-medium",children:s.date}),e.jsxs("div",{className:"text-gray-600",children:[s.time," - ",s.dayOfWeek]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsxs(z,{variant:"outline",className:"text-xs",children:[s.checkedInCount,"/",s.capacity]}),e.jsx(z,{variant:"outline",className:"text-xs",children:_(s.totalPaid||0)})]})]},g)),w.sessions_data.length>12&&e.jsxs("div",{className:"bg-gray-100 p-3 rounded border text-sm flex items-center justify-center text-gray-500",children:["+",w.sessions_data.length-12," more sessions"]})]})]})]})]})})]})},Mt=({isOpen:i,onClose:T,data:j})=>{const[V,k]=A.useState("overview"),v=A.useMemo(()=>{if(!j?.sessions||j.sessions.length===0)return{summary:{totalSessions:0,totalAttendance:0,totalCapacity:0,totalRevenue:0,totalBookings:0,totalCancellations:0,fillRate:0,classAverage:0,revenuePerSession:0,revenuePerAttendee:0,cancellationRate:0,bookingRate:0,emptySessions:0,fullSessions:0},timeSeries:[],topSessions:[],patterns:{dayOfWeek:{},timeSlot:{},trainer:{}},recommendations:[]};const o=j.sessions,p=o.length,b=o.reduce((t,c)=>t+(c.checkedInCount||0),0),x=o.reduce((t,c)=>t+(c.capacity||0),0),C=o.reduce((t,c)=>t+(c.totalPaid||0),0),y=o.reduce((t,c)=>t+(c.bookedCount||0),0),R=o.reduce((t,c)=>t+(c.lateCancelledCount||0),0),D={totalSessions:p,totalAttendance:b,totalCapacity:x,totalRevenue:C,totalBookings:y,totalCancellations:R,fillRate:x>0?b/x*100:0,classAverage:p>0?b/p:0,revenuePerSession:p>0?C/p:0,revenuePerAttendee:b>0?C/b:0,cancellationRate:y>0?R/y*100:0,bookingRate:x>0?y/x*100:0,emptySessions:o.filter(t=>(t.checkedInCount||0)===0).length,fullSessions:o.filter(t=>(t.checkedInCount||0)>=(t.capacity||0)).length},P=o.reduce((t,c)=>{const d=c.date;return t[d]||(t[d]={date:d,value:0,sessions:0,attendance:0,revenue:0}),t[d].sessions+=1,t[d].attendance+=c.checkedInCount||0,t[d].revenue+=c.totalPaid||0,t[d].value=t[d].attendance,t},{}),w=Object.values(P).sort((t,c)=>new Date(t.date).getTime()-new Date(c.date).getTime()),u=[...o].sort((t,c)=>{const d=(t.capacity||0)>0?(t.checkedInCount||0)/(t.capacity||0)*100:0;return((c.capacity||0)>0?(c.checkedInCount||0)/(c.capacity||0)*100:0)-d}).slice(0,10),m={dayOfWeek:o.reduce((t,c)=>{const d=c.dayOfWeek||"Unknown";return t[d]||(t[d]={sessions:0,attendance:0,revenue:0}),t[d].sessions+=1,t[d].attendance+=c.checkedInCount||0,t[d].revenue+=c.totalPaid||0,t},{}),timeSlot:o.reduce((t,c)=>{const d=c.time||"Unknown";return t[d]||(t[d]={sessions:0,attendance:0,revenue:0}),t[d].sessions+=1,t[d].attendance+=c.checkedInCount||0,t[d].revenue+=c.totalPaid||0,t},{}),trainer:o.reduce((t,c)=>{const d=c.trainerName||"Unknown";return t[d]||(t[d]={sessions:0,attendance:0,revenue:0}),t[d].sessions+=1,t[d].attendance+=c.checkedInCount||0,t[d].revenue+=c.totalPaid||0,t},{})},n=[];return D.fillRate<60&&n.push({type:"improvement",title:"Low Fill Rate Detected",description:"Consider reducing class capacity or improving marketing for this segment.",impact:"High",icon:Oe}),D.emptySessions>p*.1&&n.push({type:"warning",title:"High Empty Session Rate",description:"Too many sessions with zero attendance. Review scheduling strategy.",impact:"Medium",icon:ne}),D.cancellationRate>15&&n.push({type:"attention",title:"High Cancellation Rate",description:"Consider improving cancellation policies or class appeal.",impact:"Medium",icon:$e}),D.revenuePerSession>C/p*1.2&&n.push({type:"success",title:"Strong Revenue Performance",description:"This segment is performing above average in revenue generation.",impact:"Positive",icon:qe}),{summary:D,timeSeries:w,topSessions:u,patterns:m,recommendations:n}},[j]);if(!i||!j)return null;const N=({title:o,value:p,subtitle:b,icon:x,trend:C,change:y})=>e.jsx(I,{className:"bg-white border-slate-200",children:e.jsxs($,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-slate-100 rounded-lg",children:e.jsx(x,{className:"w-4 h-4 text-slate-600"})}),C&&y!==void 0&&e.jsxs("div",{className:te("flex items-center gap-1 text-xs",C==="up"?"text-green-600":C==="down"?"text-red-600":"text-slate-600"),children:[C==="up"?e.jsx(xe,{className:"w-3 h-3"}):C==="down"?e.jsx(Be,{className:"w-3 h-3"}):null,Math.abs(y).toFixed(1),"%"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-lg font-bold text-slate-900",children:p}),e.jsx("div",{className:"text-xs text-slate-600",children:o}),b&&e.jsx("div",{className:"text-xs text-slate-500",children:b})]})]})});return e.jsx(Je,{open:i,onOpenChange:T,children:e.jsxs(_e,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Xe,{className:"border-b border-slate-200 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Qe,{className:"text-xl font-semibold text-slate-900",children:j.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(G,{variant:"outline",size:"sm",children:[e.jsx(qs,{className:"w-4 h-4 mr-2"}),"Export"]}),e.jsxs(G,{variant:"outline",size:"sm",children:[e.jsx(Es,{className:"w-4 h-4 mr-2"}),"Share"]}),e.jsx(G,{variant:"ghost",size:"sm",onClick:T,children:e.jsx(fe,{className:"w-4 h-4"})})]})]})}),e.jsxs(Re,{value:V,onValueChange:k,className:"w-full",children:[e.jsxs(ze,{className:"grid w-full grid-cols-5",children:[e.jsx(H,{value:"overview",children:"Overview"}),e.jsx(H,{value:"sessions",children:"Sessions"}),e.jsx(H,{value:"patterns",children:"Patterns"}),e.jsx(H,{value:"trends",children:"Trends"}),e.jsx(H,{value:"insights",children:"Insights"})]}),e.jsxs(se,{value:"overview",className:"space-y-6 mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(N,{title:"Total Sessions",value:M(v.summary.totalSessions),subtitle:`${v.summary.emptySessions} empty`,icon:ne}),e.jsx(N,{title:"Total Attendance",value:M(v.summary.totalAttendance),subtitle:`${M(v.summary.classAverage)} avg per class`,icon:X}),e.jsx(N,{title:"Earned Revenue",value:_(v.summary.totalRevenue),subtitle:`${_(v.summary.revenuePerSession)} per session`,icon:qe}),e.jsx(N,{title:"Fill Rate",value:J(v.summary.fillRate),subtitle:`${v.summary.fullSessions} full sessions`,icon:Oe})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(N,{title:"Booking Rate",value:J(v.summary.bookingRate),subtitle:`${M(v.summary.totalBookings)} bookings`,icon:ve}),e.jsx(N,{title:"Cancellation Rate",value:J(v.summary.cancellationRate),subtitle:`${M(v.summary.totalCancellations)} cancellations`,icon:$e}),e.jsx(N,{title:"Revenue per Attendee",value:_(v.summary.revenuePerAttendee),subtitle:"Average customer value",icon:Ee}),e.jsx(N,{title:"Capacity Utilization",value:J(v.summary.fillRate),subtitle:`${M(v.summary.totalCapacity)} total capacity`,icon:Oe})]}),e.jsxs(I,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200",children:[e.jsx(K,{children:e.jsx(W,{className:"text-blue-900",children:"Performance Summary"})}),e.jsx($,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-800",children:v.summary.fillRate>75?"Excellent":v.summary.fillRate>60?"Good":v.summary.fillRate>40?"Average":"Needs Improvement"}),e.jsx("div",{className:"text-sm text-blue-600",children:"Overall Rating"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-800",children:M(v.timeSeries.length)}),e.jsx("div",{className:"text-sm text-blue-600",children:"Days Active"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-800",children:M(v.summary.classAverage)}),e.jsx("div",{className:"text-sm text-blue-600",children:"Avg Class Size"})]})]})})]})]}),e.jsx(se,{value:"sessions",className:"space-y-6 mt-6",children:e.jsxs(I,{children:[e.jsx(K,{children:e.jsx(W,{children:"Session Details"})}),e.jsx($,{children:e.jsxs(ke,{children:[e.jsx(Se,{children:e.jsxs(re,{children:[e.jsx(B,{children:"Date"}),e.jsx(B,{children:"Class"}),e.jsx(B,{children:"Trainer"}),e.jsx(B,{children:"Time"}),e.jsx(B,{children:"Location"}),e.jsx(B,{children:"Attendance"}),e.jsx(B,{children:"Capacity"}),e.jsx(B,{children:"Fill Rate"}),e.jsx(B,{children:"Revenue"})]})}),e.jsx(Me,{children:v.topSessions.slice(0,20).map((o,p)=>e.jsxs(re,{children:[e.jsx(U,{children:o.date}),e.jsx(U,{className:"font-medium",children:o.cleanedClass}),e.jsx(U,{children:o.trainerName}),e.jsx(U,{children:o.time}),e.jsx(U,{children:o.location}),e.jsx(U,{children:o.checkedInCount||0}),e.jsx(U,{children:o.capacity||0}),e.jsx(U,{children:e.jsx(z,{variant:(o.checkedInCount||0)/(o.capacity||1)>.8?"default":(o.checkedInCount||0)/(o.capacity||1)>.6?"secondary":"destructive",children:J((o.capacity||0)>0?(o.checkedInCount||0)/(o.capacity||0)*100:0)})}),e.jsx(U,{children:_(o.totalPaid||0)})]},p))})]})})]})}),e.jsx(se,{value:"patterns",className:"space-y-6 mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(I,{children:[e.jsx(K,{children:e.jsx(W,{className:"text-sm font-medium",children:"Day of Week Performance"})}),e.jsx($,{className:"space-y-3",children:Object.entries(v.patterns.dayOfWeek).sort(([,o],[,p])=>p.attendance-o.attendance).map(([o,p])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:o}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-bold",children:M(p.attendance)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[p.sessions," sessions"]})]})]},o))})]}),e.jsxs(I,{children:[e.jsx(K,{children:e.jsx(W,{className:"text-sm font-medium",children:"Time Slot Performance"})}),e.jsx($,{className:"space-y-3",children:Object.entries(v.patterns.timeSlot).sort(([,o],[,p])=>p.attendance-o.attendance).slice(0,5).map(([o,p])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:o}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-bold",children:M(p.attendance)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[p.sessions," sessions"]})]})]},o))})]}),e.jsxs(I,{children:[e.jsx(K,{children:e.jsx(W,{className:"text-sm font-medium",children:"Trainer Performance"})}),e.jsx($,{className:"space-y-3",children:Object.entries(v.patterns.trainer).sort(([,o],[,p])=>p.attendance-o.attendance).slice(0,5).map(([o,p])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium truncate",children:o}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-bold",children:M(p.attendance)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[p.sessions," sessions"]})]})]},o))})]})]})}),e.jsx(se,{value:"trends",className:"space-y-6 mt-6",children:e.jsxs(I,{children:[e.jsx(K,{children:e.jsx(W,{children:"Performance Trends"})}),e.jsx($,{children:e.jsx("div",{className:"space-y-4",children:v.timeSeries.slice(0,10).map((o,p)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{className:"w-4 h-4 text-slate-500"}),e.jsx("span",{className:"font-medium",children:o.date})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold",children:o.sessions}),e.jsx("div",{className:"text-slate-500",children:"Sessions"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold",children:o.attendance}),e.jsx("div",{className:"text-slate-500",children:"Attendance"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold",children:_(o.revenue)}),e.jsx("div",{className:"text-slate-500",children:"Revenue"})]})]})]},o.date))})})]})}),e.jsx(se,{value:"insights",className:"space-y-6 mt-6",children:e.jsxs("div",{className:"space-y-4",children:[v.recommendations.map((o,p)=>e.jsx(I,{className:te("border-l-4",o.type==="success"?"border-l-green-500 bg-green-50":o.type==="warning"?"border-l-yellow-500 bg-yellow-50":o.type==="improvement"?"border-l-blue-500 bg-blue-50":"border-l-red-500 bg-red-50"),children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:te("p-2 rounded-lg",o.type==="success"?"bg-green-100 text-green-700":o.type==="warning"?"bg-yellow-100 text-yellow-700":o.type==="improvement"?"bg-blue-100 text-blue-700":"bg-red-100 text-red-700"),children:e.jsx(o.icon,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-slate-900",children:o.title}),e.jsxs(z,{variant:"outline",className:"text-xs",children:[o.impact," Impact"]})]}),e.jsx("p",{className:"text-sm text-slate-600",children:o.description})]})]})})},p)),v.recommendations.length===0&&e.jsx(I,{className:"border-l-4 border-l-green-500 bg-green-50",children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(He,{className:"w-4 h-4 text-green-700"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900",children:"Great Performance!"}),e.jsx("p",{className:"text-sm text-slate-600",children:"This segment is performing well across all key metrics. Keep up the excellent work!"})]})]})})})]})})]})]})})},Dt=({data:i,selectedLocation:T,onLocationChange:j,children:V})=>{const k=A.useMemo(()=>{const b=new Map;i.forEach(C=>{const y=C.location||"Unknown",R=b.get(y)||{count:0,attendance:0};b.set(y,{count:R.count+1,attendance:R.attendance+(C.checkedInCount||0)})});const x=Array.from(b.entries()).map(([C,y])=>({location:C,...y}));return x.sort((C,y)=>y.count-C.count),x},[i]),v=i.length,N=i.reduce((b,x)=>b+(x.checkedInCount||0),0),o=A.useMemo(()=>T==="all"?i:i.filter(b=>b.location===T),[i,T]),p=b=>b==="all"?e.jsx(xs,{className:"w-4 h-4"}):b.toLowerCase().includes("studio")?e.jsx(ws,{className:"w-4 h-4"}):e.jsx(we,{className:"w-4 h-4"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-1",children:"Location Filter"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Select a location to filter all analytics and tables below"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:k.length}),e.jsx("div",{className:"text-xs text-slate-500",children:"Active Locations"})]})]}),e.jsxs(Re,{value:T,onValueChange:j,className:"w-full",children:[e.jsxs(ze,{className:"grid w-full bg-slate-100 p-1 rounded-lg",style:{gridTemplateColumns:`repeat(${Math.min(k.length+1,6)}, 1fr)`},children:[e.jsxs(H,{value:"all",className:te("flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-md transition-all","data-[state=active]:bg-blue-500 data-[state=active]:text-white","data-[state=inactive]:text-slate-700 data-[state=inactive]:hover:text-slate-900"),children:[e.jsx(xs,{className:"w-4 h-4"}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{children:"All Locations"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs opacity-75",children:[e.jsx(z,{variant:"secondary",className:"text-xs px-1 py-0",children:v}),e.jsx(X,{className:"w-3 h-3"}),e.jsx("span",{children:N})]})]})]}),k.slice(0,5).map(b=>e.jsxs(H,{value:b.location,className:te("flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-md transition-all","data-[state=active]:bg-blue-500 data-[state=active]:text-white","data-[state=inactive]:text-slate-700 data-[state=inactive]:hover:text-slate-900"),children:[p(b.location),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"truncate max-w-[100px]",children:b.location}),e.jsxs("div",{className:"flex items-center gap-2 text-xs opacity-75",children:[e.jsx(z,{variant:"secondary",className:"text-xs px-1 py-0",children:b.count}),e.jsx(X,{className:"w-3 h-3"}),e.jsx("span",{children:b.attendance})]})]})]},b.location)),k.length>5&&e.jsx(H,{value:"more",className:"flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-md",disabled:!0,children:e.jsxs("span",{children:["+",k.length-5," more"]})})]}),e.jsx(se,{value:"all",className:"mt-6",children:V(o)}),k.map(b=>e.jsx(se,{value:b.location,className:"mt-6",children:V(o)},b.location))]})]}),T!=="all"&&e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[p(T),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900",children:T}),e.jsxs("p",{className:"text-sm text-slate-600",children:["Showing ",o.length," sessions with ",o.reduce((b,x)=>b+(x.checkedInCount||0),0)," total attendees"]})]}),e.jsx(G,{variant:"outline",size:"sm",onClick:()=>j("all"),className:"ml-auto",children:"View All Locations"})]})})]})},lt=({data:i,onMetricClick:T})=>{const V=(o=>{const p=o.length,b=o.filter(u=>u.status==="Active").length,x=o.filter(u=>u.status==="Churned").length,C=o.filter(u=>u.status==="Frozen").length,y=p>0?x/p*100:0,R=p>0?b/p*100:0,D=p>0?C/p*100:0,P=o.filter(u=>u.status==="Churned"&&u.paid&&u.paid!=="-"),w=P.length>0?P.reduce((u,m)=>{const n=parseFloat(m.paid?.toString().replace(/[^0-9.-]/g,"")||"0");return u+(isNaN(n)?0:n)},0):0;return[{title:"Total Memberships",value:M(p),change:0,description:"All tracked membership records",calculation:"Count of all membership records",icon:"Users",rawValue:p},{title:"Active Members",value:M(b),change:0,description:`${J(R)} of total memberships`,calculation:"Count of active status",icon:"CheckCircle",rawValue:b},{title:"Churned Members",value:M(x),change:0,description:`${J(y)} churn rate`,calculation:"Count of churned status",icon:"AlertTriangle",rawValue:x},{title:"Frozen Members",value:M(C),change:0,description:`${J(D)} of total memberships`,calculation:"Count of frozen status",icon:"Clock",rawValue:C},{title:"Revenue Impact",value:`₹${M(w)}`,change:0,description:`Loss from ${P.length} churned members`,calculation:"Sum of paid amounts for churned members",icon:"TrendingUp",rawValue:w}]})(i),k=o=>{switch(o){case"Users":return X;case"CheckCircle":return Bs;case"AlertTriangle":return Le;case"Clock":return $e;default:return xe}},v=(o,p)=>["from-blue-500 to-blue-600","from-green-500 to-green-600","from-red-500 to-red-600","from-yellow-500 to-yellow-600","from-purple-500 to-purple-600"][p]||"from-slate-500 to-slate-600",N=o=>o.title==="Active Members"?i.filter(p=>p.status==="Active"):o.title==="Churned Members"?i.filter(p=>p.status==="Churned"):o.title==="Frozen Members"?i.filter(p=>p.status==="Frozen"):i;return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8",children:V.map((o,p)=>{const b=k(o.icon),x=v(o,p);return e.jsx(I,{className:te("relative overflow-hidden border-0 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:scale-105","bg-gradient-to-br",x),onClick:()=>{const C=N(o);T?.(C,o.title.toLowerCase())},children:e.jsxs($,{className:"p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg backdrop-blur-sm",children:e.jsx(b,{className:"w-6 h-6 text-white"})}),e.jsx(z,{className:"bg-white/20 text-white border-0 backdrop-blur-sm",children:p===0?"Total":p===1?"Active":p===2?"Churned":p===3?"Frozen":"Revenue"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-3xl font-bold text-white",children:o.value}),e.jsx("div",{className:"text-white/90 font-medium",children:o.title}),e.jsx("div",{className:"text-white/70 text-sm",children:o.description})]}),e.jsx("div",{className:"absolute -right-4 -bottom-4 w-24 h-24 bg-white/10 rounded-full"}),e.jsx("div",{className:"absolute -right-2 -bottom-2 w-16 h-16 bg-white/5 rounded-full"})]})},p)})})},it=({isOpen:i,onClose:T,data:j,type:V})=>{if(!j)return null;const k=Array.isArray(j)&&j.length>0&&j[0].hasOwnProperty("status"),v=()=>{if(!k)return null;const D=j,P=D.filter(m=>m.status==="Active").length,w=D.filter(m=>m.status==="Churned").length,u=D.filter(m=>m.status==="Frozen").length;return e.jsxs(I,{className:"bg-gradient-to-br from-slate-50 to-slate-100 border-slate-200",children:[e.jsx(K,{children:e.jsxs(W,{className:"flex items-center gap-2 text-slate-800",children:[e.jsx(X,{className:"w-5 h-5"}),"Member Details (",D.length," total)"]})}),e.jsxs($,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:P}),e.jsx("div",{className:"text-sm text-green-600",children:"Active"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:w}),e.jsx("div",{className:"text-sm text-red-600",children:"Churned"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:u}),e.jsx("div",{className:"text-sm text-yellow-600",children:"Frozen"})]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:D.slice(0,50).map((m,n)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-slate-800",children:[m.firstName," ",m.lastName]}),e.jsxs("div",{className:"text-sm text-slate-600",children:[m.email," • ",m.membershipName]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-sm font-medium ${m.status==="Active"?"text-green-600":m.status==="Churned"?"text-red-600":"text-yellow-600"}`,children:m.status}),e.jsxs("div",{className:"text-xs text-slate-500",children:["End: ",m.endDate]})]})]},n))})]})]})},N=(D,P=0)=>{const w=Number(D);return isNaN(w)?P:w},p=(()=>{const D=j.filteredTransactionData||j.rawData||j.transactionData||[];if(V==="product"&&j.name){const P=j.name;let w=D;return!j.filteredTransactionData&&D.length>0&&(w=D.filter(u=>u.productName===P||u.membershipName===P||u.itemName===P||u.cleanedProduct===P||u.paymentItem===P)),{...j,filteredData:w,specificRevenue:j.specificRevenue||w.reduce((u,m)=>u+(m.paymentValue||0),0),specificTransactions:j.specificTransactions||w.length,specificCustomers:j.specificCustomers||new Set(w.map(u=>u.memberId||u.customerEmail)).size}}if(V==="category"&&j.name){const P=j.name;let w=D;return!j.filteredTransactionData&&D.length>0&&(w=D.filter(u=>u.cleanedCategory===P||u.category===P)),{...j,filteredData:w,specificRevenue:j.specificRevenue||w.reduce((u,m)=>u+(m.paymentValue||0),0),specificTransactions:j.specificTransactions||w.length,specificCustomers:j.specificCustomers||new Set(w.map(u=>u.memberId||u.customerEmail)).size}}return V==="trainer"&&j.teacherName?{name:j.teacherName,location:j.location,classType:j.classType||"Mixed",totalSessions:j.sessions||j.totalSessions||0,totalRevenue:j.revenue||j.totalPaid||0,totalCustomers:j.customers||j.totalCustomers||0,utilization:j.utilization||0,avgCheckedIn:j.avgCheckedIn||0,cancellationRate:j.cancellationRate||0}:{...j,filteredData:D,specificRevenue:j.specificRevenue,specificTransactions:j.specificTransactions,specificCustomers:j.specificCustomers}})(),b=()=>{const D=N(p.specificRevenue||p.totalRevenue||p.revenue||p.grossRevenue),P=N(p.specificTransactions||p.transactions||p.totalTransactions),w=N(p.specificCustomers||p.uniqueMembers||p.totalCustomers||p.customers),u=N(p.totalChange||p.change||p.growth);return e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(I,{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white border-0 shadow-lg",children:e.jsxs($,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(qe,{className:"w-5 h-5 text-blue-100"}),e.jsx(z,{className:"bg-white/20 text-white border-0",children:"Revenue"})]}),e.jsx("div",{className:"text-2xl font-bold",children:_(D)}),e.jsx("div",{className:"text-blue-100 text-sm",children:"Total Revenue"})]})}),e.jsx(I,{className:"bg-gradient-to-br from-green-500 to-green-600 text-white border-0 shadow-lg",children:e.jsxs($,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(X,{className:"w-5 h-5 text-green-100"}),e.jsx(z,{className:"bg-white/20 text-white border-0",children:"Customers"})]}),e.jsx("div",{className:"text-2xl font-bold",children:M(w)}),e.jsx("div",{className:"text-green-100 text-sm",children:"Unique Customers"})]})}),e.jsx(I,{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white border-0 shadow-lg",children:e.jsxs($,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Us,{className:"w-5 h-5 text-purple-100"}),e.jsx(z,{className:"bg-white/20 text-white border-0",children:"Volume"})]}),e.jsx("div",{className:"text-2xl font-bold",children:M(P)}),e.jsx("div",{className:"text-purple-100 text-sm",children:"Transactions"})]})}),e.jsx(I,{className:"bg-gradient-to-br from-orange-500 to-orange-600 text-white border-0 shadow-lg",children:e.jsxs($,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u>=0?e.jsx(xe,{className:"w-5 h-5 text-orange-100"}):e.jsx(Be,{className:"w-5 h-5 text-orange-100"}),e.jsx(z,{className:"bg-white/20 text-white border-0",children:"Growth"})]}),e.jsx("div",{className:"text-2xl font-bold",children:u!==0?`${u>0?"+":""}${u.toFixed(1)}%`:"N/A"}),e.jsx("div",{className:"text-orange-100 text-sm",children:"Performance"})]})})]})},x=()=>V!=="trainer"?null:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(I,{className:"bg-gradient-to-br from-slate-50 to-slate-100 border-slate-200",children:[e.jsx(K,{children:e.jsxs(W,{className:"flex items-center gap-2 text-slate-800",children:[e.jsx(Ee,{className:"w-5 h-5"}),"Class Performance"]})}),e.jsx($,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("div",{className:"text-sm text-slate-600",children:"Total Sessions"}),e.jsx("div",{className:"text-xl font-bold text-slate-800",children:M(p.totalSessions)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("div",{className:"text-sm text-slate-600",children:"Avg Check-in"}),e.jsx("div",{className:"text-xl font-bold text-blue-600",children:M(p.avgCheckedIn)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("div",{className:"text-sm text-slate-600",children:"Utilization"}),e.jsx("div",{className:`text-xl font-bold ${p.utilization>=80?"text-green-600":"text-orange-600"}`,children:J(p.utilization/100)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("div",{className:"text-sm text-slate-600",children:"Cancellation Rate"}),e.jsx("div",{className:`text-xl font-bold ${p.cancellationRate<=10?"text-green-600":"text-red-600"}`,children:J(p.cancellationRate/100)})]})]})})]}),e.jsxs(I,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx(K,{children:e.jsxs(W,{className:"flex items-center gap-2 text-blue-800",children:[e.jsx(Oe,{className:"w-5 h-5"}),"Performance Insights"]})}),e.jsxs($,{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 bg-white rounded-lg border-l-4 border-blue-400",children:[e.jsx("div",{className:"text-sm font-medium text-blue-800",children:"Class Type"}),e.jsx("div",{className:"text-blue-600",children:p.classType})]}),e.jsxs("div",{className:"p-3 bg-white rounded-lg border-l-4 border-green-400",children:[e.jsx("div",{className:"text-sm font-medium text-green-800",children:"Revenue/Session"}),e.jsx("div",{className:"text-green-600",children:_(p.totalSessions>0?p.totalRevenue/p.totalSessions:0)})]}),e.jsxs("div",{className:"p-3 bg-white rounded-lg border-l-4 border-purple-400",children:[e.jsx("div",{className:"text-sm font-medium text-purple-800",children:"Customer/Session"}),e.jsx("div",{className:"text-purple-600",children:(p.totalSessions>0?p.totalCustomers/p.totalSessions:0).toFixed(1)})]})]})]})]}),C=()=>{const D=p.filteredData||p.rawData||[];return D.length===0?null:e.jsxs(I,{className:"bg-gradient-to-br from-slate-50 to-slate-100",children:[e.jsx(K,{children:e.jsxs(W,{className:"flex items-center gap-2 text-slate-800",children:[e.jsx(ve,{className:"w-5 h-5"}),"Transaction Details"]})}),e.jsxs($,{children:[e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:D.slice(0,20).map((P,w)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-slate-800",children:P.membershipName||P.productName||P.itemName||"Transaction"}),e.jsxs("div",{className:"text-sm text-slate-600",children:[P.customerEmail||P.memberId," • ",P.date||"N/A"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-slate-800",children:_(P.paymentValue||P.amount||0)}),e.jsx("div",{className:"text-sm text-slate-600",children:P.paymentMethod||"N/A"})]})]},w))}),D.length>20&&e.jsxs("div",{className:"mt-4 text-center text-sm text-slate-600",children:["Showing 20 of ",D.length," transactions"]})]})]})},y=()=>V==="trainer"?`${p.name} - Trainer Performance`:V==="product"?`${p.name} - Product Analysis`:V==="class"?`${p.classType||"Class"} - Detailed Analytics`:`${p.name||"Item"} - Performance Analysis`,R=()=>V==="trainer"?`${p.location} • ${p.classType} Classes`:V==="product"?"Comprehensive product performance and customer insights":"Detailed performance breakdown and analytics";return e.jsx(Je,{open:i,onOpenChange:T,children:e.jsxs(_e,{className:"max-w-7xl max-h-[95vh] overflow-y-auto bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-2xl",children:[e.jsx(Xe,{className:"pb-6 border-b border-slate-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Qe,{className:"text-3xl font-bold bg-gradient-to-r from-slate-800 via-blue-600 to-purple-600 bg-clip-text text-transparent",children:y()}),e.jsx("p",{className:"text-slate-600 mt-2 text-lg",children:R()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"bg-blue-100 text-blue-800 border-0",children:V==="trainer"?"Trainer":V==="product"?"Product":"Analytics"}),e.jsx(G,{variant:"outline",onClick:T,children:"Close"})]})]})}),e.jsxs("div",{className:"pt-6 space-y-8",children:[b(),e.jsxs(Re,{defaultValue:"overview",className:"w-full",children:[e.jsxs(ze,{className:"grid w-full grid-cols-4 bg-slate-100",children:[e.jsxs(H,{value:"overview",className:"gap-2",children:[e.jsx(ks,{className:"w-4 h-4"}),"Overview"]}),e.jsxs(H,{value:"performance",className:"gap-2",children:[e.jsx(xe,{className:"w-4 h-4"}),"Performance"]}),e.jsxs(H,{value:"details",className:"gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Details"]}),e.jsxs(H,{value:"insights",className:"gap-2",children:[e.jsx(Cs,{className:"w-4 h-4"}),"Insights"]})]}),e.jsxs(se,{value:"overview",className:"space-y-6",children:[v(),x(),e.jsxs(I,{className:"bg-gradient-to-br from-indigo-50 to-indigo-100 border-indigo-200",children:[e.jsx(K,{children:e.jsx(W,{className:"text-indigo-800",children:"Summary Statistics"})}),e.jsx($,{children:e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:_(p.specificRevenue||p.totalRevenue||0)}),e.jsx("div",{className:"text-sm text-indigo-600",children:"Total Revenue"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:M(p.specificTransactions||p.transactions||0)}),e.jsx("div",{className:"text-sm text-green-600",children:"Transactions"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:M(p.specificCustomers||p.customers||0)}),e.jsx("div",{className:"text-sm text-purple-600",children:"Customers"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:_((p.specificTransactions||p.transactions)>0?(p.specificRevenue||p.totalRevenue||0)/(p.specificTransactions||p.transactions||1):0)}),e.jsx("div",{className:"text-sm text-orange-600",children:"Avg Transaction"})]})]})})]})]}),e.jsx(se,{value:"performance",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(I,{className:"bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsx(K,{children:e.jsx(W,{className:"text-green-800",children:"Performance Metrics"})}),e.jsxs($,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white rounded-lg",children:[e.jsx("span",{className:"text-green-700",children:"Revenue Growth"}),e.jsxs(z,{className:"bg-green-200 text-green-800",children:[p.totalChange>0?"+":"",p.totalChange?.toFixed(1)||0,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white rounded-lg",children:[e.jsx("span",{className:"text-green-700",children:"Performance Rating"}),e.jsx(z,{className:"bg-green-200 text-green-800",children:(p.specificRevenue||p.totalRevenue||0)>5e4?"Excellent":"Good"})]})]})]}),e.jsxs(I,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx(K,{children:e.jsx(W,{className:"text-blue-800",children:"Key Insights"})}),e.jsxs($,{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 bg-white rounded-lg border-l-4 border-blue-400",children:[e.jsx("div",{className:"text-sm font-medium text-blue-800",children:"Market Position"}),e.jsx("div",{className:"text-blue-600",children:"Strong performer in category"})]}),e.jsxs("div",{className:"p-3 bg-white rounded-lg border-l-4 border-green-400",children:[e.jsx("div",{className:"text-sm font-medium text-green-800",children:"Customer Loyalty"}),e.jsx("div",{className:"text-green-600",children:"High retention rate"})]})]})]})]})}),e.jsx(se,{value:"details",children:C()}),e.jsx(se,{value:"insights",children:e.jsxs(I,{className:"bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx(K,{children:e.jsx(W,{className:"text-purple-800",children:"AI-Powered Insights"})}),e.jsx($,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-white rounded-lg border-l-4 border-purple-400",children:[e.jsx("h4",{className:"font-medium text-purple-800 mb-2",children:"Strengths"}),e.jsxs("ul",{className:"text-sm text-purple-600 space-y-1",children:[e.jsx("li",{children:"• Consistent revenue performance"}),e.jsx("li",{children:"• Strong customer engagement"}),e.jsx("li",{children:"• Effective conversion rates"})]})]}),e.jsxs("div",{className:"p-4 bg-white rounded-lg border-l-4 border-orange-400",children:[e.jsx("h4",{className:"font-medium text-orange-800 mb-2",children:"Opportunities"}),e.jsxs("ul",{className:"text-sm text-orange-600 space-y-1",children:[e.jsx("li",{children:"• Expand successful programs"}),e.jsx("li",{children:"• Optimize capacity utilization"}),e.jsx("li",{children:"• Enhance retention strategies"})]})]})]})})]})})]})]})]})})},fs=["#6366f1","#8b5cf6","#ec4899","#f59e0b","#10b981","#ef4444","#06b6d4","#84cc16"],ct=({data:i})=>{const T=i.reduce((b,x)=>{const C=x.status||"Unknown";return b[C]=(b[C]||0)+1,b},{}),j=Object.entries(T).map(([b,x])=>({name:b,value:x})),V=i.reduce((b,x)=>{const C=x.membershipName||"Unknown";return b[C]=(b[C]||0)+1,b},{}),k=Object.entries(V).map(([b,x])=>({name:b.length>20?b.substring(0,20)+"...":b,value:x})).sort((b,x)=>x.value-b.value).slice(0,8),v=i.reduce((b,x)=>{if(x.endDate){const C=new Date(x.endDate).toLocaleDateString("en-US",{month:"short",year:"2-digit"});b[C]=(b[C]||0)+1}return b},{}),N=Object.entries(v).map(([b,x])=>({month:b,count:x})).sort((b,x)=>b.month.localeCompare(x.month)).slice(0,12),o=i.reduce((b,x)=>{const C=x.homeLocation||"Unknown",y=x.status||"Unknown";return b[C]||(b[C]={}),b[C][y]=(b[C][y]||0)+1,b},{}),p=Object.entries(o).map(([b,x])=>({location:b.length>15?b.substring(0,15)+"...":b,...x}));return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs(I,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full"}),"Membership Status Distribution"]})}),e.jsx($,{children:e.jsx(Ne,{width:"100%",height:300,children:e.jsxs(Ts,{children:[e.jsx(As,{data:j,cx:"50%",cy:"50%",labelLine:!1,label:({name:b,percent:x})=>`${b} ${(x*100).toFixed(1)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:j.map((b,x)=>e.jsx(Rs,{fill:fs[x%fs.length]},`cell-${x}`))}),e.jsx(ye,{formatter:b=>[M(b),"Count"]})]})})})]}),e.jsxs(I,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-green-500 to-blue-500 rounded-full"}),"Top Membership Types"]})}),e.jsx($,{children:e.jsx(Ne,{width:"100%",height:300,children:e.jsxs(We,{data:k,layout:"horizontal",children:[e.jsx(Pe,{strokeDasharray:"3 3"}),e.jsx(Fe,{type:"number"}),e.jsx(Ie,{dataKey:"name",type:"category",width:100}),e.jsx(ye,{formatter:b=>[M(b),"Members"]}),e.jsx(De,{dataKey:"value",fill:"#6366f1"})]})})})]}),e.jsxs(I,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full"}),"Monthly Expiration Trend"]})}),e.jsx($,{children:e.jsx(Ne,{width:"100%",height:300,children:e.jsxs(Vs,{data:N,children:[e.jsx(Pe,{strokeDasharray:"3 3"}),e.jsx(Fe,{dataKey:"month"}),e.jsx(Ie,{}),e.jsx(ye,{formatter:b=>[M(b),"Expirations"]}),e.jsx(Ge,{type:"monotone",dataKey:"count",stroke:"#8b5cf6",fill:"#8b5cf6",fillOpacity:.3})]})})})]}),e.jsxs(I,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-orange-500 to-red-500 rounded-full"}),"Status by Location"]})}),e.jsx($,{children:e.jsx(Ne,{width:"100%",height:300,children:e.jsxs(We,{data:p,children:[e.jsx(Pe,{strokeDasharray:"3 3"}),e.jsx(Fe,{dataKey:"location"}),e.jsx(Ie,{}),e.jsx(ye,{}),e.jsx(Ps,{}),e.jsx(De,{dataKey:"Active",stackId:"a",fill:"#10b981"}),e.jsx(De,{dataKey:"Churned",stackId:"a",fill:"#ef4444"}),e.jsx(De,{dataKey:"Frozen",stackId:"a",fill:"#f59e0b"})]})})})]})]})},ot=({data:i,onRowClick:T})=>{const[j,V]=A.useState(""),[k,v]=A.useState("endDate"),[N,o]=A.useState("asc"),p=u=>{k===u?o(N==="asc"?"desc":"asc"):(v(u),o("asc"))},b=i.filter(u=>{const m=j.toLowerCase();return u.firstName?.toLowerCase().includes(m)||u.lastName?.toLowerCase().includes(m)||u.email?.toLowerCase().includes(m)||u.membershipName?.toLowerCase().includes(m)||u.status?.toLowerCase().includes(m)}).sort((u,m)=>{const n=u[k]||"",t=m[k]||"",c=N==="asc"?1:-1;return n.localeCompare(t)*c}),x=b.filter(u=>u.status==="Churned"),C=b.filter(u=>u.status==="Frozen"),y=b.filter(u=>u.status==="Active"),R=i.reduce((u,m)=>{const n=m.membershipName||"Unknown";return u[n]||(u[n]={name:n,total:0,active:0,churned:0,frozen:0}),u[n].total++,m.status==="Active"&&u[n].active++,m.status==="Churned"&&u[n].churned++,m.status==="Frozen"&&u[n].frozen++,u},{}),D=Object.values(R).sort((u,m)=>m.total-u.total),P=({field:u,children:m})=>e.jsxs(G,{variant:"ghost",size:"sm",onClick:()=>p(u),className:"h-auto p-1 font-medium text-slate-700 hover:text-slate-900",children:[m,k===u&&(N==="asc"?e.jsx(Ms,{className:"ml-1 h-3 w-3"}):e.jsx(Ds,{className:"ml-1 h-3 w-3"}))]}),w=u=>e.jsx(z,{variant:"outline",className:te("text-xs",u==="Churned"?"border-red-200 bg-red-50 text-red-700":u==="Frozen"?"border-yellow-200 bg-yellow-50 text-yellow-700":"border-green-200 bg-green-50 text-green-700"),children:u});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(I,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg",children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ss,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 h-4 w-4"}),e.jsx(Ae,{placeholder:"Search by name, email, membership, or status...",value:j,onChange:u=>V(u.target.value),className:"pl-10 border-slate-300 focus:border-blue-500 focus:ring-blue-500"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(I,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-red-600 to-red-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),"Churned Memberships (",M(x.length),")"]})}),e.jsx($,{children:e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-white/90",children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(P,{field:"firstName",children:"Member"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(P,{field:"membershipName",children:"Membership"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(P,{field:"endDate",children:"End Date"})}),e.jsx("th",{className:"text-left py-2 px-3",children:"Status"})]})}),e.jsx("tbody",{children:x.slice(0,50).map((u,m)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50 cursor-pointer",onClick:()=>T?.(u),children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:`${u.firstName} ${u.lastName}`}),e.jsx("td",{className:"py-2 px-3 text-slate-600 text-xs",children:u.membershipName}),e.jsx("td",{className:"py-2 px-3 text-slate-600",children:u.endDate}),e.jsx("td",{className:"py-2 px-3",children:w(u.status)})]},m))})]})})})]}),e.jsxs(I,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-yellow-600 to-yellow-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),"Frozen Memberships (",M(C.length),")"]})}),e.jsx($,{children:e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-white/90",children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(P,{field:"firstName",children:"Member"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(P,{field:"membershipName",children:"Membership"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(P,{field:"endDate",children:"End Date"})}),e.jsx("th",{className:"text-left py-2 px-3",children:"Status"})]})}),e.jsx("tbody",{children:C.slice(0,50).map((u,m)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50 cursor-pointer",onClick:()=>T?.(u),children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:`${u.firstName} ${u.lastName}`}),e.jsx("td",{className:"py-2 px-3 text-slate-600 text-xs",children:u.membershipName}),e.jsx("td",{className:"py-2 px-3 text-slate-600",children:u.endDate}),e.jsx("td",{className:"py-2 px-3",children:w(u.status)})]},m))})]})})})]}),e.jsxs(I,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-green-600 to-green-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Active Memberships (",M(y.length),")"]})}),e.jsx($,{children:e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-white/90",children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(P,{field:"firstName",children:"Member"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(P,{field:"membershipName",children:"Membership"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(P,{field:"endDate",children:"End Date"})}),e.jsx("th",{className:"text-left py-2 px-3",children:"Status"})]})}),e.jsx("tbody",{children:y.slice(0,50).map((u,m)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50 cursor-pointer",onClick:()=>T?.(u),children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:`${u.firstName} ${u.lastName}`}),e.jsx("td",{className:"py-2 px-3 text-slate-600 text-xs",children:u.membershipName}),e.jsx("td",{className:"py-2 px-3 text-slate-600",children:u.endDate}),e.jsx("td",{className:"py-2 px-3",children:w(u.status)})]},m))})]})})})]}),e.jsxs(I,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-slate-500 to-slate-600 rounded-full"}),"Membership Type Summary"]})}),e.jsx($,{children:e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-white/90",children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium text-slate-700",children:"Membership"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-slate-700",children:"Total"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-green-600",children:"Active"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-yellow-600",children:"Frozen"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-red-600",children:"Churned"})]})}),e.jsx("tbody",{children:D.map((u,m)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50",children:[e.jsx("td",{className:"py-2 px-3 font-medium text-xs",children:u.name}),e.jsx("td",{className:"py-2 px-3 text-center font-medium",children:M(u.total)}),e.jsx("td",{className:"py-2 px-3 text-center text-green-600",children:M(u.active)}),e.jsx("td",{className:"py-2 px-3 text-center text-yellow-600",children:M(u.frozen)}),e.jsx("td",{className:"py-2 px-3 text-center text-red-600",children:M(u.churned)})]},m))})]})})})]})]})]})},dt=({data:i})=>{const T=i.reduce((x,C)=>{const y=C.homeLocation||"Unknown";return x[y]||(x[y]={name:y,total:0,active:0,churned:0,frozen:0,churnRate:0}),x[y].total++,C.status==="Active"&&x[y].active++,C.status==="Churned"&&x[y].churned++,C.status==="Frozen"&&x[y].frozen++,x},{});Object.values(T).forEach(x=>{x.churnRate=x.total>0?x.churned/x.total*100:0});const j=Object.values(T).sort((x,C)=>C.total-x.total),V=i.reduce((x,C)=>{const y=C.soldBy||"Unknown";return x[y]||(x[y]={name:y,total:0,active:0,churned:0,frozen:0,churnRate:0}),x[y].total++,C.status==="Active"&&x[y].active++,C.status==="Churned"&&x[y].churned++,C.status==="Frozen"&&x[y].frozen++,x},{});Object.values(V).forEach(x=>{x.churnRate=x.total>0?x.churned/x.total*100:0});const k=Object.values(V).filter(x=>x.name!=="Unknown"&&x.name!=="-").sort((x,C)=>C.total-x.total).slice(0,10),v=i.reduce((x,C)=>{if(C.endDate)try{const y=new Date(C.endDate),R=Ke(y,"MMM yyyy");x[R]||(x[R]={month:R,active:0,churned:0,frozen:0,total:0}),x[R].total++,C.status==="Active"&&x[R].active++,C.status==="Churned"&&x[R].churned++,C.status==="Frozen"&&x[R].frozen++}catch{}return x},{}),N=Object.values(v).sort((x,C)=>new Date(x.month).getTime()-new Date(C.month).getTime()).slice(-12),o=i.reduce((x,C)=>{const y=parseFloat(C.paid)||0,R=y>=1e4?"High Value (₹10K+)":y>=5e3?"Medium Value (₹5K-10K)":"Low Value (<₹5K)";return x[R]||(x[R]={category:R,total:0,active:0,churned:0,frozen:0,churnRate:0}),x[R].total++,C.status==="Active"&&x[R].active++,C.status==="Churned"&&x[R].churned++,C.status==="Frozen"&&x[R].frozen++,x},{});Object.values(o).forEach(x=>{x.churnRate=x.total>0?x.churned/x.total*100:0});const p=Object.values(o),b=x=>x>=50?"text-red-600":x>=30?"text-yellow-600":"text-green-600";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(I,{className:"bg-white/70 backdrop-blur-sm border-slate-200/50",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Location Performance Analysis"})}),e.jsx($,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx(Ne,{width:"100%",height:300,children:e.jsxs(We,{data:j,children:[e.jsx(Pe,{strokeDasharray:"3 3"}),e.jsx(Fe,{dataKey:"name",angle:-45,textAnchor:"end",height:100,fontSize:12}),e.jsx(Ie,{}),e.jsx(ye,{}),e.jsx(Ps,{}),e.jsx(De,{dataKey:"active",stackId:"a",fill:"#10b981",name:"Active"}),e.jsx(De,{dataKey:"frozen",stackId:"a",fill:"#f59e0b",name:"Frozen"}),e.jsx(De,{dataKey:"churned",stackId:"a",fill:"#ef4444",name:"Churned"})]})})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium text-slate-700",children:"Location"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-slate-700",children:"Total"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-slate-700",children:"Churn Rate"})]})}),e.jsx("tbody",{children:j.map((x,C)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50",children:[e.jsx("td",{className:"py-2 px-3 font-medium text-xs",children:x.name}),e.jsx("td",{className:"py-2 px-3 text-center",children:M(x.total)}),e.jsx("td",{className:`py-2 px-3 text-center font-medium ${b(x.churnRate)}`,children:J(x.churnRate)})]},C))})]})})]})})]}),e.jsxs(I,{className:"bg-white/70 backdrop-blur-sm border-slate-200/50",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Top Sales Representatives by Membership Volume"})}),e.jsx($,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium text-slate-700",children:"Sales Rep"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-slate-700",children:"Total Sold"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-green-600",children:"Active"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-yellow-600",children:"Frozen"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-red-600",children:"Churned"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-slate-700",children:"Churn Rate"})]})}),e.jsx("tbody",{children:k.map((x,C)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50",children:[e.jsx("td",{className:"py-2 px-3 font-medium text-xs",children:x.name}),e.jsx("td",{className:"py-2 px-3 text-center font-medium",children:M(x.total)}),e.jsx("td",{className:"py-2 px-3 text-center text-green-600",children:M(x.active)}),e.jsx("td",{className:"py-2 px-3 text-center text-yellow-600",children:M(x.frozen)}),e.jsx("td",{className:"py-2 px-3 text-center text-red-600",children:M(x.churned)}),e.jsx("td",{className:`py-2 px-3 text-center font-medium ${b(x.churnRate)}`,children:J(x.churnRate)})]},C))})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(I,{className:"bg-white/70 backdrop-blur-sm border-slate-200/50",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Monthly Status Trend"})}),e.jsx($,{children:e.jsx(Ne,{width:"100%",height:300,children:e.jsxs(Vs,{data:N,children:[e.jsx(Pe,{strokeDasharray:"3 3"}),e.jsx(Fe,{dataKey:"month",fontSize:12}),e.jsx(Ie,{}),e.jsx(ye,{}),e.jsx(Ge,{type:"monotone",dataKey:"churned",stackId:"1",stroke:"#ef4444",fill:"#ef4444"}),e.jsx(Ge,{type:"monotone",dataKey:"frozen",stackId:"1",stroke:"#f59e0b",fill:"#f59e0b"}),e.jsx(Ge,{type:"monotone",dataKey:"active",stackId:"1",stroke:"#10b981",fill:"#10b981"})]})})})]}),e.jsxs(I,{className:"bg-white/70 backdrop-blur-sm border-slate-200/50",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Value Segment Performance"})}),e.jsx($,{children:e.jsx("div",{className:"space-y-4",children:p.map((x,C)=>e.jsxs("div",{className:"p-4 bg-slate-50/50 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-medium text-slate-700",children:x.category}),e.jsxs(z,{variant:"outline",className:`${b(x.churnRate)} border-current`,children:[J(x.churnRate)," Churn"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Total"}),e.jsx("div",{className:"font-medium",children:M(x.total)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-green-600",children:"Active"}),e.jsx("div",{className:"font-medium text-green-600",children:M(x.active)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-yellow-600",children:"Frozen"}),e.jsx("div",{className:"font-medium text-yellow-600",children:M(x.frozen)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-red-600",children:"Churned"}),e.jsx("div",{className:"font-medium text-red-600",children:M(x.churned)})]})]})]},C))})})]})]})]})},mt=({data:i,onRowClick:T})=>{const[j,V]=A.useState(""),[k,v]=A.useState("endDate"),[N,o]=A.useState("desc"),[p,b]=A.useState("all"),[x,C]=A.useState("all"),y=A.useMemo(()=>i.filter(t=>t.status==="Churned"),[i]),R=A.useMemo(()=>{const t=new Set(y.map(c=>c.homeLocation).filter(Boolean));return Array.from(t)},[y]),D=A.useMemo(()=>{const t=new Set(y.map(c=>c.membershipName).filter(Boolean));return Array.from(t)},[y]),P=t=>{k===t?o(N==="asc"?"desc":"asc"):(v(t),o("asc"))},w=A.useMemo(()=>y.filter(t=>{const c=j.toLowerCase(),d=t.firstName?.toLowerCase().includes(c)||t.lastName?.toLowerCase().includes(c)||t.email?.toLowerCase().includes(c)||t.membershipName?.toLowerCase().includes(c)||t.soldBy?.toLowerCase().includes(c),a=p==="all"||t.homeLocation===p,l=x==="all"||t.membershipName===x;return d&&a&&l}).sort((t,c)=>{let d=t[k]||"",a=c[k]||"";k==="endDate"?(d=new Date(d),a=new Date(a)):k==="paid"&&(d=parseFloat(d?.toString().replace(/[^0-9.-]/g,"")||"0"),a=parseFloat(a?.toString().replace(/[^0-9.-]/g,"")||"0"));const l=N==="asc"?1:-1;return d<a?-1*l:d>a?1*l:0}),[y,j,k,N,p,x]),u=A.useMemo(()=>{const t=w.reduce((d,a)=>{const l=parseFloat(a.paid?.toString().replace(/[^0-9.-]/g,"")||"0");return d+(isNaN(l)?0:l)},0),c=w.reduce((d,a)=>{const l=a.membershipName||"Unknown";return d[l]=(d[l]||0)+1,d},{});return{totalCount:w.length,totalRevenueLoss:t,membershipBreakdown:c}},[w]),m=({field:t,children:c})=>e.jsxs(G,{variant:"ghost",size:"sm",onClick:()=>P(t),className:"h-auto p-1 font-medium text-white hover:text-gray-200 hover:bg-white/10",children:[c,k===t&&(N==="asc"?e.jsx(Ms,{className:"ml-1 h-3 w-3"}):e.jsx(Ds,{className:"ml-1 h-3 w-3"}))]}),n=t=>{if(!t||t==="-")return"-";const c=parseFloat(t.toString().replace(/[^0-9.-]/g,"")||"0");return isNaN(c)?"-":_(c)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(I,{className:"bg-gradient-to-r from-red-500 to-red-600 text-white border-0 shadow-lg",children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Le,{className:"w-8 h-8"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:M(u.totalCount)}),e.jsx("div",{className:"text-red-100",children:"Churned Members"})]})]})})}),e.jsx(I,{className:"bg-gradient-to-r from-orange-500 to-orange-600 text-white border-0 shadow-lg",children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(qe,{className:"w-8 h-8"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:_(u.totalRevenueLoss)}),e.jsx("div",{className:"text-orange-100",children:"Revenue Impact"})]})]})})}),e.jsx(I,{className:"bg-gradient-to-r from-purple-500 to-purple-600 text-white border-0 shadow-lg",children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"w-8 h-8"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:Object.keys(u.membershipBreakdown).length}),e.jsx("div",{className:"text-purple-100",children:"Membership Types"})]})]})})})]}),e.jsx(I,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg",children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ss,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 h-4 w-4"}),e.jsx(Ae,{placeholder:"Search members...",value:j,onChange:t=>V(t.target.value),className:"pl-10 border-slate-300 focus:border-red-500 focus:ring-red-500"})]}),e.jsxs(pe,{value:p,onValueChange:b,children:[e.jsx(ge,{children:e.jsx(je,{placeholder:"Filter by location"})}),e.jsxs(be,{children:[e.jsx(ae,{value:"all",children:"All Locations"}),R.map(t=>e.jsx(ae,{value:t,children:t},t))]})]}),e.jsxs(pe,{value:x,onValueChange:C,children:[e.jsx(ge,{children:e.jsx(je,{placeholder:"Filter by membership"})}),e.jsxs(be,{children:[e.jsx(ae,{value:"all",children:"All Memberships"}),D.map(t=>e.jsx(ae,{value:t,children:t},t))]})]}),e.jsxs("div",{className:"text-sm text-slate-600 flex items-center",children:["Showing ",M(w.length)," of ",M(y.length)," churned members"]})]})})}),e.jsxs(I,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg",children:[e.jsx(K,{className:"bg-gradient-to-r from-red-600 to-red-700 text-white",children:e.jsxs(W,{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(Le,{className:"w-6 h-6"}),"Churned Members - Detailed Analysis"]})}),e.jsx($,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto max-h-[600px]",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-gradient-to-r from-red-600 to-red-700 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-4 min-w-[150px]",children:e.jsx(m,{field:"firstName",children:"Member Details"})}),e.jsx("th",{className:"text-left py-3 px-4 min-w-[200px]",children:e.jsx(m,{field:"membershipName",children:"Membership"})}),e.jsx("th",{className:"text-left py-3 px-4 min-w-[120px]",children:e.jsx(m,{field:"endDate",children:"End Date"})}),e.jsx("th",{className:"text-left py-3 px-4 min-w-[150px]",children:e.jsx(m,{field:"homeLocation",children:"Location"})}),e.jsx("th",{className:"text-right py-3 px-4 min-w-[100px]",children:e.jsx(m,{field:"paid",children:"Paid Amount"})}),e.jsx("th",{className:"text-left py-3 px-4 min-w-[120px]",children:e.jsx(m,{field:"soldBy",children:"Sold By"})}),e.jsx("th",{className:"text-center py-3 px-4",children:"Status"})]})}),e.jsx("tbody",{children:w.map((t,c)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-red-50/50 cursor-pointer transition-colors",onClick:()=>T?.(t),children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-slate-900",children:`${t.firstName} ${t.lastName}`}),e.jsx("div",{className:"text-xs text-slate-500",children:t.email}),e.jsxs("div",{className:"text-xs text-slate-400",children:["ID: ",t.memberId]})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-slate-700",children:t.membershipName}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Membership ID: ",t.membershipId]})]})}),e.jsx("td",{className:"py-3 px-4 text-slate-600",children:new Date(t.endDate).toLocaleDateString()}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[e.jsx(we,{className:"w-3 h-3"}),e.jsx("span",{className:"text-sm",children:t.homeLocation})]})}),e.jsx("td",{className:"py-3 px-4 text-right font-medium",children:n(t.paid)}),e.jsx("td",{className:"py-3 px-4 text-slate-600 text-sm",children:t.soldBy&&t.soldBy!=="-"?t.soldBy:"N/A"}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx(z,{variant:"outline",className:"border-red-200 bg-red-50 text-red-700",children:"Churned"})})]},t.uniqueId||c))})]})})})]})]})},vs=[{id:"all",name:"All Locations",fullName:"All Locations"},{id:"kwality",name:"Kwality House, Kemps Corner",fullName:"Kwality House, Kemps Corner"},{id:"supreme",name:"Supreme HQ, Bandra",fullName:"Supreme HQ, Bandra"},{id:"kenkere",name:"Kenkere House",fullName:"Kenkere House"}],Tt=({data:i})=>{const[T,j]=A.useState("all"),[V,k]=A.useState(null),[v,N]=A.useState("expiration"),[o,p]=A.useState(()=>({dateRange:bs(),location:[],status:[],membershipType:[],soldBy:[]})),b=u=>{let m=[...u];return T!=="all"&&(m=m.filter(n=>T==="kwality"?n.homeLocation==="Kwality House, Kemps Corner":T==="supreme"?n.homeLocation==="Supreme HQ, Bandra":n.homeLocation?.includes("Kenkere")||n.homeLocation==="Kenkere House")),o.status?.length&&(m=m.filter(n=>o.status.some(t=>n.status?.toLowerCase().includes(t.toLowerCase())))),o.membershipType?.length&&(m=m.filter(n=>o.membershipType.some(t=>n.membershipName?.toLowerCase().includes(t.toLowerCase())))),o.soldBy?.length&&(m=m.filter(n=>o.soldBy.some(t=>n.soldBy?.toLowerCase().includes(t.toLowerCase())))),m},x=A.useMemo(()=>b(i||[]),[i,o,T]),C=u=>{const m=u.length,n=u.filter(r=>r.status==="Active").length,t=u.filter(r=>r.status==="Churned").length,c=u.filter(r=>r.status==="Frozen").length,d=m>0?t/m*100:0,a=m>0?n/m*100:0,l=m>0?c/m*100:0;return[{title:"Total Memberships",value:M(m),change:0,description:"All tracked membership records",calculation:"Count of all membership records",icon:"Users",rawValue:m},{title:"Active Members",value:M(n),change:0,description:`${J(a)} of total memberships`,calculation:"Count of active status",icon:"CheckCircle",rawValue:n},{title:"Churned Members",value:M(t),change:0,description:`${J(d)} churn rate`,calculation:"Count of churned status",icon:"AlertTriangle",rawValue:t},{title:"Frozen Members",value:M(c),change:0,description:`${J(l)} of total memberships`,calculation:"Count of frozen status",icon:"Clock",rawValue:c}]},y=()=>{const u=bs();p({dateRange:u,location:[],status:[],membershipType:[],soldBy:[]})};C(x);const R=(u,m="expiration")=>{k(u),N(m)},D=u=>{const m=u.reduce((d,a)=>{const l=a.membershipName||"Unknown";return d[l]=(d[l]||0)+1,d},{}),n=Object.entries(m).map(([d,a])=>({name:d,count:a})).sort((d,a)=>a.count-d.count),t=u.reduce((d,a)=>{const l=a.status||"Unknown";return d[l]=(d[l]||0)+1,d},{}),c=Object.entries(t).map(([d,a])=>({name:d,count:a})).sort((d,a)=>a.count-d.count);return{topMemberships:n,topStatuses:c}},{topMemberships:P,topStatuses:w}=D(x);return e.jsxs("div",{className:"w-full bg-gradient-to-br from-slate-50 via-purple-50/30 to-pink-50/20 rounded-lg",children:[e.jsx("div",{className:"sticky top-0 z-20 bg-white/95 backdrop-blur-lg border-b border-slate-200/50 rounded-t-lg",children:e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-slate-800 to-slate-600 bg-clip-text text-transparent",children:"Expirations & Churn Analytics"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Qs,{additionalData:{expirations:x},defaultFileName:"expirations-analysis"}),e.jsx(Zs,{})]})]}),e.jsx(Re,{value:T,onValueChange:j,className:"w-full",children:e.jsx(ze,{className:"modern-tabs grid w-full grid-cols-4",children:vs.map(u=>e.jsx(H,{value:u.id,className:"modern-tab-trigger tab-variant-purple",children:u.name},u.id))})})]})}),e.jsx("div",{className:"p-6",children:e.jsx(Re,{value:T,onValueChange:j,className:"w-full",children:vs.map(u=>e.jsx(se,{value:u.id,className:"mt-0",children:e.jsxs(Re,{defaultValue:"overview",className:"w-full",children:[e.jsxs(ze,{className:"modern-tabs grid w-full grid-cols-2 mb-6",children:[e.jsx(H,{value:"overview",className:"modern-tab-trigger tab-variant-blue",children:"Overview & Analytics"}),e.jsx(H,{value:"churned",className:"modern-tab-trigger tab-variant-rose",children:"Churned Members Details"})]}),e.jsx(se,{value:"overview",className:"mt-0",children:e.jsxs("div",{className:"space-y-8",children:[e.jsx(nt,{filters:o,onFiltersChange:m=>p(m),onReset:y}),e.jsx(lt,{data:x,onMetricClick:(m,n)=>R(m,"expiration")}),e.jsx(ct,{data:x}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(I,{className:"bg-white/70 backdrop-blur-sm border-slate-200/50",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Top Membership Types"})}),e.jsx($,{children:e.jsx("div",{className:"space-y-2",children:P.slice(0,5).map((m,n)=>e.jsxs("div",{className:"flex justify-between items-center p-2 hover:bg-slate-50/50 rounded cursor-pointer",onClick:()=>R(x.filter(t=>t.membershipName===m.name),"expiration"),children:[e.jsx("span",{className:"text-sm text-slate-700",children:m.name}),e.jsx("span",{className:"text-sm font-medium text-slate-900",children:m.count})]},m.name))})})]}),e.jsxs(I,{className:"bg-white/70 backdrop-blur-sm border-slate-200/50",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Status Distribution"})}),e.jsx($,{children:e.jsx("div",{className:"space-y-2",children:w.map((m,n)=>e.jsxs("div",{className:"flex justify-between items-center p-2 hover:bg-slate-50/50 rounded cursor-pointer",onClick:()=>R(x.filter(t=>t.status===m.name),"status"),children:[e.jsx("span",{className:"text-sm text-slate-700",children:m.name}),e.jsx("span",{className:"text-sm font-medium text-slate-900",children:m.count})]},m.name))})})]})]}),e.jsx(dt,{data:x}),e.jsx(ot,{data:x,onRowClick:m=>R([m],"member")})]})}),e.jsx(se,{value:"churned",className:"mt-0",children:e.jsx(mt,{data:x,onRowClick:m=>R([m],"member")})})]})},u.id))})}),V&&e.jsx(it,{isOpen:!!V,onClose:()=>k(null),data:V,type:"member"})]})},At=({data:i,onMetricClick:T})=>{const j=A.useMemo(()=>{if(!i||i.length===0)return[];const k=i.length,v=new Set(i.map(D=>D.memberId)).size,N=new Set(i.map(D=>D.location)).size,o=new Set(i.map(D=>D.cleanedClass)).size;new Set(i.map(D=>D.teacherName)).size;const p=v>0?k/v:0,b=-8.5,x=12.3,C=5.2,y=i.reduce((D,P)=>{const w=P.time?parseInt(P.time.split(":")[0]):0,u=w<12?"Morning":w<17?"Afternoon":"Evening";return D[u]=(D[u]||0)+1,D},{}),R=Object.entries(y).reduce((D,P)=>y[D[0]]>y[P[0]]?D:P)?.[0]||"N/A";return[{title:"Total Late Cancellations",value:M(k),change:b,icon:Ks,color:"red",description:"Total number of late cancellations across all locations",rawData:i,metricType:"total",totalCancellations:k,uniqueMembers:v,uniqueLocations:N},{title:"Affected Members",value:M(v),change:x,icon:X,color:"orange",description:"Unique members who made late cancellations",rawData:i,metricType:"members",totalCancellations:k,uniqueMembers:v,uniqueLocations:N},{title:"Affected Locations",value:M(N),change:C,icon:we,color:"blue",description:"Studio locations with late cancellations",rawData:i,metricType:"locations",totalCancellations:k,uniqueMembers:v,uniqueLocations:N},{title:"Avg per Member",value:M(Math.round(p*10)/10),change:-5.3,icon:X,color:"purple",description:"Average late cancellations per member",rawData:i,metricType:"avg-member",totalCancellations:k,uniqueMembers:v,uniqueLocations:N},{title:"Affected Classes",value:M(o),change:8.7,icon:ne,color:"green",description:"Different class types with late cancellations",rawData:i,metricType:"classes",totalCancellations:k,uniqueMembers:v,uniqueLocations:N},{title:"Peak Time Slot",value:R,change:0,icon:$e,color:"cyan",description:"Time slot with most late cancellations",rawData:i,metricType:"peak-time",totalCancellations:k,uniqueMembers:v,uniqueLocations:N,showPercentage:!1}]},[i]),V=k=>{if(T){const v={title:k.title,metricValue:k.totalCancellations,totalCancellations:k.totalCancellations,uniqueMembers:k.uniqueMembers,uniqueLocations:k.uniqueLocations,rawData:k.rawData,type:"metric"};T(v)}};return j.length===0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((k,v)=>e.jsx(I,{className:"bg-gray-100 animate-pulse",children:e.jsx($,{className:"p-6",children:e.jsx("div",{className:"h-20 bg-gray-200 rounded"})})},v))}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:j.map((k,v)=>{const N=k.icon,o=k.change>0,p=k.showPercentage!==!1;return e.jsx(I,{className:te("bg-white shadow-xl border-0 overflow-hidden hover:shadow-2xl transition-all duration-500 group cursor-pointer","hover:scale-105 transform"),onClick:()=>V(k),style:{animationDelay:`${v*150}ms`},children:e.jsxs($,{className:"p-0",children:[e.jsxs("div",{className:`bg-gradient-to-r ${k.color==="red"?"from-red-500 to-red-600":k.color==="orange"?"from-orange-500 to-orange-600":k.color==="blue"?"from-blue-500 to-indigo-600":k.color==="purple"?"from-purple-500 to-violet-600":k.color==="green"?"from-green-500 to-teal-600":"from-cyan-500 to-blue-600"} p-6 text-white relative overflow-hidden`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 transform translate-x-8 -translate-y-8 opacity-20",children:e.jsx(N,{className:"w-20 h-20"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(N,{className:"w-6 h-6"})}),e.jsx("h3",{className:"font-semibold text-sm",children:k.title})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-3xl font-bold",children:k.value}),p&&e.jsxs("div",{className:"flex items-center gap-2",children:[o?e.jsx(xe,{className:"w-4 h-4 text-green-200"}):e.jsx(Be,{className:"w-4 h-4 text-red-200"}),e.jsxs("span",{className:`text-sm font-medium ${o?"text-green-200":"text-red-200"}`,children:[o?"+":"",k.change.toFixed(1),"%"]}),e.jsx("span",{className:"text-sm text-white/80",children:"vs last period"})]})]})]})]}),e.jsx("div",{className:"p-4 bg-gray-50",children:e.jsx("p",{className:"text-sm text-gray-600",children:k.description})})]})},v)})})},Rt=({data:i})=>{const[T,j]=A.useState("6m"),[V,k]=A.useState("monthly"),[v,N]=A.useState("count"),o=A.useMemo(()=>{if(!i||i.length===0)return[];const m=new Date;let n=new Date;switch(T){case"1m":n.setMonth(m.getMonth()-1);break;case"3m":n.setMonth(m.getMonth()-3);break;case"6m":n.setMonth(m.getMonth()-6);break;case"1y":n.setFullYear(m.getFullYear()-1);break;default:return i}return i.filter(t=>{if(!t.dateIST)return!1;const c=new Date(t.dateIST);return c>=n&&c<=m})},[i,T]),p=A.useMemo(()=>{if(!o.length)return[];const m=o.reduce((n,t)=>{if(!t.dateIST)return n;const c=new Date(t.dateIST),d=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`;return n[d]||(n[d]={month:c.toLocaleDateString("en",{month:"short",year:"numeric"}),count:0,members:new Set,locations:new Set}),n[d].count+=1,n[d].members.add(t.memberId),n[d].locations.add(t.location),n},{});return Object.values(m).map(n=>({...n,members:n.members.size,locations:n.locations.size})).sort((n,t)=>n.month.localeCompare(t.month))},[o]),b=A.useMemo(()=>{if(!o.length)return[];const m=o.reduce((t,c)=>{const d=c.location||"Unknown Location";return t[d]||(t[d]={name:d,count:0,members:new Set,classes:new Set}),t[d].count+=1,t[d].members.add(c.memberId),t[d].classes.add(c.cleanedClass),t},{});return Object.values(m).map(t=>({...t,members:t.members.size,classes:t.classes.size})).sort((t,c)=>c.count-t.count).slice(0,10)},[o]),x=A.useMemo(()=>{if(!o.length)return[];const m=o.reduce((n,t)=>{const c=t.cleanedClass||"Unknown Class";return n[c]||(n[c]=0),n[c]+=1,n},{});return Object.entries(m).map(([n,t])=>({name:n,value:t})).sort((n,t)=>t.value-n.value).slice(0,8)},[o]),C=A.useMemo(()=>{if(!o.length)return[];const m=o.reduce((t,c)=>{const d=c.dayOfWeek||"Unknown";return t[d]||(t[d]=0),t[d]+=1,t},{});return["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(t=>({day:t,count:m[t]||0}))},[o]),y=["#dc2626","#ea580c","#d97706","#ca8a04","#65a30d","#16a34a","#059669","#0891b2"],R=(m,n)=>M(Number(m)),D=A.useCallback(m=>{j(m)},[]),P=A.useCallback(m=>{k(m)},[]),w=A.useCallback(m=>{N(m)},[]);if(!i||i.length===0)return e.jsxs(I,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs(W,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5 text-red-600"}),"Interactive Late Cancellations Charts"]})}),e.jsx($,{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-slate-600",children:"No data available for charts"})})]});const u=()=>{switch(V){case"monthly":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(G,{variant:v==="count"?"default":"outline",size:"sm",onClick:()=>w("count"),children:"Cancellations"}),e.jsx(G,{variant:v==="members"?"default":"outline",size:"sm",onClick:()=>w("members"),children:"Unique Members"}),e.jsx(G,{variant:v==="locations"?"default":"outline",size:"sm",onClick:()=>w("locations"),children:"Locations"})]}),e.jsx(Ne,{width:"100%",height:400,children:e.jsxs(tt,{data:p,children:[e.jsx(Pe,{strokeDasharray:"3 3"}),e.jsx(Fe,{dataKey:"month"}),e.jsx(Ie,{tickFormatter:M}),e.jsx(ye,{formatter:R}),e.jsx(at,{type:"monotone",dataKey:v,stroke:"#dc2626",strokeWidth:3,dot:{fill:"#dc2626",strokeWidth:2,r:4}})]})})]});case"locations":return e.jsx(Ne,{width:"100%",height:400,children:e.jsxs(We,{data:b,margin:{left:20,right:20,top:20,bottom:60},children:[e.jsx(Pe,{strokeDasharray:"3 3"}),e.jsx(Fe,{dataKey:"name",angle:-45,textAnchor:"end",height:100,interval:0}),e.jsx(Ie,{tickFormatter:M}),e.jsx(ye,{formatter:R}),e.jsx(De,{dataKey:"count",fill:"#dc2626"})]})});case"classes":return e.jsx(Ne,{width:"100%",height:400,children:e.jsxs(Ts,{children:[e.jsx(As,{data:x,cx:"50%",cy:"50%",labelLine:!1,label:({name:m,percent:n})=>`${m} ${(n*100).toFixed(0)}%`,outerRadius:120,fill:"#8884d8",dataKey:"value",children:x.map((m,n)=>e.jsx(Rs,{fill:y[n%y.length]},`cell-${n}`))}),e.jsx(ye,{formatter:R})]})});case"dayofweek":return e.jsx(Ne,{width:"100%",height:400,children:e.jsxs(We,{data:C,children:[e.jsx(Pe,{strokeDasharray:"3 3"}),e.jsx(Fe,{dataKey:"day"}),e.jsx(Ie,{tickFormatter:M}),e.jsx(ye,{formatter:R}),e.jsx(De,{dataKey:"count",fill:"#ea580c"})]})});default:return null}};return e.jsxs(I,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs(W,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5 text-red-600"}),"Interactive Late Cancellations Charts"]})}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 flex items-center gap-1",children:[e.jsx(ne,{className:"w-4 h-4"}),"Time Range:"]}),[{key:"1m",label:"Last Month"},{key:"3m",label:"Last 3 Months"},{key:"6m",label:"Last 6 Months"},{key:"1y",label:"Last Year"}].map(({key:m,label:n})=>e.jsx(G,{variant:T===m?"default":"outline",size:"sm",onClick:()=>D(m),children:n},m))]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 flex items-center gap-1",children:[e.jsx(xe,{className:"w-4 h-4"}),"Chart Type:"]}),e.jsxs(G,{variant:V==="monthly"?"default":"outline",size:"sm",onClick:()=>P("monthly"),className:"flex items-center gap-1",children:[e.jsx(Ws,{className:"w-4 h-4"}),"Monthly Trend"]}),e.jsxs(G,{variant:V==="locations"?"default":"outline",size:"sm",onClick:()=>P("locations"),className:"flex items-center gap-1",children:[e.jsx(ve,{className:"w-4 h-4"}),"By Location"]}),e.jsxs(G,{variant:V==="classes"?"default":"outline",size:"sm",onClick:()=>P("classes"),className:"flex items-center gap-1",children:[e.jsx(Gs,{className:"w-4 h-4"}),"By Class Type"]}),e.jsxs(G,{variant:V==="dayofweek"?"default":"outline",size:"sm",onClick:()=>P("dayofweek"),className:"flex items-center gap-1",children:[e.jsx(ve,{className:"w-4 h-4"}),"By Day of Week"]})]})]})}),e.jsx($,{children:u()})]})},Vt=({data:i})=>{const[T,j]=A.useState("members"),V=A.useMemo(()=>{if(!i||i.length===0)return{top:[],bottom:[]};const o=(p,b)=>{const x=i.reduce((y,R)=>{const D=R[p]||"Unknown",P=R[b]||D;return y[D]||(y[D]={id:D,name:P,count:0,members:new Set,locations:new Set,classes:new Set,data:[]}),y[D].count+=1,y[D].members.add(R.memberId),y[D].locations.add(R.location),y[D].classes.add(R.cleanedClass),y[D].data.push(R),y},{}),C=Object.values(x).map(y=>({...y,uniqueMembers:y.members.size,uniqueLocations:y.locations.size,uniqueClasses:y.classes.size})).sort((y,R)=>R.count-y.count);return{top:C.slice(0,10),bottom:C.slice(-5).reverse()}};switch(T){case"members":return o("memberId","firstName");case"locations":return o("location","location");case"classes":return o("cleanedClass","cleanedClass");case"trainers":return o("teacherName","teacherName");case"memberships":return o("cleanedProduct","cleanedProduct");default:return{top:[],bottom:[]}}},[i,T]),k=()=>{switch(T){case"members":return X;case"locations":return we;case"classes":return ne;case"trainers":return as;case"memberships":return Te;default:return X}},v=()=>{switch(T){case"members":return"Members";case"locations":return"Locations";case"classes":return"Class Types";case"trainers":return"Trainers";case"memberships":return"Membership Types";default:return"Members"}},N=(o,p,b)=>{const x=k();return e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-100 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full text-white text-sm font-bold ${b?"bg-red-500":"bg-green-500"}`,children:p+1}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"w-4 h-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 truncate max-w-48",title:o.name,children:T==="members"?`${o.name} ${i.find(C=>C.memberId===o.id)?.lastName||""}`:o.name}),T==="members"&&e.jsxs("p",{className:"text-sm text-gray-500",children:["ID: ",o.id]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[T==="members"&&e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[o.uniqueLocations," location",o.uniqueLocations!==1?"s":""]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[o.uniqueClasses," class type",o.uniqueClasses!==1?"s":""]})]}),T==="locations"&&e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[o.uniqueMembers," member",o.uniqueMembers!==1?"s":""]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[o.uniqueClasses," class type",o.uniqueClasses!==1?"s":""]})]}),e.jsxs(z,{variant:b?"destructive":"secondary",children:[M(o.count)," cancellation",o.count!==1?"s":""]})]})]},o.id)};return!i||i.length===0?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(I,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-bold text-slate-800",children:"Top Performers"})}),e.jsx($,{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-slate-600",children:"No data available"})})]}),e.jsxs(I,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-bold text-slate-800",children:"Bottom Performers"})}),e.jsx($,{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-slate-600",children:"No data available"})})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(I,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:e.jsxs(K,{className:"pb-4",children:[e.jsxs(W,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-red-600"}),"Top & Bottom ",v()," by Late Cancellations"]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:[{key:"members",label:"Members",icon:X},{key:"locations",label:"Locations",icon:we},{key:"classes",label:"Classes",icon:ne},{key:"trainers",label:"Trainers",icon:as},{key:"memberships",label:"Memberships",icon:Te}].map(({key:o,label:p,icon:b})=>e.jsxs(G,{variant:T===o?"default":"outline",size:"sm",onClick:()=>j(o),className:"flex items-center gap-1",children:[e.jsx(b,{className:"w-4 h-4"}),p]},o))})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(I,{className:"bg-gradient-to-br from-white via-red-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-red-500"}),e.jsx(W,{className:"text-lg font-semibold text-gray-800",children:"Most Late Cancellations"}),e.jsxs(z,{variant:"destructive",children:[V.top.length," items"]})]})}),e.jsx($,{children:e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:V.top.length>0?V.top.map((o,p)=>N(o,p,!0)):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No data available"})})})]}),e.jsxs(I,{className:"bg-gradient-to-br from-white via-green-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5 text-green-500"}),e.jsx(W,{className:"text-lg font-semibold text-gray-800",children:"Least Late Cancellations"}),e.jsxs(z,{variant:"secondary",children:[V.bottom.length," items"]})]})}),e.jsx($,{children:e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:V.bottom.length>0?V.bottom.map((o,p)=>N(o,p,!1)):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No data available"})})})]})]})]})},Ue=100,Pt=({data:i,onDrillDown:T})=>{const[j,V]=A.useState("multiple-day"),[k,v]=A.useState(1),N=A.useMemo(()=>{if(!i||i.length===0)return[];const d=i.reduce((a,l)=>{if(!l.dateIST||!l.memberId)return a;const r=`${l.memberId}-${l.dateIST}`;return a[r]||(a[r]={memberId:l.memberId,memberName:`${l.firstName||""} ${l.lastName||""}`.trim(),email:l.email,date:l.dateIST,cancellations:[],count:0,locations:new Set,classes:new Set,trainers:new Set}),a[r].cancellations.push({sessionName:l.sessionName,time:l.time,location:l.location,teacherName:l.teacherName,cleanedClass:l.cleanedClass,cleanedProduct:l.cleanedProduct}),a[r].count+=1,a[r].locations.add(l.location),a[r].classes.add(l.cleanedClass),a[r].trainers.add(l.teacherName),a},{});return Object.values(d).filter(a=>a.count>1).map(a=>({...a,uniqueLocations:a.locations.size,uniqueClasses:a.classes.size,uniqueTrainers:a.trainers.size})).sort((a,l)=>l.count-a.count)},[i]),o=A.useMemo(()=>{if(!i||i.length===0)return[];const d=i.reduce((a,l)=>{if(!l.dateIST||!l.memberId)return a;const r=`${l.memberId}-${l.dateIST}`;return a[r]||(a[r]={memberId:l.memberId,memberName:`${l.firstName||""} ${l.lastName||""}`.trim(),email:l.email,date:l.dateIST,totalSessions:0,cancellations:0,sessionDetails:[]}),a[r].cancellations+=1,a[r].totalSessions+=1,a[r].sessionDetails.push({sessionName:l.sessionName,time:l.time,location:l.location,teacherName:l.teacherName,status:"cancelled"}),a},{});return Object.values(d).filter(a=>a.totalSessions>1).sort((a,l)=>l.totalSessions-a.totalSessions)},[i]),p=A.useMemo(()=>{if(!i||i.length===0)return[];const d=i.reduce((a,l)=>{const r=l.cleanedClass||"Unknown Class";if(a[r]||(a[r]={className:r,category:l.cleanedCategory||"Unknown",count:0,members:new Set,locations:new Set,trainers:new Set,totalDuration:0,totalRevenue:0,peakTimes:{},daysOfWeek:{}}),a[r].count+=1,a[r].members.add(l.memberId),a[r].locations.add(l.location),a[r].trainers.add(l.teacherName),a[r].totalDuration+=l.duration||0,a[r].totalRevenue+=l.paidAmount||0,l.time){const h=parseInt(l.time.split(":")[0]),s=h<12?"Morning":h<17?"Afternoon":"Evening";a[r].peakTimes[s]=(a[r].peakTimes[s]||0)+1}return l.dayOfWeek&&(a[r].daysOfWeek[l.dayOfWeek]=(a[r].daysOfWeek[l.dayOfWeek]||0)+1),a},{});return Object.values(d).map(a=>{const l=Object.entries(a.peakTimes).reduce((h,s)=>a.peakTimes[h[0]]>a.peakTimes[s[0]]?h:s,["N/A",0])[0],r=Object.entries(a.daysOfWeek).reduce((h,s)=>a.daysOfWeek[h[0]]>a.daysOfWeek[s[0]]?h:s,["N/A",0])[0];return{...a,uniqueMembers:a.members.size,uniqueLocations:a.locations.size,uniqueTrainers:a.trainers.size,avgDuration:a.count>0?Math.round(a.totalDuration/a.count):0,avgRevenue:a.count>0?a.totalRevenue/a.count:0,peakTime:l,peakDay:r}}).sort((a,l)=>l.count-a.count)},[i]),b=A.useMemo(()=>{if(!i||i.length===0)return[];const d=i.reduce((a,l)=>{const r=l.cleanedProduct||"Unknown Membership";return a[r]||(a[r]={membershipType:r,category:l.cleanedCategory||"Unknown",count:0,members:new Set,revenue:0,locations:new Set,classes:new Set,avgCancellationsPerMember:0}),a[r].count+=1,a[r].members.add(l.memberId),a[r].revenue+=l.paidAmount||0,a[r].locations.add(l.location),a[r].classes.add(l.cleanedClass),a},{});return Object.values(d).map(a=>({...a,uniqueMembers:a.members.size,uniqueLocations:a.locations.size,uniqueClasses:a.classes.size,avgRevenuePerCancellation:a.count>0?a.revenue/a.count:0,avgCancellationsPerMember:a.uniqueMembers>0?a.count/a.uniqueMembers:0})).sort((a,l)=>l.count-a.count)},[i]),x=d=>{const a=(k-1)*Ue,l=a+Ue;return d.slice(a,l)},C=d=>Math.ceil(d.length/Ue),R=(()=>{switch(j){case"multiple-day":return N;case"multiple-checkins":return o;case"by-class":return p;case"by-membership":return b;default:return[]}})(),D=x(R),P=C(R);Ve.useEffect(()=>{v(1)},[j]);const w=()=>e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t border-gray-200",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:e.jsxs("span",{children:["Showing ",(k-1)*Ue+1," to ",Math.min(k*Ue,R.length)," of ",R.length," results"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(G,{variant:"outline",size:"sm",onClick:()=>v(d=>Math.max(1,d-1)),disabled:k===1,className:"gap-1",children:[e.jsx(Ys,{className:"w-4 h-4"}),"Previous"]}),e.jsx("div",{className:"flex items-center gap-1",children:[...Array(Math.min(5,P))].map((d,a)=>{const l=Math.max(1,Math.min(P-4,k-2))+a;return l>P?null:e.jsx(G,{variant:l===k?"default":"outline",size:"sm",onClick:()=>v(l),className:"w-8 h-8 p-0",children:l},l)})}),e.jsxs(G,{variant:"outline",size:"sm",onClick:()=>v(d=>Math.min(P,d+1)),disabled:k===P,className:"gap-1",children:["Next",e.jsx(ns,{className:"w-4 h-4"})]})]})]}),u=(d,a,l)=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-5 h-5 text-orange-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:a}),e.jsxs(z,{variant:"outline",className:"bg-orange-50 text-orange-700",children:[R.length," total members"]})]})}),Array.isArray(d)&&d.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(ke,{children:[e.jsx(Se,{children:e.jsxs(re,{children:[e.jsx(B,{children:"Member"}),e.jsx(B,{children:"Email"}),e.jsx(B,{children:"Date"}),e.jsx(B,{children:"Count"}),e.jsx(B,{children:"Details"}),e.jsx(B,{children:"Sessions"})]})}),e.jsx(Me,{children:d.map((r,h)=>e.jsxs(re,{className:"h-[35px] max-h-[35px] hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>{T&&T({type:"member",title:`Member: ${r.memberName}`,data:r,rawData:r.cancellations||r.sessionDetails})},children:[e.jsx(U,{className:"font-medium h-[35px] py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-red-500 to-pink-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:r.memberName?r.memberName.charAt(0).toUpperCase():"U"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm truncate max-w-[150px]",children:r.memberName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",r.memberId]})]})]})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx("span",{className:"text-sm truncate max-w-[200px] block",children:r.email})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"outline",className:"text-xs",children:new Date(r.date).toLocaleDateString()})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsxs(z,{variant:"destructive",className:"text-xs",children:[r.count," ",l==="multiple-day"?"cancellations":"sessions"]})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsxs("div",{className:"flex gap-1",children:[r.uniqueLocations&&e.jsxs(z,{variant:"outline",className:"text-xs",children:[r.uniqueLocations," loc"]}),r.uniqueClasses&&e.jsxs(z,{variant:"outline",className:"text-xs",children:[r.uniqueClasses," classes"]})]})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx("div",{className:"text-xs text-gray-600 max-w-[200px]",children:Array.isArray(l==="multiple-day"?r.cancellations:r.sessionDetails)?`${(l==="multiple-day"?r.cancellations:r.sessionDetails).length} sessions`:"No data"})})]},h))})]}),e.jsx(w,{})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No data available"})]}),m=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-blue-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cancellations by Class Type"}),e.jsxs(z,{variant:"outline",className:"bg-blue-50 text-blue-700",children:[R.length," class types"]})]})}),D.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(ke,{children:[e.jsx(Se,{children:e.jsxs(re,{className:"h-[35px]",children:[e.jsx(B,{children:"Class Type"}),e.jsx(B,{children:"Category"}),e.jsx(B,{children:"Cancellations"}),e.jsx(B,{children:"Members"}),e.jsx(B,{children:"Locations"}),e.jsx(B,{children:"Peak Time"}),e.jsx(B,{children:"Peak Day"}),e.jsx(B,{children:"Avg Duration"})]})}),e.jsx(Me,{children:D.map((d,a)=>e.jsxs(re,{className:"h-[35px] max-h-[35px] hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>{T&&T({type:"class",title:`Class Type: ${d.className}`,data:d,rawData:i.filter(l=>l.cleanedClass===d.className)})},children:[e.jsx(U,{className:"font-medium h-[35px] py-2",children:e.jsx("span",{className:"truncate max-w-[150px] block",children:d.className})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"secondary",children:d.category})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"destructive",children:M(d.count)})}),e.jsx(U,{className:"h-[35px] py-2",children:M(d.uniqueMembers)}),e.jsx(U,{className:"h-[35px] py-2",children:M(d.uniqueLocations)}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"outline",children:d.peakTime})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"outline",children:d.peakDay})}),e.jsxs(U,{className:"h-[35px] py-2",children:[d.avgDuration," min"]})]},a))})]}),e.jsx(w,{})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No class type data available"})]}),n=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5 text-purple-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cancellations by Membership Type"}),e.jsxs(z,{variant:"outline",className:"bg-purple-50 text-purple-700",children:[R.length," membership types"]})]})}),D.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(ke,{children:[e.jsx(Se,{children:e.jsxs(re,{className:"h-[35px]",children:[e.jsx(B,{children:"Membership Type"}),e.jsx(B,{children:"Category"}),e.jsx(B,{children:"Cancellations"}),e.jsx(B,{children:"Members"}),e.jsx(B,{children:"Locations"}),e.jsx(B,{children:"Avg per Member"}),e.jsx(B,{children:"Revenue Impact"})]})}),e.jsx(Me,{children:D.map((d,a)=>e.jsxs(re,{className:"h-[35px] max-h-[35px] hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>{},children:[e.jsx(U,{className:"font-medium h-[35px] py-2",children:e.jsx("span",{className:"truncate max-w-[200px] block",children:d.membershipType})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"secondary",children:d.category})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"destructive",children:M(d.count)})}),e.jsx(U,{className:"h-[35px] py-2",children:M(d.uniqueMembers)}),e.jsx(U,{className:"h-[35px] py-2",children:M(d.uniqueLocations)}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"outline",children:(d.avgCancellationsPerMember||0).toFixed(1)})}),e.jsxs(U,{className:"h-[35px] py-2",children:["₹",(d.revenue||0).toFixed(2)]})]},a))})]}),e.jsx(w,{})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No membership type data available"})]}),t=()=>{const d=A.useMemo(()=>{if(!i||i.length===0)return[];const l=i.reduce((r,h)=>{const s=h.teacherName||"Unknown Trainer";return r[s]||(r[s]={trainerName:s,count:0,members:new Set,locations:new Set,classes:new Set,revenue:0,avgCancellationsPerSession:0,totalSessions:0}),r[s].count+=1,r[s].members.add(h.memberId),r[s].locations.add(h.location),r[s].classes.add(h.cleanedClass),r[s].revenue+=h.paidAmount||0,r[s].totalSessions+=1,r},{});return Object.values(l).map(r=>({...r,uniqueMembers:r.members.size,uniqueLocations:r.locations.size,uniqueClasses:r.classes.size,avgCancellationsPerSession:r.totalSessions>0?r.count/r.totalSessions:0})).sort((r,h)=>h.count-r.count)},[i]),a=x(d);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-green-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cancellations by Trainer"}),e.jsxs(z,{variant:"outline",className:"bg-green-50 text-green-700",children:[d.length," trainers"]})]})}),a.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(ke,{children:[e.jsx(Se,{children:e.jsxs(re,{className:"h-[35px]",children:[e.jsx(B,{children:"Trainer Name"}),e.jsx(B,{children:"Cancellations"}),e.jsx(B,{children:"Affected Members"}),e.jsx(B,{children:"Classes"}),e.jsx(B,{children:"Locations"}),e.jsx(B,{children:"Revenue Impact"}),e.jsx(B,{children:"Avg per Session"})]})}),e.jsx(Me,{children:a.map((l,r)=>e.jsxs(re,{className:"h-[35px] max-h-[35px]",children:[e.jsx(U,{className:"font-medium h-[35px] py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:l.trainerName.split(" ").map(h=>h[0]).join("").slice(0,2)}),e.jsx("span",{className:"truncate max-w-[120px]",children:l.trainerName})]})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"destructive",children:M(l.count)})}),e.jsx(U,{className:"h-[35px] py-2",children:M(l.uniqueMembers)}),e.jsx(U,{className:"h-[35px] py-2",children:M(l.uniqueClasses)}),e.jsx(U,{className:"h-[35px] py-2",children:M(l.uniqueLocations)}),e.jsxs(U,{className:"h-[35px] py-2",children:["₹",l.revenue.toFixed(2)]}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"outline",children:l.avgCancellationsPerSession.toFixed(2)})})]},r))})]}),e.jsx(w,{})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No trainer data available"})]})},c=()=>{const d=A.useMemo(()=>{if(!i||i.length===0)return[];const l=i.reduce((r,h)=>{const s=h.location||"Unknown Location";if(r[s]||(r[s]={locationName:s,count:0,members:new Set,trainers:new Set,classes:new Set,revenue:0,peakDays:{},peakTimes:{}}),r[s].count+=1,r[s].members.add(h.memberId),r[s].trainers.add(h.teacherName),r[s].classes.add(h.cleanedClass),r[s].revenue+=h.paidAmount||0,h.dayOfWeek&&(r[s].peakDays[h.dayOfWeek]=(r[s].peakDays[h.dayOfWeek]||0)+1),h.time){const g=parseInt(h.time.split(":")[0]),f=g<12?"Morning":g<17?"Afternoon":"Evening";r[s].peakTimes[f]=(r[s].peakTimes[f]||0)+1}return r},{});return Object.values(l).map(r=>{const h=Object.entries(r.peakDays).reduce((g,f)=>r.peakDays[g[0]]>r.peakDays[f[0]]?g:f,["N/A",0])[0],s=Object.entries(r.peakTimes).reduce((g,f)=>r.peakTimes[g[0]]>r.peakTimes[f[0]]?g:f,["N/A",0])[0];return{...r,uniqueMembers:r.members.size,uniqueTrainers:r.trainers.size,uniqueClasses:r.classes.size,peakDay:h,peakTime:s,avgRevenuePerCancellation:r.count>0?r.revenue/r.count:0}}).sort((r,h)=>h.count-r.count)},[i]),a=x(d);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5 text-indigo-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cancellations by Location"}),e.jsxs(z,{variant:"outline",className:"bg-indigo-50 text-indigo-700",children:[d.length," locations"]})]})}),a.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(ke,{children:[e.jsx(Se,{children:e.jsxs(re,{className:"h-[35px]",children:[e.jsx(B,{children:"Location"}),e.jsx(B,{children:"Cancellations"}),e.jsx(B,{children:"Members"}),e.jsx(B,{children:"Trainers"}),e.jsx(B,{children:"Classes"}),e.jsx(B,{children:"Peak Day"}),e.jsx(B,{children:"Peak Time"}),e.jsx(B,{children:"Revenue Impact"})]})}),e.jsx(Me,{children:a.map((l,r)=>e.jsxs(re,{className:"h-[35px] max-h-[35px]",children:[e.jsx(U,{className:"font-medium h-[35px] py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4 text-indigo-600"}),e.jsx("span",{className:"truncate max-w-[150px]",children:l.locationName})]})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"destructive",children:M(l.count)})}),e.jsx(U,{className:"h-[35px] py-2",children:M(l.uniqueMembers)}),e.jsx(U,{className:"h-[35px] py-2",children:M(l.uniqueTrainers)}),e.jsx(U,{className:"h-[35px] py-2",children:M(l.uniqueClasses)}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"outline",children:l.peakDay})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"outline",children:l.peakTime})}),e.jsxs(U,{className:"h-[35px] py-2",children:["₹",l.revenue.toFixed(2)]})]},r))})]}),e.jsx(w,{})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No location data available"})]})};return e.jsxs(I,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs(W,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-red-600"}),"Enhanced Late Cancellations Analysis",e.jsx(z,{variant:"outline",className:"bg-blue-50 text-blue-700",children:"Multiple analysis views with 35px row height"})]})}),e.jsx($,{className:"p-0",children:e.jsxs(Re,{value:j,onValueChange:V,children:[e.jsx("div",{className:"px-6",children:e.jsxs(ze,{className:"grid grid-cols-6 w-full mb-6",children:[e.jsxs(H,{value:"multiple-day",className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4"}),"Multiple/Day"]}),e.jsxs(H,{value:"multiple-checkins",className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Check-ins/Day"]}),e.jsxs(H,{value:"by-class",className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"By Class"]}),e.jsxs(H,{value:"by-membership",className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-4 w-4"}),"By Membership"]}),e.jsxs(H,{value:"by-trainer",className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"By Trainer"]}),e.jsxs(H,{value:"by-location",className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),"By Location"]})]})}),e.jsx(se,{value:"multiple-day",className:"mt-0",children:u(D,"Members with Multiple Late Cancellations per Day","multiple-day")}),e.jsx(se,{value:"multiple-checkins",className:"mt-0",children:u(D,"Members with Multiple Check-ins per Day","multiple-checkins")}),e.jsx(se,{value:"by-class",className:"mt-0",children:m()}),e.jsx(se,{value:"by-membership",className:"mt-0",children:n()}),e.jsx(se,{value:"by-trainer",className:"mt-0",children:t()}),e.jsx(se,{value:"by-location",className:"mt-0",children:c()})]})})]})};function Ft({selectedLocation:i,onLocationChange:T,selectedTimeframe:j,onTimeframeChange:V,selectedTrainer:k,onTrainerChange:v,selectedClass:N,onClassChange:o,selectedProduct:p,onProductChange:b,selectedTimeSlot:x,onTimeSlotChange:C,dateRange:y,onDateRangeChange:R,data:D,onClearFilters:P}){const[w,u]=A.useState(!1),m=Ve.useMemo(()=>Array.from(new Set(D.map(r=>r.location).filter(Boolean))),[D]),n=Ve.useMemo(()=>Array.from(new Set(D.map(r=>r.teacherName).filter(Boolean))),[D]),t=Ve.useMemo(()=>Array.from(new Set(D.map(r=>r.cleanedClass).filter(Boolean))),[D]),c=Ve.useMemo(()=>Array.from(new Set(D.map(r=>r.cleanedProduct).filter(Boolean))),[D]),d=[{value:"all",label:"All Time"},{value:"prev-month",label:"Previous Month"},{value:"1w",label:"Last Week"},{value:"2w",label:"Last 2 Weeks"},{value:"1m",label:"Last Month"},{value:"3m",label:"Last 3 Months"},{value:"6m",label:"Last 6 Months"},{value:"1y",label:"Last 12 Months"},{value:"custom",label:"Custom Range"}],a=[{value:"all",label:"All Time Slots"},{value:"morning",label:"Morning (6-12)"},{value:"afternoon",label:"Afternoon (12-17)"},{value:"evening",label:"Evening (17-22)"},{value:"late",label:"Late Night (22+)"}],l=[i!=="all",j!=="all",k!=="all",N!=="all",p!=="all",x!=="all",y.start||y.end].filter(Boolean).length;return w?e.jsxs(I,{className:"bg-gradient-to-br from-white via-red-50/30 to-white border-0 shadow-xl overflow-hidden",children:[e.jsx(K,{className:"bg-gradient-to-r from-red-600 to-orange-600 text-white",children:e.jsxs(W,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ts,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Advanced Filters"}),e.jsx("p",{className:"text-red-100 text-sm",children:"Customize your late cancellations analysis"})]}),e.jsxs(z,{className:"bg-white/20 text-white border-white/30",children:[l," Active"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(G,{variant:"outline",size:"sm",onClick:P,disabled:l===0,className:"bg-white/10 border-white/30 text-white hover:bg-white/20",children:[e.jsx(fe,{className:"w-4 h-4 mr-1"}),"Reset"]}),e.jsx(G,{variant:"ghost",size:"sm",onClick:()=>u(!1),className:"text-white hover:bg-white/20",children:e.jsx(Hs,{className:"w-4 h-4"})})]})]})}),e.jsxs($,{className:"p-8 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsx("h4",{className:"text-lg font-semibold text-slate-800",children:"Filter Options"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(de,{htmlFor:"location-select",className:"text-slate-700 flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4"}),"Location"]}),e.jsxs(pe,{value:i,onValueChange:T,children:[e.jsx(ge,{id:"location-select",className:"bg-white border-slate-200",children:e.jsx(je,{placeholder:"Select location"})}),e.jsxs(be,{className:"bg-white border-slate-200",children:[e.jsx(ae,{value:"all",children:"All Locations"}),m.map(r=>e.jsx(ae,{value:r,children:r},r))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(de,{htmlFor:"timeframe-select",className:"text-slate-700 flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),"Timeframe"]}),e.jsxs(pe,{value:j,onValueChange:V,children:[e.jsx(ge,{id:"timeframe-select",className:"bg-white border-slate-200",children:e.jsx(je,{placeholder:"Select timeframe"})}),e.jsx(be,{className:"bg-white border-slate-200",children:d.map(r=>e.jsx(ae,{value:r.value,children:r.label},r.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(de,{htmlFor:"trainer-select",className:"text-slate-700 flex items-center gap-2",children:[e.jsx(as,{className:"w-4 h-4"}),"Trainer"]}),e.jsxs(pe,{value:k,onValueChange:v,children:[e.jsx(ge,{id:"trainer-select",className:"bg-white border-slate-200",children:e.jsx(je,{placeholder:"Select trainer"})}),e.jsxs(be,{className:"bg-white border-slate-200",children:[e.jsx(ae,{value:"all",children:"All Trainers"}),n.map(r=>e.jsx(ae,{value:r,children:r},r))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(de,{htmlFor:"class-select",className:"text-slate-700 flex items-center gap-2",children:[e.jsx(Te,{className:"w-4 h-4"}),"Class Type"]}),e.jsxs(pe,{value:N,onValueChange:o,children:[e.jsx(ge,{id:"class-select",className:"bg-white border-slate-200",children:e.jsx(je,{placeholder:"Select class"})}),e.jsxs(be,{className:"bg-white border-slate-200",children:[e.jsx(ae,{value:"all",children:"All Classes"}),t.map(r=>e.jsx(ae,{value:r,children:r},r))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(de,{htmlFor:"product-select",className:"text-slate-300 flex items-center gap-2",children:[e.jsx(Te,{className:"w-4 h-4"}),"Product Type"]}),e.jsxs(pe,{value:p,onValueChange:b,children:[e.jsx(ge,{id:"product-select",className:"bg-slate-800 border-slate-600 text-white",children:e.jsx(je,{placeholder:"Select product"})}),e.jsxs(be,{className:"bg-slate-800 border-slate-600",children:[e.jsx(ae,{value:"all",className:"text-white hover:bg-slate-700",children:"All Products"}),c.map(r=>e.jsx(ae,{value:r,className:"text-white hover:bg-slate-700",children:r},r))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(de,{htmlFor:"timeslot-select",className:"text-slate-300 flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4"}),"Time Slot"]}),e.jsxs(pe,{value:x,onValueChange:C,children:[e.jsx(ge,{id:"timeslot-select",className:"bg-slate-800 border-slate-600 text-white",children:e.jsx(je,{placeholder:"Select time slot"})}),e.jsx(be,{className:"bg-slate-800 border-slate-600",children:a.map(r=>e.jsx(ae,{value:r.value,className:"text-white hover:bg-slate-700",children:r.label},r.value))})]})]}),j==="custom"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(de,{htmlFor:"start-date",className:"text-slate-700",children:"Start Date"}),e.jsx(Ae,{id:"start-date",type:"date",value:y.start,onChange:r=>R({...y,start:r.target.value}),className:"bg-white border-slate-200"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(de,{htmlFor:"end-date",className:"text-slate-700",children:"End Date"}),e.jsx(Ae,{id:"end-date",type:"date",value:y.end,onChange:r=>R({...y,end:r.target.value}),className:"bg-white border-slate-200"})]})]})]})]})]}):e.jsx(I,{className:"bg-gradient-to-br from-white via-red-50/30 to-white border-0 shadow-xl",children:e.jsx($,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-red-500 to-orange-500 rounded-lg",children:e.jsx(ts,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-800",children:"Advanced Filters"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Refine your late cancellations analysis"})]}),l>0&&e.jsxs(z,{className:"bg-gradient-to-r from-red-600 to-orange-600 text-white",children:[l," active"]})]}),e.jsxs(G,{variant:"outline",onClick:()=>u(!0),className:"gap-2 border-red-200 text-red-700 hover:bg-red-50",children:[e.jsx(Ye,{className:"w-4 h-4"}),"Expand Filters"]})]})})})}const It=({isOpen:i,onClose:T,data:j})=>{if(!j)return null;const V=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs(I,{children:[e.jsx(K,{children:e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-blue-500"}),"Member Information"]})}),e.jsxs($,{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Member Name"}),e.jsx("p",{className:"font-semibold",children:j.data.memberName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-semibold",children:j.data.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Member ID"}),e.jsx("p",{className:"font-semibold",children:j.data.memberId})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Cancellations"}),e.jsx(z,{variant:"destructive",children:j.data.count})]})]})]}),e.jsxs(I,{children:[e.jsx(K,{children:e.jsx(W,{children:"Session Details"})}),e.jsx($,{children:e.jsx(es,{className:"h-64",children:e.jsxs(ke,{children:[e.jsx(Se,{children:e.jsxs(re,{children:[e.jsx(B,{children:"Session"}),e.jsx(B,{children:"Time"}),e.jsx(B,{children:"Location"}),e.jsx(B,{children:"Trainer"})]})}),e.jsx(Me,{children:(j.rawData||[]).map((N,o)=>e.jsxs(re,{children:[e.jsx(U,{children:N.sessionName}),e.jsx(U,{children:N.time}),e.jsx(U,{children:N.location}),e.jsx(U,{children:N.teacherName})]},o))})]})})})]})]}),k=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs(I,{children:[e.jsx(K,{children:e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-green-500"}),"Class Information"]})}),e.jsxs($,{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Class Type"}),e.jsx("p",{className:"font-semibold",children:j.data.className})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Category"}),e.jsx(z,{variant:"secondary",children:j.data.category})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Cancellations"}),e.jsx(z,{variant:"destructive",children:M(j.data.count)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Unique Members"}),e.jsx("p",{className:"font-semibold",children:M(j.data.uniqueMembers)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Peak Time"}),e.jsx(z,{variant:"outline",children:j.data.peakTime})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Average Duration"}),e.jsxs("p",{className:"font-semibold",children:[j.data.avgDuration," min"]})]})]})]}),e.jsxs(I,{children:[e.jsx(K,{children:e.jsx(W,{children:"Recent Cancellations"})}),e.jsx($,{children:e.jsx(es,{className:"h-64",children:e.jsxs(ke,{children:[e.jsx(Se,{children:e.jsxs(re,{children:[e.jsx(B,{children:"Member"}),e.jsx(B,{children:"Date"}),e.jsx(B,{children:"Time"}),e.jsx(B,{children:"Location"})]})}),e.jsx(Me,{children:(j.rawData||[]).slice(0,10).map((N,o)=>e.jsxs(re,{children:[e.jsxs(U,{children:[N.firstName," ",N.lastName]}),e.jsx(U,{children:new Date(N.dateIST).toLocaleDateString()}),e.jsx(U,{children:N.time}),e.jsx(U,{children:N.location})]},o))})]})})})]})]}),v=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(I,{children:e.jsxs($,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:M(j.totalCancellations)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Cancellations"})]})}),e.jsx(I,{children:e.jsxs($,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:M(j.uniqueMembers)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Unique Members"})]})}),e.jsx(I,{children:e.jsxs($,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:M(j.uniqueLocations)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Locations"})]})}),e.jsx(I,{children:e.jsxs($,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:j.uniqueMembers>0?(j.totalCancellations/j.uniqueMembers).toFixed(1):"0"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Avg per Member"})]})})]}),e.jsxs(I,{children:[e.jsx(K,{children:e.jsx(W,{children:"Recent Activity"})}),e.jsx($,{children:e.jsx(es,{className:"h-64",children:e.jsxs(ke,{children:[e.jsx(Se,{children:e.jsxs(re,{children:[e.jsx(B,{children:"Member"}),e.jsx(B,{children:"Date"}),e.jsx(B,{children:"Class"}),e.jsx(B,{children:"Location"}),e.jsx(B,{children:"Trainer"})]})}),e.jsx(Me,{children:(j.rawData||[]).slice(0,15).map((N,o)=>e.jsxs(re,{children:[e.jsxs(U,{children:[N.firstName," ",N.lastName]}),e.jsx(U,{children:new Date(N.dateIST).toLocaleDateString()}),e.jsx(U,{children:N.cleanedClass}),e.jsx(U,{children:N.location}),e.jsx(U,{children:N.teacherName})]},o))})]})})})]})]});return e.jsx(Je,{open:i,onOpenChange:T,children:e.jsxs(_e,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Xe,{children:e.jsxs(Qe,{className:"flex items-center justify-between",children:[e.jsx("span",{children:j.title}),e.jsx("button",{onClick:T,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(fe,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"mt-4",children:[j.type==="member"&&V(),j.type==="class"&&k(),j.type==="metric"&&v()]})]})})};export{nt as A,St as D,Nt as E,Dt as L,kt as M,Ct as P,wt as S,vt as U,Ze as Y,Mt as a,yt as b,ft as c,Tt as d,Ft as e,At as f,Rt as g,Vt as h,Pt as i,It as j};
