import{r as $,M as ee,U as D,T as F,J as he,j as e,F as se,b as ve,K as be,C as ge,c as H,S as ue,i as Y,N as pe,v as _,O as fe,h as P,f as we,Q as re,R as V,V as J,u as ie,W as ne,s as ae,g as Ne,e as te,w as le,Y as je,X as ye,Z as Me}from"./react-vendor-Di6K3Iht.js";import{C as M,c as C,B as j,d as A,j as L,k,D as Ce,I as Q,Y as W,T as ce,m as de,n as z,o as T,p as me,q as N,Z as Te,_ as Re,$ as Ve,a0 as Se,r as Le,s as ke,t as X,u as Z}from"./ui-components-vIyQeg8Q.js";import{c as p,f as S,a as De}from"./utils-w8vrWjz4.js";import{R as K,P as $e,d as Ye,e as Ae,T as O,A as Fe,C as G,X as E,Y as U,f as Pe,B as q,c as B,L as Ie,b as oe}from"./chart-vendor-BSHhUw40.js";import{m as xe}from"./animation-vendor-BAkK5ra0.js";const ze=({filters:d,onFiltersChange:f,locations:w,trainers:g,membershipTypes:x})=>{const[o,s]=$.useState(!1),[m,a]=$.useState(""),c=(t,h)=>{const b=[...d[t]],y=b.includes(h)?b.filter(R=>R!==h):[...b,h];f({...d,[t]:y})},l=t=>{const h=b=>{const y=b.getFullYear(),R=String(b.getMonth()+1).padStart(2,"0"),I=String(b.getDate()).padStart(2,"0");return`${y}-${R}-${I}`};f({...d,dateRange:{start:t.from?h(t.from):"",end:t.to?h(t.to):""}})},r=()=>{f({dateRange:{start:"",end:""},location:[],homeLocation:[],trainer:[],paymentMethod:[],retentionStatus:[],conversionStatus:[],isNew:[],minLTV:void 0,maxLTV:void 0}),a("")},n=d.location.length+d.trainer.length+d.retentionStatus.length+d.conversionStatus.length+d.paymentMethod.length+d.isNew.length+(d.dateRange.start||d.dateRange.end?1:0)+(d.minLTV?1:0)+(d.maxLTV?1:0),v=["Kwality House, Kemps Corner","Supreme HQ, Bandra","Kenkere House, Bengaluru"],u=w.filter(t=>v.includes(t)),i=[{title:"Location & Geography",icon:ee,filters:[{key:"location",label:"Visit Locations",options:u,values:d.location}]},{title:"Trainer & Service",icon:D,filters:[{key:"trainer",label:"Trainers",options:g.slice(0,12),values:d.trainer}]},{title:"Conversion & Status",icon:F,filters:[{key:"conversionStatus",label:"Conversion Status",options:["Converted","Not Converted","Pending"],values:d.conversionStatus},{key:"retentionStatus",label:"Retention Status",options:["Retained","Not Retained","At Risk"],values:d.retentionStatus},{key:"isNew",label:"Client Type",options:["New","Existing","Returning"],values:d.isNew}]},{title:"Payment & Membership",icon:he,filters:[{key:"paymentMethod",label:"Payment Methods",options:["Online","Cash","Card","UPI","Bank Transfer"],values:d.paymentMethod}]}];return o?e.jsxs(M,{className:"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 border-0 shadow-xl overflow-hidden",children:[e.jsx(L,{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white",children:e.jsxs(k,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Advanced Client Filters"}),e.jsx("p",{className:"text-blue-100 text-sm",children:"Customize your analysis view"})]}),e.jsxs(j,{className:"bg-white/20 text-white border-white/30",children:[n," Active"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(A,{variant:"outline",size:"sm",onClick:r,disabled:n===0,className:"bg-white/10 border-white/30 text-white hover:bg-white/20",children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),"Reset"]}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>s(!1),className:"text-white hover:bg-white/20",children:e.jsx(ge,{className:"w-4 h-4"})})]})]})}),e.jsxs(C,{className:"p-8 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-bold text-slate-700 flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-blue-600"}),"Date Range"]}),e.jsx(Ce,{value:{from:d.dateRange.start?new Date(d.dateRange.start):void 0,to:d.dateRange.end?new Date(d.dateRange.end):void 0},onChange:l})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-bold text-slate-700 flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-blue-600"}),"Quick Search"]}),e.jsx(Q,{placeholder:"Search trainers, locations...",value:m,onChange:t=>a(t.target.value),className:"bg-white border-slate-200"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"text-sm font-bold text-slate-700 flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-blue-600"}),"Lifetime Value Range"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Q,{type:"number",placeholder:"Min LTV (₹)",value:d.minLTV||"",onChange:t=>f({...d,minLTV:t.target.value?parseFloat(t.target.value):void 0}),className:"bg-white border-slate-200"}),e.jsx(Q,{type:"number",placeholder:"Max LTV (₹)",value:d.maxLTV||"",onChange:t=>f({...d,maxLTV:t.target.value?parseFloat(t.target.value):void 0}),className:"bg-white border-slate-200"})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:i.map(t=>e.jsxs(M,{className:"bg-white/70 border-slate-200 shadow-lg",children:[e.jsx(L,{className:"pb-4",children:e.jsxs(k,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(t.icon,{className:"w-5 h-5 text-blue-600"}),t.title]})}),e.jsx(C,{className:"space-y-4",children:t.filters.map(h=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-medium text-slate-700",children:[h.label,h.values.length>0&&e.jsxs(j,{variant:"secondary",className:"ml-2 text-xs bg-blue-100 text-blue-700",children:[h.values.length," selected"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 max-h-32 overflow-y-auto",children:h.options.filter(b=>!m||b.toLowerCase().includes(m.toLowerCase())).map(b=>e.jsx(A,{variant:h.values.includes(b)?"default":"outline",size:"sm",onClick:()=>c(h.key,b),className:`text-xs transition-all duration-200 ${h.values.includes(b)?"bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-md":"hover:bg-blue-50 border-slate-200 hover:border-blue-300"}`,children:b},b))})]},h.key))})]},t.title))})]})]}):e.jsx(M,{className:"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 border-0 shadow-xl",children:e.jsx(C,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg",children:e.jsx(se,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-800",children:"Advanced Filters"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Refine your client analysis"})]}),n>0&&e.jsxs(j,{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white",children:[n," active"]})]}),e.jsxs(A,{variant:"outline",onClick:()=>s(!0),className:"gap-2 border-blue-200 text-blue-700 hover:bg-blue-50",children:[e.jsx(ve,{className:"w-4 h-4"}),"Expand Filters"]})]})})})},He=({data:d,onCardClick:f})=>{const w=d.length,g=d.filter(i=>String(i.isNew||"").toLowerCase().includes("new")).length,x=d.filter(i=>i.conversionStatus==="Converted").length,o=d.filter(i=>i.retentionStatus==="Retained").length,s=d.length,m=s>0?x/s*100:0,a=g>0?x/g*100:0,c=g>0?o/g*100:0,l=d.reduce((i,t)=>i+(t.ltv||0),0),r=w>0?l/w:0,n=d.filter(i=>i.conversionStatus==="Converted"&&i.conversionSpan&&i.conversionSpan>0),v=n.length>0?n.reduce((i,t)=>i+t.conversionSpan,0)/n.length:0,u=[{title:"New Members",value:p(g),icon:pe,gradient:"from-blue-500 to-indigo-600",description:"Recently acquired clients",change:12.5,isPositive:!0,previousValue:p(g-Math.round(g*.125)),period:"vs last month",metricType:"new_members",filterData:()=>d.filter(i=>String(i.isNew||"").toLowerCase().includes("new"))},{title:"Converted Members",value:p(x),icon:_,gradient:"from-green-500 to-teal-600",description:"Trial to paid conversions",change:8.3,isPositive:!0,previousValue:p(x-Math.round(x*.083)),period:"vs last month",metricType:"converted_members",filterData:()=>d.filter(i=>i.conversionStatus==="Converted")},{title:"Retained Members",value:p(o),icon:fe,gradient:"from-purple-500 to-violet-600",description:"Active retained clients",change:15.2,isPositive:!0,previousValue:p(o-Math.round(o*.152)),period:"vs last month",metricType:"retained_members",filterData:()=>d.filter(i=>i.retentionStatus==="Retained")},{title:"Conversion Rate",value:`${a.toFixed(1)}%`,icon:P,gradient:"from-orange-500 to-red-600",description:"New to converted rate",change:4.8,isPositive:!0,previousValue:`${(a-4.8).toFixed(1)}%`,period:"vs last month",metricType:"conversion_rate",filterData:()=>d.filter(i=>String(i.isNew||"").includes("New")||i.conversionStatus==="Converted")},{title:"Retention Rate",value:`${c.toFixed(1)}%`,icon:F,gradient:"from-cyan-500 to-blue-600",description:"Member retention rate",change:"+3.1%",isPositive:!0,metricType:"retention_rate",filterData:()=>d.filter(i=>i.retentionStatus==="Retained")},{title:"Avg LTV",value:S(r),icon:Y,gradient:"from-pink-500 to-rose-600",description:"Average lifetime value",change:"+7.2%",isPositive:!0,metricType:"avg_ltv",filterData:()=>d.filter(i=>(i.ltv||0)>0)},{title:"Avg Conv. Time",value:`${v.toFixed(0)} days`,icon:we,gradient:"from-emerald-500 to-green-600",description:"Average conversion time",change:"-2.1 days",isPositive:!0,metricType:"avg_conv_time",filterData:()=>d.filter(i=>i.conversionStatus==="Converted"&&i.firstPurchase&&i.firstVisitDate)},{title:"Trial → Member",value:`${m.toFixed(1)}%`,icon:re,gradient:"from-indigo-500 to-purple-600",description:"Trial conversion rate",change:"+5.4%",isPositive:!0,metricType:"trial_to_member",filterData:()=>d.filter(i=>(i.visitsPostTrial||0)>0)}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:u.map((i,t)=>e.jsxs(M,{className:"group relative overflow-hidden bg-white border border-slate-200 shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1 cursor-pointer",onClick:()=>f?.(i.title,i.filterData(),i.metricType),style:{backgroundColor:"white"},children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${i.gradient} opacity-3 group-hover:opacity-8 transition-opacity duration-300`}),e.jsxs(C,{className:"relative p-6 z-10 bg-white",style:{backgroundColor:"white",color:"#1e293b"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-xl bg-gradient-to-br ${i.gradient} shadow-lg group-hover:scale-110 transition-transform duration-300`,children:e.jsx(i.icon,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"text-right",children:[e.jsxs(j,{className:`text-xs px-3 py-1 font-medium transition-all duration-300 mb-1 ${i.isPositive?"bg-green-100 text-green-800 border-green-200 group-hover:bg-green-200":"bg-red-100 text-red-800 border-red-200 group-hover:bg-red-200"}`,children:[i.isPositive?"+":"",i.change]}),i.previousValue&&e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[e.jsxs("div",{children:["From: ",i.previousValue]}),e.jsx("div",{className:"text-xs opacity-75",children:i.period})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 group-hover:text-slate-800 transition-colors",style:{color:"#334155"},children:i.title}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsx("span",{className:"text-3xl font-bold text-slate-900 group-hover:text-slate-800 transition-colors",style:{color:"#0f172a"},children:i.value})}),e.jsx("p",{className:"text-xs text-slate-500 group-hover:text-slate-600 transition-colors leading-relaxed",style:{color:"#64748b"},children:i.description}),e.jsx("div",{className:"pt-3 border-t border-slate-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`flex-1 h-1 bg-gradient-to-r ${i.gradient} rounded-full opacity-30 group-hover:opacity-50 transition-opacity`}),e.jsx(re,{className:"w-4 h-4 text-slate-400 ml-3 group-hover:text-slate-600 transition-colors"})]})})]})]})]},i.title))})},Be=({data:d})=>{const[f,w]=$.useState("trainer-conversion"),g=V.useMemo(()=>{const i=new Map;return d.forEach(t=>{const h=t.trainerName||"Unknown";i.has(h)||i.set(h,{name:h,totalClients:0,newMembers:0,converted:0,retained:0,totalLTV:0,trialsCompleted:0});const b=i.get(h);b.totalClients++,b.totalLTV+=t.ltv||0,String(t.isNew||"").includes("New")&&b.newMembers++,t.conversionStatus==="Converted"&&b.converted++,t.retentionStatus==="Retained"&&b.retained++,(t.visitsPostTrial||0)>0&&b.trialsCompleted++}),Array.from(i.values()).map(t=>({...t,conversionRate:t.newMembers>0?t.converted/t.newMembers*100:0,retentionRate:t.converted>0?t.retained/t.converted*100:0,avgLTV:t.totalClients>0?t.totalLTV/t.totalClients:0,trialConversionRate:t.trialsCompleted>0?t.converted/t.trialsCompleted*100:0}))},[d]),x=V.useMemo(()=>{const i=new Map;return d.forEach(t=>{const h=t.firstVisitLocation||t.homeLocation||"Unknown";i.has(h)||i.set(h,{name:h,totalClients:0,newMembers:0,converted:0,retained:0,totalLTV:0,trialsCompleted:0});const b=i.get(h);b.totalClients++,b.totalLTV+=t.ltv||0,String(t.isNew||"").includes("New")&&b.newMembers++,t.conversionStatus==="Converted"&&b.converted++,t.retentionStatus==="Retained"&&b.retained++,(t.visitsPostTrial||0)>0&&b.trialsCompleted++}),Array.from(i.values()).map(t=>({...t,conversionRate:t.newMembers>0?t.converted/t.newMembers*100:0,retentionRate:t.converted>0?t.retained/t.converted*100:0,avgLTV:t.totalClients>0?t.totalLTV/t.totalClients:0,trialConversionRate:t.trialsCompleted>0?t.converted/t.trialsCompleted*100:0}))},[d]),o=V.useMemo(()=>{const i=new Map;return d.forEach(t=>{const h=t.firstVisitEntityName||"Unknown Class";i.has(h)||i.set(h,{name:h,totalClients:0,newMembers:0,converted:0,retained:0,totalLTV:0,trialsCompleted:0});const b=i.get(h);b.totalClients++,b.totalLTV+=t.ltv||0,String(t.isNew||"").includes("New")&&b.newMembers++,t.conversionStatus==="Converted"&&b.converted++,t.retentionStatus==="Retained"&&b.retained++,(t.visitsPostTrial||0)>0&&b.trialsCompleted++}),Array.from(i.values()).map(t=>({...t,conversionRate:t.newMembers>0?t.converted/t.newMembers*100:0,retentionRate:t.converted>0?t.retained/t.converted*100:0,avgLTV:t.totalClients>0?t.totalLTV/t.totalClients:0,trialConversionRate:t.trialsCompleted>0?t.converted/t.trialsCompleted*100:0}))},[d]),s=V.useMemo(()=>{const i=new Map;return d.forEach(t=>{const h=t.membershipUsed||"Unknown Membership";i.has(h)||i.set(h,{name:h,totalClients:0,newMembers:0,converted:0,retained:0,totalLTV:0,trialsCompleted:0});const b=i.get(h);b.totalClients++,b.totalLTV+=t.ltv||0,String(t.isNew||"").includes("New")&&b.newMembers++,t.conversionStatus==="Converted"&&b.converted++,t.retentionStatus==="Retained"&&b.retained++,(t.visitsPostTrial||0)>0&&b.trialsCompleted++}),Array.from(i.values()).map(t=>({...t,conversionRate:t.newMembers>0?t.converted/t.newMembers*100:0,retentionRate:t.converted>0?t.retained/t.converted*100:0,avgLTV:t.totalClients>0?t.totalLTV/t.totalClients:0,trialConversionRate:t.trialsCompleted>0?t.converted/t.trialsCompleted*100:0}))},[d]),m=V.useMemo(()=>{const i=new Map;return d.forEach(t=>{const h=`${t.trainerName||"Unknown"} - ${t.firstVisitEntityName||"Unknown Class"}`;i.has(h)||i.set(h,{name:h,trainer:t.trainerName||"Unknown",className:t.firstVisitEntityName||"Unknown Class",totalClients:0,newMembers:0,converted:0,retained:0,totalLTV:0,trialsCompleted:0});const b=i.get(h);b.totalClients++,b.totalLTV+=t.ltv||0,String(t.isNew||"").includes("New")&&b.newMembers++,t.conversionStatus==="Converted"&&b.converted++,t.retentionStatus==="Retained"&&b.retained++,(t.visitsPostTrial||0)>0&&b.trialsCompleted++}),Array.from(i.values()).map(t=>({...t,conversionRate:t.newMembers>0?t.converted/t.newMembers*100:0,retentionRate:t.converted>0?t.retained/t.converted*100:0,avgLTV:t.totalClients>0?t.totalLTV/t.totalClients:0,trialConversionRate:t.trialsCompleted>0?t.converted/t.trialsCompleted*100:0}))},[d]),a=[{id:"trainer-conversion",label:"Trainer Conversion",icon:J,type:"trainer",metric:"conversionRate"},{id:"trainer-retention",label:"Trainer Retention",icon:F,type:"trainer",metric:"retentionRate"},{id:"trainer-ltv",label:"Trainer LTV",icon:Y,type:"trainer",metric:"avgLTV"},{id:"trainer-volume",label:"Trainer Volume",icon:D,type:"trainer",metric:"totalClients"},{id:"location-conversion",label:"Location Conversion",icon:ee,type:"location",metric:"conversionRate"},{id:"location-retention",label:"Location Retention",icon:_,type:"location",metric:"retentionRate"},{id:"location-ltv",label:"Location LTV",icon:P,type:"location",metric:"avgLTV"},{id:"location-volume",label:"Location Volume",icon:D,type:"location",metric:"totalClients"},{id:"class-conversion",label:"Class Conversion",icon:H,type:"class",metric:"conversionRate"},{id:"class-retention",label:"Class Retention",icon:ie,type:"class",metric:"retentionRate"},{id:"class-ltv",label:"Class LTV",icon:Y,type:"class",metric:"avgLTV"},{id:"class-volume",label:"Class Volume",icon:D,type:"class",metric:"totalClients"},{id:"membership-conversion",label:"Membership Conversion",icon:_,type:"membership",metric:"conversionRate"},{id:"membership-retention",label:"Membership Retention",icon:F,type:"membership",metric:"retentionRate"},{id:"membership-ltv",label:"Membership LTV",icon:Y,type:"membership",metric:"avgLTV"},{id:"membership-volume",label:"Membership Volume",icon:D,type:"membership",metric:"totalClients"},{id:"hosted-conversion",label:"Hosted Class Conversion",icon:J,type:"hosted",metric:"conversionRate"},{id:"hosted-retention",label:"Hosted Class Retention",icon:F,type:"hosted",metric:"retentionRate"},{id:"hosted-ltv",label:"Hosted Class LTV",icon:Y,type:"hosted",metric:"avgLTV"},{id:"hosted-volume",label:"Hosted Class Volume",icon:D,type:"hosted",metric:"totalClients"}],c=()=>{const i=a.find(R=>R.id===f);if(!i)return{top:[],bottom:[]};let t;switch(i.type){case"trainer":t=g;break;case"location":t=x;break;case"class":t=o;break;case"membership":t=s;break;case"hosted":t=m;break;default:t=g}const h=i.type==="hosted"?1:i.type==="trainer"?3:1,y=[...t.filter(R=>i.metric==="totalClients"?R.totalClients>=1:R.newMembers>=h)].sort((R,I)=>I[i.metric]-R[i.metric]);return{top:y.slice(0,5),bottom:y.slice(-5).reverse()}},{top:l,bottom:r}=c(),n=a.find(i=>i.id===f),v=(i,t)=>t==="avgLTV"?S(i):t==="totalClients"?p(i):`${i.toFixed(1)}%`,u=({title:i,data:t,isTop:h=!0})=>e.jsxs(M,{className:"group bg-white shadow-lg border-0 overflow-hidden hover:shadow-2xl transition-all duration-500 hover:scale-105",children:[e.jsxs(L,{className:`bg-gradient-to-r ${h?"from-emerald-500 to-teal-600":"from-orange-500 to-red-600"} text-white relative overflow-hidden`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 transform translate-x-8 -translate-y-8 opacity-20",children:h?e.jsx(ne,{className:"w-20 h-20"}):e.jsx(ae,{className:"w-20 h-20"})}),e.jsxs(k,{className:"flex items-center gap-3 relative z-10",children:[h?e.jsx(ne,{className:"w-6 h-6"}):e.jsx(ae,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold",children:i}),e.jsx("p",{className:"text-sm opacity-90 font-normal",children:h?"Top performers":"Needs attention"})]})]})]}),e.jsx(C,{className:"p-6 space-y-4",children:t.map((b,y)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-slate-50 to-slate-100 rounded-xl hover:from-slate-100 hover:to-slate-200 transition-all duration-300 group-hover:scale-105",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full font-bold text-sm transition-all duration-300 ${y===0&&h?"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white shadow-lg":y===1&&h?"bg-gradient-to-r from-gray-300 to-gray-500 text-white shadow-lg":y===2&&h?"bg-gradient-to-r from-orange-400 to-orange-600 text-white shadow-lg":"bg-gradient-to-r from-slate-200 to-slate-300 text-slate-600"}`,children:y+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900 truncate max-w-[140px]",title:b.name,children:b.name}),e.jsxs("p",{className:"text-sm text-slate-500",children:[p(b.totalClients)," clients",b.trainer&&e.jsxs("span",{className:"block text-xs",children:["by ",b.trainer]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(j,{className:`font-bold text-sm px-3 py-1 ${h?"bg-emerald-100 text-emerald-800 border border-emerald-200":"bg-orange-100 text-orange-800 border border-orange-200"}`,children:v(b[n?.metric||"conversionRate"],n?.metric||"conversionRate")}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[S(b.avgLTV)," LTV"]})]})]},b.name))})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(M,{className:"bg-white shadow-lg border-0",children:[e.jsx(L,{children:e.jsxs(k,{className:"flex items-center gap-3 text-slate-800",children:[e.jsx(J,{className:"w-6 h-6 text-yellow-600"}),"Performance Rankings"]})}),e.jsx(C,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3",children:a.map(i=>e.jsxs(A,{variant:f===i.id?"default":"ghost",size:"sm",onClick:()=>w(i.id),className:`flex flex-col items-center gap-2 h-auto py-3 px-2 transition-all duration-300 hover:scale-105 ${f===i.id?"bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg":"hover:bg-slate-100"}`,children:[e.jsx(i.icon,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium text-center leading-tight",children:i.label})]},i.id))})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(u,{title:`Top ${n?.label||"Performance"}`,data:l,isTop:!0}),e.jsx(u,{title:`Bottom ${n?.label||"Performance"}`,data:r,isTop:!1})]})]})},_e=({data:d})=>{const[f,w]=$.useState("monthly-trends"),g=[{id:"monthly-trends",label:"Monthly Trends",icon:P,type:"line"},{id:"conversion-funnel",label:"Conversion Funnel",icon:F,type:"bar"},{id:"location-performance",label:"Location Performance",icon:ee,type:"bar"},{id:"trainer-performance",label:"Trainer Performance",icon:D,type:"bar"},{id:"retention-analysis",label:"Retention Analysis",icon:Ne,type:"area"},{id:"ltv-distribution",label:"LTV Distribution",icon:Y,type:"pie"}],x=V.useMemo(()=>{const l=new Map;return d.forEach(r=>{if(!r.firstVisitDate)return;let n;if(r.firstVisitDate.includes("/")){const[i,t,h]=r.firstVisitDate.split(" ")[0].split("/");n=new Date(parseInt(h),parseInt(t)-1,parseInt(i))}else n=new Date(r.firstVisitDate);if(isNaN(n.getTime()))return;const v=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`;l.has(v)||l.set(v,{month:v,newMembers:0,converted:0,retained:0,revenue:0});const u=l.get(v);String(r.isNew||"").includes("New")&&u.newMembers++,r.conversionStatus==="Converted"&&u.converted++,r.retentionStatus==="Retained"&&u.retained++,u.revenue+=r.ltv||0}),Array.from(l.values()).sort((r,n)=>r.month.localeCompare(n.month)).map(r=>({...r,conversionRate:r.newMembers>0?r.converted/r.newMembers*100:0,retentionRate:r.converted>0?r.retained/r.converted*100:0}))},[d]),o=V.useMemo(()=>{const l=new Map;return d.forEach(r=>{const n=r.firstVisitLocation||r.homeLocation||"Unknown";l.has(n)||l.set(n,{location:n,newMembers:0,converted:0,retained:0,revenue:0});const v=l.get(n);String(r.isNew||"").includes("New")&&v.newMembers++,r.conversionStatus==="Converted"&&v.converted++,r.retentionStatus==="Retained"&&v.retained++,v.revenue+=r.ltv||0}),Array.from(l.values()).map(r=>({...r,conversionRate:r.newMembers>0?r.converted/r.newMembers*100:0,retentionRate:r.converted>0?r.retained/r.converted*100:0})).sort((r,n)=>n.revenue-r.revenue)},[d]),s=V.useMemo(()=>{const l=new Map;return d.forEach(r=>{const n=r.trainerName||"Unknown";l.has(n)||l.set(n,{trainer:n,newMembers:0,converted:0,retained:0,revenue:0});const v=l.get(n);String(r.isNew||"").includes("New")&&v.newMembers++,r.conversionStatus==="Converted"&&v.converted++,r.retentionStatus==="Retained"&&v.retained++,v.revenue+=r.ltv||0}),Array.from(l.values()).filter(r=>r.newMembers>=3).map(r=>({...r,conversionRate:r.newMembers>0?r.converted/r.newMembers*100:0,retentionRate:r.converted>0?r.retained/r.converted*100:0})).sort((r,n)=>n.conversionRate-r.conversionRate).slice(0,10)},[d]),m=V.useMemo(()=>{const l=[{name:"₹0-5K",min:0,max:5e3,count:0,color:"#ef4444"},{name:"₹5K-15K",min:5e3,max:15e3,count:0,color:"#f97316"},{name:"₹15K-30K",min:15e3,max:3e4,count:0,color:"#eab308"},{name:"₹30K-50K",min:3e4,max:5e4,count:0,color:"#22c55e"},{name:"₹50K+",min:5e4,max:1/0,count:0,color:"#3b82f6"}];return d.forEach(r=>{const n=r.ltv||0,v=l.find(u=>n>=u.min&&n<u.max);v&&v.count++}),l.filter(r=>r.count>0)},[d]),a=()=>{switch(g.find(l=>l.id===f),f){case"monthly-trends":return e.jsx(K,{width:"100%",height:400,children:e.jsxs(Ie,{data:x,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(G,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(E,{dataKey:"month",stroke:"#64748b",fontSize:12,tickFormatter:r=>{const[n,v]=r.split("-");return`${v}/${n.slice(2)}`}}),e.jsx(U,{stroke:"#64748b",fontSize:12}),e.jsx(O,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:(r,n)=>[n.includes("Rate")?`${r.toFixed(1)}%`:p(r),n]}),e.jsx(oe,{type:"monotone",dataKey:"newMembers",stroke:"#3b82f6",strokeWidth:3,dot:{fill:"#3b82f6",strokeWidth:2,r:6},name:"New Members"}),e.jsx(oe,{type:"monotone",dataKey:"conversionRate",stroke:"#22c55e",strokeWidth:3,dot:{fill:"#22c55e",strokeWidth:2,r:6},name:"Conversion Rate"})]})});case"conversion-funnel":const l=[{name:"New Members",value:d.filter(r=>String(r.isNew||"").includes("New")).length,color:"#3b82f6"},{name:"Trials Completed",value:d.filter(r=>(r.visitsPostTrial||0)>0).length,color:"#8b5cf6"},{name:"Converted",value:d.filter(r=>r.conversionStatus==="Converted").length,color:"#22c55e"},{name:"Retained",value:d.filter(r=>r.retentionStatus==="Retained").length,color:"#f97316"}];return e.jsx(K,{width:"100%",height:400,children:e.jsxs(q,{data:l,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(G,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(E,{dataKey:"name",stroke:"#64748b",fontSize:12}),e.jsx(U,{stroke:"#64748b",fontSize:12}),e.jsx(O,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:r=>[p(r),"Count"]}),e.jsx(B,{dataKey:"value",fill:"#3b82f6",radius:[4,4,0,0]})]})});case"location-performance":return e.jsx(K,{width:"100%",height:400,children:e.jsxs(q,{data:o,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(G,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(E,{dataKey:"location",stroke:"#64748b",fontSize:12,angle:-45,textAnchor:"end",height:80,tickFormatter:r=>r.length>15?`${r.slice(0,15)}...`:r}),e.jsx(U,{stroke:"#64748b",fontSize:12}),e.jsx(O,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:(r,n)=>[n.includes("Rate")?`${r.toFixed(1)}%`:p(r),n]}),e.jsx(B,{dataKey:"conversionRate",fill:"#22c55e",radius:[4,4,0,0],name:"Conversion Rate"})]})});case"trainer-performance":return e.jsx(K,{width:"100%",height:400,children:e.jsxs(q,{data:s,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(G,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(E,{dataKey:"trainer",stroke:"#64748b",fontSize:12,angle:-45,textAnchor:"end",height:80,tickFormatter:r=>r.length>10?`${r.slice(0,10)}...`:r}),e.jsx(U,{stroke:"#64748b",fontSize:12}),e.jsx(O,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:(r,n)=>[n.includes("Rate")?`${r.toFixed(1)}%`:p(r),n]}),e.jsx(B,{dataKey:"conversionRate",fill:"#8b5cf6",radius:[4,4,0,0],name:"Conversion Rate"}),e.jsx(B,{dataKey:"retentionRate",fill:"#06b6d4",radius:[4,4,0,0],name:"Retention Rate"})]})});case"retention-analysis":return e.jsx(K,{width:"100%",height:400,children:e.jsxs(Fe,{data:x,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(G,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(E,{dataKey:"month",stroke:"#64748b",fontSize:12,tickFormatter:r=>{const[n,v]=r.split("-");return`${v}/${n.slice(2)}`}}),e.jsx(U,{stroke:"#64748b",fontSize:12}),e.jsx(O,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:(r,n)=>[n.includes("Rate")?`${r.toFixed(1)}%`:p(r),n]}),e.jsx(Pe,{type:"monotone",dataKey:"retentionRate",stackId:"1",stroke:"#f97316",fill:"url(#retentionGradient)",name:"Retention Rate"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"retentionGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#f97316",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#f97316",stopOpacity:.1})]})})]})});case"ltv-distribution":return e.jsx(K,{width:"100%",height:400,children:e.jsxs($e,{children:[e.jsx(Ye,{data:m,cx:"50%",cy:"50%",outerRadius:150,fill:"#8884d8",dataKey:"count",label:({name:r,percent:n})=>`${r} (${(n*100).toFixed(1)}%)`,children:m.map((r,n)=>e.jsx(Ae,{fill:r.color},`cell-${n}`))}),e.jsx(O,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:r=>[p(r),"Clients"]})]})});default:return null}},c=g.find(l=>l.id===f);return e.jsxs(M,{className:"bg-white shadow-lg border-0 overflow-hidden",children:[e.jsx(L,{className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white",children:e.jsxs(k,{className:"flex items-center gap-3",children:[e.jsx(te,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-sm opacity-90",children:"Interactive charts and visualizations"})]})]})}),e.jsxs(C,{className:"p-6",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3 mb-6",children:g.map(l=>e.jsxs(A,{variant:f===l.id?"default":"ghost",size:"sm",onClick:()=>w(l.id),className:`flex flex-col items-center gap-2 h-auto py-4 px-3 transition-all duration-300 hover:scale-105 ${f===l.id?"bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg":"hover:bg-slate-100"}`,children:[e.jsx(l.icon,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium text-center leading-tight",children:l.label})]},l.id))}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[c&&e.jsx(c.icon,{className:"w-5 h-5 text-slate-600"}),e.jsx("h4",{className:"text-lg font-semibold text-slate-800",children:c?.label})]}),e.jsxs(j,{className:"bg-blue-100 text-blue-800",children:[d.length," records"]})]}),a()]})]})]})},We=({activeTable:d,onTableChange:f,dataLength:w})=>{const g=[{key:"monthonmonthbytype",label:"By Client Type",description:"Monthly breakdown by client type",icon:D,gradient:"from-purple-500 to-pink-600"},{key:"monthonmonth",label:"Month on Month",description:"Monthly trends and comparisons",icon:H,gradient:"from-blue-500 to-indigo-600"},{key:"yearonyear",label:"Year on Year",description:"Annual performance comparison",icon:P,gradient:"from-green-500 to-emerald-600"},{key:"hostedclasses",label:"Hosted Classes",description:"Class performance metrics",icon:D,gradient:"from-purple-500 to-violet-600"},{key:"memberships",label:"Membership Analysis",description:"Membership type breakdown",icon:te,gradient:"from-orange-500 to-red-600"}];return e.jsxs("div",{className:"bg-gradient-to-r from-slate-50 to-gray-100 p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Data Analysis Tables"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Select a table to view detailed metrics"})]}),e.jsxs(j,{className:"bg-blue-100 text-blue-800 border-blue-200",children:[w," Records"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:g.map(x=>e.jsxs(A,{variant:d===x.key?"default":"outline",className:`h-auto p-4 flex-col items-start gap-2 transition-all duration-300 ${d===x.key?`bg-gradient-to-r ${x.gradient} text-white shadow-lg hover:shadow-xl`:"bg-white hover:bg-gray-50 border-gray-200 hover:border-gray-300"}`,onClick:()=>f(x.key),children:[e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx(x.icon,{className:`w-5 h-5 ${d===x.key?"text-white":"text-gray-600"}`}),e.jsx("span",{className:`font-semibold text-sm ${d===x.key?"text-white":"text-gray-900"}`,children:x.label})]}),e.jsx("p",{className:`text-xs text-left w-full ${d===x.key?"text-white/90":"text-gray-500"}`,children:x.description})]},x.key))})]})},Je=({data:d,visitsSummary:f,onRowClick:w})=>{const g=V.useMemo(()=>{const a=(()=>{const l=[],r=new Date,n=r.getMonth(),v=r.getFullYear();for(let u=v;u>=2024;u--){const i=u===v?n:11,t=0;for(let h=i;h>=t;h--){const b=`${u}-${(h+1).toString().padStart(2,"0")}`,y=new Date(u,h).toLocaleDateString("en-US",{month:"short",year:"numeric"});l.push({key:b,name:y})}}return l})().reduce((l,r)=>(l[r.key]={month:r.name,sortKey:r.key,totalMembers:0,newMembers:0,converted:0,retained:0,totalLTV:0,conversionIntervals:[],visitsPostTrial:[],clients:[]},l),{});return d.forEach(l=>{const r=l.firstVisitDate;let n;if(r.includes("/")){const u=r.split(" ")[0].split("/");if(u.length===3){const[i,t,h]=u;n=new Date(parseInt(h),parseInt(t)-1,parseInt(i)),isNaN(n.getTime())&&(n=new Date(parseInt(h),parseInt(i)-1,parseInt(t)))}else n=new Date(r)}else n=new Date(r);if(isNaN(n.getTime()))return;const v=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`;a[v]&&(a[v].totalMembers++,a[v].clients.push(l),(l.isNew||"").toLowerCase().includes("new")&&a[v].newMembers++,l.conversionStatus==="Converted"&&a[v].converted++,l.retentionStatus==="Retained"&&a[v].retained++,a[v].totalLTV+=l.ltv||0,l.conversionSpan&&l.conversionSpan>0&&a[v].conversionIntervals.push(l.conversionSpan),l.visitsPostTrial&&l.visitsPostTrial>0&&a[v].visitsPostTrial.push(l.visitsPostTrial))}),f&&Object.keys(a).forEach(l=>{const r=a[l],[n,v]=l.split("-"),t=`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(v)-1]} ${n}`;r.visits=f[t]||0}),Object.values(a).map(l=>({...l,trialsCompleted:l.visitsPostTrial.length,conversionRate:l.newMembers>0?l.converted/l.newMembers*100:0,retentionRate:l.newMembers>0?l.retained/l.newMembers*100:0,avgLTV:l.totalMembers>0?l.totalLTV/l.totalMembers:0,avgConversionInterval:l.conversionIntervals.length>0?l.conversionIntervals.reduce((r,n)=>r+n,0)/l.conversionIntervals.length:0,avgVisitsPostTrial:l.visitsPostTrial.length>0?l.visitsPostTrial.reduce((r,n)=>r+n,0)/l.visitsPostTrial.length:0})).sort((l,r)=>r.sortKey.localeCompare(l.sortKey))},[d]),x=[{key:"month",header:"Month",className:"font-semibold min-w-[100px]",render:s=>e.jsx("div",{className:"font-bold text-slate-800 bg-gradient-to-r from-blue-50 to-purple-50 px-3 py-2 rounded-lg",children:s})},{key:"visits",header:"Visits",align:"center",render:s=>e.jsx("span",{className:"text-base font-bold text-cyan-600",children:p(s)})},{key:"totalMembers",header:"Trials",align:"center",render:s=>e.jsx("span",{className:"text-base font-bold text-blue-600",children:p(s)})},{key:"newMembers",header:"New Members",align:"center",render:s=>e.jsx("span",{className:"text-base font-bold text-green-600",children:p(s)})},{key:"retained",header:"Retained",align:"center",render:s=>e.jsx("span",{className:"text-base font-bold text-purple-600",children:p(s)})},{key:"retentionRate",header:"Retention %",align:"center",render:s=>e.jsxs("span",{className:`text-base font-bold ${s>70?"text-purple-600":s<40?"text-red-600":"text-slate-600"}`,children:[s.toFixed(1),"%"]})},{key:"converted",header:"Converted",align:"center",render:s=>e.jsx("span",{className:"text-base font-bold text-emerald-600",children:p(s)})},{key:"conversionRate",header:"Conversion %",align:"center",render:s=>e.jsxs("span",{className:`text-base font-bold ${s>25?"text-green-600":s<10?"text-red-600":"text-slate-600"}`,children:[s.toFixed(1),"%"]})},{key:"avgLTV",header:"Avg LTV",align:"right",render:s=>e.jsx("span",{className:"text-base font-bold text-teal-600",children:S(s)})},{key:"avgConversionInterval",header:"Avg Conv Days",align:"center",render:s=>e.jsx("span",{className:"text-base font-bold text-orange-600",children:Math.round(s)})},{key:"avgVisitsPostTrial",header:"Avg Visits",align:"center",render:s=>e.jsx("span",{className:"text-base font-bold text-blue-600",children:s.toFixed(1)})}],o={month:"TOTAL",totalMembers:g.reduce((s,m)=>s+m.totalMembers,0),newMembers:g.reduce((s,m)=>s+m.newMembers,0),converted:g.reduce((s,m)=>s+m.converted,0),conversionRate:0,retained:g.reduce((s,m)=>s+m.retained,0),retentionRate:0,totalLTV:g.reduce((s,m)=>s+m.totalLTV,0),avgLTV:g.reduce((s,m)=>s+m.totalLTV,0)/Math.max(g.reduce((s,m)=>s+m.totalMembers,0),1),avgConversionInterval:g.reduce((s,m)=>s+m.avgConversionInterval*m.totalMembers,0)/Math.max(g.reduce((s,m)=>s+m.totalMembers,0),1),avgVisitsPostTrial:g.reduce((s,m)=>s+m.avgVisitsPostTrial*m.totalMembers,0)/Math.max(g.reduce((s,m)=>s+m.totalMembers,0),1)};return o.conversionRate=o.newMembers>0?o.converted/o.newMembers*100:0,o.retentionRate=o.newMembers>0?o.retained/o.newMembers*100:0,e.jsx(xe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs(M,{className:"bg-white shadow-xl border-0 overflow-hidden hover:shadow-2xl transition-all duration-300",children:[e.jsx(L,{className:"border-b border-gray-100 bg-gradient-to-r from-blue-600 to-cyan-600 text-white",children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Month-on-Month Client Conversion Analysis",e.jsxs(j,{variant:"secondary",className:"bg-white/20 text-white",children:[g.length," Months"]})]})}),e.jsx(C,{className:"p-0",children:e.jsx(W,{data:g,columns:x,headerGradient:"from-blue-600 to-cyan-600",showFooter:!0,footerData:o,maxHeight:"600px",onRowClick:w})})]})})},Qe=({data:d,checkins:f,visitsSummary:w,onRowClick:g})=>{const x=$.useMemo(()=>{if(!d||d.length===0)return[];[...new Set(d.map(c=>c.isNew||"Unknown").filter(Boolean))],f&&f.forEach(c=>{c.month&&c.year&&c.isNew&&(`${c.year}${String(new Date(Date.parse(c.month+" 1, "+c.year)).getMonth()+1).padStart(2,"0")}`,`${c.isNew}`)});const a={};return d.forEach(c=>{const l=c.firstVisitDate;if(!l)return;let r;if(l.includes("/")){const b=l.split(" ")[0].split("/");if(b.length===3){const[y,R,I]=b;r=new Date(parseInt(I),parseInt(R)-1,parseInt(y)),isNaN(r.getTime())&&(r=new Date(parseInt(I),parseInt(y)-1,parseInt(R)))}else r=new Date(l)}else r=new Date(l);if(isNaN(r.getTime()))return;const n=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`,v=r.toLocaleDateString("en-US",{month:"short",year:"numeric"}),u=c.isNew||"Unknown",i=`${n}-${u}`;if(!a[i]){const b=`${c.firstVisitDate?.split("T")[0].substring(0,7)}`,y=w?.[b]||0;a[i]={month:v,sortKey:n,type:u,visits:y,totalTrials:0,newMembers:0,converted:0,retained:0,totalLTV:0,conversionIntervals:[],visitsPostTrial:[],clients:[]}}const t=a[i];t.totalTrials++,t.clients.push(c),(c.isNew||"").toLowerCase().includes("new")&&t.newMembers++,c.conversionStatus==="Converted"&&t.converted++,c.retentionStatus==="Retained"&&t.retained++,t.totalLTV+=c.ltv||0,c.conversionSpan&&c.conversionSpan>0&&t.conversionIntervals.push(c.conversionSpan),c.visitsPostTrial&&c.visitsPostTrial>0&&t.visitsPostTrial.push(c.visitsPostTrial)}),Object.values(a).sort((c,l)=>{const r=c.sortKey.localeCompare(l.sortKey);return r!==0?r:c.type.toLowerCase().includes("new")&&!l.type.toLowerCase().includes("new")?-1:!c.type.toLowerCase().includes("new")&&l.type.toLowerCase().includes("new")?1:c.type.localeCompare(l.type)})},[d,f]),o=$.useMemo(()=>x.map(a=>{const c=a.newMembers>0?a.converted/a.newMembers*100:0,l=a.newMembers>0?a.retained/a.newMembers*100:0,r=a.totalTrials>0?a.totalLTV/a.totalTrials:0,n=a.conversionIntervals.length>0?a.conversionIntervals.reduce((u,i)=>u+i,0)/a.conversionIntervals.length:0,v=a.visitsPostTrial.length>0?a.visitsPostTrial.reduce((u,i)=>u+i,0)/a.visitsPostTrial.length:0;return{...a,conversionRate:c,retentionRate:l,avgLTV:r,avgConversionDays:n,avgVisits:v}}),[x]),s=$.useMemo(()=>o.reduce((a,c)=>({visits:a.visits+(c.visits||0),totalTrials:a.totalTrials+c.totalTrials,newMembers:a.newMembers+c.newMembers,converted:a.converted+c.converted,retained:a.retained+c.retained,totalLTV:a.totalLTV+c.totalLTV,conversionIntervals:[...a.conversionIntervals,...c.conversionIntervals],visitsPostTrial:[...a.visitsPostTrial,...c.visitsPostTrial]}),{visits:0,totalTrials:0,newMembers:0,converted:0,retained:0,totalLTV:0,conversionIntervals:[],visitsPostTrial:[]}),[o]),m=$.useMemo(()=>{const a=s.newMembers>0?s.converted/s.newMembers*100:0,c=s.newMembers>0?s.retained/s.newMembers*100:0,l=s.totalTrials>0?s.totalLTV/s.totalTrials:0,r=s.conversionIntervals.length>0?s.conversionIntervals.reduce((v,u)=>v+u,0)/s.conversionIntervals.length:0,n=s.visitsPostTrial.length>0?s.visitsPostTrial.reduce((v,u)=>v+u,0)/s.visitsPostTrial.length:0;return{month:"TOTALS",type:"All Types",visits:s.visits,totalTrials:s.totalTrials,newMembers:s.newMembers,converted:s.converted,retained:s.retained,conversionRate:a,retentionRate:c,avgLTV:l,avgConversionDays:r,avgVisits:n}},[s]);return e.jsxs(M,{className:"bg-white shadow-lg border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx(L,{className:"bg-gradient-to-r from-indigo-700 to-purple-900 text-white pb-4",children:e.jsxs(k,{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Month-on-Month Analysis by Client Type",e.jsxs(j,{variant:"secondary",className:"ml-2 bg-white/20 text-white border-white/30",children:[Object.keys(x).length," Entries"]})]})}),e.jsx(C,{className:"p-0 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto max-h-[600px]",children:e.jsxs(ce,{className:"w-full",children:[e.jsx(de,{className:"sticky top-0 z-20",children:e.jsxs(z,{className:`border-b h-12 ${De("retention")}`,children:[e.jsx(T,{className:"font-bold text-white text-xs px-4 sticky left-0 z-10 min-w-[100px]",children:"Month"}),e.jsx(T,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Type"}),e.jsx(T,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Visits"}),e.jsx(T,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Trials"}),e.jsx(T,{className:"font-bold text-white text-xs px-3 text-center min-w-[90px]",children:"New Members"}),e.jsx(T,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Retained"}),e.jsx(T,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Retention %"}),e.jsx(T,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Converted"}),e.jsx(T,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Conversion %"}),e.jsx(T,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Avg LTV"}),e.jsx(T,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Avg Conv Days"}),e.jsx(T,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Avg Visits"})]})}),e.jsxs(me,{children:[o.map((a,c)=>e.jsxs(z,{className:"hover:bg-gray-50 transition-colors cursor-pointer border-b border-gray-100 h-10",onClick:()=>g?.(a),children:[e.jsx(N,{className:"font-semibold text-gray-900 text-xs px-4 sticky left-0 bg-slate-100 z-10 border-r",children:a.month}),e.jsx(N,{className:"text-xs px-3 text-left",children:e.jsx(j,{variant:a.type.toLowerCase().includes("new")?"default":"secondary",className:"text-xs rounded-t rounded-b py-2 min-w-52 bg-indigo-900 text-white font-medium rounded-lg",children:a.type})}),e.jsx(N,{className:"text-xs px-3 text-center font-medium text-cyan-600",children:p(a.visits||0)}),e.jsx(N,{className:"text-xs px-3 text-center font-medium",children:p(a.totalTrials)}),e.jsx(N,{className:"text-xs px-3 text-center font-medium",children:p(a.newMembers)}),e.jsx(N,{className:"text-xs px-3 text-center font-medium",children:p(a.retained)}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsxs("span",{className:`font-semibold ${a.retentionRate>=70?"text-green-600":a.retentionRate>=50?"text-orange-600":"text-red-600"}`,children:[a.retentionRate.toFixed(1),"%"]})}),e.jsx(N,{className:"text-xs px-3 text-center font-medium",children:p(a.converted)}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsxs("span",{className:`font-semibold ${a.conversionRate>=50?"text-green-600":a.conversionRate>=30?"text-orange-600":"text-red-600"}`,children:[a.conversionRate.toFixed(1),"%"]})}),e.jsx(N,{className:"text-xs px-3 text-right font-semibold text-emerald-600",children:S(a.avgLTV)}),e.jsxs(N,{className:"text-xs px-3 text-center font-medium",children:[a.avgConversionDays.toFixed(0)," days"]}),e.jsx(N,{className:"text-xs px-3 text-center font-medium",children:a.avgVisits.toFixed(1)})]},`${a.month}-${a.type}`)),e.jsxs(z,{className:"border-t-4 border-gray-800 text-gray-900",children:[e.jsx(N,{className:"border-t-4 border-gray-800 text-gray-900",children:m.month}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsx(j,{variant:"outline",className:"text-xs font-bold",children:m.type})}),e.jsx(N,{className:"text-xs px-3 text-center font-bold text-cyan-600",children:p(m.visits)}),e.jsx(N,{className:"text-xs px-3 text-center font-bold",children:p(m.totalTrials)}),e.jsx(N,{className:"text-xs px-3 text-center font-bold",children:p(m.newMembers)}),e.jsx(N,{className:"text-xs px-3 text-center font-bold",children:p(m.retained)}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsxs("span",{className:`font-bold ${m.retentionRate>=70?"text-green-600":m.retentionRate>=50?"text-orange-600":"text-red-600"}`,children:[m.retentionRate.toFixed(1),"%"]})}),e.jsx(N,{className:"text-xs px-3 text-center font-bold",children:p(m.converted)}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsxs("span",{className:`font-bold ${m.conversionRate>=50?"text-green-600":m.conversionRate>=30?"text-orange-600":"text-red-600"}`,children:[m.conversionRate.toFixed(1),"%"]})}),e.jsx(N,{className:"text-xs px-3 text-right font-bold text-emerald-600",children:S(m.avgLTV)}),e.jsxs(N,{className:"text-xs px-3 text-center font-bold",children:[m.avgConversionDays.toFixed(0)," days"]}),e.jsx(N,{className:"text-xs px-3 text-center font-bold",children:m.avgVisits.toFixed(1)})]})]})]})})})]})},Xe=({data:d,visitsSummary:f,onRowClick:w})=>{const g=V.useMemo(()=>{const a=new Date().getFullYear(),c=a-1,r=Array.from({length:12},(n,v)=>{const u=v+1,i=new Date(2024,v).toLocaleDateString("en-US",{month:"short"});return{monthName:i,monthNumber:u,key:i}}).reduce((n,v)=>(n[v.key]={month:v.monthName,sortOrder:v.monthNumber,currentYear:{totalMembers:0,visits:0,newMembers:0,converted:0,retained:0,totalLTV:0,clients:[]},previousYear:{totalMembers:0,visits:0,newMembers:0,converted:0,retained:0,totalLTV:0,clients:[]}},n),{});return d.forEach(n=>{const v=n.firstVisitDate;let u;if(v.includes("/")){const h=v.split(" ")[0].split("/");if(h.length===3){const[b,y,R]=h;u=new Date(parseInt(R),parseInt(y)-1,parseInt(b)),isNaN(u.getTime())&&(u=new Date(parseInt(R),parseInt(b)-1,parseInt(y)))}else u=new Date(v)}else u=new Date(v);if(isNaN(u.getTime()))return;const i=u.getFullYear();u.getMonth()+1;const t=u.toLocaleDateString("en-US",{month:"short"});if((i===a||i===c)&&r[t]){const h=i===a?r[t].currentYear:r[t].previousYear;h.totalMembers++,h.clients.push(n),(n.isNew||"").toLowerCase().includes("new")&&h.newMembers++,n.conversionStatus==="Converted"&&h.converted++,n.retentionStatus==="Retained"&&h.retained++,h.totalLTV+=n.ltv||0}}),f&&Object.values(r).forEach(n=>{const v=new Date().getFullYear(),u=v-1,i=`${n.month} ${v}`,t=`${n.month} ${u}`;n.currentYear.visits=f[i]||0,n.previousYear.visits=f[t]||0}),Object.values(r).map(n=>{const v=n.currentYear.newMembers>0?n.currentYear.converted/n.currentYear.newMembers*100:0,u=n.previousYear.newMembers>0?n.previousYear.converted/n.previousYear.newMembers*100:0,i=n.currentYear.newMembers>0?n.currentYear.retained/n.currentYear.newMembers*100:0,t=n.previousYear.newMembers>0?n.previousYear.retained/n.previousYear.newMembers*100:0,h=n.currentYear.totalMembers>0?n.currentYear.totalLTV/n.currentYear.totalMembers:0,b=n.previousYear.totalMembers>0?n.previousYear.totalLTV/n.previousYear.totalMembers:0;return{month:n.month,sortOrder:n.sortOrder,currentVisits:n.currentYear.visits,previousVisits:n.previousYear.visits,visitsGrowth:n.previousYear.visits>0?(n.currentYear.visits-n.previousYear.visits)/n.previousYear.visits*100:0,currentTotalMembers:n.currentYear.totalMembers,previousTotalMembers:n.previousYear.totalMembers,totalMembersGrowth:n.previousYear.totalMembers>0?(n.currentYear.totalMembers-n.previousYear.totalMembers)/n.previousYear.totalMembers*100:0,currentNewMembers:n.currentYear.newMembers,previousNewMembers:n.previousYear.newMembers,newMembersGrowth:n.previousYear.newMembers>0?(n.currentYear.newMembers-n.previousYear.newMembers)/n.previousYear.newMembers*100:0,currentConverted:n.currentYear.converted,previousConverted:n.previousYear.converted,currentConversionRate:v,previousConversionRate:u,conversionRateGrowth:u>0?v-u:0,currentRetained:n.currentYear.retained,previousRetained:n.previousYear.retained,currentRetentionRate:i,previousRetentionRate:t,retentionRateGrowth:t>0?i-t:0,currentTotalLTV:n.currentYear.totalLTV,previousTotalLTV:n.previousYear.totalLTV,currentAvgLTV:h,previousAvgLTV:b,avgLTVGrowth:b>0?(h-b)/b*100:0,currentClients:n.currentYear.clients,previousClients:n.previousYear.clients}}).sort((n,v)=>n.sortOrder-v.sortOrder)},[d]),x=[{key:"month",header:"Month",className:"font-semibold min-w-[80px]"},{key:"currentVisits",header:`${new Date().getFullYear()} Visits`,align:"center",render:a=>e.jsx("span",{className:"text-base font-bold text-cyan-600",children:p(a)})},{key:"previousVisits",header:`${new Date().getFullYear()-1} Visits`,align:"center",render:a=>e.jsx("span",{className:"text-base font-bold text-slate-600",children:p(a)})},{key:"visitsGrowth",header:"Visits Growth %",align:"center",render:a=>e.jsxs("span",{className:`text-base font-bold ${(a||0)>0?"text-green-600":(a||0)<0?"text-red-600":"text-slate-600"}`,children:[(a||0)>0?"+":"",(a||0).toFixed(1),"%"]})},{key:"currentTotalMembers",header:`${new Date().getFullYear()} Total`,align:"center",render:a=>e.jsx("span",{className:"text-base font-bold text-blue-600",children:p(a)})},{key:"previousTotalMembers",header:`${new Date().getFullYear()-1} Total`,align:"center",render:a=>e.jsx("span",{className:"text-base font-bold text-slate-600",children:p(a)})},{key:"totalMembersGrowth",header:"Total Growth %",align:"center",render:a=>e.jsxs("span",{className:`text-base font-bold ${(a||0)>0?"text-green-600":(a||0)<0?"text-red-600":"text-slate-600"}`,children:[(a||0)>0?"+":"",(a||0).toFixed(1),"%"]})},{key:"currentNewMembers",header:`${new Date().getFullYear()} New`,align:"center",render:a=>e.jsx("span",{className:"text-base font-bold text-green-600",children:p(a)})},{key:"previousNewMembers",header:`${new Date().getFullYear()-1} New`,align:"center",render:a=>e.jsx("span",{className:"text-base font-bold text-slate-600",children:p(a)})},{key:"newMembersGrowth",header:"Growth %",align:"center",render:a=>e.jsxs("span",{className:`text-base font-bold ${(a||0)>0?"text-green-600":(a||0)<0?"text-red-600":"text-slate-600"}`,children:[(a||0)>0?"+":"",(a||0).toFixed(1),"%"]})},{key:"currentConversionRate",header:`${new Date().getFullYear()} Conv.`,align:"center",render:a=>e.jsxs("span",{className:"text-base font-bold text-green-600",children:[(a||0).toFixed(1),"%"]})},{key:"previousConversionRate",header:`${new Date().getFullYear()-1} Conv.`,align:"center",render:a=>e.jsxs("span",{className:"text-base font-bold text-slate-600",children:[(a||0).toFixed(1),"%"]})},{key:"conversionRateGrowth",header:"Conv. Δ",align:"center",render:a=>e.jsxs("span",{className:`text-base font-bold ${(a||0)>0?"text-green-600":(a||0)<0?"text-red-600":"text-slate-600"}`,children:[(a||0)>0?"+":"",(a||0).toFixed(1),"pp"]})},{key:"currentAvgLTV",header:`${new Date().getFullYear()} LTV`,align:"right",render:a=>e.jsx("span",{className:"text-base font-bold text-purple-600",children:S(a||0)})},{key:"previousAvgLTV",header:`${new Date().getFullYear()-1} LTV`,align:"right",render:a=>e.jsx("span",{className:"text-base font-bold text-slate-600",children:S(a||0)})},{key:"avgLTVGrowth",header:"LTV Growth",align:"center",render:a=>e.jsxs("span",{className:`text-base font-bold ${(a||0)>0?"text-green-600":(a||0)<0?"text-red-600":"text-slate-600"}`,children:[(a||0)>0?"+":"",(a||0).toFixed(1),"%"]})}],o={month:"TOTAL",currentTotalMembers:g.reduce((a,c)=>a+(c.currentTotalMembers||0),0),previousTotalMembers:g.reduce((a,c)=>a+(c.previousTotalMembers||0),0),totalMembersGrowth:0,currentNewMembers:g.reduce((a,c)=>a+(c.currentNewMembers||0),0),previousNewMembers:g.reduce((a,c)=>a+(c.previousNewMembers||0),0),newMembersGrowth:0,currentConversionRate:0,previousConversionRate:0,conversionRateGrowth:0,currentAvgLTV:g.reduce((a,c)=>a+(c.currentTotalLTV||0),0)/Math.max(g.reduce((a,c)=>a+(c.currentTotalMembers||0),0),1),previousAvgLTV:g.reduce((a,c)=>a+(c.previousTotalLTV||0),0)/Math.max(g.reduce((a,c)=>a+(c.previousTotalMembers||0),0),1),avgLTVGrowth:0},s=g.reduce((a,c)=>a+(c.currentConverted||0),0),m=g.reduce((a,c)=>a+(c.previousConverted||0),0);return o.totalMembersGrowth=o.previousTotalMembers>0?(o.currentTotalMembers-o.previousTotalMembers)/o.previousTotalMembers*100:0,o.newMembersGrowth=o.previousNewMembers>0?(o.currentNewMembers-o.previousNewMembers)/o.previousNewMembers*100:0,o.currentConversionRate=o.currentNewMembers>0?s/o.currentNewMembers*100:0,o.previousConversionRate=o.previousNewMembers>0?m/o.previousNewMembers*100:0,o.conversionRateGrowth=o.previousConversionRate>0?o.currentConversionRate-o.previousConversionRate:0,o.avgLTVGrowth=o.previousAvgLTV>0?(o.currentAvgLTV-o.previousAvgLTV)/o.previousAvgLTV*100:0,e.jsxs(M,{className:"bg-white shadow-lg border-0",children:[e.jsx(L,{className:"border-b border-gray-100 bg-gradient-to-r from-emerald-600 to-teal-600 text-white",children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5"}),"Year-on-Year Client Conversion Comparison",e.jsxs(j,{variant:"secondary",className:"bg-white/20 text-white",children:[new Date().getFullYear()," vs ",new Date().getFullYear()-1]})]})}),e.jsx(C,{className:"p-0",children:e.jsx(W,{data:g,columns:x,headerGradient:"from-emerald-600 to-teal-600",showFooter:!0,footerData:o,maxHeight:"600px",onRowClick:w})})]})},Ze=({data:d})=>{const f=V.useMemo(()=>{const x=d.reduce((o,s)=>{const m=s.membershipUsed||"No Membership";return o[m]||(o[m]={membershipType:m,totalMembers:0,newMembers:0,converted:0,retained:0,totalLTV:0,totalVisits:0,conversionSpans:[]}),o[m].totalMembers++,(s.isNew||"").includes("New")&&o[m].newMembers++,s.conversionStatus==="Converted"&&o[m].converted++,s.retentionStatus==="Retained"&&o[m].retained++,o[m].totalLTV+=s.ltv||0,o[m].totalVisits+=s.visitsPostTrial||0,s.conversionSpan&&s.conversionSpan>0&&o[m].conversionSpans.push(s.conversionSpan),o},{});return Object.values(x).map(o=>({...o,conversionRate:o.newMembers>0?o.converted/o.newMembers*100:0,retentionRate:o.totalMembers>0?o.retained/o.totalMembers*100:0,avgLTV:o.totalMembers>0?o.totalLTV/o.totalMembers:0,avgVisits:o.totalMembers>0?o.totalVisits/o.totalMembers:0,avgConversionSpan:o.conversionSpans.length>0?o.conversionSpans.reduce((s,m)=>s+m,0)/o.conversionSpans.length:0})).filter(o=>o.totalMembers>0).sort((o,s)=>s.totalMembers-o.totalMembers)},[d]),w=[{key:"membershipType",header:"Membership Type",className:"font-medium text-xs min-w-[200px]",render:x=>e.jsx("span",{className:"text-xs font-medium text-gray-800 truncate max-w-[200px]",title:x,children:x.length>25?`${x.substring(0,25)}...`:x})},{key:"totalMembers",header:"Total Members",align:"center",render:x=>e.jsx("span",{className:"text-xs font-semibold text-blue-600",children:p(x)})},{key:"newMembers",header:"New Members",align:"center",render:x=>e.jsx("span",{className:"text-xs font-semibold text-green-600",children:p(x)})},{key:"converted",header:"Converted",align:"center",render:x=>e.jsx("span",{className:"text-xs font-semibold text-green-600",children:p(x)})},{key:"conversionRate",header:"Conv. Rate",align:"center",render:x=>e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[x>50?e.jsx(P,{className:"w-3 h-3 text-green-500"}):x<20?e.jsx(le,{className:"w-3 h-3 text-red-500"}):null,e.jsxs("span",{className:`text-xs font-semibold ${x>50?"text-green-600":x<20?"text-red-600":"text-gray-600"}`,children:[x.toFixed(1),"%"]})]})},{key:"retained",header:"Retained",align:"center",render:x=>e.jsx("span",{className:"text-xs font-semibold text-purple-600",children:p(x)})},{key:"retentionRate",header:"Ret. Rate",align:"center",render:x=>e.jsxs("span",{className:"text-xs font-semibold",children:[x.toFixed(1),"%"]})},{key:"avgLTV",header:"Avg LTV",align:"right",render:x=>e.jsx("span",{className:"text-xs font-semibold",children:S(x)})}],g={membershipType:"TOTAL",totalMembers:f.reduce((x,o)=>x+o.totalMembers,0),newMembers:f.reduce((x,o)=>x+o.newMembers,0),converted:f.reduce((x,o)=>x+o.converted,0),conversionRate:0,retained:f.reduce((x,o)=>x+o.retained,0),retentionRate:0,avgLTV:f.reduce((x,o)=>x+o.totalLTV,0)/Math.max(f.reduce((x,o)=>x+o.totalMembers,0),1)};return g.conversionRate=g.newMembers>0?g.converted/g.newMembers*100:0,g.retentionRate=g.totalMembers>0?g.retained/g.totalMembers*100:0,e.jsxs(M,{className:"bg-white shadow-lg border-0",children:[e.jsx(L,{className:"border-b border-gray-100 bg-gradient-to-r from-purple-600 to-indigo-600 text-white",children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),"Membership Type Performance Analysis",e.jsxs(j,{variant:"secondary",className:"bg-white/20 text-white",children:[f.length," Types"]})]})}),e.jsx(C,{className:"p-0",children:e.jsx(W,{data:f,columns:w,headerGradient:"from-purple-600 to-indigo-600",showFooter:!0,footerData:g,maxHeight:"500px"})})]})},qe=({data:d,onRowClick:f})=>{const w=V.useMemo(()=>{const o=d.reduce((s,m)=>{const a=m.firstVisitEntityName||"Unknown Class";let c="Unknown";if(m.firstVisitDate){let r;if(m.firstVisitDate.includes("/")){const n=m.firstVisitDate.split(",")[0].trim(),[v,u,i]=n.split("/");r=new Date(parseInt(i),parseInt(u)-1,parseInt(v))}else r=new Date(m.firstVisitDate);isNaN(r.getTime())||(c=r.toLocaleDateString("en-US",{month:"short",year:"numeric"}))}const l=`${c}-${a}`;if(s[l]||(s[l]={month:c,className:a,totalMembers:0,newMembers:0,converted:0,retained:0,totalLTV:0,conversionIntervals:[],clients:[]}),s[l].totalMembers++,s[l].clients.push(m),(m.isNew||"").toLowerCase().includes("new")&&s[l].newMembers++,m.conversionStatus==="Converted"&&s[l].converted++,m.retentionStatus==="Retained"&&s[l].retained++,s[l].totalLTV+=m.ltv||0,m.firstPurchase&&m.firstVisitDate){const r=new Date(m.firstVisitDate),n=new Date(m.firstPurchase);if(!isNaN(r.getTime())&&!isNaN(n.getTime())){const v=Math.ceil((n.getTime()-r.getTime())/864e5);v>=0&&s[l].conversionIntervals.push(v)}}return s},{});return Object.values(o).map(s=>({...s,conversionRate:s.newMembers>0?s.converted/s.newMembers*100:0,retentionRate:s.converted>0?s.retained/s.converted*100:0,avgLTV:s.totalMembers>0?s.totalLTV/s.totalMembers:0,avgConversionInterval:s.conversionIntervals.length>0?s.conversionIntervals.reduce((m,a)=>m+a,0)/s.conversionIntervals.length:0})).sort((s,m)=>m.totalMembers-s.totalMembers)},[d]),g=[{key:"month",header:"Month",className:"font-semibold min-w-[100px]",render:o=>e.jsx("div",{className:"font-bold text-slate-800 bg-gradient-to-r from-purple-50 to-pink-50 px-3 py-2 rounded-lg",children:o})},{key:"className",header:"Class Name",className:"font-medium min-w-[200px]",render:o=>e.jsx("div",{className:"font-semibold text-slate-700 truncate",title:o,children:o.length>30?`${o.substring(0,30)}...`:o})},{key:"totalMembers",header:"Total Members",align:"center",render:o=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:p(o)}),e.jsx("div",{className:"text-xs text-slate-500",children:"members"})]})},{key:"newMembers",header:"New Members",align:"center",render:o=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:p(o)}),e.jsx("div",{className:"text-xs text-slate-500",children:"new"})]})},{key:"converted",header:"Converted",align:"center",render:o=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:p(o)}),e.jsx("div",{className:"text-xs text-slate-500",children:"converted"})]})},{key:"conversionRate",header:"Conv. Rate",align:"center",render:o=>e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[o>25?e.jsx(P,{className:"w-3 h-3 text-green-500"}):o<10?e.jsx(le,{className:"w-3 h-3 text-red-500"}):null,e.jsxs(j,{className:`font-bold ${o>25?"bg-green-100 text-green-800":o<10?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:[o.toFixed(1),"%"]})]})},{key:"retained",header:"Retained",align:"center",render:o=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-purple-600",children:p(o)}),e.jsx("div",{className:"text-xs text-slate-500",children:"retained"})]})},{key:"avgLTV",header:"Avg LTV",align:"right",render:o=>e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold text-emerald-600",children:S(o)}),e.jsx("div",{className:"text-xs text-slate-500",children:"per client"})]})},{key:"avgConversionInterval",header:"Avg Conv. Interval",align:"center",render:o=>e.jsxs(j,{variant:"outline",className:"bg-orange-50 text-orange-700 border-orange-200 font-bold",children:[Math.round(o)," days"]})}],x={month:"TOTAL",className:`${w.length} Classes`,totalMembers:w.reduce((o,s)=>o+s.totalMembers,0),newMembers:w.reduce((o,s)=>o+s.newMembers,0),converted:w.reduce((o,s)=>o+s.converted,0),conversionRate:0,retained:w.reduce((o,s)=>o+s.retained,0),avgLTV:w.reduce((o,s)=>o+s.totalLTV,0)/Math.max(w.reduce((o,s)=>o+s.totalMembers,0),1),avgConversionInterval:w.reduce((o,s)=>o+s.avgConversionInterval*s.totalMembers,0)/Math.max(w.reduce((o,s)=>o+s.totalMembers,0),1)};return x.conversionRate=x.newMembers>0?x.converted/x.newMembers*100:0,e.jsx(xe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs(M,{className:"bg-white shadow-xl border-0 overflow-hidden hover:shadow-2xl transition-all duration-300",children:[e.jsx(L,{className:"border-b border-gray-100 bg-gradient-to-r from-purple-600 to-pink-600 text-white",children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5"}),"Hosted Classes Performance Analysis",e.jsxs(j,{variant:"secondary",className:"bg-white/20 text-white",children:[w.length," Classes"]})]})}),e.jsx(C,{className:"p-0",children:e.jsx(W,{data:w,columns:g,headerGradient:"from-purple-600 to-pink-600",showFooter:!0,footerData:x,maxHeight:"600px",onRowClick:f})})]})})},et=({isOpen:d,onClose:f,title:w,data:g,type:x})=>{if(!g)return null;const o=V.useMemo(()=>g?x==="metric"&&g.clients||(x==="month"||x==="year")&&g.clients?g.clients:Array.isArray(g)?g:[]:[],[g,x]),s=V.useMemo(()=>{const c=o.length,l=o.filter(t=>(t.isNew||"").toLowerCase().includes("new")).length,r=o.filter(t=>(t.conversionStatus||"").toLowerCase().includes("converted")).length,n=o.filter(t=>(t.retentionStatus||"").toLowerCase().includes("retained")).length,v=o.reduce((t,h)=>t+(h.ltv||0),0),u=o.filter(t=>t.conversionSpan>0).reduce((t,h)=>t+(h.conversionSpan||0),0),i=o.filter(t=>t.conversionSpan>0).length;return{totalMembers:c,newMembers:l,convertedMembers:r,retainedMembers:n,conversionRate:l>0?r/l*100:0,retentionRate:c>0?n/c*100:0,avgLTV:c>0?v/c:0,totalLTV:v,avgConversionTime:i>0?u/i:0}},[o]),m=()=>e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(M,{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white border-0 shadow-lg",children:e.jsxs(C,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(D,{className:"w-5 h-5 text-blue-100"}),e.jsx(j,{className:"bg-white/20 text-white border-0",children:"Total"})]}),e.jsx("div",{className:"text-2xl font-bold",children:p(s.totalMembers)}),e.jsx("div",{className:"text-blue-100 text-sm",children:"Total Members"})]})}),e.jsx(M,{className:"bg-gradient-to-br from-green-500 to-green-600 text-white border-0 shadow-lg",children:e.jsxs(C,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(F,{className:"w-5 h-5 text-green-100"}),e.jsx(j,{className:"bg-white/20 text-white border-0",children:"New"})]}),e.jsx("div",{className:"text-2xl font-bold",children:p(s.newMembers)}),e.jsx("div",{className:"text-green-100 text-sm",children:"New Members"})]})}),e.jsx(M,{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white border-0 shadow-lg",children:e.jsxs(C,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(P,{className:"w-5 h-5 text-purple-100"}),e.jsx(j,{className:"bg-white/20 text-white border-0",children:"Rate"})]}),e.jsxs("div",{className:"text-2xl font-bold",children:[s.conversionRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-purple-100 text-sm",children:"Conversion Rate"})]})}),e.jsx(M,{className:"bg-gradient-to-br from-orange-500 to-orange-600 text-white border-0 shadow-lg",children:e.jsxs(C,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Y,{className:"w-5 h-5 text-orange-100"}),e.jsx(j,{className:"bg-white/20 text-white border-0",children:"LTV"})]}),e.jsx("div",{className:"text-2xl font-bold",children:S(s.avgLTV)}),e.jsx("div",{className:"text-orange-100 text-sm",children:"Avg LTV"})]})})]}),a=()=>o.length===0?e.jsx(M,{children:e.jsxs(C,{className:"p-8 text-center",children:[e.jsx(D,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No client data available for this selection."})]})}):e.jsxs(M,{children:[e.jsx(L,{children:e.jsxs(k,{className:"text-lg",children:["Client Details (",p(o.length)," members)"]})}),e.jsx(C,{className:"p-0",children:e.jsxs("div",{className:"max-h-96 overflow-y-auto",children:[e.jsxs(ce,{children:[e.jsx(de,{className:"sticky top-0 bg-gray-50 z-10",children:e.jsxs(z,{children:[e.jsx(T,{className:"font-semibold text-gray-900 text-xs px-3",children:"Name"}),e.jsx(T,{className:"font-semibold text-gray-900 text-xs px-3",children:"Email"}),e.jsx(T,{className:"font-semibold text-gray-900 text-xs px-3 text-center",children:"Type"}),e.jsx(T,{className:"font-semibold text-gray-900 text-xs px-3 text-center",children:"Status"}),e.jsx(T,{className:"font-semibold text-gray-900 text-xs px-3 text-center",children:"Conversion"}),e.jsx(T,{className:"font-semibold text-gray-900 text-xs px-3 text-right",children:"LTV"}),e.jsx(T,{className:"font-semibold text-gray-900 text-xs px-3 text-center",children:"Location"})]})}),e.jsx(me,{children:o.slice(0,50).map((c,l)=>e.jsxs(z,{className:"hover:bg-gray-50 transition-colors h-10",children:[e.jsxs(N,{className:"text-xs px-3 font-medium",children:[c.firstName," ",c.lastName]}),e.jsx(N,{className:"text-xs px-3 text-gray-600 truncate max-w-[150px]",title:c.email,children:c.email}),e.jsx(N,{className:"text-xs px-3 text-left rounded-t rounded-none",children:e.jsx(j,{variant:c.isNew?.toLowerCase().includes("new")?"default":"secondary",className:"text-xs rounded min-w-44",children:c.isNew||"Unknown"})}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsx(j,{variant:c.retentionStatus?.toLowerCase().includes("retained")?"default":"secondary",className:`text-xs ${c.retentionStatus?.toLowerCase().includes("retained")?"bg-purple-100 text-purple-800":""}`,children:c.retentionStatus||"Pending"})}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsx(j,{variant:c.conversionStatus?.toLowerCase().includes("converted")?"default":"secondary",className:`text-xs ${c.conversionStatus?.toLowerCase().includes("converted")?"bg-green-100 text-green-800":""}`,children:c.conversionStatus||"Pending"})}),e.jsx(N,{className:"text-xs px-3 text-right font-semibold text-emerald-600",children:S(c.ltv||0)}),e.jsx(N,{className:"text-xs px-3 text-center text-gray-600 truncate max-w-[120px]",title:c.firstVisitLocation,children:c.firstVisitLocation||"Unknown"})]},l))})]}),o.length>50&&e.jsxs("div",{className:"p-4 text-center text-sm text-gray-600 bg-gray-50 border-t",children:["Showing 50 of ",o.length," clients. Drill down shows only targeted data for this selection."]})]})})]});return e.jsx(Te,{open:d,onOpenChange:f,children:e.jsxs(Re,{className:"max-w-7xl max-h-[95vh] overflow-y-auto bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-2xl",children:[e.jsx(Ve,{className:"pb-6 border-b border-slate-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(Se,{className:"text-3xl font-bold bg-gradient-to-r from-slate-800 via-blue-600 to-purple-600 bg-clip-text text-transparent",children:[w," - Detailed Analysis"]}),e.jsx("p",{className:"text-slate-600 mt-2 text-lg",children:"Targeted client conversion and retention analysis"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"bg-blue-100 text-blue-800 border-0",children:x==="month"?"Monthly":x==="year"?"Yearly":x==="metric"?"Metric Analysis":"Analytics"}),e.jsx(A,{variant:"outline",onClick:f,children:e.jsx(ye,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"pt-6 space-y-8",children:[m(),e.jsxs(Le,{defaultValue:"overview",className:"w-full",children:[e.jsxs(ke,{className:"grid w-full grid-cols-3 bg-slate-100",children:[e.jsxs(X,{value:"overview",className:"gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Overview"]}),e.jsxs(X,{value:"clients",className:"gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),"Client Details"]}),e.jsxs(X,{value:"insights",className:"gap-2",children:[e.jsx(Me,{className:"w-4 h-4"}),"Insights"]})]}),e.jsx(Z,{value:"overview",className:"space-y-6",children:e.jsxs(M,{className:"bg-gradient-to-br from-indigo-50 to-indigo-100 border-indigo-200",children:[e.jsx(L,{children:e.jsx(k,{className:"text-indigo-800",children:"Summary Statistics"})}),e.jsx(C,{children:e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:p(s.totalMembers)}),e.jsx("div",{className:"text-sm text-indigo-600",children:"Total Members"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:p(s.convertedMembers)}),e.jsx("div",{className:"text-sm text-green-600",children:"Converted"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[s.conversionRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-purple-600",children:"Conversion Rate"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:s.avgConversionTime>0?`${s.avgConversionTime.toFixed(0)} days`:"N/A"}),e.jsx("div",{className:"text-sm text-orange-600",children:"Avg Conv. Time"})]})]})})]})}),e.jsx(Z,{value:"clients",children:a()}),e.jsx(Z,{value:"insights",children:e.jsxs(M,{className:"bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx(L,{children:e.jsx(k,{className:"text-purple-800",children:"AI-Powered Insights"})}),e.jsx(C,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-white rounded-lg border-l-4 border-purple-400",children:[e.jsx("h4",{className:"font-medium text-purple-800 mb-2",children:"Key Metrics"}),e.jsxs("ul",{className:"text-sm text-purple-600 space-y-1",children:[e.jsxs("li",{children:["• Total Revenue: ",S(s.totalLTV)]}),e.jsxs("li",{children:["• Conversion Rate: ",s.conversionRate.toFixed(1),"%"]}),e.jsxs("li",{children:["• Retention Rate: ",s.retentionRate.toFixed(1),"%"]}),e.jsxs("li",{children:["• Average Customer Value: ",S(s.avgLTV)]})]})]}),e.jsxs("div",{className:"p-4 bg-white rounded-lg border-l-4 border-orange-400",children:[e.jsx("h4",{className:"font-medium text-orange-800 mb-2",children:"Performance Analysis"}),e.jsxs("ul",{className:"text-sm text-orange-600 space-y-1",children:[e.jsxs("li",{children:["• ",s.conversionRate>30?"Strong":s.conversionRate>15?"Moderate":"Needs improvement"," conversion performance"]}),e.jsxs("li",{children:["• ",s.retentionRate>70?"Excellent":s.retentionRate>50?"Good":"Needs attention"," retention rate"]}),e.jsxs("li",{children:["• Customer lifetime value is ",s.avgLTV>1e4?"high":s.avgLTV>5e3?"moderate":"developing"]}),e.jsx("li",{children:"• This selection shows targeted analytics for clicked data only"})]})]})]})})]})})]})]})]})})};export{He as C,ze as E,Be as a,_e as b,We as c,Qe as d,Je as e,Xe as f,qe as g,Ze as h,et as i};
