import{r as $,M as te,U as D,T as P,J as ve,j as e,F as re,b as be,K as ge,C as ue,c as H,S as pe,i as Y,N as fe,v as _,O as we,h as F,f as Ne,Q as ne,R as V,V as J,u as ce,W as ae,s as oe,g as je,e as se,w as ee,Y as ie,X as ye,Z as Me}from"./react-vendor-dqSXVcdP.js";import{C as M,c as C,B as j,d as A,j as L,k,D as Ce,I as X,Y as W,T as de,m as me,n as z,o as T,p as xe,q as N,Z as Te,_ as Re,$ as Ve,a0 as Se,r as Le,s as ke,t as Q,u as Z}from"./ui-components-DsfbLwT7.js";import{c as f,f as S,a as De}from"./utils-BhCMrGmG.js";import{R as K,P as $e,d as Ye,e as Ae,T as O,A as Fe,C as E,X as G,Y as U,f as Pe,B as q,c as B,L as Ie,b as le}from"./chart-vendor-By6BsRZf.js";import{m as he}from"./animation-vendor-COY9SM-0.js";const ze=({filters:m,onFiltersChange:p,locations:w,trainers:g,membershipTypes:x})=>{const[a,o]=$.useState(!1),[d,s]=$.useState(""),c=(t,h)=>{const b=[...m[t]],y=b.includes(h)?b.filter(R=>R!==h):[...b,h];p({...m,[t]:y})},l=t=>{const h=b=>{const y=b.getFullYear(),R=String(b.getMonth()+1).padStart(2,"0"),I=String(b.getDate()).padStart(2,"0");return`${y}-${R}-${I}`};p({...m,dateRange:{start:t.from?h(t.from):"",end:t.to?h(t.to):""}})},r=()=>{p({dateRange:{start:"",end:""},location:[],homeLocation:[],trainer:[],paymentMethod:[],retentionStatus:[],conversionStatus:[],isNew:[],minLTV:void 0,maxLTV:void 0}),s("")},n=m.location.length+m.trainer.length+m.retentionStatus.length+m.conversionStatus.length+m.paymentMethod.length+m.isNew.length+(m.dateRange.start||m.dateRange.end?1:0)+(m.minLTV?1:0)+(m.maxLTV?1:0),v=["Kwality House, Kemps Corner","Supreme HQ, Bandra","Kenkere House, Bengaluru"],u=w.filter(t=>v.includes(t)),i=[{title:"Location & Geography",icon:te,filters:[{key:"location",label:"Visit Locations",options:u,values:m.location}]},{title:"Trainer & Service",icon:D,filters:[{key:"trainer",label:"Trainers",options:g.slice(0,12),values:m.trainer}]},{title:"Conversion & Status",icon:P,filters:[{key:"conversionStatus",label:"Conversion Status",options:["Converted","Not Converted","Pending"],values:m.conversionStatus},{key:"retentionStatus",label:"Retention Status",options:["Retained","Not Retained","At Risk"],values:m.retentionStatus},{key:"isNew",label:"Client Type",options:["New","Existing","Returning"],values:m.isNew}]},{title:"Payment & Membership",icon:ve,filters:[{key:"paymentMethod",label:"Payment Methods",options:["Online","Cash","Card","UPI","Bank Transfer"],values:m.paymentMethod}]}];return a?e.jsxs(M,{className:"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 border-0 shadow-xl overflow-hidden",children:[e.jsx(L,{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white",children:e.jsxs(k,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Advanced Client Filters"}),e.jsx("p",{className:"text-blue-100 text-sm",children:"Customize your analysis view"})]}),e.jsxs(j,{className:"bg-white/20 text-white border-white/30",children:[n," Active"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(A,{variant:"outline",size:"sm",onClick:r,disabled:n===0,className:"bg-white/10 border-white/30 text-white hover:bg-white/20",children:[e.jsx(ge,{className:"w-4 h-4 mr-1"}),"Reset"]}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>o(!1),className:"text-white hover:bg-white/20",children:e.jsx(ue,{className:"w-4 h-4"})})]})]})}),e.jsxs(C,{className:"p-8 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-bold text-slate-700 flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-blue-600"}),"Date Range"]}),e.jsx(Ce,{value:{from:m.dateRange.start?new Date(m.dateRange.start):void 0,to:m.dateRange.end?new Date(m.dateRange.end):void 0},onChange:l})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-bold text-slate-700 flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-blue-600"}),"Quick Search"]}),e.jsx(X,{placeholder:"Search trainers, locations...",value:d,onChange:t=>s(t.target.value),className:"bg-white border-slate-200"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"text-sm font-bold text-slate-700 flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-blue-600"}),"Lifetime Value Range"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(X,{type:"number",placeholder:"Min LTV (₹)",value:m.minLTV||"",onChange:t=>p({...m,minLTV:t.target.value?parseFloat(t.target.value):void 0}),className:"bg-white border-slate-200"}),e.jsx(X,{type:"number",placeholder:"Max LTV (₹)",value:m.maxLTV||"",onChange:t=>p({...m,maxLTV:t.target.value?parseFloat(t.target.value):void 0}),className:"bg-white border-slate-200"})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:i.map(t=>e.jsxs(M,{className:"bg-white/70 border-slate-200 shadow-lg",children:[e.jsx(L,{className:"pb-4",children:e.jsxs(k,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(t.icon,{className:"w-5 h-5 text-blue-600"}),t.title]})}),e.jsx(C,{className:"space-y-4",children:t.filters.map(h=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-medium text-slate-700",children:[h.label,h.values.length>0&&e.jsxs(j,{variant:"secondary",className:"ml-2 text-xs bg-blue-100 text-blue-700",children:[h.values.length," selected"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 max-h-32 overflow-y-auto",children:h.options.filter(b=>!d||b.toLowerCase().includes(d.toLowerCase())).map(b=>e.jsx(A,{variant:h.values.includes(b)?"default":"outline",size:"sm",onClick:()=>c(h.key,b),className:`text-xs transition-all duration-200 ${h.values.includes(b)?"bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-md":"hover:bg-blue-50 border-slate-200 hover:border-blue-300"}`,children:b},b))})]},h.key))})]},t.title))})]})]}):e.jsx(M,{className:"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 border-0 shadow-xl",children:e.jsx(C,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg",children:e.jsx(re,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-800",children:"Advanced Filters"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Refine your client analysis"})]}),n>0&&e.jsxs(j,{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white",children:[n," active"]})]}),e.jsxs(A,{variant:"outline",onClick:()=>o(!0),className:"gap-2 border-blue-200 text-blue-700 hover:bg-blue-50",children:[e.jsx(be,{className:"w-4 h-4"}),"Expand Filters"]})]})})})},He=({data:m,onCardClick:p})=>{const w=m.length,g=m.filter(i=>String(i.isNew||"").toLowerCase().includes("new")).length,x=m.filter(i=>i.conversionStatus==="Converted").length,a=m.filter(i=>i.retentionStatus==="Retained").length,o=m.length,d=o>0?x/o*100:0,s=g>0?x/g*100:0,c=g>0?a/g*100:0,l=m.reduce((i,t)=>i+(t.ltv||0),0),r=w>0?l/w:0,n=m.filter(i=>i.conversionStatus==="Converted"&&i.conversionSpan&&i.conversionSpan>0),v=n.length>0?n.reduce((i,t)=>i+t.conversionSpan,0)/n.length:0,u=[{title:"New Members",value:f(g),icon:fe,gradient:"from-blue-500 to-indigo-600",description:"Recently acquired clients",change:12.5,isPositive:!0,previousValue:f(g-Math.round(g*.125)),period:"vs last month",metricType:"new_members",filterData:()=>m.filter(i=>String(i.isNew||"").toLowerCase().includes("new"))},{title:"Converted Members",value:f(x),icon:_,gradient:"from-green-500 to-teal-600",description:"Trial to paid conversions",change:8.3,isPositive:!0,previousValue:f(x-Math.round(x*.083)),period:"vs last month",metricType:"converted_members",filterData:()=>m.filter(i=>i.conversionStatus==="Converted")},{title:"Retained Members",value:f(a),icon:we,gradient:"from-purple-500 to-violet-600",description:"Active retained clients",change:15.2,isPositive:!0,previousValue:f(a-Math.round(a*.152)),period:"vs last month",metricType:"retained_members",filterData:()=>m.filter(i=>i.retentionStatus==="Retained")},{title:"Conversion Rate",value:`${s.toFixed(1)}%`,icon:F,gradient:"from-orange-500 to-red-600",description:"New to converted rate",change:4.8,isPositive:!0,previousValue:`${(s-4.8).toFixed(1)}%`,period:"vs last month",metricType:"conversion_rate",filterData:()=>m.filter(i=>String(i.isNew||"").includes("New")||i.conversionStatus==="Converted")},{title:"Retention Rate",value:`${c.toFixed(1)}%`,icon:P,gradient:"from-cyan-500 to-blue-600",description:"Member retention rate",change:"+3.1%",isPositive:!0,metricType:"retention_rate",filterData:()=>m.filter(i=>i.retentionStatus==="Retained")},{title:"Avg LTV",value:S(r),icon:Y,gradient:"from-pink-500 to-rose-600",description:"Average lifetime value",change:"+7.2%",isPositive:!0,metricType:"avg_ltv",filterData:()=>m.filter(i=>(i.ltv||0)>0)},{title:"Avg Conv. Time",value:`${v.toFixed(0)} days`,icon:Ne,gradient:"from-emerald-500 to-green-600",description:"Average conversion time",change:"-2.1 days",isPositive:!0,metricType:"avg_conv_time",filterData:()=>m.filter(i=>i.conversionStatus==="Converted"&&i.firstPurchase&&i.firstVisitDate)},{title:"Trial → Member",value:`${d.toFixed(1)}%`,icon:ne,gradient:"from-indigo-500 to-purple-600",description:"Trial conversion rate",change:"+5.4%",isPositive:!0,metricType:"trial_to_member",filterData:()=>m.filter(i=>(i.visitsPostTrial||0)>0)}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:u.map((i,t)=>e.jsxs(M,{className:"group relative overflow-hidden bg-white border border-slate-200 shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1 cursor-pointer",onClick:()=>p?.(i.title,i.filterData(),i.metricType),style:{backgroundColor:"white"},children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${i.gradient} opacity-3 group-hover:opacity-8 transition-opacity duration-300`}),e.jsxs(C,{className:"relative p-6 z-10 bg-white",style:{backgroundColor:"white",color:"#1e293b"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-xl bg-gradient-to-br ${i.gradient} shadow-lg group-hover:scale-110 transition-transform duration-300`,children:e.jsx(i.icon,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"text-right",children:[e.jsxs(j,{className:`text-xs px-3 py-1 font-medium transition-all duration-300 mb-1 ${i.isPositive?"bg-green-100 text-green-800 border-green-200 group-hover:bg-green-200":"bg-red-100 text-red-800 border-red-200 group-hover:bg-red-200"}`,children:[i.isPositive?"+":"",i.change]}),i.previousValue&&e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[e.jsxs("div",{children:["From: ",i.previousValue]}),e.jsx("div",{className:"text-xs opacity-75",children:i.period})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 group-hover:text-slate-800 transition-colors",style:{color:"#334155"},children:i.title}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsx("span",{className:"text-3xl font-bold text-slate-900 group-hover:text-slate-800 transition-colors",style:{color:"#0f172a"},children:i.value})}),e.jsx("p",{className:"text-xs text-slate-500 group-hover:text-slate-600 transition-colors leading-relaxed",style:{color:"#64748b"},children:i.description}),e.jsx("div",{className:"pt-3 border-t border-slate-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`flex-1 h-1 bg-gradient-to-r ${i.gradient} rounded-full opacity-30 group-hover:opacity-50 transition-opacity`}),e.jsx(ne,{className:"w-4 h-4 text-slate-400 ml-3 group-hover:text-slate-600 transition-colors"})]})})]})]})]},i.title))})},Be=({data:m})=>{const[p,w]=$.useState("trainer-conversion"),g=V.useMemo(()=>{const i=new Map;return m.forEach(t=>{const h=t.trainerName||"Unknown";i.has(h)||i.set(h,{name:h,totalClients:0,newMembers:0,converted:0,retained:0,totalLTV:0,trialsCompleted:0});const b=i.get(h);b.totalClients++,b.totalLTV+=t.ltv||0,String(t.isNew||"").includes("New")&&b.newMembers++,t.conversionStatus==="Converted"&&b.converted++,t.retentionStatus==="Retained"&&b.retained++,(t.visitsPostTrial||0)>0&&b.trialsCompleted++}),Array.from(i.values()).map(t=>({...t,conversionRate:t.newMembers>0?t.converted/t.newMembers*100:0,retentionRate:t.converted>0?t.retained/t.converted*100:0,avgLTV:t.totalClients>0?t.totalLTV/t.totalClients:0,trialConversionRate:t.trialsCompleted>0?t.converted/t.trialsCompleted*100:0}))},[m]),x=V.useMemo(()=>{const i=new Map;return m.forEach(t=>{const h=t.firstVisitLocation||t.homeLocation||"Unknown";i.has(h)||i.set(h,{name:h,totalClients:0,newMembers:0,converted:0,retained:0,totalLTV:0,trialsCompleted:0});const b=i.get(h);b.totalClients++,b.totalLTV+=t.ltv||0,String(t.isNew||"").includes("New")&&b.newMembers++,t.conversionStatus==="Converted"&&b.converted++,t.retentionStatus==="Retained"&&b.retained++,(t.visitsPostTrial||0)>0&&b.trialsCompleted++}),Array.from(i.values()).map(t=>({...t,conversionRate:t.newMembers>0?t.converted/t.newMembers*100:0,retentionRate:t.converted>0?t.retained/t.converted*100:0,avgLTV:t.totalClients>0?t.totalLTV/t.totalClients:0,trialConversionRate:t.trialsCompleted>0?t.converted/t.trialsCompleted*100:0}))},[m]),a=V.useMemo(()=>{const i=new Map;return m.forEach(t=>{const h=t.firstVisitEntityName||"Unknown Class";i.has(h)||i.set(h,{name:h,totalClients:0,newMembers:0,converted:0,retained:0,totalLTV:0,trialsCompleted:0});const b=i.get(h);b.totalClients++,b.totalLTV+=t.ltv||0,String(t.isNew||"").includes("New")&&b.newMembers++,t.conversionStatus==="Converted"&&b.converted++,t.retentionStatus==="Retained"&&b.retained++,(t.visitsPostTrial||0)>0&&b.trialsCompleted++}),Array.from(i.values()).map(t=>({...t,conversionRate:t.newMembers>0?t.converted/t.newMembers*100:0,retentionRate:t.converted>0?t.retained/t.converted*100:0,avgLTV:t.totalClients>0?t.totalLTV/t.totalClients:0,trialConversionRate:t.trialsCompleted>0?t.converted/t.trialsCompleted*100:0}))},[m]),o=V.useMemo(()=>{const i=new Map;return m.forEach(t=>{const h=t.membershipUsed||"Unknown Membership";i.has(h)||i.set(h,{name:h,totalClients:0,newMembers:0,converted:0,retained:0,totalLTV:0,trialsCompleted:0});const b=i.get(h);b.totalClients++,b.totalLTV+=t.ltv||0,String(t.isNew||"").includes("New")&&b.newMembers++,t.conversionStatus==="Converted"&&b.converted++,t.retentionStatus==="Retained"&&b.retained++,(t.visitsPostTrial||0)>0&&b.trialsCompleted++}),Array.from(i.values()).map(t=>({...t,conversionRate:t.newMembers>0?t.converted/t.newMembers*100:0,retentionRate:t.converted>0?t.retained/t.converted*100:0,avgLTV:t.totalClients>0?t.totalLTV/t.totalClients:0,trialConversionRate:t.trialsCompleted>0?t.converted/t.trialsCompleted*100:0}))},[m]),d=V.useMemo(()=>{const i=new Map;return m.forEach(t=>{const h=`${t.trainerName||"Unknown"} - ${t.firstVisitEntityName||"Unknown Class"}`;i.has(h)||i.set(h,{name:h,trainer:t.trainerName||"Unknown",className:t.firstVisitEntityName||"Unknown Class",totalClients:0,newMembers:0,converted:0,retained:0,totalLTV:0,trialsCompleted:0});const b=i.get(h);b.totalClients++,b.totalLTV+=t.ltv||0,String(t.isNew||"").includes("New")&&b.newMembers++,t.conversionStatus==="Converted"&&b.converted++,t.retentionStatus==="Retained"&&b.retained++,(t.visitsPostTrial||0)>0&&b.trialsCompleted++}),Array.from(i.values()).map(t=>({...t,conversionRate:t.newMembers>0?t.converted/t.newMembers*100:0,retentionRate:t.converted>0?t.retained/t.converted*100:0,avgLTV:t.totalClients>0?t.totalLTV/t.totalClients:0,trialConversionRate:t.trialsCompleted>0?t.converted/t.trialsCompleted*100:0}))},[m]),s=[{id:"trainer-conversion",label:"Trainer Conversion",icon:J,type:"trainer",metric:"conversionRate"},{id:"trainer-retention",label:"Trainer Retention",icon:P,type:"trainer",metric:"retentionRate"},{id:"trainer-ltv",label:"Trainer LTV",icon:Y,type:"trainer",metric:"avgLTV"},{id:"trainer-volume",label:"Trainer Volume",icon:D,type:"trainer",metric:"totalClients"},{id:"location-conversion",label:"Location Conversion",icon:te,type:"location",metric:"conversionRate"},{id:"location-retention",label:"Location Retention",icon:_,type:"location",metric:"retentionRate"},{id:"location-ltv",label:"Location LTV",icon:F,type:"location",metric:"avgLTV"},{id:"location-volume",label:"Location Volume",icon:D,type:"location",metric:"totalClients"},{id:"class-conversion",label:"Class Conversion",icon:H,type:"class",metric:"conversionRate"},{id:"class-retention",label:"Class Retention",icon:ce,type:"class",metric:"retentionRate"},{id:"class-ltv",label:"Class LTV",icon:Y,type:"class",metric:"avgLTV"},{id:"class-volume",label:"Class Volume",icon:D,type:"class",metric:"totalClients"},{id:"membership-conversion",label:"Membership Conversion",icon:_,type:"membership",metric:"conversionRate"},{id:"membership-retention",label:"Membership Retention",icon:P,type:"membership",metric:"retentionRate"},{id:"membership-ltv",label:"Membership LTV",icon:Y,type:"membership",metric:"avgLTV"},{id:"membership-volume",label:"Membership Volume",icon:D,type:"membership",metric:"totalClients"},{id:"hosted-conversion",label:"Hosted Class Conversion",icon:J,type:"hosted",metric:"conversionRate"},{id:"hosted-retention",label:"Hosted Class Retention",icon:P,type:"hosted",metric:"retentionRate"},{id:"hosted-ltv",label:"Hosted Class LTV",icon:Y,type:"hosted",metric:"avgLTV"},{id:"hosted-volume",label:"Hosted Class Volume",icon:D,type:"hosted",metric:"totalClients"}],c=()=>{const i=s.find(R=>R.id===p);if(!i)return{top:[],bottom:[]};let t;switch(i.type){case"trainer":t=g;break;case"location":t=x;break;case"class":t=a;break;case"membership":t=o;break;case"hosted":t=d;break;default:t=g}const h=i.type==="hosted"?1:i.type==="trainer"?3:1,y=[...t.filter(R=>i.metric==="totalClients"?R.totalClients>=1:R.newMembers>=h)].sort((R,I)=>I[i.metric]-R[i.metric]);return{top:y.slice(0,5),bottom:y.slice(-5).reverse()}},{top:l,bottom:r}=c(),n=s.find(i=>i.id===p),v=(i,t)=>t==="avgLTV"?S(i):t==="totalClients"?f(i):`${i.toFixed(1)}%`,u=({title:i,data:t,isTop:h=!0})=>e.jsxs(M,{className:"group bg-white shadow-lg border-0 overflow-hidden hover:shadow-2xl transition-all duration-500 hover:scale-105",children:[e.jsxs(L,{className:`bg-gradient-to-r ${h?"from-emerald-500 to-teal-600":"from-orange-500 to-red-600"} text-white relative overflow-hidden`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 transform translate-x-8 -translate-y-8 opacity-20",children:h?e.jsx(ae,{className:"w-20 h-20"}):e.jsx(oe,{className:"w-20 h-20"})}),e.jsxs(k,{className:"flex items-center gap-3 relative z-10",children:[h?e.jsx(ae,{className:"w-6 h-6"}):e.jsx(oe,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold",children:i}),e.jsx("p",{className:"text-sm opacity-90 font-normal",children:h?"Top performers":"Needs attention"})]})]})]}),e.jsx(C,{className:"p-6 space-y-4",children:t.map((b,y)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-slate-50 to-slate-100 rounded-xl hover:from-slate-100 hover:to-slate-200 transition-all duration-300 group-hover:scale-105",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full font-bold text-sm transition-all duration-300 ${y===0&&h?"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white shadow-lg":y===1&&h?"bg-gradient-to-r from-gray-300 to-gray-500 text-white shadow-lg":y===2&&h?"bg-gradient-to-r from-orange-400 to-orange-600 text-white shadow-lg":"bg-gradient-to-r from-slate-200 to-slate-300 text-slate-600"}`,children:y+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900 truncate max-w-[140px]",title:b.name,children:b.name}),e.jsxs("p",{className:"text-sm text-slate-500",children:[f(b.totalClients)," clients",b.trainer&&e.jsxs("span",{className:"block text-xs",children:["by ",b.trainer]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(j,{className:`font-bold text-sm px-3 py-1 ${h?"bg-emerald-100 text-emerald-800 border border-emerald-200":"bg-orange-100 text-orange-800 border border-orange-200"}`,children:v(b[n?.metric||"conversionRate"],n?.metric||"conversionRate")}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[S(b.avgLTV)," LTV"]})]})]},b.name))})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(M,{className:"bg-white shadow-lg border-0",children:[e.jsx(L,{children:e.jsxs(k,{className:"flex items-center gap-3 text-slate-800",children:[e.jsx(J,{className:"w-6 h-6 text-yellow-600"}),"Performance Rankings"]})}),e.jsx(C,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3",children:s.map(i=>e.jsxs(A,{variant:p===i.id?"default":"ghost",size:"sm",onClick:()=>w(i.id),className:`flex flex-col items-center gap-2 h-auto py-3 px-2 transition-all duration-300 hover:scale-105 ${p===i.id?"bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg":"hover:bg-slate-100"}`,children:[e.jsx(i.icon,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium text-center leading-tight",children:i.label})]},i.id))})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(u,{title:`Top ${n?.label||"Performance"}`,data:l,isTop:!0}),e.jsx(u,{title:`Bottom ${n?.label||"Performance"}`,data:r,isTop:!1})]})]})},_e=({data:m})=>{const[p,w]=$.useState("monthly-trends"),g=[{id:"monthly-trends",label:"Monthly Trends",icon:F,type:"line"},{id:"conversion-funnel",label:"Conversion Funnel",icon:P,type:"bar"},{id:"location-performance",label:"Location Performance",icon:te,type:"bar"},{id:"trainer-performance",label:"Trainer Performance",icon:D,type:"bar"},{id:"retention-analysis",label:"Retention Analysis",icon:je,type:"area"},{id:"ltv-distribution",label:"LTV Distribution",icon:Y,type:"pie"}],x=V.useMemo(()=>{const l=new Map;return m.forEach(r=>{if(!r.firstVisitDate)return;let n;if(r.firstVisitDate.includes("/")){const[i,t,h]=r.firstVisitDate.split(" ")[0].split("/");n=new Date(parseInt(h),parseInt(t)-1,parseInt(i))}else n=new Date(r.firstVisitDate);if(isNaN(n.getTime()))return;const v=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`;l.has(v)||l.set(v,{month:v,newMembers:0,converted:0,retained:0,revenue:0});const u=l.get(v);String(r.isNew||"").includes("New")&&u.newMembers++,r.conversionStatus==="Converted"&&u.converted++,r.retentionStatus==="Retained"&&u.retained++,u.revenue+=r.ltv||0}),Array.from(l.values()).sort((r,n)=>r.month.localeCompare(n.month)).map(r=>({...r,conversionRate:r.newMembers>0?r.converted/r.newMembers*100:0,retentionRate:r.converted>0?r.retained/r.converted*100:0}))},[m]),a=V.useMemo(()=>{const l=new Map;return m.forEach(r=>{const n=r.firstVisitLocation||r.homeLocation||"Unknown";l.has(n)||l.set(n,{location:n,newMembers:0,converted:0,retained:0,revenue:0});const v=l.get(n);String(r.isNew||"").includes("New")&&v.newMembers++,r.conversionStatus==="Converted"&&v.converted++,r.retentionStatus==="Retained"&&v.retained++,v.revenue+=r.ltv||0}),Array.from(l.values()).map(r=>({...r,conversionRate:r.newMembers>0?r.converted/r.newMembers*100:0,retentionRate:r.converted>0?r.retained/r.converted*100:0})).sort((r,n)=>n.revenue-r.revenue)},[m]),o=V.useMemo(()=>{const l=new Map;return m.forEach(r=>{const n=r.trainerName||"Unknown";l.has(n)||l.set(n,{trainer:n,newMembers:0,converted:0,retained:0,revenue:0});const v=l.get(n);String(r.isNew||"").includes("New")&&v.newMembers++,r.conversionStatus==="Converted"&&v.converted++,r.retentionStatus==="Retained"&&v.retained++,v.revenue+=r.ltv||0}),Array.from(l.values()).filter(r=>r.newMembers>=3).map(r=>({...r,conversionRate:r.newMembers>0?r.converted/r.newMembers*100:0,retentionRate:r.converted>0?r.retained/r.converted*100:0})).sort((r,n)=>n.conversionRate-r.conversionRate).slice(0,10)},[m]),d=V.useMemo(()=>{const l=[{name:"₹0-5K",min:0,max:5e3,count:0,color:"#ef4444"},{name:"₹5K-15K",min:5e3,max:15e3,count:0,color:"#f97316"},{name:"₹15K-30K",min:15e3,max:3e4,count:0,color:"#eab308"},{name:"₹30K-50K",min:3e4,max:5e4,count:0,color:"#22c55e"},{name:"₹50K+",min:5e4,max:1/0,count:0,color:"#3b82f6"}];return m.forEach(r=>{const n=r.ltv||0,v=l.find(u=>n>=u.min&&n<u.max);v&&v.count++}),l.filter(r=>r.count>0)},[m]),s=()=>{switch(g.find(l=>l.id===p),p){case"monthly-trends":return e.jsx(K,{width:"100%",height:400,children:e.jsxs(Ie,{data:x,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(E,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(G,{dataKey:"month",stroke:"#64748b",fontSize:12,tickFormatter:r=>{const[n,v]=r.split("-");return`${v}/${n.slice(2)}`}}),e.jsx(U,{stroke:"#64748b",fontSize:12}),e.jsx(O,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:(r,n)=>[n.includes("Rate")?`${r.toFixed(1)}%`:f(r),n]}),e.jsx(le,{type:"monotone",dataKey:"newMembers",stroke:"#3b82f6",strokeWidth:3,dot:{fill:"#3b82f6",strokeWidth:2,r:6},name:"New Members"}),e.jsx(le,{type:"monotone",dataKey:"conversionRate",stroke:"#22c55e",strokeWidth:3,dot:{fill:"#22c55e",strokeWidth:2,r:6},name:"Conversion Rate"})]})});case"conversion-funnel":const l=[{name:"New Members",value:m.filter(r=>String(r.isNew||"").includes("New")).length,color:"#3b82f6"},{name:"Trials Completed",value:m.filter(r=>(r.visitsPostTrial||0)>0).length,color:"#8b5cf6"},{name:"Converted",value:m.filter(r=>r.conversionStatus==="Converted").length,color:"#22c55e"},{name:"Retained",value:m.filter(r=>r.retentionStatus==="Retained").length,color:"#f97316"}];return e.jsx(K,{width:"100%",height:400,children:e.jsxs(q,{data:l,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(E,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(G,{dataKey:"name",stroke:"#64748b",fontSize:12}),e.jsx(U,{stroke:"#64748b",fontSize:12}),e.jsx(O,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:r=>[f(r),"Count"]}),e.jsx(B,{dataKey:"value",fill:"#3b82f6",radius:[4,4,0,0]})]})});case"location-performance":return e.jsx(K,{width:"100%",height:400,children:e.jsxs(q,{data:a,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(E,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(G,{dataKey:"location",stroke:"#64748b",fontSize:12,angle:-45,textAnchor:"end",height:80,tickFormatter:r=>r.length>15?`${r.slice(0,15)}...`:r}),e.jsx(U,{stroke:"#64748b",fontSize:12}),e.jsx(O,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:(r,n)=>[n.includes("Rate")?`${r.toFixed(1)}%`:f(r),n]}),e.jsx(B,{dataKey:"conversionRate",fill:"#22c55e",radius:[4,4,0,0],name:"Conversion Rate"})]})});case"trainer-performance":return e.jsx(K,{width:"100%",height:400,children:e.jsxs(q,{data:o,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(E,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(G,{dataKey:"trainer",stroke:"#64748b",fontSize:12,angle:-45,textAnchor:"end",height:80,tickFormatter:r=>r.length>10?`${r.slice(0,10)}...`:r}),e.jsx(U,{stroke:"#64748b",fontSize:12}),e.jsx(O,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:(r,n)=>[n.includes("Rate")?`${r.toFixed(1)}%`:f(r),n]}),e.jsx(B,{dataKey:"conversionRate",fill:"#8b5cf6",radius:[4,4,0,0],name:"Conversion Rate"}),e.jsx(B,{dataKey:"retentionRate",fill:"#06b6d4",radius:[4,4,0,0],name:"Retention Rate"})]})});case"retention-analysis":return e.jsx(K,{width:"100%",height:400,children:e.jsxs(Fe,{data:x,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(E,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(G,{dataKey:"month",stroke:"#64748b",fontSize:12,tickFormatter:r=>{const[n,v]=r.split("-");return`${v}/${n.slice(2)}`}}),e.jsx(U,{stroke:"#64748b",fontSize:12}),e.jsx(O,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:(r,n)=>[n.includes("Rate")?`${r.toFixed(1)}%`:f(r),n]}),e.jsx(Pe,{type:"monotone",dataKey:"retentionRate",stackId:"1",stroke:"#f97316",fill:"url(#retentionGradient)",name:"Retention Rate"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"retentionGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#f97316",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#f97316",stopOpacity:.1})]})})]})});case"ltv-distribution":return e.jsx(K,{width:"100%",height:400,children:e.jsxs($e,{children:[e.jsx(Ye,{data:d,cx:"50%",cy:"50%",outerRadius:150,fill:"#8884d8",dataKey:"count",label:({name:r,percent:n})=>`${r} (${(n*100).toFixed(1)}%)`,children:d.map((r,n)=>e.jsx(Ae,{fill:r.color},`cell-${n}`))}),e.jsx(O,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:r=>[f(r),"Clients"]})]})});default:return null}},c=g.find(l=>l.id===p);return e.jsxs(M,{className:"bg-white shadow-lg border-0 overflow-hidden",children:[e.jsx(L,{className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white",children:e.jsxs(k,{className:"flex items-center gap-3",children:[e.jsx(se,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-sm opacity-90",children:"Interactive charts and visualizations"})]})]})}),e.jsxs(C,{className:"p-6",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3 mb-6",children:g.map(l=>e.jsxs(A,{variant:p===l.id?"default":"ghost",size:"sm",onClick:()=>w(l.id),className:`flex flex-col items-center gap-2 h-auto py-4 px-3 transition-all duration-300 hover:scale-105 ${p===l.id?"bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg":"hover:bg-slate-100"}`,children:[e.jsx(l.icon,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium text-center leading-tight",children:l.label})]},l.id))}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[c&&e.jsx(c.icon,{className:"w-5 h-5 text-slate-600"}),e.jsx("h4",{className:"text-lg font-semibold text-slate-800",children:c?.label})]}),e.jsxs(j,{className:"bg-blue-100 text-blue-800",children:[m.length," records"]})]}),s()]})]})]})},We=({activeTable:m,onTableChange:p,dataLength:w})=>{const g=[{key:"monthonmonthbytype",label:"By Client Type",description:"Monthly breakdown by client type",icon:D,gradient:"from-purple-500 to-pink-600"},{key:"monthonmonth",label:"Month on Month",description:"Monthly trends and comparisons",icon:H,gradient:"from-blue-500 to-indigo-600"},{key:"yearonyear",label:"Year on Year",description:"Annual performance comparison",icon:F,gradient:"from-green-500 to-emerald-600"},{key:"hostedclasses",label:"Hosted Classes",description:"Class performance metrics",icon:D,gradient:"from-purple-500 to-violet-600"},{key:"memberships",label:"Membership Analysis",description:"Membership type breakdown",icon:se,gradient:"from-orange-500 to-red-600"}];return e.jsxs("div",{className:"bg-gradient-to-r from-slate-50 to-gray-100 p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Data Analysis Tables"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Select a table to view detailed metrics"})]}),e.jsxs(j,{className:"bg-blue-100 text-blue-800 border-blue-200",children:[w," Records"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:g.map(x=>e.jsxs(A,{variant:m===x.key?"default":"outline",className:`h-auto p-4 flex-col items-start gap-2 transition-all duration-300 ${m===x.key?`bg-gradient-to-r ${x.gradient} text-white shadow-lg hover:shadow-xl`:"bg-white hover:bg-gray-50 border-gray-200 hover:border-gray-300"}`,onClick:()=>p(x.key),children:[e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx(x.icon,{className:`w-5 h-5 ${m===x.key?"text-white":"text-gray-600"}`}),e.jsx("span",{className:`font-semibold text-sm ${m===x.key?"text-white":"text-gray-900"}`,children:x.label})]}),e.jsx("p",{className:`text-xs text-left w-full ${m===x.key?"text-white/90":"text-gray-500"}`,children:x.description})]},x.key))})]})},Je=({data:m,visitsSummary:p,onRowClick:w})=>{const g=V.useMemo(()=>{const s=(()=>{const l=[],r=new Date,n=r.getMonth(),v=r.getFullYear();for(let u=v;u>=2024;u--){const i=u===v?n:11,t=0;for(let h=i;h>=t;h--){const b=`${u}-${(h+1).toString().padStart(2,"0")}`,y=new Date(u,h).toLocaleDateString("en-US",{month:"short",year:"numeric"});l.push({key:b,name:y})}}return l})().reduce((l,r)=>(l[r.key]={month:r.name,sortKey:r.key,totalMembers:0,newMembers:0,converted:0,retained:0,totalLTV:0,conversionIntervals:[],visitsPostTrial:[],clients:[]},l),{});return m.forEach(l=>{const r=l.firstVisitDate;let n;if(r.includes("/")){const u=r.split(" ")[0].split("/");if(u.length===3){const[i,t,h]=u;n=new Date(parseInt(h),parseInt(t)-1,parseInt(i)),isNaN(n.getTime())&&(n=new Date(parseInt(h),parseInt(i)-1,parseInt(t)))}else n=new Date(r)}else n=new Date(r);if(isNaN(n.getTime()))return;const v=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`;s[v]&&(s[v].totalMembers++,s[v].clients.push(l),(l.isNew||"").toLowerCase().includes("new")&&s[v].newMembers++,l.conversionStatus==="Converted"&&s[v].converted++,l.retentionStatus==="Retained"&&s[v].retained++,s[v].totalLTV+=l.ltv||0,l.conversionSpan&&l.conversionSpan>0&&s[v].conversionIntervals.push(l.conversionSpan),l.visitsPostTrial&&l.visitsPostTrial>0&&s[v].visitsPostTrial.push(l.visitsPostTrial))}),p&&Object.keys(s).forEach(l=>{const r=s[l],[n,v]=l.split("-"),t=`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(v)-1]} ${n}`;r.visits=p[t]||0}),Object.values(s).map(l=>({...l,trialsCompleted:l.visitsPostTrial.length,conversionRate:l.newMembers>0?l.converted/l.newMembers*100:0,retentionRate:l.newMembers>0?l.retained/l.newMembers*100:0,avgLTV:l.totalMembers>0?l.totalLTV/l.totalMembers:0,avgConversionInterval:l.conversionIntervals.length>0?l.conversionIntervals.reduce((r,n)=>r+n,0)/l.conversionIntervals.length:0,avgVisitsPostTrial:l.visitsPostTrial.length>0?l.visitsPostTrial.reduce((r,n)=>r+n,0)/l.visitsPostTrial.length:0})).sort((l,r)=>r.sortKey.localeCompare(l.sortKey))},[m]),x=[{key:"month",header:"Month",className:"font-semibold min-w-[100px]",render:o=>e.jsx("div",{className:"font-bold text-slate-800 bg-gradient-to-r from-blue-50 to-purple-50 px-3 py-2 rounded-lg",children:o})},{key:"totalMembers",header:"Trials",align:"center",render:o=>e.jsx("span",{className:"text-base font-bold text-blue-600",children:f(o)})},{key:"newMembers",header:"New Members",align:"center",render:o=>e.jsx("span",{className:"text-base font-bold text-green-600",children:f(o)})},{key:"retained",header:"Retained",align:"center",render:o=>e.jsx("span",{className:"text-base font-bold text-purple-600",children:f(o)})},{key:"retentionRate",header:"Retention %",align:"center",render:o=>e.jsxs("span",{className:`text-base font-bold ${o>70?"text-purple-600":o<40?"text-red-600":"text-slate-600"}`,children:[o.toFixed(1),"%"]})},{key:"converted",header:"Converted",align:"center",render:o=>e.jsx("span",{className:"text-base font-bold text-emerald-600",children:f(o)})},{key:"conversionRate",header:"Conversion %",align:"center",render:o=>e.jsxs("span",{className:`text-base font-bold ${o>25?"text-green-600":o<10?"text-red-600":"text-slate-600"}`,children:[o.toFixed(1),"%"]})},{key:"avgLTV",header:"Avg LTV",align:"right",render:o=>e.jsx("span",{className:"text-base font-bold text-teal-600",children:S(o)})},{key:"avgConversionInterval",header:"Avg Conv Days",align:"center",render:o=>e.jsx("span",{className:"text-base font-bold text-orange-600",children:Math.round(o)})},{key:"avgVisitsPostTrial",header:"Avg Visits",align:"center",render:o=>e.jsx("span",{className:"text-base font-bold text-blue-600",children:o.toFixed(1)})}],a={month:"TOTAL",totalMembers:g.reduce((o,d)=>o+d.totalMembers,0),newMembers:g.reduce((o,d)=>o+d.newMembers,0),converted:g.reduce((o,d)=>o+d.converted,0),conversionRate:0,retained:g.reduce((o,d)=>o+d.retained,0),retentionRate:0,totalLTV:g.reduce((o,d)=>o+d.totalLTV,0),avgLTV:g.reduce((o,d)=>o+d.totalLTV,0)/Math.max(g.reduce((o,d)=>o+d.totalMembers,0),1),avgConversionInterval:g.reduce((o,d)=>o+d.avgConversionInterval*d.totalMembers,0)/Math.max(g.reduce((o,d)=>o+d.totalMembers,0),1),avgVisitsPostTrial:g.reduce((o,d)=>o+d.avgVisitsPostTrial*d.totalMembers,0)/Math.max(g.reduce((o,d)=>o+d.totalMembers,0),1)};return a.conversionRate=a.newMembers>0?a.converted/a.newMembers*100:0,a.retentionRate=a.newMembers>0?a.retained/a.newMembers*100:0,e.jsx(he.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs(M,{className:"bg-white shadow-xl border-0 overflow-hidden hover:shadow-2xl transition-all duration-300",children:[e.jsx(L,{className:"border-b border-gray-100 bg-gradient-to-r from-blue-600 to-cyan-600 text-white",children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Month-on-Month Client Conversion Analysis",e.jsxs(j,{variant:"secondary",className:"bg-white/20 text-white",children:[g.length," Months"]})]})}),e.jsx(C,{className:"p-0",children:e.jsx(W,{data:g,columns:x,headerGradient:"from-blue-600 to-cyan-600",showFooter:!0,footerData:a,maxHeight:"600px",onRowClick:w})})]})})},Xe=({data:m,checkins:p,visitsSummary:w,onRowClick:g})=>{const x=$.useMemo(()=>{if(!m||m.length===0)return[];[...new Set(m.map(c=>c.isNew||"Unknown").filter(Boolean))],p&&p.forEach(c=>{c.month&&c.year&&c.isNew&&(`${c.year}${String(new Date(Date.parse(c.month+" 1, "+c.year)).getMonth()+1).padStart(2,"0")}`,`${c.isNew}`)});const s={};return m.forEach(c=>{const l=c.firstVisitDate;if(!l)return;let r;if(l.includes("/")){const b=l.split(" ")[0].split("/");if(b.length===3){const[y,R,I]=b;r=new Date(parseInt(I),parseInt(R)-1,parseInt(y)),isNaN(r.getTime())&&(r=new Date(parseInt(I),parseInt(y)-1,parseInt(R)))}else r=new Date(l)}else r=new Date(l);if(isNaN(r.getTime()))return;const n=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`,v=r.toLocaleDateString("en-US",{month:"short",year:"numeric"}),u=c.isNew||"Unknown",i=`${n}-${u}`;if(!s[i]){const b=`${c.firstVisitDate?.split("T")[0].substring(0,7)}`,y=w?.[b]||0;s[i]={month:v,sortKey:n,type:u,visits:y,totalTrials:0,newMembers:0,converted:0,retained:0,totalLTV:0,conversionIntervals:[],visitsPostTrial:[],clients:[]}}const t=s[i];t.totalTrials++,t.clients.push(c),(c.isNew||"").toLowerCase().includes("new")&&t.newMembers++,c.conversionStatus==="Converted"&&t.converted++,c.retentionStatus==="Retained"&&t.retained++,t.totalLTV+=c.ltv||0,c.conversionSpan&&c.conversionSpan>0&&t.conversionIntervals.push(c.conversionSpan),c.visitsPostTrial&&c.visitsPostTrial>0&&t.visitsPostTrial.push(c.visitsPostTrial)}),Object.values(s).sort((c,l)=>{const r=c.sortKey.localeCompare(l.sortKey);return r!==0?r:c.type.toLowerCase().includes("new")&&!l.type.toLowerCase().includes("new")?-1:!c.type.toLowerCase().includes("new")&&l.type.toLowerCase().includes("new")?1:c.type.localeCompare(l.type)})},[m,p]),a=$.useMemo(()=>x.map(s=>{const c=s.newMembers>0?s.converted/s.newMembers*100:0,l=s.newMembers>0?s.retained/s.newMembers*100:0,r=s.totalTrials>0?s.totalLTV/s.totalTrials:0,n=s.conversionIntervals.length>0?s.conversionIntervals.reduce((u,i)=>u+i,0)/s.conversionIntervals.length:0,v=s.visitsPostTrial.length>0?s.visitsPostTrial.reduce((u,i)=>u+i,0)/s.visitsPostTrial.length:0;return{...s,conversionRate:c,retentionRate:l,avgLTV:r,avgConversionDays:n,avgVisits:v}}),[x]),o=$.useMemo(()=>a.reduce((s,c)=>({visits:s.visits+(c.visits||0),totalTrials:s.totalTrials+c.totalTrials,newMembers:s.newMembers+c.newMembers,converted:s.converted+c.converted,retained:s.retained+c.retained,totalLTV:s.totalLTV+c.totalLTV,conversionIntervals:[...s.conversionIntervals,...c.conversionIntervals],visitsPostTrial:[...s.visitsPostTrial,...c.visitsPostTrial]}),{visits:0,totalTrials:0,newMembers:0,converted:0,retained:0,totalLTV:0,conversionIntervals:[],visitsPostTrial:[]}),[a]),d=$.useMemo(()=>{const s=o.newMembers>0?o.converted/o.newMembers*100:0,c=o.newMembers>0?o.retained/o.newMembers*100:0,l=o.totalTrials>0?o.totalLTV/o.totalTrials:0,r=o.conversionIntervals.length>0?o.conversionIntervals.reduce((v,u)=>v+u,0)/o.conversionIntervals.length:0,n=o.visitsPostTrial.length>0?o.visitsPostTrial.reduce((v,u)=>v+u,0)/o.visitsPostTrial.length:0;return{month:"TOTALS",type:"All Types",visits:o.visits,totalTrials:o.totalTrials,newMembers:o.newMembers,converted:o.converted,retained:o.retained,conversionRate:s,retentionRate:c,avgLTV:l,avgConversionDays:r,avgVisits:n}},[o]);return e.jsxs(M,{className:"bg-white shadow-lg border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx(L,{className:"bg-gradient-to-r from-indigo-700 to-purple-900 text-white pb-4",children:e.jsxs(k,{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Month-on-Month Analysis by Client Type",e.jsxs(j,{variant:"secondary",className:"ml-2 bg-white/20 text-white border-white/30",children:[Object.keys(x).length," Entries"]})]})}),e.jsx(C,{className:"p-0 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto max-h-[600px]",children:e.jsxs(de,{className:"w-full",children:[e.jsx(me,{className:"sticky top-0 z-20",children:e.jsxs(z,{className:`border-b h-12 ${De("retention")}`,children:[e.jsx(T,{className:"font-bold text-white text-xs px-4 sticky left-0 z-10 min-w-[100px]",children:"Month"}),e.jsx(T,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Type"}),e.jsx(T,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Trials"}),e.jsx(T,{className:"font-bold text-white text-xs px-3 text-center min-w-[90px]",children:"New Members"}),e.jsx(T,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Retained"}),e.jsx(T,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Retention %"}),e.jsx(T,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Converted"}),e.jsx(T,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Conversion %"}),e.jsx(T,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Avg LTV"}),e.jsx(T,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Avg Conv Days"}),e.jsx(T,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Avg Visits"})]})}),e.jsxs(xe,{children:[a.map((s,c)=>e.jsxs(z,{className:"hover:bg-gray-50 transition-colors cursor-pointer border-b border-gray-100 h-10",onClick:()=>g?.(s),children:[e.jsx(N,{className:"font-semibold text-gray-900 text-xs px-4 sticky left-0 bg-slate-100 z-10 border-r",children:s.month}),e.jsx(N,{className:"text-xs px-3 text-left",children:e.jsx(j,{variant:s.type.toLowerCase().includes("new")?"default":"secondary",className:"text-xs rounded-t rounded-b py-2 min-w-52 bg-indigo-900 text-white font-medium rounded-lg",children:s.type})}),e.jsx(N,{className:"text-xs px-3 text-center font-medium",children:f(s.totalTrials)}),e.jsx(N,{className:"text-xs px-3 text-center font-medium",children:f(s.newMembers)}),e.jsx(N,{className:"text-xs px-3 text-center font-medium",children:f(s.retained)}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsxs("span",{className:`font-semibold ${s.retentionRate>=70?"text-green-600":s.retentionRate>=50?"text-orange-600":"text-red-600"}`,children:[s.retentionRate.toFixed(1),"%"]})}),e.jsx(N,{className:"text-xs px-3 text-center font-medium",children:f(s.converted)}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsxs("span",{className:`font-semibold ${s.conversionRate>=50?"text-green-600":s.conversionRate>=30?"text-orange-600":"text-red-600"}`,children:[s.conversionRate.toFixed(1),"%"]})}),e.jsx(N,{className:"text-xs px-3 text-right font-semibold text-emerald-600",children:S(s.avgLTV)}),e.jsxs(N,{className:"text-xs px-3 text-center font-medium",children:[s.avgConversionDays.toFixed(0)," days"]}),e.jsx(N,{className:"text-xs px-3 text-center font-medium",children:s.avgVisits.toFixed(1)})]},`${s.month}-${s.type}`)),e.jsxs(z,{className:"border-t-4 border-gray-800 text-gray-900",children:[e.jsx(N,{className:"border-t-4 border-gray-800 text-gray-900",children:d.month}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsx(j,{variant:"outline",className:"text-xs font-bold",children:d.type})}),e.jsx(N,{className:"text-xs px-3 text-center font-bold",children:f(d.totalTrials)}),e.jsx(N,{className:"text-xs px-3 text-center font-bold",children:f(d.newMembers)}),e.jsx(N,{className:"text-xs px-3 text-center font-bold",children:f(d.retained)}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsxs("span",{className:`font-bold ${d.retentionRate>=70?"text-green-600":d.retentionRate>=50?"text-orange-600":"text-red-600"}`,children:[d.retentionRate.toFixed(1),"%"]})}),e.jsx(N,{className:"text-xs px-3 text-center font-bold",children:f(d.converted)}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsxs("span",{className:`font-bold ${d.conversionRate>=50?"text-green-600":d.conversionRate>=30?"text-orange-600":"text-red-600"}`,children:[d.conversionRate.toFixed(1),"%"]})}),e.jsx(N,{className:"text-xs px-3 text-right font-bold text-emerald-600",children:S(d.avgLTV)}),e.jsxs(N,{className:"text-xs px-3 text-center font-bold",children:[d.avgConversionDays.toFixed(0)," days"]}),e.jsx(N,{className:"text-xs px-3 text-center font-bold",children:d.avgVisits.toFixed(1)})]})]})]})})})]})},Qe=({data:m,visitsSummary:p,onRowClick:w})=>{const g=V.useMemo(()=>{const s=new Date().getFullYear(),c=s-1,r=Array.from({length:12},(n,v)=>{const u=v+1,i=new Date(2024,v).toLocaleDateString("en-US",{month:"short"});return{monthName:i,monthNumber:u,key:i}}).reduce((n,v)=>(n[v.key]={month:v.monthName,sortOrder:v.monthNumber,currentYear:{totalMembers:0,visits:0,newMembers:0,converted:0,retained:0,totalLTV:0,clients:[]},previousYear:{totalMembers:0,visits:0,newMembers:0,converted:0,retained:0,totalLTV:0,clients:[]}},n),{});return m.forEach(n=>{const v=n.firstVisitDate;let u;if(v.includes("/")){const h=v.split(" ")[0].split("/");if(h.length===3){const[b,y,R]=h;u=new Date(parseInt(R),parseInt(y)-1,parseInt(b)),isNaN(u.getTime())&&(u=new Date(parseInt(R),parseInt(b)-1,parseInt(y)))}else u=new Date(v)}else u=new Date(v);if(isNaN(u.getTime()))return;const i=u.getFullYear();u.getMonth()+1;const t=u.toLocaleDateString("en-US",{month:"short"});if((i===s||i===c)&&r[t]){const h=i===s?r[t].currentYear:r[t].previousYear;h.totalMembers++,h.clients.push(n),(n.isNew||"").toLowerCase().includes("new")&&h.newMembers++,n.conversionStatus==="Converted"&&h.converted++,n.retentionStatus==="Retained"&&h.retained++,h.totalLTV+=n.ltv||0}}),p&&Object.values(r).forEach(n=>{const v=new Date().getFullYear(),u=v-1,i=`${n.month} ${v}`,t=`${n.month} ${u}`;n.currentYear.visits=p[i]||0,n.previousYear.visits=p[t]||0}),Object.values(r).map(n=>{const v=n.currentYear.newMembers>0?n.currentYear.converted/n.currentYear.newMembers*100:0,u=n.previousYear.newMembers>0?n.previousYear.converted/n.previousYear.newMembers*100:0,i=n.currentYear.newMembers>0?n.currentYear.retained/n.currentYear.newMembers*100:0,t=n.previousYear.newMembers>0?n.previousYear.retained/n.previousYear.newMembers*100:0,h=n.currentYear.totalMembers>0?n.currentYear.totalLTV/n.currentYear.totalMembers:0,b=n.previousYear.totalMembers>0?n.previousYear.totalLTV/n.previousYear.totalMembers:0;return{month:n.month,sortOrder:n.sortOrder,currentVisits:n.currentYear.visits,previousVisits:n.previousYear.visits,visitsGrowth:n.previousYear.visits>0?(n.currentYear.visits-n.previousYear.visits)/n.previousYear.visits*100:0,currentTotalMembers:n.currentYear.totalMembers,previousTotalMembers:n.previousYear.totalMembers,totalMembersGrowth:n.previousYear.totalMembers>0?(n.currentYear.totalMembers-n.previousYear.totalMembers)/n.previousYear.totalMembers*100:0,currentNewMembers:n.currentYear.newMembers,previousNewMembers:n.previousYear.newMembers,newMembersGrowth:n.previousYear.newMembers>0?(n.currentYear.newMembers-n.previousYear.newMembers)/n.previousYear.newMembers*100:0,currentConverted:n.currentYear.converted,previousConverted:n.previousYear.converted,currentConversionRate:v,previousConversionRate:u,conversionRateGrowth:u>0?v-u:0,currentRetained:n.currentYear.retained,previousRetained:n.previousYear.retained,currentRetentionRate:i,previousRetentionRate:t,retentionRateGrowth:t>0?i-t:0,currentTotalLTV:n.currentYear.totalLTV,previousTotalLTV:n.previousYear.totalLTV,currentAvgLTV:h,previousAvgLTV:b,avgLTVGrowth:b>0?(h-b)/b*100:0,currentClients:n.currentYear.clients,previousClients:n.previousYear.clients}}).sort((n,v)=>n.sortOrder-v.sortOrder)},[m]),x=[{key:"month",header:"Month",className:"font-semibold min-w-[80px]"},{key:"currentTotalMembers",header:`${new Date().getFullYear()} Trials`,align:"center",render:s=>e.jsx("span",{className:"text-base font-bold text-blue-600",children:f(s)})},{key:"previousTotalMembers",header:`${new Date().getFullYear()-1} Trials`,align:"center",render:s=>e.jsx("span",{className:"text-base font-bold text-slate-600",children:f(s)})},{key:"totalMembersGrowth",header:"Trials Growth %",align:"center",render:s=>e.jsxs("span",{className:`text-base font-bold ${(s||0)>0?"text-green-600":(s||0)<0?"text-red-600":"text-slate-600"}`,children:[(s||0)>0?"+":"",(s||0).toFixed(1),"%"]})},{key:"currentNewMembers",header:`${new Date().getFullYear()} New Members`,align:"center",render:s=>e.jsx("span",{className:"text-base font-bold text-green-600",children:f(s)})},{key:"previousNewMembers",header:`${new Date().getFullYear()-1} New Members`,align:"center",render:s=>e.jsx("span",{className:"text-base font-bold text-slate-600",children:f(s)})},{key:"newMembersGrowth",header:"New Members Growth %",align:"center",render:s=>e.jsxs("span",{className:`text-base font-bold ${(s||0)>0?"text-green-600":(s||0)<0?"text-red-600":"text-slate-600"}`,children:[(s||0)>0?"+":"",(s||0).toFixed(1),"%"]})},{key:"currentConversionRate",header:`${new Date().getFullYear()} Conversion %`,align:"center",render:s=>e.jsxs("span",{className:"text-base font-bold text-green-600",children:[(s||0).toFixed(1),"%"]})},{key:"previousConversionRate",header:`${new Date().getFullYear()-1} Conversion %`,align:"center",render:s=>e.jsxs("span",{className:"text-base font-bold text-slate-600",children:[(s||0).toFixed(1),"%"]})},{key:"conversionRateGrowth",header:"Conv. Growth",align:"center",render:s=>e.jsxs("span",{className:`text-base font-bold ${(s||0)>0?"text-green-600":(s||0)<0?"text-red-600":"text-slate-600"}`,children:[(s||0)>0?"+":"",(s||0).toFixed(1),"pp"]})},{key:"currentAvgLTV",header:`${new Date().getFullYear()} Avg LTV`,align:"right",render:s=>e.jsx("span",{className:"text-base font-bold text-purple-600",children:S(s||0)})},{key:"previousAvgLTV",header:`${new Date().getFullYear()-1} Avg LTV`,align:"right",render:s=>e.jsx("span",{className:"text-base font-bold text-slate-600",children:S(s||0)})},{key:"avgLTVGrowth",header:"LTV Growth %",align:"center",render:s=>e.jsxs("span",{className:`text-base font-bold ${(s||0)>0?"text-green-600":(s||0)<0?"text-red-600":"text-slate-600"}`,children:[(s||0)>0?"+":"",(s||0).toFixed(1),"%"]})}],a={month:"TOTAL",currentTotalMembers:g.reduce((s,c)=>s+(c.currentTotalMembers||0),0),previousTotalMembers:g.reduce((s,c)=>s+(c.previousTotalMembers||0),0),totalMembersGrowth:0,currentNewMembers:g.reduce((s,c)=>s+(c.currentNewMembers||0),0),previousNewMembers:g.reduce((s,c)=>s+(c.previousNewMembers||0),0),newMembersGrowth:0,currentConversionRate:0,previousConversionRate:0,conversionRateGrowth:0,currentAvgLTV:g.reduce((s,c)=>s+(c.currentTotalLTV||0),0)/Math.max(g.reduce((s,c)=>s+(c.currentTotalMembers||0),0),1),previousAvgLTV:g.reduce((s,c)=>s+(c.previousTotalLTV||0),0)/Math.max(g.reduce((s,c)=>s+(c.previousTotalMembers||0),0),1),avgLTVGrowth:0},o=g.reduce((s,c)=>s+(c.currentConverted||0),0),d=g.reduce((s,c)=>s+(c.previousConverted||0),0);return a.totalMembersGrowth=a.previousTotalMembers>0?(a.currentTotalMembers-a.previousTotalMembers)/a.previousTotalMembers*100:0,a.newMembersGrowth=a.previousNewMembers>0?(a.currentNewMembers-a.previousNewMembers)/a.previousNewMembers*100:0,a.currentConversionRate=a.currentNewMembers>0?o/a.currentNewMembers*100:0,a.previousConversionRate=a.previousNewMembers>0?d/a.previousNewMembers*100:0,a.conversionRateGrowth=a.previousConversionRate>0?a.currentConversionRate-a.previousConversionRate:0,a.avgLTVGrowth=a.previousAvgLTV>0?(a.currentAvgLTV-a.previousAvgLTV)/a.previousAvgLTV*100:0,e.jsxs(M,{className:"bg-white shadow-lg border-0",children:[e.jsx(L,{className:"border-b border-gray-100 bg-gradient-to-r from-emerald-600 to-teal-600 text-white",children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5"}),"Year-on-Year Client Conversion Comparison",e.jsxs(j,{variant:"secondary",className:"bg-white/20 text-white",children:[new Date().getFullYear()," vs ",new Date().getFullYear()-1]})]})}),e.jsx(C,{className:"p-0",children:e.jsx(W,{data:g,columns:x,headerGradient:"from-emerald-600 to-teal-600",showFooter:!0,footerData:a,maxHeight:"600px",onRowClick:w})})]})},Ze=({data:m})=>{const p=V.useMemo(()=>{const x=m.reduce((a,o)=>{const d=o.membershipUsed||"No Membership";return a[d]||(a[d]={membershipType:d,totalMembers:0,newMembers:0,converted:0,retained:0,totalLTV:0,totalVisits:0,conversionSpans:[]}),a[d].totalMembers++,(o.isNew||"").includes("New")&&a[d].newMembers++,o.conversionStatus==="Converted"&&a[d].converted++,o.retentionStatus==="Retained"&&a[d].retained++,a[d].totalLTV+=o.ltv||0,a[d].totalVisits+=o.visitsPostTrial||0,o.conversionSpan&&o.conversionSpan>0&&a[d].conversionSpans.push(o.conversionSpan),a},{});return Object.values(x).map(a=>({...a,conversionRate:a.newMembers>0?a.converted/a.newMembers*100:0,retentionRate:a.totalMembers>0?a.retained/a.totalMembers*100:0,avgLTV:a.totalMembers>0?a.totalLTV/a.totalMembers:0,avgVisits:a.totalMembers>0?a.totalVisits/a.totalMembers:0,avgConversionSpan:a.conversionSpans.length>0?a.conversionSpans.reduce((o,d)=>o+d,0)/a.conversionSpans.length:0})).filter(a=>a.totalMembers>0).sort((a,o)=>o.totalMembers-a.totalMembers)},[m]),w=[{key:"membershipType",header:"Membership Type",className:"font-medium text-xs min-w-[200px]",render:x=>e.jsx("span",{className:"text-xs font-medium text-gray-800 truncate max-w-[200px]",title:x,children:x.length>25?`${x.substring(0,25)}...`:x})},{key:"totalMembers",header:"Trials",align:"center",render:x=>e.jsx("span",{className:"text-xs font-semibold text-blue-600",children:f(x)})},{key:"newMembers",header:"New Members",align:"center",render:x=>e.jsx("span",{className:"text-xs font-semibold text-green-600",children:f(x)})},{key:"retained",header:"Retained",align:"center",render:x=>e.jsx("span",{className:"text-xs font-semibold text-purple-600",children:f(x)})},{key:"retentionRate",header:"Retention %",align:"center",render:x=>e.jsxs("span",{className:"text-xs font-semibold",children:[x.toFixed(1),"%"]})},{key:"converted",header:"Converted",align:"center",render:x=>e.jsx("span",{className:"text-xs font-semibold text-green-600",children:f(x)})},{key:"conversionRate",header:"Conversion %",align:"center",render:x=>e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[x>50?e.jsx(F,{className:"w-3 h-3 text-green-500"}):x<20?e.jsx(ee,{className:"w-3 h-3 text-red-500"}):null,e.jsxs("span",{className:`text-xs font-semibold ${x>50?"text-green-600":x<20?"text-red-600":"text-gray-600"}`,children:[x.toFixed(1),"%"]})]})},{key:"avgLTV",header:"Avg LTV",align:"right",render:x=>e.jsx("span",{className:"text-xs font-semibold",children:S(x)})}],g={membershipType:"TOTAL",totalMembers:p.reduce((x,a)=>x+a.totalMembers,0),newMembers:p.reduce((x,a)=>x+a.newMembers,0),converted:p.reduce((x,a)=>x+a.converted,0),conversionRate:0,retained:p.reduce((x,a)=>x+a.retained,0),retentionRate:0,avgLTV:p.reduce((x,a)=>x+a.totalLTV,0)/Math.max(p.reduce((x,a)=>x+a.totalMembers,0),1)};return g.conversionRate=g.newMembers>0?g.converted/g.newMembers*100:0,g.retentionRate=g.totalMembers>0?g.retained/g.totalMembers*100:0,e.jsxs(M,{className:"bg-white shadow-lg border-0",children:[e.jsx(L,{className:"border-b border-gray-100 bg-gradient-to-r from-purple-600 to-indigo-600 text-white",children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),"Membership Type Performance Analysis",e.jsxs(j,{variant:"secondary",className:"bg-white/20 text-white",children:[p.length," Types"]})]})}),e.jsx(C,{className:"p-0",children:e.jsx(W,{data:p,columns:w,headerGradient:"from-purple-600 to-indigo-600",showFooter:!0,footerData:g,maxHeight:"500px"})})]})},qe=({data:m,onRowClick:p})=>{if(!m||m.length===0)return e.jsxs(M,{className:"bg-white shadow-xl border-0 overflow-hidden",children:[e.jsx(L,{className:"border-b border-gray-100 bg-gradient-to-r from-purple-600 to-pink-600 text-white",children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5"}),"Hosted Classes Performance Analysis",e.jsx(j,{variant:"secondary",className:"bg-white/20 text-white",children:"0 Classes"})]})}),e.jsx(C,{className:"p-6",children:e.jsx("p",{className:"text-gray-500 text-center",children:"No class data available for analysis."})})]});const w=V.useMemo(()=>{const o=m.filter(d=>{if(!d||!d.firstVisitEntityName)return!1;const s=d.firstVisitEntityName.toLowerCase(),c=s.includes("host")||s.includes("hosted")||s.includes("sign up"),l=/\bx\b/.test(s);return c||l}).reduce((d,s)=>{if(!s)return d;const c=s.firstVisitEntityName||"Unknown Class";let l="Unknown";if(s.firstVisitDate)try{let n;if(s.firstVisitDate.includes("/")){const v=s.firstVisitDate.split(",")[0].trim(),[u,i,t]=v.split("/");n=new Date(parseInt(t),parseInt(i)-1,parseInt(u))}else n=new Date(s.firstVisitDate);isNaN(n.getTime())||(l=n.toLocaleDateString("en-US",{month:"short",year:"numeric"}))}catch{}const r=`${l}-${c}`;if(d[r]||(d[r]={month:l,className:c,totalMembers:0,newMembers:0,converted:0,retained:0,totalLTV:0,conversionIntervals:[],clients:[]}),d[r].totalMembers++,d[r].clients.push(s),(s.isNew||"").toLowerCase().includes("new")&&d[r].newMembers++,s.conversionStatus==="Converted"&&d[r].converted++,s.retentionStatus==="Retained"&&d[r].retained++,d[r].totalLTV+=s.ltv||0,s.firstPurchase&&s.firstVisitDate)try{const n=new Date(s.firstVisitDate),v=new Date(s.firstPurchase);if(!isNaN(n.getTime())&&!isNaN(v.getTime())){const u=Math.ceil((v.getTime()-n.getTime())/864e5);u>=0&&d[r].conversionIntervals.push(u)}}catch{}return d},{});return Object.values(o).map(d=>({...d,conversionRate:d.newMembers>0?d.converted/d.newMembers*100:0,retentionRate:d.converted>0?d.retained/d.converted*100:0,avgLTV:d.totalMembers>0?d.totalLTV/d.totalMembers:0,avgConversionInterval:d.conversionIntervals.length>0?d.conversionIntervals.reduce((s,c)=>s+c,0)/d.conversionIntervals.length:0})).sort((d,s)=>s.totalMembers-d.totalMembers)},[m]),g=[{key:"month",header:"Month",className:"font-semibold min-w-[100px]",render:a=>e.jsx("div",{className:"font-bold text-slate-800 bg-gradient-to-r from-purple-50 to-pink-50 px-3 py-2 rounded-lg",children:a})},{key:"className",header:"Class Name",className:"font-medium min-w-[200px]",render:a=>e.jsx("div",{className:"font-semibold text-slate-700 truncate",title:a,children:a.length>30?`${a.substring(0,30)}...`:a})},{key:"totalMembers",header:"Trials",align:"center",render:a=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:f(a)}),e.jsx("div",{className:"text-xs text-slate-500",children:"trials"})]})},{key:"newMembers",header:"New Members",align:"center",render:a=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:f(a)}),e.jsx("div",{className:"text-xs text-slate-500",children:"new"})]})},{key:"retained",header:"Retained",align:"center",render:a=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-purple-600",children:f(a)}),e.jsx("div",{className:"text-xs text-slate-500",children:"retained"})]})},{key:"retentionRate",header:"Retention %",align:"center",render:a=>{const o=a??0;return e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[o>70?e.jsx(F,{className:"w-3 h-3 text-green-500"}):o<50?e.jsx(ee,{className:"w-3 h-3 text-red-500"}):null,e.jsxs(j,{className:`font-bold ${o>70?"bg-green-100 text-green-800":o<50?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:[o.toFixed(1),"%"]})]})}},{key:"converted",header:"Converted",align:"center",render:a=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:f(a)}),e.jsx("div",{className:"text-xs text-slate-500",children:"converted"})]})},{key:"conversionRate",header:"Conversion %",align:"center",render:a=>{const o=a??0;return e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[o>25?e.jsx(F,{className:"w-3 h-3 text-green-500"}):o<10?e.jsx(ee,{className:"w-3 h-3 text-red-500"}):null,e.jsxs(j,{className:`font-bold ${o>25?"bg-green-100 text-green-800":o<10?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:[o.toFixed(1),"%"]})]})}},{key:"avgLTV",header:"Avg LTV",align:"right",render:a=>e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold text-emerald-600",children:S(a)}),e.jsx("div",{className:"text-xs text-slate-500",children:"per client"})]})},{key:"avgConversionInterval",header:"Avg Conv Days",align:"center",render:a=>{const o=a??0;return e.jsxs(j,{variant:"outline",className:"bg-orange-50 text-orange-700 border-orange-200 font-bold",children:[Math.round(o)," days"]})}}],x={month:"TOTAL",className:`${w.length} Classes`,totalMembers:w.reduce((a,o)=>a+o.totalMembers,0),newMembers:w.reduce((a,o)=>a+o.newMembers,0),converted:w.reduce((a,o)=>a+o.converted,0),conversionRate:0,retained:w.reduce((a,o)=>a+o.retained,0),avgLTV:w.reduce((a,o)=>a+o.totalLTV,0)/Math.max(w.reduce((a,o)=>a+o.totalMembers,0),1),avgConversionInterval:w.reduce((a,o)=>a+o.avgConversionInterval*o.totalMembers,0)/Math.max(w.reduce((a,o)=>a+o.totalMembers,0),1)};return x.conversionRate=x.newMembers>0?x.converted/x.newMembers*100:0,e.jsx(he.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs(M,{className:"bg-white shadow-xl border-0 overflow-hidden hover:shadow-2xl transition-all duration-300",children:[e.jsx(L,{className:"border-b border-gray-100 bg-gradient-to-r from-purple-600 to-pink-600 text-white",children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5"}),"Hosted Classes Performance Analysis",e.jsxs(j,{variant:"secondary",className:"bg-white/20 text-white",children:[w.length," Classes"]})]})}),e.jsx(C,{className:"p-0",children:e.jsx(W,{data:w,columns:g,headerGradient:"from-purple-600 to-pink-600",showFooter:!0,footerData:x,maxHeight:"600px",onRowClick:p})})]})})},et=({isOpen:m,onClose:p,title:w,data:g,type:x})=>{if(!g)return null;const a=V.useMemo(()=>g?x==="metric"&&g.clients||(x==="month"||x==="year")&&g.clients?g.clients:Array.isArray(g)?g:[]:[],[g,x]),o=V.useMemo(()=>{const c=a.length,l=a.filter(t=>(t.isNew||"").toLowerCase().includes("new")).length,r=a.filter(t=>(t.conversionStatus||"").toLowerCase().includes("converted")).length,n=a.filter(t=>(t.retentionStatus||"").toLowerCase().includes("retained")).length,v=a.reduce((t,h)=>t+(h.ltv||0),0),u=a.filter(t=>t.conversionSpan>0).reduce((t,h)=>t+(h.conversionSpan||0),0),i=a.filter(t=>t.conversionSpan>0).length;return{totalMembers:c,newMembers:l,convertedMembers:r,retainedMembers:n,conversionRate:l>0?r/l*100:0,retentionRate:c>0?n/c*100:0,avgLTV:c>0?v/c:0,totalLTV:v,avgConversionTime:i>0?u/i:0}},[a]),d=()=>e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(M,{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white border-0 shadow-lg",children:e.jsxs(C,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(D,{className:"w-5 h-5 text-blue-100"}),e.jsx(j,{className:"bg-white/20 text-white border-0",children:"Total"})]}),e.jsx("div",{className:"text-2xl font-bold",children:f(o.totalMembers)}),e.jsx("div",{className:"text-blue-100 text-sm",children:"Total Members"})]})}),e.jsx(M,{className:"bg-gradient-to-br from-green-500 to-green-600 text-white border-0 shadow-lg",children:e.jsxs(C,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(P,{className:"w-5 h-5 text-green-100"}),e.jsx(j,{className:"bg-white/20 text-white border-0",children:"New"})]}),e.jsx("div",{className:"text-2xl font-bold",children:f(o.newMembers)}),e.jsx("div",{className:"text-green-100 text-sm",children:"New Members"})]})}),e.jsx(M,{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white border-0 shadow-lg",children:e.jsxs(C,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(F,{className:"w-5 h-5 text-purple-100"}),e.jsx(j,{className:"bg-white/20 text-white border-0",children:"Rate"})]}),e.jsxs("div",{className:"text-2xl font-bold",children:[o.conversionRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-purple-100 text-sm",children:"Conversion Rate"})]})}),e.jsx(M,{className:"bg-gradient-to-br from-orange-500 to-orange-600 text-white border-0 shadow-lg",children:e.jsxs(C,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Y,{className:"w-5 h-5 text-orange-100"}),e.jsx(j,{className:"bg-white/20 text-white border-0",children:"LTV"})]}),e.jsx("div",{className:"text-2xl font-bold",children:S(o.avgLTV)}),e.jsx("div",{className:"text-orange-100 text-sm",children:"Avg LTV"})]})})]}),s=()=>a.length===0?e.jsx(M,{children:e.jsxs(C,{className:"p-8 text-center",children:[e.jsx(D,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No client data available for this selection."})]})}):e.jsxs(M,{children:[e.jsx(L,{children:e.jsxs(k,{className:"text-lg",children:["Client Details (",f(a.length)," members)"]})}),e.jsx(C,{className:"p-0",children:e.jsxs("div",{className:"max-h-96 overflow-y-auto",children:[e.jsxs(de,{children:[e.jsx(me,{className:"sticky top-0 bg-gray-50 z-10",children:e.jsxs(z,{children:[e.jsx(T,{className:"font-semibold text-gray-900 text-xs px-3",children:"Name"}),e.jsx(T,{className:"font-semibold text-gray-900 text-xs px-3",children:"Email"}),e.jsx(T,{className:"font-semibold text-gray-900 text-xs px-3 text-center",children:"Type"}),e.jsx(T,{className:"font-semibold text-gray-900 text-xs px-3 text-center",children:"Status"}),e.jsx(T,{className:"font-semibold text-gray-900 text-xs px-3 text-center",children:"Conversion"}),e.jsx(T,{className:"font-semibold text-gray-900 text-xs px-3 text-right",children:"LTV"}),e.jsx(T,{className:"font-semibold text-gray-900 text-xs px-3 text-center",children:"Location"})]})}),e.jsx(xe,{children:a.slice(0,50).map((c,l)=>e.jsxs(z,{className:"hover:bg-gray-50 transition-colors h-10",children:[e.jsxs(N,{className:"text-xs px-3 font-medium",children:[c.firstName," ",c.lastName]}),e.jsx(N,{className:"text-xs px-3 text-gray-600 truncate max-w-[150px]",title:c.email,children:c.email}),e.jsx(N,{className:"text-xs px-3 text-left rounded-t rounded-none",children:e.jsx(j,{variant:c.isNew?.toLowerCase().includes("new")?"default":"secondary",className:"text-xs rounded min-w-44",children:c.isNew||"Unknown"})}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsx(j,{variant:c.retentionStatus?.toLowerCase().includes("retained")?"default":"secondary",className:`text-xs ${c.retentionStatus?.toLowerCase().includes("retained")?"bg-purple-100 text-purple-800":""}`,children:c.retentionStatus||"Pending"})}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsx(j,{variant:c.conversionStatus?.toLowerCase().includes("converted")?"default":"secondary",className:`text-xs ${c.conversionStatus?.toLowerCase().includes("converted")?"bg-green-100 text-green-800":""}`,children:c.conversionStatus||"Pending"})}),e.jsx(N,{className:"text-xs px-3 text-right font-semibold text-emerald-600",children:S(c.ltv||0)}),e.jsx(N,{className:"text-xs px-3 text-center text-gray-600 truncate max-w-[120px]",title:c.firstVisitLocation,children:c.firstVisitLocation||"Unknown"})]},l))})]}),a.length>50&&e.jsxs("div",{className:"p-4 text-center text-sm text-gray-600 bg-gray-50 border-t",children:["Showing 50 of ",a.length," clients. Drill down shows only targeted data for this selection."]})]})})]});return e.jsx(Te,{open:m,onOpenChange:p,children:e.jsxs(Re,{className:"max-w-7xl max-h-[95vh] overflow-y-auto bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-2xl",children:[e.jsx(Ve,{className:"pb-6 border-b border-slate-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(Se,{className:"text-3xl font-bold bg-gradient-to-r from-slate-800 via-blue-600 to-purple-600 bg-clip-text text-transparent",children:[w," - Detailed Analysis"]}),e.jsx("p",{className:"text-slate-600 mt-2 text-lg",children:"Targeted client conversion and retention analysis"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"bg-blue-100 text-blue-800 border-0",children:x==="month"?"Monthly":x==="year"?"Yearly":x==="metric"?"Metric Analysis":"Analytics"}),e.jsx(A,{variant:"outline",onClick:p,children:e.jsx(ye,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"pt-6 space-y-8",children:[d(),e.jsxs(Le,{defaultValue:"overview",className:"w-full",children:[e.jsxs(ke,{className:"grid w-full grid-cols-3 bg-slate-100",children:[e.jsxs(Q,{value:"overview",className:"gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Overview"]}),e.jsxs(Q,{value:"clients",className:"gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),"Client Details"]}),e.jsxs(Q,{value:"insights",className:"gap-2",children:[e.jsx(Me,{className:"w-4 h-4"}),"Insights"]})]}),e.jsx(Z,{value:"overview",className:"space-y-6",children:e.jsxs(M,{className:"bg-gradient-to-br from-indigo-50 to-indigo-100 border-indigo-200",children:[e.jsx(L,{children:e.jsx(k,{className:"text-indigo-800",children:"Summary Statistics"})}),e.jsx(C,{children:e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:f(o.totalMembers)}),e.jsx("div",{className:"text-sm text-indigo-600",children:"Total Members"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:f(o.convertedMembers)}),e.jsx("div",{className:"text-sm text-green-600",children:"Converted"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[o.conversionRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-purple-600",children:"Conversion Rate"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:o.avgConversionTime>0?`${o.avgConversionTime.toFixed(0)} days`:"N/A"}),e.jsx("div",{className:"text-sm text-orange-600",children:"Avg Conv. Time"})]})]})})]})}),e.jsx(Z,{value:"clients",children:s()}),e.jsx(Z,{value:"insights",children:e.jsxs(M,{className:"bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx(L,{children:e.jsx(k,{className:"text-purple-800",children:"AI-Powered Insights"})}),e.jsx(C,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-white rounded-lg border-l-4 border-purple-400",children:[e.jsx("h4",{className:"font-medium text-purple-800 mb-2",children:"Key Metrics"}),e.jsxs("ul",{className:"text-sm text-purple-600 space-y-1",children:[e.jsxs("li",{children:["• Total Revenue: ",S(o.totalLTV)]}),e.jsxs("li",{children:["• Conversion Rate: ",o.conversionRate.toFixed(1),"%"]}),e.jsxs("li",{children:["• Retention Rate: ",o.retentionRate.toFixed(1),"%"]}),e.jsxs("li",{children:["• Average Customer Value: ",S(o.avgLTV)]})]})]}),e.jsxs("div",{className:"p-4 bg-white rounded-lg border-l-4 border-orange-400",children:[e.jsx("h4",{className:"font-medium text-orange-800 mb-2",children:"Performance Analysis"}),e.jsxs("ul",{className:"text-sm text-orange-600 space-y-1",children:[e.jsxs("li",{children:["• ",o.conversionRate>30?"Strong":o.conversionRate>15?"Moderate":"Needs improvement"," conversion performance"]}),e.jsxs("li",{children:["• ",o.retentionRate>70?"Excellent":o.retentionRate>50?"Good":"Needs attention"," retention rate"]}),e.jsxs("li",{children:["• Customer lifetime value is ",o.avgLTV>1e4?"high":o.avgLTV>5e3?"moderate":"developing"]}),e.jsx("li",{children:"• This selection shows targeted analytics for clicked data only"})]})]})]})})]})})]})]})]})})};export{He as C,ze as E,Be as a,_e as b,We as c,Xe as d,Je as e,Qe as f,qe as g,Ze as h,et as i};
