import{r as M,i as xe,w as ae,P as oe,_ as ve,$ as z,U as me,j as e,E as se,M as fe,d as je,c as re,a0 as Te,J as le,T as Re,g as pe,a1 as $e,a2 as ye,e as Ne,W as Ve,a3 as Ke,S as Le,D as Ue,h as Ie}from"./react-vendor-dqSXVcdP.js";import{C as B,j as K,k as L,d as Y,c as $,B as U,T as J,m as Z,n as O,o as k,p as ee,q as i,r as ce,s as ie,t as F,u as E,I as Oe,a1 as ne,Z as Fe,_ as Ee,$ as ze,a0 as He,a2 as qe,a3 as Ye,a4 as We,W as Ge}from"./ui-components-DsfbLwT7.js";import{f as u,b as V,c as R}from"./utils-BhCMrGmG.js";import{R as H,L as be,C as G,X as Q,Y as W,T as q,b as te,B as de,c as X,a as ue,P as Ce,d as Se,e as Me,S as Qe,g as Xe}from"./chart-vendor-By6BsRZf.js";import{c as ge}from"./dashboard-classes-C0LoPzks.js";import{A as _e}from"./dashboard-misc-CA4t7ooT.js";const dt=({data:j,selectedLocation:h})=>{const[C,x]=M.useState("overview"),[A,m]=M.useState(!1),v=M.useMemo(()=>!j||j.length===0?[]:!h||h==="all"?j:j.filter(t=>t.calculatedLocation===h),[j,h]),o=M.useMemo(()=>{if(!v||v.length===0)return{totalTransactions:0,discountedTransactions:0,totalRevenue:0,totalDiscounts:0,avgDiscountPercent:0,topDiscountedProducts:[],monthlyTrends:[],locationBreakdown:[],categoryBreakdown:[],customerSegments:[],staffPerformance:[]};const t=v.filter(r=>{const b=(r.discountAmount||0)>0,y=(r.discountPercentage||0)>0,_=r.isPromotional===!0,he=r.discountType&&r.discountType!=="";return b||y||_||he}),l=v.length,D=t.length,p=v.reduce((r,b)=>r+(b.paymentValue||0),0),n=v.reduce((r,b)=>r+(b.discountAmount||0),0),a=t.length>0?t.reduce((r,b)=>{let y=b.discountPercentage||0;if(y===0&&b.discountAmount&&b.paymentValue){const _=b.paymentValue+b.discountAmount;y=_>0?b.discountAmount/_*100:0}return r+y},0)/t.length:0,g=v.reduce((r,b)=>{const y=b.cleanedProduct||"Unknown";return r[y]||(r[y]={name:y,category:b.cleanedCategory||"Unknown",totalDiscount:0,transactions:0,discountedTransactions:0,revenue:0,customers:new Set}),r[y].totalDiscount+=b.discountAmount||0,r[y].transactions+=1,r[y].revenue+=b.paymentValue||0,r[y].customers.add(b.customerEmail),((b.discountAmount||0)>0||(b.discountPercentage||0)>0)&&(r[y].discountedTransactions+=1),r},{}),w=Object.values(g).map(r=>({...r,uniqueCustomers:r.customers.size,discountRate:r.transactions>0?r.discountedTransactions/r.transactions*100:0})).sort((r,b)=>b.totalDiscount-r.totalDiscount).slice(0,10),P=v.reduce((r,b)=>{if(!b.paymentDate)return r;let y;try{if(b.paymentDate.includes("/")){const[_,he,Be]=b.paymentDate.split(" ")[0].split("/");y=`${Be}-${he.padStart(2,"0")}`}else y=b.paymentDate.substring(0,7)}catch{y="Unknown"}return r[y]||(r[y]={month:y,revenue:0,discounts:0,transactions:0,discountedTransactions:0,discountRate:0}),r[y].revenue+=b.paymentValue||0,r[y].discounts+=b.discountAmount||0,r[y].transactions+=1,((b.discountAmount||0)>0||(b.discountPercentage||0)>0)&&(r[y].discountedTransactions+=1),r},{}),I=Object.values(P).map(r=>({...r,discountRate:r.transactions>0?r.discountedTransactions/r.transactions*100:0})).sort((r,b)=>r.month.localeCompare(b.month)),N=v.reduce((r,b)=>{const y=b.calculatedLocation||"Unknown";return r[y]||(r[y]={location:y,revenue:0,discounts:0,transactions:0,discountedTransactions:0,customers:new Set}),r[y].revenue+=b.paymentValue||0,r[y].discounts+=b.discountAmount||0,r[y].transactions+=1,r[y].customers.add(b.customerEmail),(b.discountAmount||0)>0&&(r[y].discountedTransactions+=1),r},{}),S=Object.values(N).map(r=>({...r,uniqueCustomers:r.customers.size,discountRate:r.transactions>0?r.discountedTransactions/r.transactions*100:0,avgDiscountPerTransaction:r.discountedTransactions>0?r.discounts/r.discountedTransactions:0})),c=v.reduce((r,b)=>{const y=b.cleanedCategory||"Unknown";return r[y]||(r[y]={category:y,revenue:0,discounts:0,transactions:0,discountedTransactions:0}),r[y].revenue+=b.paymentValue||0,r[y].discounts+=b.discountAmount||0,r[y].transactions+=1,(b.discountAmount||0)>0&&(r[y].discountedTransactions+=1),r},{}),f=Object.values(c).map(r=>({...r,discountRate:r.transactions>0?r.discountedTransactions/r.transactions*100:0})).sort((r,b)=>b.discounts-r.discounts),d=v.reduce((r,b)=>{const y=b.soldBy||"Unknown";return r[y]||(r[y]={name:y,totalDiscounts:0,transactions:0,discountedTransactions:0,revenue:0}),r[y].totalDiscounts+=b.discountAmount||0,r[y].transactions+=1,r[y].revenue+=b.paymentValue||0,(b.discountAmount||0)>0&&(r[y].discountedTransactions+=1),r},{}),T=Object.values(d).map(r=>({...r,discountRate:r.transactions>0?r.discountedTransactions/r.transactions*100:0,avgDiscountPerTransaction:r.discountedTransactions>0?r.totalDiscounts/r.discountedTransactions:0})).sort((r,b)=>b.totalDiscounts-r.totalDiscounts).slice(0,10);return{totalTransactions:l,discountedTransactions:D,totalRevenue:p,totalDiscounts:n,avgDiscountPercent:a,topDiscountedProducts:w,monthlyTrends:I,locationBreakdown:S,categoryBreakdown:f,staffPerformance:T}},[v]),s=[{title:"Total Revenue",value:u(o.totalRevenue),icon:xe,gradient:"from-green-500 to-emerald-600",description:"Total sales revenue",change:12.5},{title:"Total Discounts",value:u(o.totalDiscounts),icon:ae,gradient:"from-red-500 to-rose-600",description:"Amount saved by customers",change:-8.3},{title:"Discount Rate",value:V(o.totalRevenue>0?o.totalDiscounts/o.totalRevenue*100:0),icon:oe,gradient:"from-blue-500 to-indigo-600",description:"Discount as % of revenue",change:-2.1},{title:"Discounted Sales",value:`${R(o.discountedTransactions)} / ${R(o.totalTransactions)}`,icon:ve,gradient:"from-purple-500 to-violet-600",description:"Sales with discounts applied",change:5.7},{title:"Avg Discount %",value:V(o.avgDiscountPercent),icon:z,gradient:"from-orange-500 to-red-600",description:"Average discount percentage",change:-1.2},{title:"Penetration Rate",value:V(o.totalTransactions>0?o.discountedTransactions/o.totalTransactions*100:0),icon:me,gradient:"from-cyan-500 to-blue-600",description:"Percentage of discounted sales",change:3.4}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(B,{className:"border-0 shadow-xl bg-gradient-to-r from-orange-50 to-red-50",children:e.jsx(K,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-orange-500 to-red-500 rounded-xl flex items-center justify-center",children:e.jsx(oe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx(L,{className:"text-2xl font-bold text-gray-900",children:"Discounts & Promotions Analytics"}),e.jsxs("p",{className:"text-gray-600",children:["Comprehensive discount impact analysis",h!=="all"&&` for ${h}`]})]})]}),e.jsx("div",{className:"flex gap-2",children:["overview","details","analytics"].map(t=>e.jsx(Y,{variant:C===t?"default":"outline",onClick:()=>x(t),className:"capitalize",children:t},t))})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6",children:s.map((t,l)=>e.jsx(B,{className:"bg-white shadow-xl border-0 overflow-hidden hover:shadow-2xl transition-all duration-300 group cursor-pointer",children:e.jsx($,{className:"p-0",children:e.jsxs("div",{className:`bg-gradient-to-r ${t.gradient} p-6 text-white relative overflow-hidden`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 transform translate-x-8 -translate-y-8 opacity-20",children:e.jsx(t.icon,{className:"w-20 h-20"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(t.icon,{className:"w-6 h-6"}),e.jsx("h3",{className:"font-semibold text-sm",children:t.title})]}),e.jsx("p",{className:"text-3xl font-bold mb-1",children:t.value}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:`text-sm ${t.change>=0?"text-green-200":"text-red-200"}`,children:[t.change>=0?"+":"",t.change.toFixed(1),"%"]}),e.jsx("span",{className:"text-sm opacity-90",children:"vs last period"})]})]})]})})},t.title))}),C==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(B,{className:"bg-white shadow-xl border-0",children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-blue-600"}),"Monthly Discount Trends"]})}),e.jsx($,{children:e.jsx(H,{width:"100%",height:300,children:e.jsxs(be,{data:o.monthlyTrends,children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"month"}),e.jsx(W,{}),e.jsx(q,{formatter:(t,l)=>[l==="discounts"||l==="revenue"?u(t):l==="discountRate"?V(t):R(t),l]}),e.jsx(te,{type:"monotone",dataKey:"revenue",stroke:"#8884d8",name:"Revenue"}),e.jsx(te,{type:"monotone",dataKey:"discounts",stroke:"#82ca9d",name:"Discounts"}),e.jsx(te,{type:"monotone",dataKey:"discountRate",stroke:"#ffc658",name:"Discount Rate %"})]})})})]}),e.jsxs(B,{className:"bg-white shadow-xl border-0",children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-green-600"}),"Top Discounted Products"]})}),e.jsx($,{children:e.jsx("div",{className:"space-y-4 max-h-80 overflow-y-auto",children:o.topDiscountedProducts.slice(0,8).map((t,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-orange-500 to-red-500 rounded-full flex items-center justify-center text-white font-bold text-sm",children:l+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 truncate max-w-[200px]",children:t.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{variant:"outline",className:"text-xs",children:t.category}),e.jsxs(U,{variant:"secondary",className:"text-xs",children:[V(t.discountRate)," discount rate"]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-red-600",children:u(t.totalDiscount)}),e.jsxs("p",{className:"text-sm text-gray-600",children:[R(t.transactions)," sales"]})]})]},t.name))})})]})]}),C==="details"&&e.jsxs(B,{className:"bg-white shadow-xl border-0",children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-blue-600"}),"Detailed Discount Transactions"]})}),e.jsx($,{children:e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs(J,{children:[e.jsx(Z,{children:e.jsxs(O,{children:[e.jsx(k,{children:"Date"}),e.jsx(k,{children:"Customer"}),e.jsx(k,{children:"Product"}),e.jsx(k,{children:"Location"}),e.jsx(k,{children:"Revenue"}),e.jsx(k,{children:"Discount"}),e.jsx(k,{children:"Discount %"}),e.jsx(k,{children:"Sold By"})]})}),e.jsx(ee,{children:v.filter(t=>(t.discountAmount||0)>0).slice(0,50).map((t,l)=>e.jsxs(O,{children:[e.jsx(i,{children:t.paymentDate}),e.jsx(i,{className:"font-medium",children:t.customerName}),e.jsx(i,{children:e.jsx(U,{variant:"outline",children:t.cleanedProduct})}),e.jsx(i,{children:t.calculatedLocation}),e.jsx(i,{children:e.jsx(U,{className:"bg-green-100 text-green-800",children:u(t.paymentValue||0)})}),e.jsx(i,{children:e.jsx(U,{className:"bg-red-100 text-red-800",children:u(t.discountAmount||0)})}),e.jsx(i,{children:e.jsx(U,{className:"bg-blue-100 text-blue-800",children:V(t.discountPercentage||0)})}),e.jsx(i,{children:t.soldBy})]},l))})]})})})]}),C==="analytics"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(B,{className:"bg-white shadow-xl border-0",children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-purple-600"}),"Location Discount Performance"]})}),e.jsx($,{children:e.jsx(H,{width:"100%",height:300,children:e.jsxs(de,{data:o.locationBreakdown,children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"location"}),e.jsx(W,{}),e.jsx(q,{formatter:t=>u(t)}),e.jsx(X,{dataKey:"discounts",fill:"#8884d8",name:"Discounts"})]})})})]}),e.jsxs(B,{className:"bg-white shadow-xl border-0",children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-orange-600"}),"Category Discount Analysis"]})}),e.jsx($,{children:e.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:o.categoryBreakdown.map((t,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.category}),e.jsxs("p",{className:"text-sm text-gray-600",children:[R(t.transactions)," transactions • ",V(t.discountRate)," discount rate"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-red-600",children:u(t.discounts)}),e.jsxs("p",{className:"text-sm text-gray-600",children:[u(t.revenue)," revenue"]})]})]},t.category))})})]}),e.jsxs(B,{className:"bg-white shadow-xl border-0",children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5 text-green-600"}),"Staff Discount Performance"]})}),e.jsx($,{children:e.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:o.staffPerformance.map((t,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center text-white font-bold text-sm",children:l+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[R(t.discountedTransactions)," discounted sales • ",V(t.discountRate)," rate"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-red-600",children:u(t.totalDiscounts)}),e.jsxs("p",{className:"text-sm text-gray-600",children:[u(t.avgDiscountPerTransaction)," avg"]})]})]},t.name))})})]}),e.jsxs(B,{className:"bg-white shadow-xl border-0",children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-blue-600"}),"Monthly Discount Rate Trends"]})}),e.jsx($,{children:e.jsx(H,{width:"100%",height:300,children:e.jsxs(de,{data:o.monthlyTrends,children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"month"}),e.jsx(W,{}),e.jsx(q,{formatter:(t,l)=>[l==="discountRate"?V(t):R(t),l]}),e.jsx(X,{dataKey:"discountRate",fill:"#ffc658",name:"Discount Rate %"})]})})})]})]})]})},Je={DollarSign:xe,ShoppingCart:ve,Activity:pe,Users:me,Target:Re,Percent:oe,CreditCard:le,ArrowDownRight:Te},Ze=({data:j,onMetricClick:h})=>{const C=M.useMemo(()=>{const n=j.reduce((T,r)=>T+(r.discountAmount||0),0),a=j.reduce((T,r)=>T+(r.paymentValue||0),0),g=j.length,w=j.filter(T=>(T.discountAmount||0)>0).length,P=new Set(j.map(T=>T.memberId||T.customerEmail)).size,I=new Set(j.filter(T=>(T.discountAmount||0)>0).map(T=>T.memberId||T.customerEmail)).size,N=a>0?n/(a+n)*100:0,S=g>0?w/g*100:0,c=P>0?I/P*100:0,f=w>0?n/w:0,d=I>0?n/I:0;return{metrics:[{title:"Total Discounts",value:u(n),description:"Total amount saved by customers",icon:"DollarSign",change:null,trend:"neutral",color:"orange"},{title:"Discount Rate",value:V(N),description:"Percentage of gross revenue",icon:"Percent",change:null,trend:"neutral",color:"orange"},{title:"Transactions with Discounts",value:R(w),description:`${V(S)} of all transactions`,icon:"ShoppingCart",change:null,trend:"neutral",color:"orange"},{title:"Customers with Discounts",value:R(I),description:`${V(c)} of all customers`,icon:"Users",change:null,trend:"neutral",color:"orange"},{title:"Avg Discount per Transaction",value:u(f),description:"Average savings per discounted purchase",icon:"Target",change:null,trend:"neutral",color:"orange"},{title:"Avg Discount per Customer",value:u(d),description:"Average savings per customer",icon:"Activity",change:null,trend:"neutral",color:"orange"}],totalRevenue:a,totalDiscounts:n,totalTransactions:g,discountedTransactions:w,uniqueCustomers:P,customersWithDiscounts:I,discountRate:N,discountPenetration:S}},[j]),{metrics:x,totalRevenue:A,totalDiscounts:m,totalTransactions:v,discountedTransactions:o,uniqueCustomers:s,customersWithDiscounts:t,discountRate:l,discountPenetration:D}=C,p=n=>{if(h){const a={title:n.title,name:n.title,type:"metric",totalRevenue:A,totalDiscounts:m,transactions:v,discountedTransactions:o,uniqueCustomers:s,customersWithDiscounts:t,discountRate:l,discountPenetration:D,rawData:j,filteredTransactionData:j,isDynamic:!0,calculatedFromFiltered:!0};h(a)}};return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[x.map((n,a)=>{const g=Je[n.icon]||xe;return e.jsxs(B,{className:ge("group relative overflow-hidden border-0 shadow-lg hover:shadow-xl transition-all duration-300 ease-out cursor-pointer","bg-gradient-to-br from-white via-orange-50/30 to-orange-100/50","hover:scale-105 hover:-translate-y-1"),onClick:()=>p(n),style:{animationDelay:`${a*100}ms`,animation:"slideInUp 0.6s ease-out forwards"},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-500/5 via-transparent to-orange-600/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsxs($,{className:"relative p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-1",children:n.title}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-1",children:n.value}),e.jsx("p",{className:"text-xs text-gray-500 leading-relaxed",children:n.description})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("div",{className:ge("p-2 rounded-lg transition-colors duration-300","bg-orange-100 text-orange-600","group-hover:bg-orange-200 group-hover:scale-110"),children:e.jsx(g,{className:"w-5 h-5"})}),n.change&&e.jsxs(U,{className:ge("text-xs font-medium px-2 py-1",n.trend==="up"?"bg-green-100 text-green-700 border-green-200":n.trend==="down"?"bg-red-100 text-red-700 border-red-200":"bg-gray-100 text-gray-700 border-gray-200"),children:[n.trend==="up"&&e.jsx($e,{className:"w-3 h-3 mr-1"}),n.trend==="down"&&e.jsx(Te,{className:"w-3 h-3 mr-1"}),n.change]})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-orange-400 to-orange-600 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-left"})]})]},n.title)}),e.jsx("style",{children:`
        @keyframes slideInUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
      `})]})},De=["#8b5cf6","#06b6d4","#10b981","#f59e0b","#ef4444","#6366f1","#ec4899","#84cc16"],we=({data:j,filters:h})=>{const[C,x]=M.useState("trends"),A=M.useMemo(()=>{let m=j.filter(n=>(n.discountAmount||0)>0);h&&(m=m.filter(n=>{if(h.location&&n.calculatedLocation!==h.location||h.category&&n.cleanedCategory!==h.category||h.product&&n.cleanedProduct!==h.product||h.soldBy&&(n.soldBy==="-"?"Online/System":n.soldBy)!==h.soldBy||h.paymentMethod&&n.paymentMethod!==h.paymentMethod||h.minDiscountAmount&&(n.discountAmount||0)<h.minDiscountAmount||h.maxDiscountAmount&&(n.discountAmount||0)>h.maxDiscountAmount||h.minDiscountPercent&&(n.discountPercentage||0)<h.minDiscountPercent||h.maxDiscountPercent&&(n.discountPercentage||0)>h.maxDiscountPercent)return!1;if(h.dateRange?.from||h.dateRange?.to){const a=new Date(n.paymentDate);if(h.dateRange.from&&a<h.dateRange.from||h.dateRange.to&&a>h.dateRange.to)return!1}return!0}));const v=m.reduce((n,a)=>{const g=new Date(a.paymentDate),w=`${g.getFullYear()}-${(g.getMonth()+1).toString().padStart(2,"0")}`;return n[w]||(n[w]={month:w,transactions:0,totalDiscount:0,totalRevenue:0,avgDiscount:0}),n[w].transactions+=1,n[w].totalDiscount+=a.discountAmount||0,n[w].totalRevenue+=a.paymentValue||0,n},{}),o=Object.values(v).map(n=>({...n,avgDiscount:n.transactions>0?n.totalDiscount/n.transactions:0,discountRate:n.totalRevenue>0?n.totalDiscount/(n.totalRevenue+n.totalDiscount)*100:0})).sort((n,a)=>n.month.localeCompare(a.month)),s=m.reduce((n,a)=>{const g=a.cleanedCategory||"Unknown";return n[g]||(n[g]={name:g,value:0,transactions:0}),n[g].value+=a.discountAmount||0,n[g].transactions+=1,n},{}),t=Object.values(s).sort((n,a)=>a.value-n.value).slice(0,8),D=[{min:0,max:100,label:"₹0-100"},{min:100,max:500,label:"₹100-500"},{min:500,max:1e3,label:"₹500-1K"},{min:1e3,max:2500,label:"₹1K-2.5K"},{min:2500,max:5e3,label:"₹2.5K-5K"},{min:5e3,max:1/0,label:"₹5K+"}].map(n=>{const a=m.filter(g=>{const w=g.discountAmount||0;return w>=n.min&&w<n.max});return{range:n.label,transactions:a.length,totalDiscount:a.reduce((g,w)=>g+(w.discountAmount||0),0),avgDiscount:a.length>0?a.reduce((g,w)=>g+(w.discountAmount||0),0)/a.length:0,totalRevenue:a.reduce((g,w)=>g+(w.paymentValue||0),0)}}),p=m.slice(0,200).map(n=>({discountAmount:n.discountAmount||0,discountPercent:n.discountPercentage||0,revenue:n.paymentValue||0,category:n.cleanedCategory||"Unknown"}));return{monthlyTrends:o,categoryDistribution:t,rangeAnalysis:D,scatterData:p}},[j,h]);return e.jsx("div",{className:"space-y-6",children:e.jsxs(ce,{value:C,onValueChange:x,className:"w-full",children:[e.jsxs(ie,{className:"grid w-full grid-cols-4 bg-white border border-slate-200 p-1 rounded-xl shadow-sm h-auto",children:[e.jsxs(F,{value:"trends",className:"text-sm px-4 py-3 data-[state=active]:bg-blue-600 data-[state=active]:text-white",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Trends"]}),e.jsxs(F,{value:"distribution",className:"text-sm px-4 py-3 data-[state=active]:bg-purple-600 data-[state=active]:text-white",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Distribution"]}),e.jsxs(F,{value:"ranges",className:"text-sm px-4 py-3 data-[state=active]:bg-green-600 data-[state=active]:text-white",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Ranges"]}),e.jsxs(F,{value:"correlation",className:"text-sm px-4 py-3 data-[state=active]:bg-orange-600 data-[state=active]:text-white",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Correlation"]})]}),e.jsx(E,{value:"trends",className:"space-y-6",children:e.jsxs(B,{className:"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs(L,{className:"text-xl font-bold bg-gradient-to-r from-blue-700 to-indigo-700 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx(re,{className:"w-6 h-6 text-blue-600"}),"Monthly Discount Trends"]})}),e.jsx($,{children:e.jsx(H,{width:"100%",height:400,children:e.jsxs(be,{data:A.monthlyTrends,children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"month"}),e.jsx(W,{yAxisId:"left",tickFormatter:m=>u(m)}),e.jsx(W,{yAxisId:"right",orientation:"right",tickFormatter:m=>`${m}%`}),e.jsx(q,{formatter:(m,v)=>[v==="discountRate"?`${m.toFixed(1)}%`:u(m),v==="totalDiscount"?"Total Discount":v==="totalRevenue"?"Revenue":"Discount Rate"]}),e.jsx(ue,{}),e.jsx(X,{yAxisId:"left",dataKey:"totalDiscount",fill:"#3b82f6",name:"Total Discount"}),e.jsx(te,{yAxisId:"right",type:"monotone",dataKey:"discountRate",stroke:"#ef4444",strokeWidth:3,name:"Discount Rate %"})]})})})]})}),e.jsx(E,{value:"distribution",className:"space-y-6",children:e.jsxs(B,{className:"bg-gradient-to-br from-white via-purple-50/30 to-violet-50/20 border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs(L,{className:"text-xl font-bold bg-gradient-to-r from-purple-700 to-violet-700 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx(ye,{className:"w-6 h-6 text-purple-600"}),"Discount Distribution by Category"]})}),e.jsx($,{children:e.jsx(H,{width:"100%",height:400,children:e.jsxs(Ce,{children:[e.jsx(Se,{data:A.categoryDistribution,cx:"50%",cy:"50%",labelLine:!1,label:({name:m,value:v})=>`${m}: ${u(v)}`,outerRadius:120,fill:"#8884d8",dataKey:"value",children:A.categoryDistribution.map((m,v)=>e.jsx(Me,{fill:De[v%De.length]},`cell-${v}`))}),e.jsx(q,{formatter:m=>u(m)})]})})})]})}),e.jsx(E,{value:"ranges",className:"space-y-6",children:e.jsxs(B,{className:"bg-gradient-to-br from-white via-green-50/30 to-emerald-50/20 border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs(L,{className:"text-xl font-bold bg-gradient-to-r from-green-700 to-emerald-700 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx(Ne,{className:"w-6 h-6 text-green-600"}),"Discount Range Analysis"]})}),e.jsx($,{children:e.jsx(H,{width:"100%",height:400,children:e.jsxs(de,{data:A.rangeAnalysis,children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"range"}),e.jsx(W,{tickFormatter:m=>u(m)}),e.jsx(q,{formatter:(m,v)=>[u(m),v==="totalDiscount"?"Total Discount":"Average Discount"]}),e.jsx(ue,{}),e.jsx(X,{dataKey:"totalDiscount",fill:"#10b981",name:"Total Discount"}),e.jsx(X,{dataKey:"avgDiscount",fill:"#06b6d4",name:"Average Discount"})]})})})]})}),e.jsx(E,{value:"correlation",className:"space-y-6",children:e.jsxs(B,{className:"bg-gradient-to-br from-white via-orange-50/30 to-amber-50/20 border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs(L,{className:"text-xl font-bold bg-gradient-to-r from-orange-700 to-amber-700 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx(pe,{className:"w-6 h-6 text-orange-600"}),"Discount Amount vs Percentage Correlation"]})}),e.jsx($,{children:e.jsx(H,{width:"100%",height:400,children:e.jsxs(Qe,{data:A.scatterData,children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"discountPercent",name:"Discount %",tickFormatter:m=>`${m}%`}),e.jsx(W,{dataKey:"discountAmount",name:"Discount Amount",tickFormatter:m=>u(m)}),e.jsx(q,{formatter:(m,v)=>[v==="discountPercent"?`${m}%`:u(m),v==="discountPercent"?"Discount %":"Discount Amount"]}),e.jsx(Xe,{dataKey:"discountAmount",fill:"#f59e0b"})]})})})]})})]})})},et=({data:j,filters:h,onDrillDown:C})=>{const[x,A]=M.useState("desc"),m=M.useMemo(()=>{const o=j.reduce((p,n)=>{const a=n.cleanedCategory||"Unknown";return p[a]||(p[a]={totalDiscount:0,count:0,totalRevenue:0,avgPercent:0}),p[a].totalDiscount+=n.discountAmount||0,p[a].count+=1,p[a].totalRevenue+=n.paymentValue||0,p[a].avgPercent+=n.discountPercentage||0,p},{}),s=j.reduce((p,n)=>{const a=n.cleanedProduct||"Unknown";return p[a]||(p[a]={totalDiscount:0,count:0,totalRevenue:0,avgPercent:0}),p[a].totalDiscount+=n.discountAmount||0,p[a].count+=1,p[a].totalRevenue+=n.paymentValue||0,p[a].avgPercent+=n.discountPercentage||0,p},{}),t=j.reduce((p,n)=>{const a=n.soldBy==="-"?"Online/System":n.soldBy;return p[a]||(p[a]={totalDiscount:0,count:0,totalRevenue:0,avgPercent:0}),p[a].totalDiscount+=n.discountAmount||0,p[a].count+=1,p[a].totalRevenue+=n.paymentValue||0,p[a].avgPercent+=n.discountPercentage||0,p},{}),l=j.reduce((p,n)=>{const a=n.paymentMethod||"Unknown";return p[a]||(p[a]={totalDiscount:0,count:0,totalRevenue:0,avgPercent:0}),p[a].totalDiscount+=n.discountAmount||0,p[a].count+=1,p[a].totalRevenue+=n.paymentValue||0,p[a].avgPercent+=n.discountPercentage||0,p},{}),D=p=>Object.entries(p).map(([n,a])=>({name:n,totalDiscount:a.totalDiscount,count:a.count,totalRevenue:a.totalRevenue,avgPercent:a.count>0?a.avgPercent/a.count:0,avgDiscount:a.count>0?a.totalDiscount/a.count:0})).sort((n,a)=>x==="desc"?a.totalDiscount-n.totalDiscount:n.totalDiscount-a.totalDiscount);return{categories:D(o),products:D(s),soldBy:D(t),paymentMethods:D(l)}},[j,x]),v=(o,s,t,l)=>{const D=o.slice(0,5),p=o.slice(-5).reverse();return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(B,{className:"bg-gradient-to-br from-white via-green-50/30 to-emerald-50/20 border-0 shadow-lg",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(L,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(Ve,{className:"w-5 h-5 text-yellow-600"}),"Top ",t," by Discount",e.jsx(Y,{variant:"ghost",size:"sm",onClick:()=>A(x==="desc"?"asc":"desc"),className:"ml-auto",children:e.jsx(Ke,{className:"w-4 h-4"})})]})}),e.jsx($,{className:"space-y-3",children:D.map((n,a)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/60 rounded-lg hover:bg-white/80 transition-all duration-300 cursor-pointer hover:scale-102 group",onClick:()=>C?.(`${n.name} - Discount Details`,j.filter(g=>(l==="category"?g.cleanedCategory:l==="product"?g.cleanedProduct:l==="soldBy"?g.soldBy==="-"?"Online/System":g.soldBy:g.paymentMethod)===n.name),l),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm ${a===0?"bg-gradient-to-r from-yellow-500 to-amber-500":a===1?"bg-gradient-to-r from-gray-400 to-gray-500":a===2?"bg-gradient-to-r from-orange-500 to-amber-600":"bg-gradient-to-r from-blue-500 to-purple-600"}`,children:["#",a+1]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm text-slate-800 truncate group-hover:text-slate-900",children:n.name}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-600",children:[e.jsxs("span",{children:[R(n.count)," transactions"]}),e.jsxs(U,{variant:"outline",className:"text-xs bg-green-50 text-green-700 border-green-200",children:[n.avgPercent.toFixed(1),"% avg"]})]})]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("div",{className:"font-bold text-red-600 text-sm",children:u(n.totalDiscount)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[u(n.avgDiscount),"/txn"]})]})]},n.name))})]}),e.jsxs(B,{className:"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 border-0 shadow-lg",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(L,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(Re,{className:"w-5 h-5 text-blue-600"}),"Lowest ",t," by Discount"]})}),e.jsx($,{className:"space-y-3",children:p.map((n,a)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/60 rounded-lg hover:bg-white/80 transition-all duration-300 cursor-pointer hover:scale-102 group",onClick:()=>C?.(`${n.name} - Discount Details`,j.filter(g=>(l==="category"?g.cleanedCategory:l==="product"?g.cleanedProduct:l==="soldBy"?g.soldBy==="-"?"Online/System":g.soldBy:g.paymentMethod)===n.name),l),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-10 h-10 bg-gradient-to-r from-slate-500 to-gray-600 rounded-full flex items-center justify-center text-white font-bold text-sm",children:["#",p.length-a]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm text-slate-800 truncate group-hover:text-slate-900",children:n.name}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-600",children:[e.jsxs("span",{children:[R(n.count)," transactions"]}),e.jsxs(U,{variant:"outline",className:"text-xs bg-blue-50 text-blue-700 border-blue-200",children:[n.avgPercent.toFixed(1),"% avg"]})]})]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("div",{className:"font-bold text-blue-600 text-sm",children:u(n.totalDiscount)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[u(n.avgDiscount),"/txn"]})]})]},n.name))})]})]})};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Top & Bottom Performers"}),e.jsxs(U,{variant:"outline",className:"text-sm",children:[R(j.length)," total discounted transactions"]})]}),e.jsxs(ce,{defaultValue:"categories",className:"w-full",children:[e.jsxs(ie,{className:"grid w-full grid-cols-4 mb-6 bg-white shadow-sm",children:[e.jsxs(F,{value:"categories",className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"Categories"]}),e.jsxs(F,{value:"products",className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"Products"]}),e.jsxs(F,{value:"soldBy",className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4"}),"Sold By"]}),e.jsxs(F,{value:"payment",className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Payment Method"]})]}),e.jsx(E,{value:"categories",children:v(m.categories,e.jsx(z,{className:"w-5 h-5"}),"Categories","category")}),e.jsx(E,{value:"products",children:v(m.products,e.jsx(z,{className:"w-5 h-5"}),"Products","product")}),e.jsx(E,{value:"soldBy",children:v(m.soldBy,e.jsx(je,{className:"w-5 h-5"}),"Staff","soldBy")}),e.jsx(E,{value:"payment",children:v(m.paymentMethods,e.jsx(le,{className:"w-5 h-5"}),"Payment Methods","paymentMethod")})]})]})},tt=({data:j,onRowClick:h})=>{const[C,x]=M.useState(""),[A,m]=M.useState("paymentDate"),[v,o]=M.useState("desc"),[s,t]=M.useState(1),l=50,D=M.useMemo(()=>{let N=j.filter(S=>{const c=C.toLowerCase();return S.customerName?.toLowerCase().includes(c)||S.customerEmail?.toLowerCase().includes(c)||S.cleanedProduct?.toLowerCase().includes(c)||S.cleanedCategory?.toLowerCase().includes(c)||S.calculatedLocation?.toLowerCase().includes(c)||S.soldBy?.toLowerCase().includes(c)});return N.sort((S,c)=>{let f=S[A],d=c[A];return typeof f=="number"&&typeof d=="number"?v==="asc"?f-d:d-f:typeof f=="string"&&typeof d=="string"?v==="asc"?f.localeCompare(d):d.localeCompare(f):0}),N},[j,C,A,v]),p=Math.ceil(D.length/l),n=D.slice((s-1)*l,s*l),a=M.useMemo(()=>{const N=D.reduce((d,T)=>d+(T.discountAmount||0),0),S=D.reduce((d,T)=>d+(T.paymentValue||0),0),c=D.reduce((d,T)=>d+(T.mrpPostTax||0),0),f=D.length>0?D.reduce((d,T)=>d+(T.discountPercentage||0),0)/D.length:0;return{totalDiscount:N,totalRevenue:S,totalMrp:c,avgDiscountPercentage:f,totalTransactions:D.length}},[D]),g=N=>{A===N?o(v==="asc"?"desc":"asc"):(m(N),o("desc"))},w=N=>{h&&h(`Transaction Details - ${N.customerName}`,[N],"transaction-detail")},P=N=>A!==N?null:v==="asc"?e.jsx(Ie,{className:"w-4 h-4"}):e.jsx(ae,{className:"w-4 h-4"}),I=N=>N>=50?"destructive":N>=25?"secondary":"default";return e.jsxs(B,{className:"shadow-xl border-0 bg-gradient-to-br from-white via-slate-50 to-blue-50/30",children:[e.jsx(K,{className:"bg-gradient-to-r from-slate-800 via-slate-700 to-slate-600 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg backdrop-blur-sm",children:e.jsx(oe,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx(L,{className:"text-2xl font-bold",children:"Detailed Discount Analysis"}),e.jsx("p",{className:"text-slate-200 mt-1",children:"Comprehensive transaction-level discount data with advanced filtering"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(Oe,{placeholder:"Search transactions...",value:C,onChange:N=>x(N.target.value),className:"pl-10 bg-white/10 border-white/20 text-white placeholder:text-slate-300"})]}),e.jsxs(Y,{variant:"outline",size:"sm",className:"bg-white/10 border-white/20 text-white hover:bg-white/20",children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Export"]})]})]})}),e.jsxs($,{className:"p-0",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 border-b",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-700",children:R(a.totalTransactions)}),e.jsx("div",{className:"text-sm text-slate-500",children:"Total Transactions"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:u(a.totalDiscount)}),e.jsx("div",{className:"text-sm text-slate-500",children:"Total Discount"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:u(a.totalRevenue)}),e.jsx("div",{className:"text-sm text-slate-500",children:"Total Revenue"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:u(a.totalMrp)}),e.jsx("div",{className:"text-sm text-slate-500",children:"Total MRP"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:V(a.avgDiscountPercentage)}),e.jsx("div",{className:"text-sm text-slate-500",children:"Avg Discount %"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(J,{children:[e.jsx(Z,{className:"bg-gradient-to-br from-indigo-800 to-blue-900 ",children:e.jsxs(O,{className:"bg-gradient-to-br from-gray-800 to-indigo-900",children:[e.jsx(k,{className:"cursor-pointer",onClick:()=>g("paymentDate"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Date ",P("paymentDate")]})}),e.jsx(k,{className:"cursor-pointer",onClick:()=>g("customerName"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Customer ",P("customerName")]})}),e.jsx(k,{onClick:()=>g("cleanedProduct"),className:"cursor-pointer bg-gradient-to-br from-gray-800 to-indigo-900 ",children:e.jsxs("div",{className:"flex items-center gap-2",children:["Product ",P("cleanedProduct")]})}),e.jsx(k,{className:"cursor-pointer text-right",onClick:()=>g("mrpPostTax"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:["MRP ",P("mrpPostTax")]})}),e.jsx(k,{className:"cursor-pointer text-right",onClick:()=>g("discountAmount"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:["Discount ",P("discountAmount")]})}),e.jsx(k,{className:"cursor-pointer text-right",onClick:()=>g("discountPercentage"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:["Discount % ",P("discountPercentage")]})}),e.jsx(k,{className:"cursor-pointer text-right",onClick:()=>g("paymentValue"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:["Final Amount ",P("paymentValue")]})}),e.jsx(k,{children:"Location"}),e.jsx(k,{children:"Sold By"}),e.jsx(k,{className:"text-center",children:"Actions"})]})}),e.jsx(ee,{children:n.map((N,S)=>e.jsxs(O,{className:"hover:cursor-pointer",children:[e.jsx(i,{className:"font-medium",children:new Date(N.paymentDate).toLocaleDateString()}),e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-700",children:N.customerName}),e.jsx("div",{className:"text-sm text-slate-500",children:N.customerEmail})]})}),e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-700",children:N.cleanedProduct}),e.jsx("div",{className:"text-sm text-slate-500",children:N.cleanedCategory})]})}),e.jsx(i,{className:"text-right font-medium",children:u(N.mrpPostTax||0)}),e.jsx(i,{className:"text-right",children:e.jsxs("span",{className:"font-semibold text-red-600",children:["-",u(N.discountAmount||0)]})}),e.jsx(i,{className:"text-right",children:e.jsx(U,{variant:I(N.discountPercentage||0),children:V(N.discountPercentage||0)})}),e.jsx(i,{className:"text-right font-semibold text-green-600",children:u(N.paymentValue||0)}),e.jsx(i,{children:e.jsx("span",{className:"text-sm text-slate-600",children:N.calculatedLocation})}),e.jsx(i,{children:e.jsx("span",{className:"text-sm text-slate-600",children:N.soldBy})}),e.jsx(i,{className:"text-center",children:e.jsx(Y,{variant:"outline",size:"sm",onClick:()=>w(N),className:"hover:bg-blue-50",children:e.jsx(se,{className:"w-4 h-4"})})})]},`${N.saleItemId}-${S}`))}),e.jsx(ne,{children:e.jsxs(O,{children:[e.jsxs(i,{colSpan:3,className:"font-bold",children:["Summary (",R(a.totalTransactions)," transactions)"]}),e.jsx(i,{className:"text-right font-bold",children:u(a.totalMrp)}),e.jsxs(i,{className:"text-right font-bold text-red-600",children:["-",u(a.totalDiscount)]}),e.jsx(i,{className:"text-right font-bold",children:V(a.avgDiscountPercentage)}),e.jsx(i,{className:"text-right font-bold text-green-600",children:u(a.totalRevenue)}),e.jsx(i,{colSpan:3})]})})]})}),p>1&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-t bg-slate-50",children:[e.jsxs("div",{className:"text-sm text-slate-600",children:["Showing ",(s-1)*l+1," to ",Math.min(s*l,D.length)," of ",D.length," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{variant:"outline",size:"sm",onClick:()=>t(Math.max(1,s-1)),disabled:s===1,children:"Previous"}),e.jsxs("span",{className:"text-sm text-slate-600",children:["Page ",s," of ",p]}),e.jsx(Y,{variant:"outline",size:"sm",onClick:()=>t(Math.min(p,s+1)),disabled:s===p,children:"Next"})]})]})]})]})},st=({data:j,onDrillDown:h})=>{const C=M.useMemo(()=>{const o=j.reduce((s,t)=>{const l=t.cleanedProduct||"Unknown Product";return s[l]||(s[l]={product:l,category:t.cleanedCategory||"Unknown",transactions:0,totalDiscount:0,totalRevenue:0,totalMrp:0,avgDiscountPercentage:0,data:[]}),s[l].transactions+=1,s[l].totalDiscount+=t.discountAmount||0,s[l].totalRevenue+=t.paymentValue||0,s[l].totalMrp+=t.mrpPostTax||0,s[l].data.push(t),s},{});return Object.values(o).map(s=>({...s,avgDiscountPercentage:s.totalMrp>0?s.totalDiscount/s.totalMrp*100:0,discountRate:s.transactions>0?s.totalDiscount/s.transactions:0})).sort((s,t)=>t.totalDiscount-s.totalDiscount)},[j]),x=M.useMemo(()=>{const o=j.reduce((s,t)=>{const l=t.calculatedLocation||"Unknown Location";return s[l]||(s[l]={location:l,transactions:0,totalDiscount:0,totalRevenue:0,totalMrp:0,uniqueCustomers:new Set,data:[]}),s[l].transactions+=1,s[l].totalDiscount+=t.discountAmount||0,s[l].totalRevenue+=t.paymentValue||0,s[l].totalMrp+=t.mrpPostTax||0,s[l].uniqueCustomers.add(t.customerEmail),s[l].data.push(t),s},{});return Object.values(o).map(s=>({...s,uniqueCustomers:s.uniqueCustomers.size,avgDiscountPercentage:s.totalMrp>0?s.totalDiscount/s.totalMrp*100:0,avgDiscountPerTransaction:s.transactions>0?s.totalDiscount/s.transactions:0})).sort((s,t)=>t.totalDiscount-s.totalDiscount)},[j]),A=M.useMemo(()=>{const o=j.reduce((s,t)=>{const l=t.soldBy||"Unknown";return s[l]||(s[l]={staff:l,transactions:0,totalDiscount:0,totalRevenue:0,totalMrp:0,data:[]}),s[l].transactions+=1,s[l].totalDiscount+=t.discountAmount||0,s[l].totalRevenue+=t.paymentValue||0,s[l].totalMrp+=t.mrpPostTax||0,s[l].data.push(t),s},{});return Object.values(o).map(s=>({...s,avgDiscountPercentage:s.totalMrp>0?s.totalDiscount/s.totalMrp*100:0,discountRate:s.transactions>0?s.totalDiscount/s.transactions:0})).sort((s,t)=>t.totalDiscount-s.totalDiscount)},[j]),m=(o,s,t)=>{h&&h(o,s,t)},v=o=>o>=40?{variant:"destructive",label:"High"}:o>=20?{variant:"secondary",label:"Medium"}:{variant:"default",label:"Low"};return e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(B,{className:"shadow-xl border-0 bg-gradient-to-br from-white via-orange-50/30 to-amber-50/20",children:[e.jsx(K,{className:"bg-gradient-to-r from-slate-800 via-slate-700 to-slate-600 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg backdrop-blur-sm",children:e.jsx(z,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx(L,{className:"text-2xl font-bold",children:"Product-wise Discount Breakdown"}),e.jsx("p",{className:"text-slate-200 mt-1",children:"Discount performance analysis by product category"})]})]})}),e.jsx($,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(J,{children:[e.jsx(Z,{children:e.jsxs(O,{children:[e.jsx(k,{children:"Product"}),e.jsx(k,{children:"Category"}),e.jsx(k,{className:"text-center",children:"Transactions"}),e.jsx(k,{className:"text-right",children:"Total Discount"}),e.jsx(k,{className:"text-right",children:"Avg Discount %"}),e.jsx(k,{className:"text-right",children:"Total Revenue"}),e.jsx(k,{className:"text-right",children:"Discount Impact"}),e.jsx(k,{className:"text-center",children:"Actions"})]})}),e.jsx(ee,{children:C.slice(0,10).map((o,s)=>{const t=v(o.avgDiscountPercentage);return e.jsxs(O,{children:[e.jsx(i,{className:"font-medium",children:e.jsx("div",{className:"max-w-[200px] truncate",title:o.product,children:o.product})}),e.jsx(i,{children:e.jsx("span",{className:"text-sm text-slate-600",children:o.category})}),e.jsx(i,{className:"text-center",children:e.jsx(U,{variant:"outline",children:R(o.transactions)})}),e.jsx(i,{className:"text-right font-semibold text-red-600",children:u(o.totalDiscount)}),e.jsx(i,{className:"text-right",children:e.jsx(U,{variant:t.variant,children:V(o.avgDiscountPercentage)})}),e.jsx(i,{className:"text-right font-semibold text-green-600",children:u(o.totalRevenue)}),e.jsx(i,{className:"text-right",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:u(o.discountRate)}),e.jsx("div",{className:"text-slate-500",children:"per transaction"})]})}),e.jsx(i,{className:"text-center",children:e.jsx(Y,{variant:"outline",size:"sm",onClick:()=>m(`${o.product} - Discount Analysis`,o.data,"product-discount"),className:"hover:bg-orange-50",children:e.jsx(se,{className:"w-4 h-4"})})})]},s)})}),e.jsx(ne,{children:e.jsxs(O,{children:[e.jsx(i,{colSpan:2,className:"font-bold",children:"Total (Top 10)"}),e.jsx(i,{className:"text-center font-bold",children:R(C.slice(0,10).reduce((o,s)=>o+s.transactions,0))}),e.jsx(i,{className:"text-right font-bold text-red-600",children:u(C.slice(0,10).reduce((o,s)=>o+s.totalDiscount,0))}),e.jsx(i,{className:"text-right font-bold",children:V(C.slice(0,10).reduce((o,s)=>o+s.avgDiscountPercentage,0)/Math.min(10,C.length))}),e.jsx(i,{className:"text-right font-bold text-green-600",children:u(C.slice(0,10).reduce((o,s)=>o+s.totalRevenue,0))}),e.jsx(i,{colSpan:2})]})})]})})})]}),e.jsxs(B,{className:"shadow-xl border-0 bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20",children:[e.jsx(K,{className:"bg-gradient-to-r from-slate-800 via-slate-700 to-slate-600 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg backdrop-blur-sm",children:e.jsx(fe,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx(L,{className:"text-2xl font-bold",children:"Location-wise Discount Breakdown"}),e.jsx("p",{className:"text-slate-200 mt-1",children:"Geographic analysis of discount utilization patterns"})]})]})}),e.jsx($,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(J,{children:[e.jsx(Z,{children:e.jsxs(O,{children:[e.jsx(k,{children:"Location"}),e.jsx(k,{className:"text-center",children:"Transactions"}),e.jsx(k,{className:"text-center",children:"Customers"}),e.jsx(k,{className:"text-right",children:"Total Discount"}),e.jsx(k,{className:"text-right",children:"Avg Discount %"}),e.jsx(k,{className:"text-right",children:"Avg per Transaction"}),e.jsx(k,{className:"text-right",children:"Total Revenue"}),e.jsx(k,{className:"text-center",children:"Actions"})]})}),e.jsx(ee,{children:x.map((o,s)=>{const t=v(o.avgDiscountPercentage);return e.jsxs(O,{children:[e.jsx(i,{className:"font-medium",children:o.location}),e.jsx(i,{className:"text-center",children:e.jsx(U,{variant:"outline",children:R(o.transactions)})}),e.jsx(i,{className:"text-center",children:e.jsx(U,{variant:"secondary",children:R(o.uniqueCustomers)})}),e.jsx(i,{className:"text-right font-semibold text-red-600",children:u(o.totalDiscount)}),e.jsx(i,{className:"text-right",children:e.jsx(U,{variant:t.variant,children:V(o.avgDiscountPercentage)})}),e.jsx(i,{className:"text-right font-medium",children:u(o.avgDiscountPerTransaction)}),e.jsx(i,{className:"text-right font-semibold text-green-600",children:u(o.totalRevenue)}),e.jsx(i,{className:"text-center",children:e.jsx(Y,{variant:"outline",size:"sm",onClick:()=>m(`${o.location} - Discount Analysis`,o.data,"location-discount"),className:"hover:bg-blue-50",children:e.jsx(se,{className:"w-4 h-4"})})})]},s)})}),e.jsx(ne,{children:e.jsxs(O,{children:[e.jsx(i,{className:"font-bold",children:"Total"}),e.jsx(i,{className:"text-center font-bold",children:R(x.reduce((o,s)=>o+s.transactions,0))}),e.jsx(i,{className:"text-center font-bold",children:R(x.reduce((o,s)=>o+s.uniqueCustomers,0))}),e.jsx(i,{className:"text-right font-bold text-red-600",children:u(x.reduce((o,s)=>o+s.totalDiscount,0))}),e.jsx(i,{className:"text-right font-bold",children:V(x.reduce((o,s)=>o+s.avgDiscountPercentage,0)/x.length)}),e.jsx(i,{className:"text-right font-bold",children:u(x.reduce((o,s)=>o+s.avgDiscountPerTransaction,0)/x.length)}),e.jsx(i,{className:"text-right font-bold text-green-600",children:u(x.reduce((o,s)=>o+s.totalRevenue,0))}),e.jsx(i,{})]})})]})})})]}),e.jsxs(B,{className:"shadow-xl border-0 bg-gradient-to-br from-white via-purple-50/30 to-pink-50/20",children:[e.jsx(K,{className:"bg-gradient-to-r from-slate-800 via-slate-700 to-slate-600 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg backdrop-blur-sm",children:e.jsx(me,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx(L,{className:"text-2xl font-bold",children:"Staff-wise Discount Breakdown"}),e.jsx("p",{className:"text-slate-200 mt-1",children:"Analysis of discount authorization by sales staff"})]})]})}),e.jsx($,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(J,{children:[e.jsx(Z,{children:e.jsxs(O,{children:[e.jsx(k,{children:"Staff Member"}),e.jsx(k,{className:"text-center",children:"Transactions"}),e.jsx(k,{className:"text-right",children:"Total Discount"}),e.jsx(k,{className:"text-right",children:"Avg Discount %"}),e.jsx(k,{className:"text-right",children:"Discount per Sale"}),e.jsx(k,{className:"text-right",children:"Total Revenue"}),e.jsx(k,{className:"text-center",children:"Performance"}),e.jsx(k,{className:"text-center",children:"Actions"})]})}),e.jsx(ee,{children:A.map((o,s)=>{const t=v(o.avgDiscountPercentage);return e.jsxs(O,{children:[e.jsx(i,{className:"font-medium",children:o.staff}),e.jsx(i,{className:"text-center",children:e.jsx(U,{variant:"outline",children:R(o.transactions)})}),e.jsx(i,{className:"text-right font-semibold text-red-600",children:u(o.totalDiscount)}),e.jsx(i,{className:"text-right",children:e.jsx(U,{variant:t.variant,children:V(o.avgDiscountPercentage)})}),e.jsx(i,{className:"text-right font-medium",children:u(o.discountRate)}),e.jsx(i,{className:"text-right font-semibold text-green-600",children:u(o.totalRevenue)}),e.jsx(i,{className:"text-center",children:e.jsx(U,{variant:t.variant,children:t.label})}),e.jsx(i,{className:"text-center",children:e.jsx(Y,{variant:"outline",size:"sm",onClick:()=>m(`${o.staff} - Discount Analysis`,o.data,"staff-discount"),className:"hover:bg-purple-50",children:e.jsx(se,{className:"w-4 h-4"})})})]},s)})}),e.jsx(ne,{children:e.jsxs(O,{children:[e.jsx(i,{className:"font-bold",children:"Total"}),e.jsx(i,{className:"text-center font-bold",children:R(A.reduce((o,s)=>o+s.transactions,0))}),e.jsx(i,{className:"text-right font-bold text-red-600",children:u(A.reduce((o,s)=>o+s.totalDiscount,0))}),e.jsx(i,{className:"text-right font-bold",children:V(A.reduce((o,s)=>o+s.avgDiscountPercentage,0)/A.length)}),e.jsx(i,{className:"text-right font-bold",children:u(A.reduce((o,s)=>o+s.discountRate,0)/A.length)}),e.jsx(i,{className:"text-right font-bold text-green-600",children:u(A.reduce((o,s)=>o+s.totalRevenue,0))}),e.jsx(i,{colSpan:2})]})})]})})})]})]})},ke=["#8b5cf6","#06b6d4","#10b981","#f59e0b","#ef4444","#6366f1","#ec4899","#84cc16"],nt=({isOpen:j,onClose:h,title:C,data:x,type:A})=>{const m=M.useMemo(()=>{if(!x||x.length===0)return null;const t=x.reduce((c,f)=>c+(f.discountAmount||0),0),l=x.reduce((c,f)=>c+(f.paymentValue||0),0),D=x.length,p=new Set(x.map(c=>c.customerEmail)).size,n=t/x.length,a=x.reduce((c,f)=>c+(f.discountPercentage||0),0)/x.length,g=x.reduce((c,f)=>{const d=f.cleanedCategory||"Unknown";return c[d]||(c[d]={discountAmount:0,revenue:0,units:0,customers:new Set}),c[d].discountAmount+=f.discountAmount||0,c[d].revenue+=f.paymentValue||0,c[d].units+=1,c[d].customers.add(f.customerEmail),c},{}),w=x.reduce((c,f)=>{const d=f.cleanedProduct||"Unknown";return c[d]||(c[d]={discountAmount:0,revenue:0,units:0,customers:new Set}),c[d].discountAmount+=f.discountAmount||0,c[d].revenue+=f.paymentValue||0,c[d].units+=1,c[d].customers.add(f.customerEmail),c},{}),P=x.reduce((c,f)=>{const d=f.calculatedLocation||"Unknown";return c[d]||(c[d]={discountAmount:0,revenue:0,units:0,customers:new Set}),c[d].discountAmount+=f.discountAmount||0,c[d].revenue+=f.paymentValue||0,c[d].units+=1,c[d].customers.add(f.customerEmail),c},{}),I=x.reduce((c,f)=>{const d=f.paymentMethod||"Unknown";return c[d]||(c[d]={discountAmount:0,revenue:0,units:0,customers:new Set}),c[d].discountAmount+=f.discountAmount||0,c[d].revenue+=f.paymentValue||0,c[d].units+=1,c[d].customers.add(f.customerEmail),c},{}),N=x.reduce((c,f)=>{if(!f.paymentDate)return c;const d=new Date(f.paymentDate),T=`${d.getFullYear()}-${(d.getMonth()+1).toString().padStart(2,"0")}`,r=d.toLocaleDateString("en-US",{month:"short",year:"numeric"});return c[T]||(c[T]={month:r,discountAmount:0,revenue:0,units:0,customers:new Set}),c[T].discountAmount+=f.discountAmount||0,c[T].revenue+=f.paymentValue||0,c[T].units+=1,c[T].customers.add(f.customerEmail),c},{}),S=c=>Object.entries(c).map(([f,d])=>({name:f,discountAmount:d.discountAmount,revenue:d.revenue,units:d.units,customers:d.customers.size,avgDiscount:d.units>0?d.discountAmount/d.units:0,discountRate:d.revenue>0?d.discountAmount/d.revenue*100:0})).sort((f,d)=>d.discountAmount-f.discountAmount);return{summary:{totalDiscount:t,totalRevenue:l,totalUnits:D,uniqueCustomers:p,avgDiscount:n,avgDiscountPercent:a,discountRate:l>0?t/l*100:0},categoryBreakdown:S(g),productBreakdown:S(w),locationBreakdown:S(P),paymentBreakdown:S(I),monthlyTrend:Object.values(N).map(c=>({...c,customers:c.customers.size,avgDiscount:c.units>0?c.discountAmount/c.units:0,discountRate:c.revenue>0?c.discountAmount/c.revenue*100:0})).sort((c,f)=>c.month.localeCompare(f.month))}},[x]);if(!m)return null;const v=()=>e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(B,{className:"bg-gradient-to-br from-red-50 to-rose-50 border-red-200",children:e.jsxs($,{className:"p-4 text-center",children:[e.jsx(ae,{className:"w-8 h-8 text-red-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-red-700",children:"Total Discount"}),e.jsx("p",{className:"text-xl font-bold text-red-800",children:u(m.summary.totalDiscount)})]})}),e.jsx(B,{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200",children:e.jsxs($,{className:"p-4 text-center",children:[e.jsx(ve,{className:"w-8 h-8 text-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-blue-700",children:"Units Sold"}),e.jsx("p",{className:"text-xl font-bold text-blue-800",children:R(m.summary.totalUnits)})]})}),e.jsx(B,{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-green-200",children:e.jsxs($,{className:"p-4 text-center",children:[e.jsx(xe,{className:"w-8 h-8 text-green-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-green-700",children:"Revenue"}),e.jsx("p",{className:"text-xl font-bold text-green-800",children:u(m.summary.totalRevenue)})]})}),e.jsx(B,{className:"bg-gradient-to-br from-purple-50 to-violet-50 border-purple-200",children:e.jsxs($,{className:"p-4 text-center",children:[e.jsx(me,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-purple-700",children:"Customers"}),e.jsx("p",{className:"text-xl font-bold text-purple-800",children:R(m.summary.uniqueCustomers)})]})})]}),o=()=>{switch(A){case"categories":return e.jsx(H,{width:"100%",height:300,children:e.jsxs(de,{data:m.categoryBreakdown.slice(0,10),children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name"}),e.jsx(W,{}),e.jsx(q,{formatter:t=>u(t)}),e.jsx(ue,{}),e.jsx(X,{dataKey:"discountAmount",fill:"#ef4444",name:"Discount Amount"}),e.jsx(X,{dataKey:"revenue",fill:"#10b981",name:"Revenue"})]})});case"monthly-trend":return e.jsx(H,{width:"100%",height:300,children:e.jsxs(be,{data:m.monthlyTrend,children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"month"}),e.jsx(W,{}),e.jsx(q,{formatter:t=>u(t)}),e.jsx(ue,{}),e.jsx(te,{type:"monotone",dataKey:"discountAmount",stroke:"#ef4444",name:"Discount Amount"}),e.jsx(te,{type:"monotone",dataKey:"revenue",stroke:"#10b981",name:"Revenue"})]})});case"payment-methods":return e.jsx(H,{width:"100%",height:300,children:e.jsxs(Ce,{children:[e.jsx(Se,{data:m.paymentBreakdown.slice(0,8),cx:"50%",cy:"50%",labelLine:!1,label:({name:t,percent:l})=>`${t} ${(l*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"discountAmount",children:m.paymentBreakdown.slice(0,8).map((t,l)=>e.jsx(Me,{fill:ke[l%ke.length]},`cell-${l}`))}),e.jsx(q,{formatter:t=>u(t)})]})});default:return null}},s=()=>{let t=[],l=[];switch(A){case"categories":t=m.categoryBreakdown,l=[{key:"name",label:"Category",icon:z},{key:"discountAmount",label:"Discount Amount",format:u},{key:"revenue",label:"Revenue",format:u},{key:"units",label:"Units Sold",format:R},{key:"customers",label:"Customers",format:R},{key:"discountRate",label:"Discount Rate",format:D=>`${D.toFixed(1)}%`}];break;case"locations":t=m.locationBreakdown,l=[{key:"name",label:"Location",icon:fe},{key:"discountAmount",label:"Discount Amount",format:u},{key:"revenue",label:"Revenue",format:u},{key:"units",label:"Units Sold",format:R},{key:"customers",label:"Customers",format:R},{key:"discountRate",label:"Discount Rate",format:D=>`${D.toFixed(1)}%`}];break;case"payment-methods":t=m.paymentBreakdown,l=[{key:"name",label:"Payment Method",icon:le},{key:"discountAmount",label:"Discount Amount",format:u},{key:"revenue",label:"Revenue",format:u},{key:"units",label:"Units Sold",format:R},{key:"customers",label:"Customers",format:R},{key:"discountRate",label:"Discount Rate",format:D=>`${D.toFixed(1)}%`}];break;case"monthly-trend":t=m.monthlyTrend,l=[{key:"month",label:"Month",icon:re},{key:"discountAmount",label:"Discount Amount",format:u},{key:"revenue",label:"Revenue",format:u},{key:"units",label:"Units Sold",format:R},{key:"customers",label:"Customers",format:R},{key:"discountRate",label:"Discount Rate",format:D=>`${D.toFixed(1)}%`}];break;default:return null}return e.jsxs(B,{children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"Detailed Breakdown"]})}),e.jsx($,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(J,{children:[e.jsx(Z,{children:e.jsx(O,{children:l.map(D=>e.jsx(k,{className:"font-semibold",children:e.jsxs("div",{className:"flex items-center gap-2",children:[D.icon&&e.jsx(D.icon,{className:"w-4 h-4"}),D.label]})},D.key))})}),e.jsx(ee,{children:t.slice(0,20).map((D,p)=>e.jsx(O,{className:"hover:bg-gray-50",children:l.map(n=>e.jsx(i,{children:n.format?n.format(D[n.key]):D[n.key]},n.key))},p))})]})})})]})};return e.jsx(Fe,{open:j,onOpenChange:h,children:e.jsxs(Ee,{className:"max-w-6xl max-h-[90vh]",children:[e.jsx(ze,{children:e.jsxs(He,{className:"text-xl font-bold text-gray-900",children:[C," - Detailed Analysis"]})}),e.jsx(qe,{className:"max-h-[calc(90vh-120px)]",children:e.jsxs("div",{className:"space-y-6 pr-4",children:[v(),o()&&e.jsxs(B,{children:[e.jsx(K,{children:e.jsx(L,{children:"Visual Analysis"})}),e.jsx($,{children:o()})]}),s()]})})]})})},Ae=[{id:"all",name:"All Locations"},{id:"kwality",name:"Kwality House, Kemps Corner"},{id:"supreme",name:"Supreme HQ, Bandra"},{id:"kenkere",name:"Kenkere House"}],Pe=()=>{const j=new Date,h=new Date(j.getFullYear(),j.getMonth(),1),C=new Date(j.getFullYear(),j.getMonth()+1,0),x=A=>A.toISOString().split("T")[0];return{start:x(h),end:x(C)}},ut=({data:j})=>{const[h,C]=M.useState("all"),[x,A]=M.useState({dateRange:{start:null,end:null},category:[],product:[],soldBy:[],paymentMethod:[]}),[m,v]=M.useState({isOpen:!1,title:"",data:[],type:""});M.useEffect(()=>{const a=Pe();A(g=>({...g,dateRange:{start:a.start,end:a.end}}))},[]);const o=(a,g=!1)=>{let w=a.slice();if(h!=="all"&&(w=w.filter(P=>h==="kwality"?P.calculatedLocation==="Kwality House, Kemps Corner":h==="supreme"?P.calculatedLocation==="Supreme HQ, Bandra":P.calculatedLocation?.includes("Kenkere")||P.calculatedLocation==="Kenkere House")),!g&&(x.dateRange.start||x.dateRange.end)){const P=x.dateRange.start?new Date(x.dateRange.start):null,I=x.dateRange.end?(()=>{const N=new Date(x.dateRange.end);return N.setHours(23,59,59,999),N})():null;(P||I)&&(w=w.filter(N=>{if(!N.paymentDate)return!1;let S;if(N.paymentDate.includes("/"))if(N.paymentDate.includes(" ")){const[f]=N.paymentDate.split(" "),[d,T,r]=f.split("/");S=new Date(parseInt(d),parseInt(T)-1,parseInt(r))}else{const[f,d,T]=N.paymentDate.split("/");S=new Date(parseInt(T),parseInt(d)-1,parseInt(f))}else S=new Date(N.paymentDate);return!S||isNaN(S.getTime())?!1:(!P||S>=P)&&(!I||S<=I)}))}return x.category&&x.category.length>0&&(w=w.filter(P=>x.category.includes(P.cleanedCategory||"Uncategorized"))),x.product&&x.product.length>0&&(w=w.filter(P=>x.product.includes(P.cleanedProduct||P.paymentItem||"Unknown"))),x.soldBy&&x.soldBy.length>0&&(w=w.filter(P=>x.soldBy.includes(P.soldBy||"Unknown"))),x.paymentMethod&&x.paymentMethod.length>0&&(w=w.filter(P=>x.paymentMethod.includes(P.paymentMethod||"Unknown"))),w},s=M.useMemo(()=>o(j),[j,x,h]),t=M.useMemo(()=>o(j,!0),[j,h]),l=M.useMemo(()=>s,[s]);M.useMemo(()=>s.filter(g=>(g.discountAmount||0)>0),[s]);const D=a=>{v({isOpen:!0,title:`${a.title} Analysis`,data:a.rawData||s,type:"metric"})},p=(a,g,w)=>{v({isOpen:!0,title:a,data:g,type:w})},n=()=>{const a=Pe();A({dateRange:{start:a.start,end:a.end},category:[],product:[],soldBy:[],paymentMethod:[]})};return e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"container mx-auto px-6",children:e.jsx(Ye,{})}),e.jsx("div",{className:"container mx-auto px-6 space-y-6",children:e.jsxs(ce,{value:h,onValueChange:C,className:"w-full",children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx(ie,{className:"bg-white/90 backdrop-blur-sm p-2 rounded-2xl shadow-xl border-0 grid grid-cols-4 w-full max-w-7xl min-h-24 overflow-hidden",children:Ae.map(a=>e.jsx(F,{value:a.id,className:"relative px-6 py-4 font-semibold text-gray-800 transition-all duration-300 ease-out hover:scale-105 data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-600 data-[state=active]:to-amber-600 data-[state=active]:text-white data-[state=active]:shadow-lg hover:bg-gray-50 text-2xl rounded-2xl",children:e.jsxs("div",{className:"relative z-10 text-center",children:[e.jsx("div",{className:"font-bold",children:a.name.split(",")[0]}),e.jsx("div",{className:"text-xs opacity-80",children:a.name.split(",")[1]?.trim()})]})},a.id))})}),Ae.map(a=>e.jsxs(E,{value:a.id,className:"space-y-8",children:[e.jsx("div",{className:"w-full",children:e.jsx(_e,{filters:x,onFiltersChange:A,onReset:n})}),e.jsx(Ze,{data:l,onMetricClick:D}),e.jsx(we,{data:t}),e.jsx(et,{data:l,onDrillDown:p}),e.jsxs(ce,{defaultValue:"detailed",className:"space-y-6",children:[e.jsxs(ie,{className:"grid w-full grid-cols-3 bg-gradient-to-r from-orange-100 via-amber-100 to-yellow-100 p-1 rounded-xl shadow-lg border border-orange-200/50",children:[e.jsx(F,{value:"detailed",className:"data-[state=active]:bg-white data-[state=active]:shadow-lg data-[state=active]:text-orange-800 font-semibold transition-all duration-300",children:"Data Tables"}),e.jsx(F,{value:"breakdown",className:"data-[state=active]:bg-white data-[state=active]:shadow-lg data-[state=active]:text-orange-800 font-semibold transition-all duration-300",children:"Breakdowns"}),e.jsx(F,{value:"analytics",className:"data-[state=active]:bg-white data-[state=active]:shadow-lg data-[state=active]:text-orange-800 font-semibold transition-all duration-300",children:"Analytics"})]}),e.jsx(E,{value:"analytics",className:"space-y-6",children:e.jsx(we,{data:l})}),e.jsx(E,{value:"detailed",className:"space-y-6",children:e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-xl p-6 border border-orange-200/50",children:e.jsx(tt,{data:l,onRowClick:(g,w,P)=>p(g,w,P)})})}),e.jsx(E,{value:"breakdown",className:"space-y-6",children:e.jsx(st,{data:l,onDrillDown:p})})]})]},a.id))]})}),e.jsx(nt,{isOpen:m.isOpen,onClose:()=>v({isOpen:!1,title:"",data:[],type:""}),title:m.title,data:m.data,type:m.type})]})},xt=({data:j})=>{const h=j.reduce((s,t)=>s+(t.discountAmount||0),0),C=j.length,x=j.filter(s=>(s.discountAmount||0)>0).length,A=j.reduce((s,t)=>s+(t.paymentValue||0),0),m=A>0?h/(A+h)*100:0,v=[{location:"Total Discounts",label:"Amount saved by customers",value:u(h)},{location:"Discount Rate",label:"Percentage of gross revenue",value:V(m)},{location:"Transactions",label:`${x} of ${C} had discounts`,value:R(x)}],o=e.jsx(Ge,{salesData:j,defaultFileName:"discounts-promotions-filtered",size:"sm",variant:"ghost"});return e.jsx(We,{title:"Discounts & Promotions",subtitle:"Comprehensive analysis of discount strategies, promotional effectiveness, and customer savings patterns",variant:"discounts",metrics:v,exportButton:o})};export{xt as D,dt as E,ut as a};
