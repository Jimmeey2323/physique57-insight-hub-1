import{r as E,bR as ce}from"./react-vendor-dqSXVcdP.js";import{bt as ie,bu as le}from"./vendor-CBk7njWV.js";import{f as M}from"./utils-vendor-R2EFQ5ZT.js";import{u as de}from"./dashboard-executive-yZpGwH-8.js";import{u as ue}from"./dashboard-classes-C0LoPzks.js";const me=1,pe=1e6;let Y=0;function fe(){return Y=(Y+1)%Number.MAX_SAFE_INTEGER,Y.toString()}const K=new Map,J=n=>{if(K.has(n))return;const s=setTimeout(()=>{K.delete(n),A({type:"REMOVE_TOAST",toastId:n})},pe);K.set(n,s)},he=(n,s)=>{switch(s.type){case"ADD_TOAST":return{...n,toasts:[s.toast,...n.toasts].slice(0,me)};case"UPDATE_TOAST":return{...n,toasts:n.toasts.map(p=>p.id===s.toast.id?{...p,...s.toast}:p)};case"DISMISS_TOAST":{const{toastId:p}=s;return p?J(p):n.toasts.forEach(c=>{J(c.id)}),{...n,toasts:n.toasts.map(c=>c.id===p||p===void 0?{...c,open:!1}:c)}}case"REMOVE_TOAST":return s.toastId===void 0?{...n,toasts:[]}:{...n,toasts:n.toasts.filter(p=>p.id!==s.toastId)}}},j=[];let H={toasts:[]};function A(n){H=he(H,n),j.forEach(s=>{s(H)})}function ge({...n}){const s=fe(),p=I=>A({type:"UPDATE_TOAST",toast:{...I,id:s}}),c=()=>A({type:"DISMISS_TOAST",toastId:s});return A({type:"ADD_TOAST",toast:{...n,id:s,open:!0,onOpenChange:I=>{I||c()}}}),{id:s,dismiss:c,update:p}}function Ae(){const[n,s]=E.useState(H);return E.useEffect(()=>(j.push(s),()=>{const p=j.indexOf(s);p>-1&&j.splice(p,1)}),[n]),{...n,toast:ge,dismiss:p=>A({type:"DISMISS_TOAST",toastId:p})}}const ee={sales:{name:"Sales Analytics",heroGradient:"from-slate-900 via-blue-900 to-slate-800",activeTabGradient:"from-blue-600 to-blue-800",accentColors:{primary:"blue-600",secondary:"blue-500",light:"blue-100",dark:"blue-800"},metricCardBorder:"border-blue-200",tableHeaderGradient:"from-blue-700 to-blue-900",badgeColors:"bg-blue-100 text-blue-800"},discounts:{name:"Discounts & Promotions",heroGradient:"from-stone-900 via-amber-900 to-stone-800",activeTabGradient:"from-orange-600 to-amber-600",accentColors:{primary:"orange-600",secondary:"amber-500",light:"orange-100",dark:"orange-800"},metricCardBorder:"border-orange-200",tableHeaderGradient:"from-orange-700 to-amber-800",badgeColors:"bg-orange-100 text-orange-800"},funnel:{name:"Lead Funnel",heroGradient:"from-slate-900 via-violet-900 to-slate-800",activeTabGradient:"from-red-600 to-rose-700",accentColors:{primary:"red-600",secondary:"rose-500",light:"red-100",dark:"red-800"},metricCardBorder:"border-red-200",tableHeaderGradient:"from-red-700 to-rose-800",badgeColors:"bg-red-100 text-red-800"},retention:{name:"Client Retention",heroGradient:"from-gray-900 via-purple-900 to-gray-800",activeTabGradient:"from-purple-600 to-violet-700",accentColors:{primary:"purple-600",secondary:"violet-500",light:"purple-100",dark:"purple-800"},metricCardBorder:"border-purple-200",tableHeaderGradient:"from-purple-700 to-violet-800",badgeColors:"bg-purple-100 text-purple-800"},attendance:{name:"Class Attendance",heroGradient:"from-gray-900 via-purple-900 to-gray-800",activeTabGradient:"from-purple-600 to-violet-700",accentColors:{primary:"purple-600",secondary:"violet-500",light:"purple-100",dark:"purple-800"},metricCardBorder:"border-purple-200",tableHeaderGradient:"from-purple-700 to-violet-800",badgeColors:"bg-purple-100 text-purple-800"},powercycle:{name:"PowerCycle vs Barre",heroGradient:"from-zinc-900 via-cyan-900 to-zinc-800",activeTabGradient:"from-cyan-600 to-teal-700",accentColors:{primary:"cyan-600",secondary:"teal-500",light:"cyan-100",dark:"cyan-800"},metricCardBorder:"border-cyan-200",tableHeaderGradient:"from-cyan-700 to-teal-800",badgeColors:"bg-cyan-100 text-cyan-800"},expiration:{name:"Expiration Analytics",heroGradient:"from-neutral-900 via-red-900 to-neutral-800",activeTabGradient:"from-red-600 to-pink-700",accentColors:{primary:"red-600",secondary:"pink-500",light:"red-100",dark:"red-800"},metricCardBorder:"border-red-200",tableHeaderGradient:"from-red-700 to-pink-800",badgeColors:"bg-red-100 text-red-800"},cancellations:{name:"Late Cancellations",heroGradient:"from-stone-900 via-rose-900 to-stone-800",activeTabGradient:"from-rose-600 to-pink-700",accentColors:{primary:"rose-600",secondary:"pink-500",light:"rose-100",dark:"rose-800"},metricCardBorder:"border-rose-200",tableHeaderGradient:"from-rose-700 to-pink-800",badgeColors:"bg-rose-100 text-rose-800"},analytics:{name:"Analytics & Performance",heroGradient:"from-zinc-900 via-indigo-900 to-zinc-800",activeTabGradient:"from-indigo-600 to-indigo-800",accentColors:{primary:"indigo-600",secondary:"indigo-500",light:"indigo-100",dark:"indigo-800"},metricCardBorder:"border-indigo-200",tableHeaderGradient:"from-indigo-700 to-indigo-800",badgeColors:"bg-indigo-100 text-indigo-800"},summary:{name:"Executive Summary",heroGradient:"from-slate-900 via-teal-900 to-slate-800",activeTabGradient:"from-blue-600 to-purple-600",accentColors:{primary:"blue-600",secondary:"purple-500",light:"blue-100",dark:"blue-800"},metricCardBorder:"border-blue-200",tableHeaderGradient:"from-blue-700 to-purple-800",badgeColors:"bg-blue-100 text-blue-800"}},ne=n=>ee[n]||ee.summary,we=n=>`text-slate-600 data-[state=active]:bg-gradient-to-r data-[state=active]:${ne(n).activeTabGradient} data-[state=active]:text-white data-[state=active]:shadow-lg hover:text-slate-800`,Le=n=>`bg-gradient-to-r ${ne(n).tableHeaderGradient} text-white`,xe=ce()(ie((n,s)=>({isLoading:!1,loadingMessage:"Loading...",progress:0,loadingStartTime:null,setLoading:(p,c="Loading...")=>{n({isLoading:p,loadingMessage:c,loadingStartTime:p?Date.now():null,progress:p?0:100})},setProgress:p=>n({progress:Math.min(Math.max(p,0),100)}),resetProgress:()=>n({progress:0})}))),Me=()=>{E.useEffect(()=>{const n=()=>{["/executive-summary","/sales-analytics","/funnel-leads","/client-retention","/trainer-performance"].forEach(f=>{const h=document.createElement("link");h.rel="prefetch",h.href=f,document.head.appendChild(h)})};"requestIdleCallback"in window?requestIdleCallback(n):setTimeout(n,100);let s=null;const p=[];if("PerformanceObserver"in window){s=new PerformanceObserver(I=>{I.getEntries().forEach(f=>{f.entryType==="longtask"&&f.duration>100})});try{s.observe({entryTypes:["longtask"]})}catch{}}return(()=>{document.querySelectorAll('img[loading="lazy"]').forEach(f=>{if("IntersectionObserver"in window){const h=new IntersectionObserver(a=>{a.forEach(m=>{if(m.isIntersecting){const e=m.target;e.dataset.src&&(e.src=e.dataset.src,e.removeAttribute("data-src"),h.unobserve(e))}})});h.observe(f),p.push(h)}})})(),()=>{s&&s.disconnect(),p.forEach(I=>{I.disconnect()})}},[])},Oe=()=>{const n=new Date,s=new Date(n.getFullYear(),n.getMonth()-1,1),p=new Date(n.getFullYear(),n.getMonth(),0),c=f=>{const h=f.getFullYear(),a=String(f.getMonth()+1).padStart(2,"0"),m=String(f.getDate()).padStart(2,"0");return`${h}-${a}-${m}`};return{start:c(s),end:c(p)}},Ge=n=>{if(!n||n.trim()==="")return null;try{if(n.includes("/")){const c=n.split(" ")[0].trim().split("/");if(c.length===3){const I=parseInt(c[0]),f=parseInt(c[1]),h=parseInt(c[2]);if(!isNaN(h)&&!isNaN(f)&&!isNaN(I))return new Date(h,f-1,I)}}if(n.includes("-")){const p=new Date(n);if(!isNaN(p.getTime()))return p}const s=new Date(n);return isNaN(s.getTime())?null:s}catch{return null}},Fe=()=>{const n=new Date,s=new Date(n.getFullYear(),n.getMonth()-1,1);return`${s.toLocaleDateString("en-US",{month:"long"})} ${s.getFullYear()}`},O={CLIENT_ID:"416630995185-007ermh3iidknbbtdmu5vct207mdlbaa.apps.googleusercontent.com",CLIENT_SECRET:"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",REFRESH_TOKEN:"1//04w4V2xMUIMzACgYIARAAGAQSNwF-L9Ir5__pXDmZVYaHKOSqyauTDVmTvrCvgaL2beep4gmp8_lVED0ppM9BPWDDimHyQKk50EY",TOKEN_URL:"https://oauth2.googleapis.com/token"},ye="11_i8_iflhhdHZ-oKQU6UsPOfsM3MdOOUwSc8McpuXaU",se=()=>{const[n,s]=E.useState([]),[p,c]=E.useState(!0),[I,f]=E.useState(null),h=async()=>{try{return(await(await fetch(O.TOKEN_URL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:O.CLIENT_ID,client_secret:O.CLIENT_SECRET,refresh_token:O.REFRESH_TOKEN,grant_type:"refresh_token"})})).json()).access_token}catch(e){throw e}},a=e=>{if(typeof e=="number")return e;if(!e||e==="")return 0;const o=e.toString().replace(/,/g,""),y=parseFloat(o);return isNaN(y)?0:y},m=async()=>{try{c(!0),f(null);const e=await h(),o=await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${ye}/values/Sales?alt=json`,{headers:{Authorization:`Bearer ${e}`}});if(!o.ok)throw new Error("Failed to fetch data");const r=(await o.json()).values||[];if(r.length<2){s([]);return}const u=r[0],t=100,g=[],T=(b,i)=>{const N=r.slice(b,i).map(_=>{const d={};return u.forEach((w,L)=>{d[w]=_[L]||""}),{memberId:d["Member ID"]||d.memberId||"",customerName:d["Customer Name"]||d.customerName||"",customerEmail:d["Customer Email"]||d.customerEmail||"",saleItemId:d["Sale Item ID"]||d.saleItemId||"",paymentCategory:d["Payment Category"]||d.paymentCategory||"",membershipType:d["Membership Type"]||d.membershipType||"",paymentDate:d["Payment Date"]||d.paymentDate||"",paymentValue:a(d["Payment Value"]||d.paymentValue||0),paidInMoneyCredits:a(d["Paid in Money Credits"]||d["Paid In Money Credits"]||d.paidInMoneyCredits||0),paymentVAT:a(d["Payment VAT"]||d.paymentVAT||0),paymentItem:d["Payment Item"]||d.paymentItem||"",paymentStatus:d["Payment Status"]||d.paymentStatus||"",paymentMethod:d["Payment Method"]||d.paymentMethod||"",paymentTransactionId:d["Payment Transaction ID"]||d.paymentTransactionId||"",stripeToken:d["Stripe Token"]||d.stripeToken||"",soldBy:d["Sold By"]||d.soldBy||"",saleReference:d["Sale Reference"]||d.saleReference||"",calculatedLocation:d["Calculated Location"]||d.calculatedLocation||"",cleanedProduct:d["Cleaned Product"]||d.cleanedProduct||"",cleanedCategory:d["Cleaned Category"]||d.cleanedCategory||"",netRevenue:a(d["Payment Value"]||d.paymentValue||0)-a(d["Payment VAT"]||d.paymentVAT||0),vat:a(d["Payment VAT"]||d.paymentVAT||0),grossRevenue:a(d["Payment Value"]||d.paymentValue||0),mrpPreTax:a(d["Mrp - Pre Tax"]||d["MRP Pre Tax"]||d.MRP_Pre_Tax||d.mrpPreTax||d.MrpPreTax||d["Pre Tax MRP"]||0),mrpPostTax:a(d["Mrp - Post Tax"]||d["MRP Post Tax"]||d.MRP_Post_Tax||d.mrpPostTax||d.MrpPostTax||d["Post Tax MRP"]||0),discountAmount:a(d["Discount Amount -Mrp- Payment Value"]||d["Discount Amount"]||d.discount_amount||d.discountAmount||d.DiscountAmount||d.Discount_Amount||d["Total Discount"]||0),discountPercentage:a(d["Discount Percentage - discount amount/mrp*100"]||d["Discount Percentage"]||d.discount_percentage||d.discountPercentage||d.DiscountPercentage||d.Discount_Percentage||d["Discount %"]||d.Discount_Percent||0),hostId:d["Host Id"]||d["Host ID"]||d.hostId||""}});g.push(...N)},l=r.length-1;for(let b=1;b<=l;b+=t){const i=Math.min(b+t,l+1);b>1&&await new Promise(N=>setTimeout(N,0)),T(b,i)}s(g),f(null)}catch{f("Failed to load sales data")}finally{c(!1)}};return E.useEffect(()=>{m()},[]),{data:n,loading:p,error:I,refetch:m}},Ve={card:{shadow:"shadow-[0_4px_20px_rgba(0,0,0,0.08)]",border:"border border-slate-200/60",background:"bg-white/95 backdrop-blur-md",radius:"rounded-2xl"},table:{header:"bg-gradient-to-r from-slate-50 to-slate-100 border-b-2 border-slate-200",headerText:"text-xs font-bold text-slate-700 uppercase tracking-wider",row:"hover:bg-slate-50/80 transition-colors border-b border-slate-100",cell:"px-4 py-2 text-sm text-slate-800 font-medium whitespace-nowrap overflow-hidden text-ellipsis"}},v=n=>{if(n==null||isNaN(n))return"₹0";const s=Math.abs(n);return s<1e3?`₹${Math.round(n)}`:s>=1e7?`₹${(n/1e7).toFixed(1)}Cr`:s>=1e5?`₹${(n/1e5).toFixed(1)}L`:s>=1e3?`₹${(n/1e3).toFixed(1)}K`:`₹${n.toLocaleString("en-IN")}`},$e=n=>{if(n==null||isNaN(n))return"₹0";const s=Math.abs(n);return s<1e3?`₹${Math.round(n)}`:s>=1e7?`₹${(n/1e7).toFixed(1)}Cr`:s>=1e5?`₹${(n/1e5).toFixed(1)}L`:s>=1e3?`₹${(n/1e3).toFixed(1)}K`:`₹${n.toLocaleString("en-IN")}`},te=n=>n==null||isNaN(n)?"0.0%":`${n.toFixed(1)}%`,R=n=>n==null||isNaN(n)?"0":n.toLocaleString("en-IN"),Be=()=>{const{data:n,loading:s,error:p}=se();return{data:n,loading:s,error:p,isLoading:s}},G={CLIENT_ID:"416630995185-g7b0fm679lb4p45p5lou070cqscaalaf.apps.googleusercontent.com",CLIENT_SECRET:"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",REFRESH_TOKEN:"1//0gT2uoYBlNdGXCgYIARAAGBASNwF-L9IrBK_ijYwpce6-TdqDfji4GxYuc4uxIBKasdgoZBPm-tu_EU0xS34cNirqfLgXbJ8_NMk",TOKEN_URL:"https://oauth2.googleapis.com/token"},Te="1i5GcTahIchSF6pLn0c2ZgqtQVYBG-Fqt7rGxIzD7qrA",Ue=()=>{const[n,s]=E.useState([]),[p,c]=E.useState(!0),[I,f]=E.useState(null),h=async()=>{try{return(await(await fetch(G.TOKEN_URL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:G.CLIENT_ID,client_secret:G.CLIENT_SECRET,refresh_token:G.REFRESH_TOKEN,grant_type:"refresh_token"})})).json()).access_token}catch(e){throw e}},a=e=>{if(typeof e=="number")return e;if(!e||e==="")return 0;const o=e.toString().replace(/,/g,""),y=parseFloat(o);return isNaN(y)?0:y},m=async()=>{try{c(!0);const e=await h(),o=await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${Te}/values/Sessions?alt=json`,{headers:{Authorization:`Bearer ${e}`}});if(!o.ok)throw new Error("Failed to fetch sessions data");const r=(await o.json()).values||[];if(r.length<2){s([]);return}const u=r.slice(1).map(t=>{const g=a(t[6]),T=a(t[7]),l=g>0?T/g*100:0;return{trainerId:t[0]||"",trainerFirstName:t[1]||"",trainerLastName:t[2]||"",trainerName:t[3]||"",sessionId:t[4]||"",sessionName:t[5]||"",capacity:g,checkedInCount:T,lateCancelledCount:a(t[8]),bookedCount:a(t[9]),complimentaryCount:a(t[10]),location:t[11]||"",date:t[12]||"",dayOfWeek:t[13]||"",time:t[14]||"",totalPaid:a(t[15]),nonPaidCount:a(t[16]),uniqueId1:t[17]||"",uniqueId2:t[18]||"",checkedInsWithMemberships:a(t[19]),checkedInsWithPackages:a(t[20]),checkedInsWithIntroOffers:a(t[21]),checkedInsWithSingleClasses:a(t[22]),classType:t[23]||"",cleanedClass:t[24]||"",classes:a(t[25]),fillPercentage:l,revenue:a(t[15]),uniqueId:t[17]||""}});s(u),f(null)}catch{f("Failed to load sessions data")}finally{c(!1)}};return E.useEffect(()=>{m()},[]),{data:n,loading:p,error:I,refetch:m}},F={CLIENT_ID:"416630995185-g7b0fm679lb4p45p5lou070cqscaalaf.apps.googleusercontent.com",CLIENT_SECRET:"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",REFRESH_TOKEN:"1//0gT2uoYBlNdGXCgYIARAAGBASNwF-L9IrBK_ijYwpce6-TdqDfji4GxYuc4uxIBKasdgoZBPm-tu_EU0xS34cNirqfLgXbJ8_NMk",TOKEN_URL:"https://oauth2.googleapis.com/token"},Ie="1i5GcTahIchSF6pLn0c2ZgqtQVYBG-Fqt7rGxIzD7qrA",je=()=>{const[n,s]=E.useState([]),[p,c]=E.useState(!0),[I,f]=E.useState(null),h=async()=>{try{return(await(await fetch(F.TOKEN_URL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:F.CLIENT_ID,client_secret:F.CLIENT_SECRET,refresh_token:F.REFRESH_TOKEN,grant_type:"refresh_token"})})).json()).access_token}catch(e){throw e}},a=e=>{if(typeof e=="number")return e;if(!e||e==="")return 0;const o=e.toString().replace(/,/g,""),y=parseFloat(o);return isNaN(y)?0:y},m=async()=>{try{c(!0);const e=await h(),o=await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${Ie}/values/Payroll?alt=json`,{headers:{Authorization:`Bearer ${e}`}});if(!o.ok)throw new Error(`Failed to fetch payroll data: ${o.status} ${o.statusText}`);const r=(await o.json()).values||[];if(r.length<2){s([]);return}const u=r.slice(1).map(t=>({teacherId:t[0]||"",teacherName:t[1]||"",teacherEmail:t[2]||"",location:t[3]||"",cycleSessions:a(t[4]),emptyCycleSessions:a(t[5]),nonEmptyCycleSessions:a(t[6]),cycleCustomers:a(t[7]),cyclePaid:a(t[8]),strengthSessions:a(t[9]),emptyStrengthSessions:a(t[10]),nonEmptyStrengthSessions:a(t[11]),strengthCustomers:a(t[12]),strengthPaid:a(t[13]),barreSessions:a(t[14]),emptyBarreSessions:a(t[15]),nonEmptyBarreSessions:a(t[16]),barreCustomers:a(t[17]),barrePaid:a(t[18]),totalSessions:a(t[19]),totalEmptySessions:a(t[20]),totalNonEmptySessions:a(t[21]),totalCustomers:a(t[22]),totalPaid:a(t[23]),monthYear:t[24]||"",unique:t[25]||"",converted:a(t[26]),conversion:a(t[27]).toString()+"%",retained:a(t[28]),retention:a(t[29]).toString()+"%",new:a(t[30]),classAverageInclEmpty:a(t[22])>0?a(t[19])/a(t[22]):0,classAverageExclEmpty:a(t[21])>0?a(t[22])/a(t[21]):0}));s(u),f(null)}catch{f("Failed to load payroll data")}finally{c(!1)}};return E.useEffect(()=>{m()},[]),{data:n,isLoading:p,error:I,refetch:m}},V={CLIENT_ID:"416630995185-g7b0fm679lb4p45p5lou070cqscaalaf.apps.googleusercontent.com",CLIENT_SECRET:"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",REFRESH_TOKEN:"1//0gT2uoYBlNdGXCgYIARAAGBASNwF-L9IrBK_ijYwpce6-TdqDfji4GxYuc4uxIBKasdgoZBPm-tu_EU0xS34cNirqfLgXbJ8_NMk",TOKEN_URL:"https://oauth2.googleapis.com/token"},Ee="1i5GcTahIchSF6pLn0c2ZgqtQVYBG-Fqt7rGxIzD7qrA",He=()=>{const[n,s]=E.useState([]),[p,c]=E.useState(!0),[I,f]=E.useState(null),[h,a]=E.useState(!1),m=async()=>{try{return(await(await fetch(V.TOKEN_URL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:V.CLIENT_ID,client_secret:V.CLIENT_SECRET,refresh_token:V.REFRESH_TOKEN,grant_type:"refresh_token"})})).json()).access_token}catch(r){throw r}},e=(r,u)=>{if(!r||!u)return 0;let t,g;if(r.includes("/")){const[b,i,N]=r.split(" ")[0].split("/");t=new Date(parseInt(N),parseInt(i)-1,parseInt(b))}else t=new Date(r);if(u.includes("/")){const[b,i,N]=u.split(" ")[0].split("/");g=new Date(parseInt(N),parseInt(i)-1,parseInt(b))}else g=new Date(u);if(isNaN(t.getTime())||isNaN(g.getTime()))return 0;const T=g.getTime()-t.getTime(),l=Math.ceil(T/(1e3*60*60*24));return Math.max(0,l)},o=(r="")=>{if(!r)return"";let u;if(r.includes("/")){const T=r.split(",")[0].trim(),[l,b,i]=T.split("/");u=new Date(parseInt(i),parseInt(b)-1,parseInt(l))}else u=new Date(r);if(isNaN(u.getTime()))return"";const t=u.getFullYear(),g=(u.getMonth()+1).toString().padStart(2,"0");return`${t}-${g}`},y=async()=>{try{h&&c(!0);const r=await m(),u=await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${Ee}/values/New?alt=json`,{headers:{Authorization:`Bearer ${r}`}});if(!u.ok)throw new Error("Failed to fetch new client data");const g=(await u.json()).values||[];if(g.length<2){s([]);return}const T=g.slice(1).map(l=>{const b=l[5]||"";return{memberId:l[0]||"",firstName:l[1]||"",lastName:l[2]||"",email:l[3]||"",phoneNumber:l[4]||"",firstVisitDate:b,firstVisitEntityName:l[6]||"",firstVisitType:l[7]||"",firstVisitLocation:l[8]||"",paymentMethod:l[9]||"",membershipUsed:l[10]||"",homeLocation:l[11]||"",classNo:parseFloat(l[12])||0,trainerName:l[13]||"",isNew:l[14]||"",visitsPostTrial:parseFloat(l[15])||0,membershipsBoughtPostTrial:l[16]||"",purchaseCountPostTrial:parseFloat(l[17])||0,ltv:parseFloat(l[18])||0,retentionStatus:l[19]||"",conversionStatus:l[20]||"",period:l[21]||"",unique:l[22]||"",firstPurchase:l[23]||"",conversionSpan:e(b,l[23]||""),monthYear:o(b)}});s(T),f(null),a(!0)}catch{f("Failed to load new client data"),a(!0)}finally{c(!1)}};return E.useEffect(()=>{h||y()},[h]),{data:n,loading:p,error:I,refetch:y}},$={CLIENT_ID:"416630995185-g7b0fm679lb4p45p5lou070cqscaalaf.apps.googleusercontent.com",CLIENT_SECRET:"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",REFRESH_TOKEN:"1//0gT2uoYBlNdGXCgYIARAAGBASNwF-L9IrBK_ijYwpce6-TdqDfji4GxYuc4uxIBKasdgoZBPm-tu_EU0xS34cNirqfLgXbJ8_NMk",TOKEN_URL:"https://oauth2.googleapis.com/token"},De="1dQMNF69WnXVQdhlLvUZTig3kL97NA21k6eZ9HRu6xiQ",k=n=>{if(!n||n.trim()===""||n==="-")return"";try{let s;const p=new Date;if(n.includes("/")){const c=n.split("/");if(c.length===3){const I=parseInt(c[0]),f=parseInt(c[1]),h=parseInt(c[2]);!isNaN(h)&&!isNaN(f)&&!isNaN(I)&&(s=new Date(h,f-1,I))}}else n.includes("-")?s=new Date(n):s=new Date(n);return!s||isNaN(s.getTime())||s>p||s.getFullYear()<2020?"":s.toISOString()}catch{return""}},D=(n,s)=>n&&n[s]!==void 0&&n[s]!==null?String(n[s]).trim():"",be=(n,s)=>{const p=D(n,s),c=parseFloat(p);return isNaN(c)?0:c},ae=(n,s)=>{const p=D(n,s),c=parseInt(p);return isNaN(c)?0:c},Ye=()=>{const[n,s]=E.useState([]),[p,c]=E.useState(!0),[I,f]=E.useState(null),h=async()=>{try{const m=await fetch($.TOKEN_URL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:$.CLIENT_ID,client_secret:$.CLIENT_SECRET,refresh_token:$.REFRESH_TOKEN,grant_type:"refresh_token"})});if(!m.ok)throw new Error(`Token request failed: ${m.statusText}`);const e=await m.json();if(!e.access_token)throw new Error("No access token received");return e.access_token}catch(m){throw m}},a=async()=>{try{c(!0),f(null);const m=await h(),e=await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${De}/values/◉ Leads?alt=json`,{headers:{Authorization:`Bearer ${m}`}});if(!e.ok)throw new Error(`Failed to fetch leads data: ${e.statusText}`);const y=(await e.json()).values||[];if(y.length<2){s([]);return}const r=y.slice(1).map((u,t)=>{try{return!u||u.length===0?null:{id:D(u,0),fullName:D(u,1),phone:D(u,2),email:D(u,3),createdAt:k(D(u,4)),sourceId:D(u,5),source:D(u,6),memberId:D(u,7),convertedToCustomerAt:k(D(u,8)),stage:D(u,9),associate:D(u,10),remarks:D(u,11),followUp1Date:k(D(u,12)),followUpComments1:D(u,13),followUp2Date:k(D(u,14)),followUpComments2:D(u,15),followUp3Date:k(D(u,16)),followUpComments3:D(u,17),followUp4Date:k(D(u,18)),followUpComments4:D(u,19),center:D(u,20),classType:D(u,21),hostId:D(u,22),status:D(u,23),channel:D(u,24),period:D(u,25),purchasesMade:ae(u,26),ltv:be(u,27),visits:ae(u,28),trialStatus:D(u,29),conversionStatus:D(u,30),retentionStatus:D(u,31)}}catch{return null}}).filter(u=>u!==null);s(r),f(null)}catch(m){f(m instanceof Error?m.message:"Failed to load leads data")}finally{c(!1)}};return E.useEffect(()=>{a()},[]),{data:n,loading:p,error:I,refetch:a}},Ke=()=>{const{data:n,loading:s,error:p}=se(),[c,I]=E.useState([]);E.useEffect(()=>{if(n&&n.length>0)try{const h=e=>{if(e==null||e==="")return 0;const o=e.toString().replace(/[₹,]/g,"").trim(),y=parseFloat(o);return isNaN(y)?0:y},a=e=>{if(!e)return"";try{if(e.includes("/")){const o=e.split(",")[0].trim(),[y,r,u]=o.split("/");if(y&&r&&u){const t=`${u}-${r.padStart(2,"0")}-${y.padStart(2,"0")}`;return new Date(t).toISOString().split("T")[0]}}if(e.includes("-")){const o=new Date(e);if(!isNaN(o.getTime()))return o.toISOString().split("T")[0]}return""}catch{return""}},m=n.map(e=>{const o=h(e.discountAmount||e["Discount Amount -Mrp- Payment Value"]||0),y=h(e.discountPercentage||e["Discount Percentage - discount amount/mrp*100"]||0);return{memberId:e.memberId||e["Member ID"]?.toString()||"",customerName:e.customerName||e["Customer Name"]||"",customerEmail:e.customerEmail||e["Customer Email"]||"",saleItemId:e.saleItemId||e["Sale Item ID"]?.toString()||"",paymentCategory:e.paymentCategory||e["Payment Category"]||"",paymentDate:a(e.paymentDate||e["Payment Date"]||""),paymentValue:h(e.paymentValue||e["Payment Value"]||0),paidInMoneyCredits:h(e.paidInMoneyCredits||e["Paid In Money Credits"]||0),paymentVat:h(e.paymentVat||e["Payment VAT"]||0),paymentItem:e.paymentItem||e["Payment Item"]||"",paymentMethod:e.paymentMethod||e["Payment Method"]||"",paymentStatus:e.paymentStatus||e["Payment Status"]||"",paymentTransactionId:e.paymentTransactionId||e["Payment Transaction ID"]?.toString()||"",stripeToken:e.stripeToken||e["Stripe Token"]||"",saleReference:e.saleReference||e["Sale Reference"]?.toString()||"",soldBy:e.soldBy==="-"?"Online/System":e.soldBy||e["Sold By"]||"Unknown",location:e.calculatedLocation||e["Calculated Location"]||"",cleanedProduct:e.cleanedProduct||e["Cleaned Product"]||"",cleanedCategory:e.cleanedCategory||e["Cleaned Category"]||"",hostId:e.hostId||e["Host Id"]?.toString()||"",mrpPreTax:h(e.mrpPreTax||e["Mrp - Pre Tax"]||0),mrpPostTax:h(e.mrpPostTax||e["Mrp - Post Tax"]||0),discountAmount:o,discountPercentage:y,membershipType:e.membershipType||e["Membership Type"]?.trim()||""}});I(m)}catch{I([])}else I([])},[n]);const f=E.useMemo(()=>{if(!c.length)return{totalDiscountAmount:0,totalRevenueLost:0,totalTransactions:0,avgDiscountPercentage:0,totalPotentialRevenue:0,totalActualRevenue:0,discountEffectiveness:0,productBreakdown:[],monthlyBreakdown:[]};const h=c.reduce((t,g)=>t+(g.discountAmount||0),0),a=c.length,m=c.reduce((t,g)=>t+(g.mrpPostTax||g.paymentValue||0),0),e=c.reduce((t,g)=>t+(g.paymentValue||0),0),o=c.filter(t=>(t.discountAmount||0)>0),y=o.length>0?o.reduce((t,g)=>t+(g.discountPercentage||0),0)/o.length:0,r=c.reduce((t,g)=>{const T=g.cleanedProduct||"Unknown Product";return t[T]||(t[T]={product:T,transactions:0,totalDiscount:0,avgDiscountPercentage:0,revenue:0,totalMrp:0}),t[T].transactions+=1,t[T].totalDiscount+=g.discountAmount||0,t[T].revenue+=g.paymentValue||0,t[T].totalMrp+=g.mrpPostTax||g.paymentValue||0,t},{});Object.values(r).forEach(t=>{t.avgDiscountPercentage=t.totalMrp>0?t.totalDiscount/t.totalMrp*100:0});const u=c.reduce((t,g)=>{if(!g.paymentDate)return t;const T=g.paymentDate.substring(0,7);return t[T]||(t[T]={month:T,transactions:0,totalDiscount:0,revenue:0}),t[T].transactions+=1,t[T].totalDiscount+=g.discountAmount||0,t[T].revenue+=g.paymentValue||0,t},{});return{totalDiscountAmount:h,totalRevenueLost:h,totalTransactions:a,avgDiscountPercentage:y,totalPotentialRevenue:m,totalActualRevenue:e,discountEffectiveness:m>0?e/m*100:0,productBreakdown:Object.values(r),monthlyBreakdown:Object.values(u)}},[c]);return{data:c,metrics:f,loading:s,error:p}},qe=()=>{const[n,s]=E.useState(!1),p=(a,m)=>[m.join(","),...a.map(o=>m.map(y=>{const r=o[y];return r==null?"":typeof r=="string"&&r.includes(",")?`"${r.replace(/"/g,'""')}"`:r}).join(","))].join(`
`),c=(a,m)=>{const e=new Blob([a],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),y=URL.createObjectURL(e);o.setAttribute("href",y),o.setAttribute("download",m),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)},I=(a,m)=>{const e=new le("l","mm","a4"),o=e.internal.pageSize.getWidth();e.internal.pageSize.getHeight(),e.setFontSize(20),e.setTextColor(40,40,40),e.text("Complete Dashboard Export",o/2,20,{align:"center"}),e.setFontSize(10),e.setTextColor(100,100,100);const y=M(new Date,"PPP p");e.text(`Generated on: ${y}`,20,30),m.dateRange&&e.text(`Date Range: ${M(new Date(m.dateRange.start),"PP")} - ${M(new Date(m.dateRange.end),"PP")}`,20,35);let r=45;return a.salesData&&a.salesData.length>0&&(r=f(e,"Sales Analytics Data",a.salesData,r,["customerName","paymentDate","membershipType","paymentValue","calculatedLocation","soldBy","paymentMethod"])),a.sessionsData&&a.sessionsData.length>0&&(r=f(e,"Sessions Data",a.sessionsData,r,["date","classType","instructor","location","capacity","checkedIn","fillPercentage"])),a.newClientData&&a.newClientData.length>0&&(r=f(e,"Client Conversion Data",a.newClientData,r,["firstName","lastName","email","firstVisitDate","firstVisitLocation","conversionStatus","ltv"])),a.payrollData&&a.payrollData.length>0&&(r=f(e,"Trainer Performance Data",a.payrollData,r,["teacherName","location","totalSessions","totalCustomers","totalPaid","conversion","retention"])),a.lateCancellationsData&&a.lateCancellationsData.length>0&&(r=f(e,"Late Cancellations Data",a.lateCancellationsData,r,["firstName","lastName","sessionName","teacherName","location","dateIST","time"])),a.discountData&&a.discountData.length>0&&(r=f(e,"Discounts & Promotions Data",a.discountData,r,["firstName","lastName","cleanedProduct","mrpPostTax","discountAmount","discountPercentage","location"])),a.additionalData&&Object.entries(a.additionalData).forEach(([u,t])=>{if(t&&t.length>0){const g=Object.keys(t[0]).slice(0,7);r=f(e,u,t,r,g)}}),e},f=(a,m,e,o,y)=>{const r=a.internal.pageSize.getHeight();o>r-100&&(a.addPage(),o=20),a.setFontSize(14),a.setTextColor(60,60,60),a.text(m,20,o),o+=10;const u=e.slice(0,100).map(t=>y.map(g=>{const T=t[g];return T==null?"":typeof T=="number"?T.toLocaleString():String(T)}));return a.autoTable({head:[y.map(t=>t.charAt(0).toUpperCase()+t.slice(1).replace(/([A-Z])/g," $1"))],body:u,startY:o,styles:{fontSize:8,cellPadding:2},headStyles:{fillColor:[66,139,202],textColor:255,fontSize:9,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:20,right:20}}),a.lastAutoTable.finalY+15};return{exportAllData:async(a,m)=>{s(!0);try{const e=m.fileName||`dashboard-export-${M(new Date,"yyyy-MM-dd-HH-mm")}`;if(m.format==="pdf")I(a,m).save(`${e}.pdf`);else if(m.format==="csv"){let o="";const y=[];if(a.salesData?.length){const r=Object.keys(a.salesData[0]);o+=`Sales Analytics Data
${p(a.salesData,r)}

`,y.push("Sales")}if(a.sessionsData?.length){const r=Object.keys(a.sessionsData[0]);o+=`Sessions Data
${p(a.sessionsData,r)}

`,y.push("Sessions")}if(a.newClientData?.length){const r=Object.keys(a.newClientData[0]);o+=`Client Conversion Data
${p(a.newClientData,r)}

`,y.push("Client Conversion")}if(a.payrollData?.length){const r=Object.keys(a.payrollData[0]);o+=`Trainer Performance Data
${p(a.payrollData,r)}

`,y.push("Trainer Performance")}if(a.lateCancellationsData?.length){const r=Object.keys(a.lateCancellationsData[0]);o+=`Late Cancellations Data
${p(a.lateCancellationsData,r)}

`,y.push("Late Cancellations")}if(a.discountData?.length){const r=Object.keys(a.discountData[0]);o+=`Discounts & Promotions Data
${p(a.discountData,r)}

`,y.push("Discounts")}a.additionalData&&Object.entries(a.additionalData).forEach(([r,u])=>{if(u?.length){const t=Object.keys(u[0]);o+=`${r}
${p(u,t)}

`,y.push(r)}}),c(o,`${e}.csv`)}}catch(e){throw e}finally{s(!1)}},isExporting:n}},ze=n=>{const{filters:s}=de();return{metrics:E.useMemo(()=>{if(!n||n.length===0)return[];const c=n,I=n.length,f=Math.floor(I/2),h=c.slice(0,f);c.slice(f);const a=c.reduce((S,C)=>S+(typeof C.paymentValue=="number"?C.paymentValue:0),0),m=c.reduce((S,C)=>S+(typeof C.discountAmount=="number"?C.discountAmount:0),0),e=c.length,o=new Set(c.map(S=>S.memberId||S.customerEmail).filter(Boolean)).size,y=c.length,r=e>0?a/e:0,u=o>0?a/o:0,t=c.length>0?c.reduce((S,C)=>S+(typeof C.discountPercentage=="number"?C.discountPercentage:0),0)/c.length:0,g=h.reduce((S,C)=>S+(typeof C.paymentValue=="number"?C.paymentValue:0),0),T=h.reduce((S,C)=>S+(typeof C.discountAmount=="number"?C.discountAmount:0),0),l=h.length,b=new Set(h.map(S=>S.memberId||S.customerEmail).filter(Boolean)).size,i=h.length,N=l>0?g/l:0,_=b>0?g/b:0,d=h.length>0?h.reduce((S,C)=>S+(typeof C.discountPercentage=="number"?C.discountPercentage:0),0)/h.length:0,P=(S,C)=>{if(C===0)return{rate:S>0?100:0,isSignificant:S>0,trend:"moderate"};const x=(S-C)/C*100,re=Math.abs(x)>=5,oe=Math.abs(x)>=20?"strong":Math.abs(x)>=10?"moderate":"weak";return{rate:x,isSignificant:re,trend:oe}},w=P(a,g),L=P(e,l),q=P(o,b),z=P(y,i),X=P(r,N),Z=P(u,_),Q=P(m,T),W=P(t,d);return[{title:"Sales Revenue",value:v(a),rawValue:a,change:w.rate,changeDetails:w,icon:"DollarSign",color:"blue",description:"Total sales revenue across all transactions",previousValue:v(g),previousRawValue:g,comparison:{current:a,previous:g,difference:a-g}},{title:"Units Sold",value:R(y),rawValue:y,change:z.rate,changeDetails:z,icon:"ShoppingCart",color:"green",description:"Total number of units/items sold",previousValue:R(i),previousRawValue:i,comparison:{current:y,previous:i,difference:y-i}},{title:"Transactions",value:R(e),rawValue:e,change:L.rate,changeDetails:L,icon:"Activity",color:"purple",description:"Number of completed transactions",previousValue:R(l),previousRawValue:l,comparison:{current:e,previous:l,difference:e-l}},{title:"Unique Members",value:R(o),rawValue:o,change:q.rate,changeDetails:q,icon:"Users",color:"orange",description:"Individual customers who made purchases",previousValue:R(b),previousRawValue:b,comparison:{current:o,previous:b,difference:o-b}},{title:"Avg Transaction Value",value:v(r),rawValue:r,change:X.rate,changeDetails:X,icon:"Target",color:"cyan",description:"Average value per transaction",previousValue:v(N),previousRawValue:N,comparison:{current:r,previous:N,difference:r-N}},{title:"Avg Spend per Member",value:v(u),rawValue:u,change:Z.rate,changeDetails:Z,icon:"Calendar",color:"pink",description:"Average spending per unique customer",previousValue:v(_),previousRawValue:_,comparison:{current:u,previous:_,difference:u-_}},{title:"Discount Value",value:v(m),rawValue:m,change:Q.rate,changeDetails:Q,icon:"CreditCard",color:"red",description:"Total discount amount applied",previousValue:v(T),previousRawValue:T,comparison:{current:m,previous:T,difference:m-T}},{title:"Discount Percentage",value:te(t/100),rawValue:t,change:W.rate,changeDetails:W,icon:"ArrowDownRight",color:"amber",description:"Average discount rate applied",previousValue:te(d/100),previousRawValue:d,comparison:{current:t,previous:d,difference:t-d}}]},[n,s.dateRange])}},Xe=n=>{let s=null;try{s=ue().filters}catch{s=null}return E.useMemo(()=>n?n.filter(c=>{const I=c.sessionName?.toLowerCase()||"";if(I.includes("test")||I.includes("demo"))return!1;if(!s)return!0;if(s.trainers.length>0&&!s.trainers.includes(c.trainerName)||s.classTypes.length>0&&!s.classTypes.includes(c.cleanedClass)||s.dayOfWeek.length>0&&!s.dayOfWeek.includes(c.dayOfWeek)||s.timeSlots.length>0&&!s.timeSlots.includes(c.time))return!1;if(s.dateRange.start||s.dateRange.end){let f;if(c.date.includes("/")){const a=c.date.split("/");if(a.length===3){const m=parseInt(a[0]),e=parseInt(a[1]),o=parseInt(a[2]);f=new Date(o,e-1,m)}else f=new Date(c.date)}else f=new Date(c.date);if(isNaN(f.getTime()))return!0;const h=new Date(f.getFullYear(),f.getMonth(),f.getDate());if(s.dateRange.start){const a=new Date(s.dateRange.start.getFullYear(),s.dateRange.start.getMonth(),s.dateRange.start.getDate());if(h<a)return!1}if(s.dateRange.end){const a=new Date(s.dateRange.end.getFullYear(),s.dateRange.end.getMonth(),s.dateRange.end.getDate());if(h>a)return!1}}return!0}):[],[n,s])},B={CLIENT_ID:"416630995185-007ermh3iidknbbtdmu5vct207mdlbaa.apps.googleusercontent.com",CLIENT_SECRET:"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",REFRESH_TOKEN:"1//04w4V2xMUIMzACgYIARAAGAQSNwF-L9Ir5__pXDmZVYaHKOSqyauTDVmTvrCvgaL2beep4gmp8_lVED0ppM9BPWDDimHyQKk50EY",TOKEN_URL:"https://oauth2.googleapis.com/token"},Se="1rGMDDvvTbZfNg1dueWtRN3LhOgGQOdLg3Fd7Sn1GCZo",Ze=()=>{const[n,s]=E.useState([]),[p,c]=E.useState(!0),[I,f]=E.useState(null),h=async()=>{try{return(await(await fetch(B.TOKEN_URL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:B.CLIENT_ID,client_secret:B.CLIENT_SECRET,refresh_token:B.REFRESH_TOKEN,grant_type:"refresh_token"})})).json()).access_token}catch(m){throw m}},a=async()=>{try{c(!0),f(null);const m=await h(),e=["Expirations","Expiration","Members","Sheet1","Data"];let o,y="";for(const T of e)try{if(o=await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${Se}/values/${T}?alt=json`,{headers:{Authorization:`Bearer ${m}`}}),o.ok){y=T;break}}catch{continue}if(!o||!o.ok)throw new Error(`Failed to fetch expirations data from any sheet. Tried: ${e.join(", ")}`);const u=(await o.json()).values||[];if(u.length<2){s([]);return}const t=u[0],g=[];for(let T=1;T<u.length;T++){const l=u[T];if(!l||l.length===0)continue;const b={uniqueId:l[t.findIndex(i=>i==="Unique Id")]||`exp-${Date.now()}-${T}`,memberId:l[t.findIndex(i=>i==="Member ID")]||"",firstName:l[t.findIndex(i=>i==="First Name")]||"",lastName:l[t.findIndex(i=>i==="Last Name")]||"",email:l[t.findIndex(i=>i==="Email")]||"",membershipName:l[t.findIndex(i=>i==="Membership Name")]||"",endDate:l[t.findIndex(i=>i==="End Date")]||"",homeLocation:l[t.findIndex(i=>i==="Home Location")]||"",currentUsage:l[t.findIndex(i=>i==="Current Usage")]||"",id:l[t.findIndex(i=>i==="Id")]||"",orderAt:l[t.findIndex(i=>i==="Order At")]||"",soldBy:l[t.findIndex(i=>i==="Sold By")]||"",membershipId:l[t.findIndex(i=>i==="Membership Id")]||"",frozen:l[t.findIndex(i=>i==="Frozen")]==="TRUE",paid:l[t.findIndex(i=>i==="Paid")]||"",status:l[t.findIndex(i=>i==="Status")]||""};g.push(b)}s(g),f(null)}catch(m){f(m instanceof Error?m.message:"Failed to load expirations data"),s([])}finally{c(!1)}};return E.useEffect(()=>{a()},[]),{data:n,loading:p,error:I||"",refetch:a}},U={CLIENT_ID:"416630995185-g7b0fm679lb4p45p5lou070cqscaalaf.apps.googleusercontent.com",CLIENT_SECRET:"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",REFRESH_TOKEN:"1//0gT2uoYBlNdGXCgYIARAAGBASNwF-L9IrBK_ijYwpce6-TdqDfji4GxYuc4uxIBKasdgoZBPm-tu_EU0xS34cNirqfLgXbJ8_NMk",TOKEN_URL:"https://oauth2.googleapis.com/token"},Ce="1i5GcTahIchSF6pLn0c2ZgqtQVYBG-Fqt7rGxIzD7qrA",Qe=()=>{const[n,s]=E.useState([]),[p,c]=E.useState(!0),[I,f]=E.useState(null),h=async()=>{try{return(await(await fetch(U.TOKEN_URL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:U.CLIENT_ID,client_secret:U.CLIENT_SECRET,refresh_token:U.REFRESH_TOKEN,grant_type:"refresh_token"})})).json()).access_token}catch(e){throw e}},a=e=>{if(typeof e=="number")return e;if(!e||e==="")return 0;const o=e.toString();if(o.includes("-")&&(o.includes("1899")||o.includes("1900")))return 0;const y=o.replace(/,/g,""),r=parseFloat(y);return isNaN(r)?0:r},m=async()=>{try{c(!0),f(null);const e=await h(),o=await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${Ce}/values/Checkins?alt=json`,{headers:{Authorization:`Bearer ${e}`}});if(!o.ok)throw new Error("Failed to fetch late cancellations data");const r=(await o.json()).values||[];if(r.length<2){s([]);return}const u=[];if(r.length<2){s([]);return}const t=r[0],g=t.findIndex(T=>T==="Is Late Cancelled");if(g===-1){s([]);return}for(let T=1;T<r.length;T++){const l=r[T];if(!l||l.length===0||l[g]!=="TRUE")continue;const b={memberId:l[t.findIndex(i=>i==="Member ID")]||"",firstName:l[t.findIndex(i=>i==="First Name")]||"",lastName:l[t.findIndex(i=>i==="Last Name")]||"",email:l[t.findIndex(i=>i==="Email")]||"",location:l[t.findIndex(i=>i==="Location")]||"",sessionName:l[t.findIndex(i=>i==="Session Name")]||"",teacherName:l[t.findIndex(i=>i==="Teacher Name")]||"",cleanedProduct:l[t.findIndex(i=>i==="Cleaned Product")]||"",cleanedCategory:l[t.findIndex(i=>i==="Cleaned Category")]||"",cleanedClass:l[t.findIndex(i=>i==="Cleaned Class")]||"",paymentMethodName:l[t.findIndex(i=>i==="Payment Method Name")]||"",dateIST:l[t.findIndex(i=>i==="Date (IST)")]||"",dayOfWeek:l[t.findIndex(i=>i==="Day of Week")]||"",time:l[t.findIndex(i=>i==="Time")]||"",duration:a(l[t.findIndex(i=>i==="Duration (Minutes)")]||"0"),capacity:a(l[t.findIndex(i=>i==="Capacity")]||"0"),month:l[t.findIndex(i=>i==="Month")]||"",year:a(l[t.findIndex(i=>i==="Year")]||"0"),paidAmount:a(l[t.findIndex(i=>i==="Paid")]||"0"),isNew:l[t.findIndex(i=>i==="Is New")]||"",tableType:"checkins"};u.push(b)}s(u),f(null)}catch{f("Failed to load late cancellations data"),s([])}finally{c(!1)}};return E.useEffect(()=>{m()},[]),{data:n,loading:p,error:I,refetch:m}};export{Le as a,te as b,R as c,Xe as d,je as e,v as f,Oe as g,Ve as h,Fe as i,xe as j,Be as k,He as l,Ye as m,Ke as n,ne as o,we as p,$e as q,Ge as r,ze as s,se as t,Ue as u,Ze as v,Qe as w,Ae as x,qe as y,Me as z};
