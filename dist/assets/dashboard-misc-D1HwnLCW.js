import{r as P,j as e,h as oe,e as ue,g as $e,Z as nt,i as qe,U as Q,O as tt,T as Le,c as ae,f as Fe,F as st,b as Ge,y as yt,X as pe,$ as De,a7 as dt,v as He,s as Be,E as wt,R as Ae,k as rt,ad as lt,ae as it,w as Oe,J as mt,af as Rt,ag as Vt,B as Ct,ah as Pt,ai as It,aj as $t,M as Te,V as xt,W as Ft,u as kt,D as zt,ak as Lt,al as ht,a9 as Ot,_ as Et,S as qt,m as Bt,n as Ut,am as Kt,an as Wt,a1 as Yt,d as at,l as Gt,C as Ht}from"./react-vendor-CYideCN0.js";import{C as F,j as K,k as W,c as z,a as Jt,b as _t,e as Xt,P as ut,J as gt,d as G,K as pt,M as jt,S as ve,f as Ne,g as ye,h as we,i as ce,I as Re,B as L,r as ze,s as Ee,t as H,u as se,a6 as ct,L as me,l as bt,_ as Je,$ as _e,a0 as Xe,a1 as Qe,T as Ce,m as ke,n as ne,o as B,p as Me,q as U,X as Qt,a7 as Zt,a3 as et}from"./ui-components-Cek3D08m.js";import{b as D,f as _,p as es,a as J,g as ft}from"./utils-Bswz-ULp.js";import{c as te}from"./dashboard-classes-DkM9eh--.js";import{S as ts}from"./dashboard-sales-Dn9BVdD4.js";import{f as Ke}from"./utils-vendor-R2EFQ5ZT.js";import{R as je,P as Mt,d as St,e as Dt,T as be,B as We,C as Ve,X as Pe,Y as Ie,c as Se,A as Tt,f as Ye,a as At,L as ss,b as as}from"./chart-vendor-DyOsfj4e.js";const bs=({title:r="Physique 57 Analytics",subtitle:T="Loading your dashboard...",variant:j="default"})=>{const[R,M]=P.useState(0),[v,N]=P.useState(0);P.useEffect(()=>{const y=setInterval(()=>{M(S=>S>=100?0:S+2)},50),A=setInterval(()=>{N(S=>(S+1)%4)},800);return()=>{clearInterval(y),clearInterval(A)}},[]);const l=()=>{switch(j){case"analytics":return ue;case"sales":return oe;case"conversion":return nt;default:return $e}},u=()=>{switch(j){case"analytics":return"from-blue-600 to-indigo-600";case"sales":return"from-green-600 to-emerald-600";case"conversion":return"from-purple-600 to-pink-600";default:return"from-blue-600 to-purple-600"}},b=()=>["Fetching data from Google Sheets...","Processing analytics information...","Building interactive visualizations...","Almost ready..."][v],o=l(),w=u();return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50/30 to-purple-50/20 flex flex-col items-center justify-center relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden will-change-transform",children:[e.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-gradient-to-r from-blue-400/20 to-purple-400/20 rounded-full blur-3xl",style:{animation:"float1 6s ease-in-out infinite",transform:"translate3d(0, 0, 0)"}}),e.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-gradient-to-r from-purple-400/15 to-pink-400/15 rounded-full blur-3xl",style:{animation:"float2 8s ease-in-out infinite 2s",transform:"translate3d(0, 0, 0)"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 w-64 h-64 bg-gradient-to-r from-indigo-400/10 to-blue-400/10 rounded-full blur-3xl",style:{animation:"float3 7s ease-in-out infinite 1s",transform:"translate3d(-50%, -50%, 0)"}})]}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center space-y-8 text-center",children:[e.jsxs("div",{className:"relative transform will-change-transform",children:[e.jsx("div",{className:`w-28 h-28 bg-gradient-to-br ${w} rounded-3xl flex items-center justify-center shadow-2xl shadow-blue-500/20`,style:{animation:"logoFloat 3s ease-in-out infinite",transform:"translate3d(0, 0, 0)"},children:e.jsx(o,{className:"w-14 h-14 text-white",style:{animation:"iconSpin 4s linear infinite",transform:"translate3d(0, 0, 0)"}})}),e.jsx("div",{className:"absolute -top-3 -right-3 w-10 h-10 bg-gradient-to-br from-emerald-500 to-teal-500 rounded-full flex items-center justify-center shadow-lg",style:{animation:"smallFloat1 2s ease-in-out infinite"},children:e.jsx(oe,{className:"w-5 h-5 text-white"})}),e.jsx("div",{className:"absolute -bottom-2 -left-2 w-8 h-8 bg-gradient-to-br from-orange-500 to-red-500 rounded-full flex items-center justify-center",style:{animation:"smallFloat2 2.5s ease-in-out infinite 0.5s"},children:e.jsx(ue,{className:"w-4 h-4 text-white"})})]}),e.jsx("div",{className:"flex items-center space-x-2",children:[0,1,2,3].map(y=>e.jsx("div",{className:`w-3 h-3 ${y===0?"bg-blue-600":y===1?"bg-purple-600":y===2?"bg-indigo-600":"bg-pink-600"} rounded-full`,style:{animation:"dotBounce 1.2s ease-in-out infinite",animationDelay:`${y*.15}s`,transform:"translate3d(0, 0, 0)"}},y))}),e.jsxs("div",{className:"space-y-3 max-w-md",children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-slate-700 via-slate-800 to-slate-900 bg-clip-text text-transparent",children:r}),e.jsx("p",{className:"text-slate-600 text-lg leading-relaxed",children:T})]}),e.jsx("div",{className:"w-80 h-2 bg-slate-200 rounded-full overflow-hidden shadow-inner",children:e.jsx("div",{className:`h-full bg-gradient-to-r ${w} rounded-full shadow-sm transition-all duration-100 ease-out`,style:{width:`${Math.min(R,100)}%`,transform:"translate3d(0, 0, 0)"}})}),e.jsxs("div",{className:"text-sm text-slate-500 flex items-center space-x-2 h-6",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-ping"}),e.jsx("span",{className:"transition-opacity duration-300",children:b()})]})]}),e.jsx("style",{children:`
        @keyframes float1 {
          0%, 100% { transform: translate(0, 0) scale(1); }
          50% { transform: translate(20px, -30px) scale(1.1); }
        }
        @keyframes float2 {
          0%, 100% { transform: translate(0, 0) scale(1); }
          50% { transform: translate(-25px, 20px) scale(0.9); }
        }
        @keyframes float3 {
          0%, 100% { transform: translate(-50%, -50%) scale(1); }
          50% { transform: translate(-50%, -60%) scale(1.05); }
        }
        @keyframes logoFloat {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-10px); }
        }
        @keyframes iconSpin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
        @keyframes smallFloat1 {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-8px); }
        }
        @keyframes smallFloat2 {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-6px); }
        }
        @keyframes dotBounce {
          0%, 20%, 53%, 80%, 100% { transform: translateY(0); }
          40%, 43% { transform: translateY(-8px); }
        }
      `})]})},fs=({onButtonClick:r})=>{const T=[{id:"executive-summary",title:"Executive Summary",description:"High-level business metrics and KPIs",icon:oe,color:"from-blue-500 to-blue-600",hoverColor:"hover:from-blue-600 hover:to-blue-700"},{id:"sales-analytics",title:"Sales Analytics",description:"Revenue trends and sales performance",icon:qe,color:"from-green-500 to-green-600",hoverColor:"hover:from-green-600 hover:to-green-700"},{id:"class-attendance",title:"Class Attendance",description:"Session attendance and capacity analysis",icon:Q,color:"from-purple-500 to-purple-600",hoverColor:"hover:from-purple-600 hover:to-purple-700"},{id:"trainer-performance",title:"Trainer Performance",description:"Individual trainer metrics and rankings",icon:tt,color:"from-orange-500 to-orange-600",hoverColor:"hover:from-orange-600 hover:to-orange-700"},{id:"client-retention",title:"Client Retention",description:"Member retention and conversion analysis",icon:Le,color:"from-teal-500 to-teal-600",hoverColor:"hover:from-teal-600 hover:to-teal-700"},{id:"discounts-promotions",title:"Discounts & Promotions",description:"Discount analysis and promotional effectiveness",icon:ue,color:"from-pink-500 to-pink-600",hoverColor:"hover:from-pink-600 hover:to-pink-700"},{id:"funnel-leads",title:"Funnel & Leads",description:"Lead conversion and sales funnel analysis",icon:$e,color:"from-indigo-500 to-indigo-600",hoverColor:"hover:from-indigo-600 hover:to-indigo-700"},{id:"class-performance-series",title:"Class Performance Series",description:"Detailed class format performance analysis",icon:ae,color:"from-cyan-500 to-cyan-600",hoverColor:"hover:from-cyan-600 hover:to-cyan-700"},{id:"late-cancellations",title:"Late Cancellations",description:"Analysis of late cancellations and no-shows",icon:Fe,color:"from-red-500 to-red-600",hoverColor:"hover:from-red-600 hover:to-red-700"},{id:"powercycle-vs-barre",title:"powerCycle Vs Barre Vs Strength",description:"Comparative analysis of PowerCycle, Barre, and Strength classes",icon:$e,color:"from-violet-500 to-violet-600",hoverColor:"hover:from-violet-600 hover:to-violet-700"},{id:"expiration-analytics",title:"Expirations & Churn",description:"Membership expirations and customer retention analysis",icon:ae,color:"from-amber-500 to-amber-600",hoverColor:"hover:from-amber-600 hover:to-amber-700"}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 p-2",children:T.map(j=>{const R=j.icon;return e.jsxs(F,{className:"group cursor-pointer relative overflow-hidden bg-white/80 backdrop-blur-sm border-0 shadow-lg hover:shadow-2xl transition-all duration-500 ease-out hover:-translate-y-3 hover:rotate-1 transform-gpu",onClick:()=>r(j.id),children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${j.color} opacity-0 group-hover:opacity-10 transition-opacity duration-700`}),e.jsx("div",{className:`absolute inset-0 rounded-lg bg-gradient-to-r ${j.color} opacity-0 group-hover:opacity-20 blur-xl transition-all duration-500 -z-10`}),e.jsxs(K,{className:"pb-4 relative z-10",children:[e.jsxs("div",{className:`w-14 h-14 rounded-2xl bg-gradient-to-br ${j.color} ${j.hoverColor} flex items-center justify-center mb-4 transition-all duration-500 group-hover:scale-125 group-hover:rotate-12 shadow-lg group-hover:shadow-2xl`,children:[e.jsx(R,{className:"w-7 h-7 text-white transition-transform duration-300 group-hover:scale-110"}),e.jsx("div",{className:`absolute inset-0 rounded-2xl bg-gradient-to-r ${j.color} opacity-0 group-hover:opacity-30 animate-ping`})]}),e.jsx(W,{className:"text-xl font-bold text-gray-900 group-hover:bg-gradient-to-r group-hover:from-gray-900 group-hover:to-gray-600 group-hover:bg-clip-text group-hover:text-transparent transition-all duration-500 leading-tight",children:j.title})]}),e.jsxs(z,{className:"pt-0 relative z-10",children:[e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed mb-4 transition-colors duration-300 group-hover:text-gray-700",children:j.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx("div",{className:"w-2.5 h-2.5 bg-emerald-400 rounded-full mr-2 animate-pulse shadow-sm shadow-emerald-400/50 group-hover:animate-bounce"}),e.jsx("span",{className:"font-medium group-hover:text-emerald-600 transition-colors",children:"Active"})]}),e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-100 group-hover:bg-gray-200 flex items-center justify-center transition-all duration-300 group-hover:translate-x-1",children:e.jsx("svg",{className:"w-3 h-3 text-gray-400 group-hover:text-gray-600 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),e.jsx("div",{className:`absolute bottom-0 left-0 h-1 bg-gradient-to-r ${j.color} transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500 origin-left rounded-full`})]}),e.jsxs("div",{className:"absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity duration-700",children:[e.jsx("div",{className:"w-1 h-1 bg-white rounded-full animate-bounce delay-100"}),e.jsx("div",{className:"w-1 h-1 bg-white rounded-full animate-bounce delay-200 mt-1 ml-2"}),e.jsx("div",{className:"w-1 h-1 bg-white rounded-full animate-bounce delay-300 mt-1"})]})]},j.id)})})},ns=({filters:r,onFiltersChange:T,onReset:j})=>{const[R,M]=P.useState(!1),[v,N]=P.useState(r.dateRange.start?new Date(r.dateRange.start):void 0),[l,u]=P.useState(r.dateRange.end?new Date(r.dateRange.end):void 0),[b,o]=P.useState(r),w=()=>{const k={...b,dateRange:{start:v?Ke(v,"yyyy-MM-dd"):"",end:l?Ke(l,"yyyy-MM-dd"):""}};T(k),M(!1)},y=()=>{j(),N(void 0),u(void 0),o({dateRange:{start:"",end:""},location:[],category:[],product:[],soldBy:[],paymentMethod:[]}),M(!1)},A=(k,g)=>{if(k==="dateRange")N(void 0),u(void 0),T({...r,dateRange:{start:"",end:""}});else if(Array.isArray(r[k])){const x=r[k].filter(n=>n!==g);T({...r,[k]:x})}},V=(()=>{let k=0;return(r.dateRange.start||r.dateRange.end)&&k++,r.category?.length&&(k+=r.category.length),r.paymentMethod?.length&&(k+=r.paymentMethod.length),r.soldBy?.length&&(k+=r.soldBy.length),(r.minAmount||r.maxAmount)&&k++,k})();return e.jsxs(F,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl backdrop-blur-sm",children:[e.jsxs(Jt,{open:R,onOpenChange:M,children:[e.jsx(_t,{asChild:!0,children:e.jsx(K,{className:"cursor-pointer hover:bg-slate-50/50 transition-colors rounded-t-xl",children:e.jsxs(W,{className:"flex items-center justify-between text-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-r from-blue-500 to-purple-600",children:e.jsx(st,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:"bg-gradient-to-r from-slate-700 via-slate-800 to-slate-900 bg-clip-text text-transparent",children:"Advanced Filters"}),V>0&&e.jsxs(L,{variant:"default",className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white",children:[V," active"]})]}),e.jsx(Ge,{className:te("w-5 h-5 transition-transform text-slate-600",R&&"rotate-180")})]})})}),e.jsx(Xt,{children:e.jsxs(z,{className:"space-y-6 pt-0",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"Start Date"}),e.jsxs(ut,{children:[e.jsx(gt,{asChild:!0,children:e.jsxs(G,{variant:"outline",className:te("w-full justify-start text-left font-normal bg-white/80 backdrop-blur-sm",!v&&"text-muted-foreground"),children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),v?Ke(v,"PPP"):"Pick start date"]})}),e.jsx(pt,{className:"w-auto p-0",align:"start",children:e.jsx(jt,{mode:"single",selected:v,onSelect:N,initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"End Date"}),e.jsxs(ut,{children:[e.jsx(gt,{asChild:!0,children:e.jsxs(G,{variant:"outline",className:te("w-full justify-start text-left font-normal bg-white/80 backdrop-blur-sm",!l&&"text-muted-foreground"),children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),l?Ke(l,"PPP"):"Pick end date"]})}),e.jsx(pt,{className:"w-auto p-0",align:"start",children:e.jsx(jt,{mode:"single",selected:l,onSelect:u,initialFocus:!0})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"Category"}),e.jsxs(ve,{value:"",onValueChange:k=>{b.category?.includes(k)||o({...b,category:[...b.category||[],k]})},children:[e.jsx(Ne,{className:"bg-white/80 backdrop-blur-sm",children:e.jsx(ye,{placeholder:"Select categories..."})}),e.jsxs(we,{children:[e.jsx(ce,{value:"membership",children:"Membership"}),e.jsx(ce,{value:"class-packages",children:"Class Packages"}),e.jsx(ce,{value:"merchandise",children:"Merchandise"}),e.jsx(ce,{value:"personal-training",children:"Personal Training"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"Min Amount"}),e.jsx(Re,{type:"number",placeholder:"₹0",value:b.minAmount||"",onChange:k=>o({...b,minAmount:k.target.value?Number(k.target.value):void 0}),className:"bg-white/80 backdrop-blur-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"Max Amount"}),e.jsx(Re,{type:"number",placeholder:"₹100,000",value:b.maxAmount||"",onChange:k=>o({...b,maxAmount:k.target.value?Number(k.target.value):void 0}),className:"bg-white/80 backdrop-blur-sm"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-slate-200/50",children:[e.jsx(G,{onClick:w,className:"flex-1 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700",children:"Apply Filters"}),e.jsxs(G,{onClick:y,variant:"outline",className:"gap-2",children:[e.jsx(yt,{className:"w-4 h-4"}),"Reset"]})]})]})})]}),V>0&&e.jsx(z,{className:"pt-0 pb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(r.dateRange.start||r.dateRange.end)&&e.jsxs(L,{variant:"secondary",className:"gap-1",children:["Date: ",r.dateRange.start||"..."," to ",r.dateRange.end||"...",e.jsx(pe,{className:"w-3 h-3 cursor-pointer hover:text-red-500",onClick:()=>A("dateRange","")})]}),r.category?.map(k=>e.jsxs(L,{variant:"secondary",className:"gap-1",children:["Category: ",k,e.jsx(pe,{className:"w-3 h-3 cursor-pointer hover:text-red-500",onClick:()=>A("category",k)})]},k)),r.paymentMethod?.map(k=>e.jsxs(L,{variant:"secondary",className:"gap-1",children:["Payment: ",k,e.jsx(pe,{className:"w-3 h-3 cursor-pointer hover:text-red-500",onClick:()=>A("paymentMethod",k)})]},k)),r.soldBy?.map(k=>e.jsxs(L,{variant:"secondary",className:"gap-1",children:["Sold by: ",k,e.jsx(pe,{className:"w-3 h-3 cursor-pointer hover:text-red-500",onClick:()=>A("soldBy",k)})]},k)),(r.minAmount||r.maxAmount)&&e.jsxs(L,{variant:"secondary",className:"gap-1",children:["Amount: ₹",r.minAmount||0," - ₹",r.maxAmount||"∞",e.jsx(pe,{className:"w-3 h-3 cursor-pointer hover:text-red-500",onClick:()=>T({...r,minAmount:void 0,maxAmount:void 0})})]})]})})]})},vs=({data:r,onRowClick:T})=>{const[j,R]=P.useState("product"),[M,v]=P.useState(!1),[N,l]=P.useState(null),[u,b]=P.useState(!1),o=g=>{const x=r.reduce((n,c)=>{let m="";switch(g){case"product":m=c.cleanedProduct;break;case"category":m=c.cleanedCategory;break;case"member":m=c.customerName;break;case"seller":m=c.soldBy;break}return n[m]||(n[m]={name:m,totalValue:0,unitsSold:0,transactions:0,uniqueMembers:new Set,atv:0,auv:0,asv:0,upt:0}),n[m].totalValue+=c.paymentValue,n[m].unitsSold+=1,n[m].transactions+=1,n[m].uniqueMembers.add(c.memberId),n},{});return Object.values(x).forEach(n=>{const c=n.uniqueMembers.size;n.uniqueMembers=c,n.atv=n.transactions>0?n.totalValue/n.transactions:0,n.auv=n.unitsSold>0?n.totalValue/n.unitsSold:0,n.asv=c>0?n.totalValue/c:0,n.upt=n.transactions>0?n.unitsSold/n.transactions:0}),Object.values(x).sort((n,c)=>c.totalValue-n.totalValue)},w=g=>{switch(g){case"product":return{icon:De,label:"Products",description:"Individual product performance"};case"category":return{icon:dt,label:"Categories",description:"Category-wise performance"};case"member":return{icon:Q,label:"Members",description:"Customer spending patterns"};case"seller":return{icon:tt,label:"Associates",description:"Sales representative performance"};default:return{icon:De,label:"Products",description:"Performance data"}}},y=(g,x,n)=>{const c=w(n);return c.icon,e.jsxs(F,{className:"bg-gradient-to-br from-white via-slate-50/50 to-white border-0 shadow-xl hover:shadow-2xl transition-all duration-500",children:[e.jsx(K,{className:"pb-4",children:e.jsx(W,{className:"flex items-center gap-3 text-xl",children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500",children:e.jsx(He,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsxs("span",{className:"bg-gradient-to-r from-yellow-600 to-orange-600 bg-clip-text text-transparent",children:["Top ",S," ",c.label]}),e.jsx("p",{className:"text-sm text-slate-600 font-normal",children:c.description})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-r from-red-400 to-rose-500",children:e.jsx(Be,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsxs("span",{className:"bg-gradient-to-r from-red-600 to-rose-600 bg-clip-text text-transparent",children:["Bottom ",S," ",c.label]}),e.jsx("p",{className:"text-sm text-slate-600 font-normal",children:"Areas for improvement"})]})]})})}),e.jsxs(z,{className:"space-y-4",children:[g.map((m,d)=>e.jsxs("div",{className:"group flex items-center justify-between p-4 rounded-xl bg-white shadow-sm border hover:shadow-md transition-all duration-300 cursor-pointer",onClick:()=>{const s=r.filter(i=>{switch(n){case"product":return i.cleanedProduct===m.name;case"category":return i.cleanedCategory===m.name;case"member":return i.customerName===m.name;case"seller":return i.soldBy===m.name;default:return!1}});T?.({...m,rawData:s,filteredTransactionData:s,type:n,title:m.name,name:m.name,grossRevenue:m.totalValue,totalRevenue:m.totalValue,totalValue:m.totalValue,totalCurrent:m.totalValue,metricValue:m.totalValue,transactions:m.transactions,totalTransactions:m.transactions,uniqueMembers:m.uniqueMembers,totalCustomers:m.uniqueMembers,totalChange:12.5,months:{},monthlyValues:{},isDynamic:!0,calculatedFromFiltered:!0})},children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:te("w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold shadow-sm",x?"bg-gradient-to-r from-green-400 to-emerald-600 text-white":"bg-gradient-to-r from-red-400 to-rose-600 text-white"),children:d+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-slate-900 whitespace-normal break-words group-hover:text-blue-600 transition-colors",children:m.name}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsxs(L,{variant:"secondary",className:"text-xs bg-blue-50 text-blue-700 border-blue-200",children:[D(m.transactions)," txns"]}),e.jsxs(L,{variant:"outline",className:"text-xs border-purple-200 text-purple-700",children:["ATV: ",_(m.atv)]}),e.jsxs(L,{variant:"outline",className:"text-xs border-green-200 text-green-700",children:["AUV: ",_(m.auv)]}),e.jsxs(L,{variant:"outline",className:"text-xs border-orange-200 text-orange-700",children:["ASV: ",_(m.asv)]}),e.jsxs(L,{variant:"outline",className:"text-xs border-slate-200 text-slate-700",children:["UPT: ",m.upt.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-xl text-slate-900 group-hover:text-blue-600 transition-colors",children:_(m.totalValue)}),e.jsxs("p",{className:"text-sm text-slate-500",children:[D(m.unitsSold)," units"]}),e.jsxs("p",{className:"text-xs text-slate-400",children:[D(m.uniqueMembers)," customers"]}),e.jsxs(G,{variant:"ghost",size:"sm",className:"mt-1 opacity-0 group-hover:opacity-100 transition-all duration-300 hover:bg-blue-50 hover:text-blue-600 hover:shadow-sm",onClick:s=>{s.stopPropagation();const i=r.filter(h=>{switch(n){case"product":return h.cleanedProduct===m.name;case"category":return h.cleanedCategory===m.name;case"member":return h.customerName===m.name;case"seller":return h.soldBy===m.name;default:return!1}}),a={...m,rawData:i,filteredTransactionData:i,type:n,title:m.name,name:m.name,grossRevenue:m.totalValue,totalValue:m.totalValue,totalCurrent:m.totalValue,metricValue:m.totalValue,transactions:m.transactions,totalTransactions:m.transactions,uniqueMembers:m.uniqueMembers,totalCustomers:m.uniqueMembers,totalChange:0,months:{},monthlyValues:{}};l(a),b(!0)},children:[e.jsx(wt,{className:"w-3 h-3 mr-1"}),"View Analytics"]})]})]},m.name)),e.jsxs("div",{className:"mt-6 p-4 bg-gradient-to-r from-slate-50 to-slate-100 rounded-lg border",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h4",{className:"font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4"}),"Performance Summary"]}),e.jsxs(G,{variant:"outline",size:"sm",onClick:()=>v(!M),className:"text-xs",children:["Show ",M?"Less":"More"]})]}),e.jsxs("ul",{className:"text-sm text-slate-600 space-y-1",children:[e.jsxs("li",{children:["• Average revenue: ",_(g.reduce((m,d)=>m+d.totalValue,0)/g.length)]}),e.jsxs("li",{children:["• Total transactions: ",D(g.reduce((m,d)=>m+d.transactions,0))]}),e.jsxs("li",{children:["• Combined customer reach: ",D(g.reduce((m,d)=>m+d.uniqueMembers,0))," unique customers"]}),e.jsxs("li",{children:["• Performance spread: ",((g[0]?.totalValue/g[g.length-1]?.totalValue||1)-1).toFixed(1),"x variance"]})]})]})]})]})},A=o(j),S=M?10:5,V=A.slice(0,S),k=A.slice(-S).reverse();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(F,{className:"bg-gradient-to-br from-white via-slate-50/20 to-white border-0 shadow-xl",children:[e.jsx(K,{className:"pb-4",children:e.jsx(W,{className:"text-2xl font-bold bg-gradient-to-r from-slate-700 via-slate-800 to-slate-900 bg-clip-text text-transparent",children:"Performance Analysis"})}),e.jsx(z,{children:e.jsxs(ze,{value:j,onValueChange:R,className:"w-full",children:[e.jsxs(Ee,{className:"grid w-full grid-cols-4 bg-gradient-to-r from-blue-50 via-purple-50 to-blue-50 p-2 rounded-2xl shadow-lg border border-slate-200/30",children:[e.jsxs(H,{value:"product",className:"text-sm font-bold transition-all duration-300 data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-purple-600 data-[state=active]:text-white data-[state=active]:shadow-lg rounded-xl",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"Products"]}),e.jsxs(H,{value:"category",className:"text-sm font-bold transition-all duration-300 data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-purple-600 data-[state=active]:text-white data-[state=active]:shadow-lg rounded-xl",children:[e.jsx(dt,{className:"w-4 h-4 mr-2"}),"Categories"]}),e.jsxs(H,{value:"member",className:"text-sm font-bold transition-all duration-300 data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-purple-600 data-[state=active]:text-white data-[state=active]:shadow-lg rounded-xl",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Members"]}),e.jsxs(H,{value:"seller",className:"text-sm font-bold transition-all duration-300 data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-purple-600 data-[state=active]:text-white data-[state=active]:shadow-lg rounded-xl",children:[e.jsx(tt,{className:"w-4 h-4 mr-2"}),"Associates"]})]}),e.jsx(se,{value:j,className:"mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[y(V,!0,j),y(k,!1,j)]})})]})})]}),e.jsx(ts,{isOpen:u,onClose:()=>b(!1),data:N})]})},Ze=({value:r,onValueChange:T,className:j=""})=>e.jsx(ze,{value:r,onValueChange:T,className:j,children:e.jsxs(Ee,{className:"grid w-full grid-cols-3 lg:grid-cols-11 bg-white border border-gray-200 p-1 rounded-xl shadow-sm h-auto gap-1",children:[e.jsx(H,{value:"revenue",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"Revenue"}),e.jsx(H,{value:"units",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"Units Sold"}),e.jsx(H,{value:"transactions",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"Transactions"}),e.jsx(H,{value:"members",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"Members"}),e.jsx(H,{value:"auv",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"AUV"}),e.jsx(H,{value:"atv",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"ATV"}),e.jsx(H,{value:"asv",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"ASV"}),e.jsx(H,{value:"upt",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"UPT"}),e.jsx(H,{value:"vat",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"VAT"}),e.jsx(H,{value:"discountValue",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"Discount ₹"}),e.jsx(H,{value:"discountPercentage",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"Discount %"})]})}),rs=r=>r.reduce((T,j)=>{const R=j.cleanedCategory||"Uncategorized",M=j.cleanedProduct||"Unspecified";return T[R]||(T[R]={}),T[R][M]||(T[R][M]=[]),T[R][M].push(j),T},{}),Ns=({data:r,filters:T={dateRange:{start:"",end:""},location:[],category:[],product:[],soldBy:[],paymentMethod:[]},onRowClick:j,collapsedGroups:R=new Set,onGroupToggle:M=()=>{},selectedMetric:v="revenue"})=>{const[N,l]=P.useState(v),[u,b]=P.useState(!1),[o,w]=P.useState(new Set),[y,A]=P.useState(!1),S=s=>{if(!s)return null;const i=s.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(i){const[,h,t,p]=i;return new Date(parseInt(p),parseInt(t)-1,parseInt(h))}const a=new Date(s);return isNaN(a.getTime())?null:a},V=(s,i)=>{if(!s.length)return 0;const a=s.reduce((I,O)=>I+(O.paymentValue||0),0),h=s.length,t=new Set(s.map(I=>I.memberId)).size,p=s.length,f=s.reduce((I,O)=>I+(O.discountAmount||0),0),C=s.length>0?s.reduce((I,O)=>I+(O.discountPercentage||0),0)/s.length:0;switch(i){case"revenue":return a;case"transactions":return h;case"members":return t;case"units":return p;case"atv":return h>0?a/h:0;case"auv":return t>0?a/t:0;case"asv":return new Set(s.map($=>$.saleItemId)).size>0?a/new Set(s.map($=>$.saleItemId)).size:0;case"upt":const I=s.length,O=new Set(s.map($=>$.paymentTransactionId)).size;return O>0?I/O:0;case"vat":return s.reduce(($,Y)=>$+(Y.paymentVAT||0),0);case"netRevenue":const q=a,E=s.reduce(($,Y)=>$+(Y.paymentVAT||0),0);return q-E;case"discountValue":return f;case"discountPercentage":return C;default:return 0}},k=(s,i)=>{switch(i){case"revenue":case"auv":case"asv":case"atv":case"vat":case"netRevenue":case"discountValue":return _(s);case"transactions":case"members":case"units":return D(s);case"upt":return s.toFixed(2);case"discountPercentage":return`${s.toFixed(1)}%`;default:return D(s)}},g=(s,i)=>i===0&&s===0?null:i===0?"+100":((s-i)/i*100).toFixed(1),x=P.useMemo(()=>Array.isArray(r)?r.filter(s=>!(T?.location?.length>0&&!T.location.includes(s.calculatedLocation)||T?.category?.length>0&&!T.category.includes(s.cleanedCategory)||T?.product?.length>0&&!T.product.includes(s.cleanedProduct)||T?.soldBy?.length>0&&!T.soldBy.includes(s.soldBy)||T?.paymentMethod?.length>0&&!T.paymentMethod.includes(s.paymentMethod)||T?.minAmount!==void 0&&s.paymentValue<T.minAmount||T?.maxAmount!==void 0&&s.paymentValue>T.maxAmount)):[],[r,T]),n=P.useMemo(()=>{const s=[],i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];for(let a=7;a>=0;a--){const h=i[a],t=a+1;s.push({key:`2024-${String(t).padStart(2,"0")}`,display:`${h} 2024`,year:2024,month:t,sortOrder:(5-a)*2}),s.push({key:`2025-${String(t).padStart(2,"0")}`,display:`${h} 2025`,year:2025,month:t,sortOrder:(5-a)*2+1})}return s},[]),c=P.useMemo(()=>{const s=rs(x),i=Object.entries(s).map(([a,h])=>{const t={category:a,products:Object.entries(h).map(([f,C])=>{const I={};n.forEach(({key:E,year:$,month:Y})=>{const Z=C.filter(ee=>{const X=S(ee.paymentDate);return X&&X.getFullYear()===$&&X.getMonth()+1===Y});I[E]=V(Z,N)});const O=Object.values(I).filter(E=>E>0),q={atv:O.length>0?O.reduce((E,$)=>E+$,0)/O.length:0,auv:O.length>0?O.reduce((E,$)=>E+$,0)/O.length:0,asv:O.length>0?O.reduce((E,$)=>E+$,0)/O.length:0,upt:O.length>0?O.reduce((E,$)=>E+$,0)/O.length:0};return{product:f,monthlyValues:I,rawData:C,averages:q}})},p={};return n.forEach(({key:f})=>{p[f]=t.products.reduce((C,I)=>C+(I.monthlyValues[f]||0),0)}),{...t,monthlyValues:p}});return!y&&i.length>0&&(w(new Set),A(!0)),i},[x,N,n,y]),m=P.useCallback(()=>{window.location.reload()},[]);P.useCallback(()=>{const s=c.map(t=>{const p=[t.category,...n.map(({key:C})=>k(t.monthlyValues[C]||0,N))].join(","),f=t.products.map(C=>[`  ${C.product}`,...n.map(({key:I})=>k(C.monthlyValues[I]||0,N))].join(","));return[p,...f].join(`
`)}).join(`
`),i=new Blob([s],{type:"text/csv"}),a=window.URL.createObjectURL(i),h=document.createElement("a");h.href=a,h.download=`year-on-year-${N}-data.csv`,h.click()},[c,n,N]),P.useCallback(s=>{},[]);const d=P.useCallback(s=>{const i=new Set(o);i.has(s)?i.delete(s):i.add(s),w(i)},[o]);return e.jsxs(F,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(W,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-blue-600"}),"Year-on-Year Performance Analysis"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Monthly comparison between 2024 and 2025 with alternating year display"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(G,{variant:"outline",size:"sm",onClick:m,className:"flex items-center gap-2 hover:bg-purple-50 hover:text-purple-700",children:[e.jsx(yt,{className:"w-4 h-4"}),"Refresh"]})})]}),e.jsx(Ze,{value:N,onValueChange:l,className:"w-full"})]})}),e.jsx(z,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border-t border-gray-200 rounded-lg",children:[e.jsx("thead",{className:"bg-gradient-to-r from-purple-700 to-purple-900 text-white font-semibold text-sm uppercase tracking-wider sticky top-0 z-30",children:e.jsxs("tr",{className:"bg-gradient-to-r from-blue-800 to-indigo-900 text-white font-semibold text-sm uppercase tracking-wider",children:[e.jsx("th",{className:"bg-gradient-to-r from-blue-800 to-blue-800 text-white font-semibold text-sm uppercase tracking-wider px-4 py-2 sticky left-0 z-40",children:"Product/Category"}),n.map(({key:s,display:i,year:a})=>e.jsx("th",{className:"text-white font-semibold text-sm uppercase tracking-wider px-4 py-2",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-base",children:i.split(" ")[0]}),e.jsx("span",{className:"text-yellow-200 text-xs",children:i.split(" ")[1]})]})},s))]})}),e.jsxs("tbody",{children:[c.map(s=>e.jsxs(Ae.Fragment,{children:[e.jsxs("tr",{onClick:()=>d(s.category),className:"bg-white hover:bg-gray-100 cursor-pointer border-b border-gray-200 group transition-colors duration-200 ease-in-out",children:[e.jsx("td",{className:"py-2 font-semibold text-gray-800 group-hover:text-gray-900 bg-white group-hover:bg-gray-100 sticky left-0 z-20 transition-colors duration-200 ease-in-out px-[10px] min-w-80 text-sm max-h-[35px] h-[35px] overflow-hidden",children:e.jsxs("div",{className:"flex justify-between items-center min-w-full text-md text-bold",children:[o.has(s.category)?e.jsx(rt,{className:"w-4 h-4 mr-2 text-gray-500 transition-transform duration-200"}):e.jsx(Ge,{className:"w-4 h-4 mr-2 text-gray-500 transition-transform duration-200"}),s.category,e.jsxs(L,{variant:"secondary",className:"ml-auto text-sm text-yellow-300 min-w-12 bg-slate-950 rounded-xl",children:[s.products.length," products"]})]})}),n.map(({key:i,year:a,month:h,display:t},p)=>{const f=s.monthlyValues[i]||0,C=p>0&&s.monthlyValues[n[p-1].key]||0,I=g(f,C);return e.jsx("td",{className:"px-4 py-2 text-center font-semibold text-gray-900 text-sm hover:bg-blue-100 cursor-pointer transition-colors max-h-[35px] h-[35px] overflow-hidden",title:I?`${I}% vs last year`:"",onClick:O=>{O.stopPropagation();const q=r.filter(ee=>{const X=S(ee.paymentDate);if(!X)return!1;const de=ee.cleanedCategory===s.category,ge=X.getFullYear()===a&&X.getMonth()+1===h;return de&&ge}),E=q.reduce((ee,X)=>ee+(X.paymentValue||0),0),$=q.length,Y=new Set(q.map(ee=>ee.memberId||ee.customerEmail)).size,Z={name:`${s.category} - ${t}`,category:s.category,totalRevenue:E,grossRevenue:E,netRevenue:E,totalValue:E,totalCurrent:E,metricValue:E,transactions:$,totalTransactions:$,uniqueMembers:Y,totalCustomers:Y,rawData:q,filteredTransactionData:q,isDynamic:!0,calculatedFromFiltered:!0,isGroupCell:!0,cellSpecific:!0,month:t,monthKey:i};j&&j(Z)},children:k(s.monthlyValues[i]||0,N)},i)})]}),!o.has(s.category)&&s.products.map(i=>e.jsxs("tr",{className:"hover:bg-blue-50 cursor-pointer border-b border-gray-100 transition-colors duration-200",onClick:()=>j&&j(i.rawData),children:[e.jsx("td",{className:"px-8 py-3 text-sm text-gray-700 hover:text-blue-700 sticky left-0 bg-white hover:bg-blue-50 z-10 transition-colors duration-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:i.product}),["atv","auv","asv","upt"].includes(N)&&e.jsxs(L,{variant:"outline",className:"text-xs ml-2 border-blue-200 text-blue-700",children:["Avg: ",k(i.averages[N]||0,N)]})]})}),n.map(({key:a,year:h,month:t,display:p})=>e.jsx("td",{className:"px-4 py-3 text-center text-sm text-gray-900 font-mono hover:bg-blue-50 cursor-pointer transition-colors",onClick:f=>{f.stopPropagation();const C=(Array.isArray(i.rawData)?i.rawData:[]).filter($=>{const Y=S($.paymentDate);return Y?Y.getFullYear()===h&&Y.getMonth()+1===t:!1}),I=C.reduce(($,Y)=>$+(Y.paymentValue||0),0),O=C.length,q=new Set(C.map($=>$.memberId||$.customerEmail)).size,E={...i,name:`${i.product} - ${p}`,totalRevenue:I,grossRevenue:I,netRevenue:I,totalValue:I,totalCurrent:I,metricValue:I,transactions:O,totalTransactions:O,uniqueMembers:q,totalCustomers:q,rawData:C,filteredTransactionData:C,isDynamic:!0,calculatedFromFiltered:!0,cellSpecific:!0,month:p,monthKey:a};j&&j(E)},children:k(i.monthlyValues[a]||0,N)},a))]},`${s.category}-${i.product}`)),e.jsxs("tr",{className:"bg-gradient-to-r from-blue-100 to-indigo-100 border-t-2 border-blue-300 font-bold",children:[e.jsxs("td",{className:"px-8 py-3 text-sm font-bold text-blue-900 sticky left-0 bg-gradient-to-r from-blue-100 to-indigo-100 z-10",children:[s.category," TOTAL"]}),n.map(({key:i})=>e.jsx("td",{className:"px-4 py-3 text-center text-sm text-blue-900 font-mono font-bold",children:k(s.monthlyValues[i]||0,N)},i))]})]},s.category)),e.jsxs("tr",{className:"bg-gradient-to-r from-emerald-500 via-teal-600 to-emerald-500 text-white border-t-4 border-emerald-700",children:[e.jsx("td",{className:"px-8 py-3 text-sm font-bold sticky left-0 bg-gradient-to-r from-emerald-500 to-teal-600 z-10",children:"GRAND TOTAL"}),n.map(({key:s})=>{const i=c.reduce((a,h)=>a+(h.monthlyValues[s]||0),0);return e.jsx("td",{className:"px-4 py-3 text-center text-sm font-mono font-bold",children:k(i,N)},s)})]})]})]})})})]})},ys=({data:r,filters:T={dateRange:{start:"",end:""},location:[],category:[],product:[],soldBy:[],paymentMethod:[]},onRowClick:j,collapsedGroups:R,onGroupToggle:M,selectedMetric:v="revenue"})=>{const[N,l]=P.useState(v),[u,b]=P.useState(!1),[o,w]=P.useState(`• Month-on-month analysis shows seasonal patterns
• Strong performance in peak months with growth opportunities identified
• Consistent upward trend in key metrics`),[y,A]=P.useState(new Set);Ae.useEffect(()=>{A(new Set)},[]);const S=h=>{if(!h)return null;const t=h.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(t){const[,f,C,I]=t;return new Date(parseInt(I),parseInt(C)-1,parseInt(f))}const p=new Date(h);return isNaN(p.getTime())?null:p},V=(h,t)=>{if(!h.length)return 0;const p=h.reduce((E,$)=>E+($.paymentValue||0),0),f=h.length,C=new Set(h.map(E=>E.memberId)).size,I=h.length,O=h.reduce((E,$)=>E+($.discountAmount||0),0),q=h.length>0?h.reduce((E,$)=>E+($.discountPercentage||0),0)/h.length:0;switch(t){case"revenue":return p;case"transactions":return f;case"members":return C;case"units":return I;case"atv":return f>0?p/f:0;case"auv":return I>0?p/I:0;case"asv":return C>0?p/C:0;case"upt":return f>0?I/f:0;case"vat":return h.reduce((E,$)=>E+($.paymentVAT||0),0);case"discountValue":return O;case"discountPercentage":return q;default:return 0}},k=(h,t)=>{switch(t){case"revenue":case"auv":case"atv":case"asv":case"vat":return _(h);case"transactions":case"members":case"units":return D(h);case"upt":return h.toFixed(2);default:return D(h)}};P.useCallback((h,t)=>{},[]);const g=P.useMemo(()=>{const h=[],t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],p=new Date,f=p.getFullYear(),C=p.getMonth();for(let I=17;I>=0;I--){const O=new Date(f,C-I,1),q=O.getFullYear(),E=O.getMonth(),$=t[E],Y=E+1;h.push({key:`${q}-${String(Y).padStart(2,"0")}`,display:`${$} ${q}`,year:q,month:Y,quarter:Math.ceil(Y/3)})}return h},[]),x=P.useMemo(()=>{const h=r.reduce((p,f)=>{const C=f.cleanedCategory||"Uncategorized";return p[C]||(p[C]=[]),p[C].push(f),p},{});return Object.entries(h).map(([p,f])=>{const C=f.reduce((q,E)=>{const $=E.cleanedProduct||"Unspecified";return q[$]||(q[$]=[]),q[$].push(E),q},{}),I=Object.entries(C).map(([q,E])=>{const $={};g.forEach(({key:Z,year:ee,month:X})=>{const de=E.filter(ge=>{const re=S(ge.paymentDate);return re&&re.getFullYear()===ee&&re.getMonth()+1===X});$[Z]=V(de,N)});const Y=V(E,N);return{product:q,category:p,metricValue:Y,monthlyValues:$,rawData:E}}),O={};return g.forEach(({key:q})=>{O[q]=I.reduce((E,$)=>E+($.monthlyValues[q]||0),0)}),{category:p,products:I.sort((q,E)=>E.metricValue-q.metricValue),metricValue:V(f,N),monthlyValues:O,rawData:f}}).sort((p,f)=>f.metricValue-p.metricValue)},[r,N,g]),n=(h,t)=>t===0&&h===0?null:t===0?"+100":((h-t)/t*100).toFixed(1),c=P.useMemo(()=>{const h={};return g.forEach(({key:t})=>{h[t]=x.reduce((p,f)=>p+(f.monthlyValues[t]||0),0)}),{category:"TOTAL",metricValue:V(r,N),monthlyValues:h}},[x,g,r,N]),m=()=>{b(!1),localStorage.setItem("monthOnMonthSummary",o)},d=()=>{b(!1);const h=localStorage.getItem("monthOnMonthSummary");h&&w(h)},s=P.useMemo(()=>{const h={};return g.forEach(t=>{const p=`${t.year}-Q${t.quarter}`;h[p]||(h[p]=[]),h[p].push(t)}),h},[g]),i=h=>{const t=new Set(y);t.has(h)?t.delete(h):t.add(h),A(t)},a=h=>{const t=h.rawData||[],p=t.reduce((O,q)=>O+(q.paymentValue||0),0),f=t.length,C=new Set(t.map(O=>O.memberId||O.customerEmail)).size,I={...h,title:h.product,name:h.product,type:"product",totalRevenue:p,grossRevenue:p,netRevenue:p,totalValue:p,totalCurrent:p,metricValue:p,transactions:f,totalTransactions:f,uniqueMembers:C,totalCustomers:C,months:h.monthlyValues,monthlyValues:h.monthlyValues,rawData:t,filteredTransactionData:t,isDynamic:!0,calculatedFromFiltered:!0};j(I)};return e.jsxs(F,{className:"bg-gradient-to-br from-blue-50 via-blue-100 to-blue-200 border-0 shadow-2xl rounded-2xl",children:[e.jsx(K,{className:"pb-4 bg-gradient-to-r from-blue-700 to-blue-900 rounded-t-2xl shadow-md",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsxs(W,{className:"font-bold flex items-center gap-2 text-white text-2xl",children:[e.jsx(ae,{className:"w-5 h-5 text-blue-600 bg-yellow-300"}),"Product Month-on-Month Analysis"]}),e.jsx("p",{className:"mt-1 font-semibold text-left text-sm text-amber-300",children:"Monthly performance metrics by product (Last 18 months from current date)"})]})}),e.jsx(Ze,{value:N,onValueChange:l,className:"w-full"})]})}),e.jsxs(z,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto rounded-b-2xl",children:e.jsxs("table",{className:"min-w-full bg-white border-t border-blue-200 rounded-b-2xl shadow-md",children:[e.jsxs("thead",{className:"bg-gradient-to-r from-blue-700 to-blue-900 text-white font-semibold text-sm uppercase tracking-wider sticky top-0 z-30",children:[e.jsxs("tr",{className:"bg-gradient-to-r from-blue-700 to-blue-900 text-white font-semibold text-sm uppercase tracking-wider",children:[e.jsx("th",{rowSpan:2,className:"text-white font-semibold uppercase tracking-wider px-6 py-3 text-left rounded-tl-lg sticky left-0 bg-blue-800 z-40 max-h-[35px] h-[35px]",children:"Category / Product"}),Object.entries(s).map(([h,t])=>e.jsx("th",{colSpan:t.length,className:"text-white font-semibold text-sm uppercase tracking-wider px-4 py-2 text-center border-l border-blue-600",children:h},h))]}),e.jsx("tr",{children:g.map(({key:h,display:t})=>e.jsx("th",{className:"text-white font-semibold text-xs uppercase tracking-wider px-3 py-2 bg-blue-800 border-l border-blue-600 max-h-[35px] h-[35px]",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm",children:t.split(" ")[0]}),e.jsx("span",{className:"text-blue-200 text-xs",children:t.split(" ")[1]})]})},h))})]}),e.jsxs("tbody",{children:[x.map((h,t)=>e.jsxs(Ae.Fragment,{children:[e.jsxs("tr",{className:"bg-gradient-to-r from-gray-100 to-gray-200 border-b-2 border-gray-300 font-bold max-h-[35px] h-[35px]",children:[e.jsx("td",{className:"text-sm font-bold text-gray-800 sticky left-0 bg-gradient-to-r from-gray-100 to-gray-200 border-r border-gray-300 z-20 hover:bg-blue-100 cursor-pointer transition-colors max-h-[35px] h-[35px] overflow-hidden",onClick:p=>{if(p.target.closest("button"))return;const C=r.filter($=>$.cleanedCategory===C.category),I=C.reduce(($,Y)=>$+(Y.paymentValue||0),0),O=C.length,q=new Set(C.map($=>$.memberId||$.customerEmail)).size,E={name:`${C.category} - All Months`,category:C.category,totalRevenue:I,grossRevenue:I,netRevenue:I,totalValue:I,totalCurrent:I,metricValue:I,transactions:O,totalTransactions:O,uniqueMembers:q,totalCustomers:q,rawData:C,filteredTransactionData:C,isDynamic:!0,calculatedFromFiltered:!0,isGroup:!0};j(E)},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(G,{variant:"ghost",size:"sm",onClick:()=>i(h.category),className:"p-1 h-6 w-6 text-gray-600 hover:text-gray-800",children:y.has(h.category)?e.jsx(rt,{className:"w-4 h-4"}):e.jsx(Ge,{className:"w-4 h-4"})}),e.jsxs("span",{className:"font-bold",children:["#",t+1," ",h.category]}),e.jsxs(L,{variant:"outline",className:"text-xs bg-gray-900 rounded-md text-yellow-300",children:[h.products.length," products"]})]})}),g.map(({key:p,year:f,month:C,display:I},O)=>{const q=h.monthlyValues[p]||0,E=O>0&&h.monthlyValues[g[O-1].key]||0,$=n(q,E);return e.jsx("td",{className:"px-3 py-3 text-center text-sm text-gray-800 font-mono font-bold border-l border-gray-300 hover:bg-blue-100 cursor-pointer transition-colors max-h-[35px] h-[35px]",title:$?`${$}% vs last month`:"",onClick:Y=>{Y.stopPropagation();const Z=r.filter(re=>{const le=S(re.paymentDate);if(!le)return!1;const ie=re.cleanedCategory===h.category,xe=le.getFullYear()===f&&le.getMonth()+1===C;return ie&&xe}),ee=Z.reduce((re,le)=>re+(le.paymentValue||0),0),X=Z.length,de=new Set(Z.map(re=>re.memberId||re.customerEmail)).size,ge={name:`${h.category} - ${I}`,category:h.category,totalRevenue:ee,grossRevenue:ee,netRevenue:ee,totalValue:ee,totalCurrent:ee,metricValue:ee,transactions:X,totalTransactions:X,uniqueMembers:de,totalCustomers:de,rawData:Z,filteredTransactionData:Z,isDynamic:!0,calculatedFromFiltered:!0,isGroupCell:!0,cellSpecific:!0,month:I,monthKey:p};j(ge)},children:e.jsx("div",{className:"flex items-center justify-center",children:k(q,N)})},p)})]}),!y.has(h.category)&&h.products.map((p,f)=>e.jsxs("tr",{onClick:()=>a(p),className:"hover:bg-gray-100/60 cursor-pointer border-b border-gray-100 transition-colors duration-200 group",children:[e.jsx("td",{className:"px-2 py-2 text-sm font-medium text-gray-900 sticky left-0 bg-white border-r border-gray-200 min-w-96 z-10 max-h-[35px] h-[35px] overflow-hidden",children:e.jsxs("div",{className:"flex items-center gap-2 pl-8",children:[e.jsxs("span",{className:"text-gray-500",children:["#",f+1]}),e.jsx("span",{className:"whitespace-normal break-words font-semibold group-hover:text-blue-700 transition-all duration-150",children:p.product})]})}),g.map(({key:C,year:I,month:O,display:q},E)=>{const $=p.monthlyValues[C]||0,Y=E>0&&p.monthlyValues[g[E-1].key]||0,Z=n($,Y);return e.jsx("td",{className:"px-3 py-3 text-center text-sm text-gray-900 font-mono border-l border-gray-100 hover:bg-blue-50 cursor-pointer transition-colors max-h-[35px] h-[35px] overflow-hidden",title:Z?`${Z}% vs last month`:"",onClick:ee=>{ee.stopPropagation();const X=(p.rawData||[]).filter(ie=>{const xe=S(ie.paymentDate);return xe?xe.getFullYear()===I&&xe.getMonth()+1===O:!1}),de=X.reduce((ie,xe)=>ie+(xe.paymentValue||0),0),ge=X.length,re=new Set(X.map(ie=>ie.memberId||ie.customerEmail)).size,le={...p,name:`${p.product} - ${q}`,totalRevenue:de,grossRevenue:de,netRevenue:de,totalValue:de,totalCurrent:de,metricValue:de,transactions:ge,totalTransactions:ge,uniqueMembers:re,totalCustomers:re,rawData:X,filteredTransactionData:X,isDynamic:!0,calculatedFromFiltered:!0,cellSpecific:!0,month:q,monthKey:C};j&&j(le)},children:e.jsx("div",{className:"flex items-center justify-center",children:k($,N)})},C)})]},`${h.category}-${p.product}`))]},h.category)),e.jsxs("tr",{className:"bg-gradient-to-r from-blue-200 to-blue-300 border-t-4 border-gray-800 font-bold",children:[e.jsx("td",{className:"px-6 py-3 text-sm font-bold text-blue-900 sticky left-0 border-r border-blue-300 z-20 bg-slate-50 hover:bg-blue-100 cursor-pointer transition-colors",onClick:()=>{const h=r.reduce((C,I)=>C+(I.paymentValue||0),0),t=r.length,p=new Set(r.map(C=>C.memberId||C.customerEmail)).size;j({name:"All Products & Categories - Total",totalRevenue:h,grossRevenue:h,netRevenue:h,totalValue:h,totalCurrent:h,metricValue:h,transactions:t,totalTransactions:t,uniqueMembers:p,totalCustomers:p,rawData:r,filteredTransactionData:r,isDynamic:!0,calculatedFromFiltered:!0,isTotal:!0})},children:"TOTAL"}),g.map(({key:h,year:t,month:p,display:f})=>e.jsx("td",{className:"px-3 py-3 text-center text-sm text-blue-900 font-mono font-bold border-l border-gray-200 bg-white hover:bg-blue-100 cursor-pointer transition-colors",onClick:()=>{const C=r.filter($=>{const Y=S($.paymentDate);return Y?Y.getFullYear()===t&&Y.getMonth()+1===p:!1}),I=C.reduce(($,Y)=>$+(Y.paymentValue||0),0),O=C.length,q=new Set(C.map($=>$.memberId||$.customerEmail)).size,E={name:`All Products & Categories - ${f}`,totalRevenue:I,grossRevenue:I,netRevenue:I,totalValue:I,totalCurrent:I,metricValue:I,transactions:O,totalTransactions:O,uniqueMembers:q,totalCustomers:q,rawData:C,filteredTransactionData:C,isDynamic:!0,calculatedFromFiltered:!0,isTotal:!0,cellSpecific:!0,month:f,monthKey:h};j(E)},children:k(c.monthlyValues[h]||0,N)},h))]})]})]})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 bg-gradient-to-r from-slate-50 to-white rounded-b-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-blue-600"}),"Product Month-on-Month Insights"]}),u?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(G,{variant:"outline",size:"sm",onClick:m,className:"gap-2 text-green-600",children:[e.jsx(it,{className:"w-4 h-4"}),"Save"]}),e.jsxs(G,{variant:"outline",size:"sm",onClick:d,className:"gap-2 text-red-600",children:[e.jsx(pe,{className:"w-4 h-4"}),"Cancel"]})]}):e.jsxs(G,{variant:"outline",size:"sm",onClick:()=>b(!0),className:"gap-2",children:[e.jsx(lt,{className:"w-4 h-4"}),"Edit"]})]}),u?e.jsx(ct,{value:o,onChange:h=>w(h.target.value),placeholder:"Enter month-on-month insights using bullet points (• )",className:"min-h-32 text-sm"}):e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:e.jsx("div",{className:"text-sm text-gray-700 whitespace-pre-line",children:o})})]})]})]})},ws=({data:r,onRowClick:T,selectedMetric:j="revenue"})=>{const[R,M]=P.useState(j),[v,N]=P.useState(!1),[l,u]=P.useState(`• Sales team performance analysis by individual seller
• Consistent performers identified for recognition
• Training opportunities highlighted for underperformers`),b=P.useMemo(()=>{const x=[],n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],c=new Date,m=c.getFullYear(),d=c.getMonth();for(let s=17;s>=0;s--){const i=new Date(m,d-s,1),a=i.getFullYear(),h=i.getMonth()+1,t=n[i.getMonth()];x.push({key:`${a}-${String(h).padStart(2,"0")}`,display:`${t} ${a}`,year:a,month:h,quarter:Math.ceil(h/3)})}return x},[]),o=(x,n)=>{if(!x.length)return 0;const c=x.reduce((h,t)=>h+(t.paymentValue||0),0),m=x.length,d=new Set(x.map(h=>h.memberId)).size,s=x.length,i=x.reduce((h,t)=>h+(t.discountAmount||0),0),a=x.length>0?x.reduce((h,t)=>h+(t.discountPercentage||0),0)/x.length:0;switch(n){case"revenue":return c;case"transactions":return m;case"members":return d;case"units":return s;case"atv":return m>0?c/m:0;case"auv":return s>0?c/s:0;case"asv":return d>0?c/d:0;case"upt":return m>0?s/m:0;case"discountValue":return i;case"discountPercentage":return a;default:return 0}},w=(x,n)=>{switch(n){case"revenue":case"discountValue":return _(x);case"atv":case"auv":case"asv":return _(Math.round(x));case"transactions":case"members":case"units":return D(x);case"upt":return x.toFixed(1);case"discountPercentage":return`${x.toFixed(1)}%`;default:return D(x)}},y=P.useMemo(()=>{const x=r.reduce((c,m)=>{const d=m.soldBy||"Unknown";return c[d]||(c[d]=[]),c[d].push(m),c},{});return Object.entries(x).map(([c,m])=>{const d={};b.forEach(({key:O,year:q,month:E})=>{const $=m.filter(Y=>{const Z=es(Y.paymentDate);return Z?Z.getFullYear()===q&&Z.getMonth()+1===E:!1});d[O]=o($,R)});const s=o(m,R),i=m.reduce((O,q)=>O+(q.paymentValue||0),0),a=m.length,h=new Set(m.map(O=>O.memberId)).size,t=m.length,p=h>0?i/h:0,f=a>0?t/a:0,C=a>0?i/a:0,I=t>0?i/t:0;return{soldBy:c,metricValue:s,totalRevenue:i,totalTransactions:a,uniqueMembers:h,units:t,asv:p,upt:f,atv:C,auv:I,monthlyValues:d,rawData:m,name:c,grossRevenue:i,netRevenue:i,totalValue:i,totalCurrent:i,totalCustomers:h,totalChange:b.length>=2?((d[b[b.length-1].key]||0)-(d[b[b.length-2].key]||0))/(d[b[b.length-2].key]||1)*100:0,months:b.reduce((O,{key:q,display:E})=>(O[E]={current:d[q]||0,change:0},O),{})}}).sort((c,m)=>m.metricValue-c.metricValue)},[r,R,b]),A=(x,n)=>{if(n===0&&x===0)return null;if(n===0)return e.jsx(oe,{className:"w-3 h-3 text-green-500 inline ml-1"});const c=(x-n)/n*100;return c>5?e.jsx(oe,{className:"w-3 h-3 text-green-500 inline ml-1"}):c<-5?e.jsx(Oe,{className:"w-3 h-3 text-red-500 inline ml-1"}):null},S=x=>e.jsx(L,{className:"text-blue-900 text-xs min-w-40 h-6 flex items-center justify-center bg-indigo-50",children:x}),V=P.useMemo(()=>{const x={};b.forEach(({key:t})=>{x[t]=y.reduce((p,f)=>p+(f.monthlyValues[t]||0),0)});const n=y.reduce((t,p)=>t+p.totalRevenue,0),c=y.reduce((t,p)=>t+p.totalTransactions,0),m=new Set(r.map(t=>t.memberId)).size,d=y.reduce((t,p)=>t+p.units,0),s=m>0?n/m:0,i=c>0?d/c:0,a=c>0?n/c:0,h=d>0?n/d:0;return{soldBy:"TOTAL",metricValue:o(r,R),totalRevenue:n,totalTransactions:c,asv:s,upt:i,atv:a,auv:h,monthlyValues:x}},[y,b,r,R]),k=()=>{N(!1),localStorage.setItem("soldByMonthOnMonthSummary",l)},g=()=>{N(!1);const x=localStorage.getItem("soldByMonthOnMonthSummary");x&&u(x)};return e.jsxs(F,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl rounded-xl",children:[e.jsx(K,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsxs(W,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5 text-blue-600"}),"Sales Associate Month-on-Month Analysis"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Monthly performance metrics by sales associate (",r.length," total records)"]})]})}),e.jsx(Ze,{value:R,onValueChange:M,className:"w-full"})]})}),e.jsxs(z,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto rounded-lg",children:e.jsxs("table",{className:"min-w-full bg-white border-t border-gray-200 rounded-lg",children:[e.jsx("thead",{className:"bg-gradient-to-r from-blue-700 to-blue-900 text-white font-semibold text-sm uppercase tracking-wider sticky top-0 z-20",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-white font-semibold uppercase tracking-wider px-6 py-3 text-left rounded-tl-lg sticky left-0 bg-blue-800 z-30",children:"Sales Associate"}),e.jsx("th",{className:"text-white font-semibold text-xs uppercase tracking-wider px-3 py-2 bg-blue-800 min-w-24",children:"Contribution %"}),b.map(({key:x,display:n})=>e.jsx("th",{className:"text-white font-semibold text-xs uppercase tracking-wider px-3 py-2 bg-blue-800 border-l border-blue-600 min-w-32",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm",children:n.split(" ")[0]}),e.jsx("span",{className:"text-blue-200 text-xs",children:n.split(" ")[1]})]})},x))]})}),e.jsxs("tbody",{children:[y.map((x,n)=>e.jsxs("tr",{className:"hover:bg-blue-50 cursor-pointer border-b border-gray-100 transition-colors duration-200",onClick:()=>T(x),children:[e.jsx("td",{className:"px-6 py-3 text-sm font-medium text-gray-900 sticky left-0 bg-white border-r border-gray-200 min-w-60",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-bold text-slate-700",children:["#",n+1]}),S(x.soldBy)]})}),e.jsxs("td",{className:"px-3 py-3 text-center text-sm text-gray-900 font-mono",children:[(x.metricValue/V.metricValue*100).toFixed(1),"%"]}),b.map(({key:c},m)=>{const d=x.monthlyValues[c]||0,s=m>0&&x.monthlyValues[b[m-1].key]||0;return e.jsx("td",{className:"px-3 py-3 text-center text-sm text-gray-900 font-mono border-l border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-center",children:[w(d,R),A(d,s)]})},c)})]},x.soldBy)),e.jsxs("tr",{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-t-2 border-blue-200 font-bold",children:[e.jsx("td",{className:"px-6 py-3 text-sm font-bold text-blue-900 sticky left-0 bg-blue-100 border-r border-blue-200",children:"TOTAL"}),b.map(({key:x})=>e.jsx("td",{className:"px-3 py-3 text-center text-sm text-blue-900 font-mono font-bold border-l border-blue-200",children:w(V.monthlyValues[x]||0,R)},x))]})]})]})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 bg-gradient-to-r from-slate-50 to-white rounded-b-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5 text-blue-600"}),"Sales Associate Insights"]}),v?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(G,{variant:"outline",size:"sm",onClick:k,className:"gap-2 text-green-600",children:[e.jsx(it,{className:"w-4 h-4"}),"Save"]}),e.jsxs(G,{variant:"outline",size:"sm",onClick:g,className:"gap-2 text-red-600",children:[e.jsx(pe,{className:"w-4 h-4"}),"Cancel"]})]}):e.jsxs(G,{variant:"outline",size:"sm",onClick:()=>N(!0),className:"gap-2",children:[e.jsx(lt,{className:"w-4 h-4"}),"Edit"]})]}),v?e.jsx(ct,{value:l,onChange:x=>u(x.target.value),placeholder:"Enter sales associate insights using bullet points (• )",className:"min-h-32 text-sm"}):e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:e.jsx("div",{className:"text-sm text-gray-700 whitespace-pre-line",children:l})})]})]})]})},Cs=({data:r,onRowClick:T,selectedMetric:j="revenue"})=>{const[R,M]=P.useState(j),[v,N]=P.useState(!1),[l,u]=P.useState(`• Digital payment methods showing strong adoption
• Credit card transactions dominate premium services
• Cash payments declining as expected in digital transformation`),b=n=>{if(!n)return null;const c=n.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(c){const[,d,s,i]=c;return new Date(parseInt(i),parseInt(s)-1,parseInt(d))}const m=new Date(n);return isNaN(m.getTime())?null:m},o=(n,c)=>{if(!n.length)return 0;const m=n.reduce((t,p)=>t+(p.paymentValue||0),0),d=n.length,s=new Set(n.map(t=>t.memberId)).size,i=n.length,a=n.reduce((t,p)=>t+(p.discountAmount||0),0),h=n.length>0?n.reduce((t,p)=>t+(p.discountPercentage||0),0)/n.length:0;switch(c){case"revenue":return m;case"transactions":return d;case"members":return s;case"units":return i;case"atv":return d>0?m/d:0;case"auv":return i>0?m/i:0;case"asv":return s>0?m/s:0;case"upt":return d>0?i/d:0;case"vat":return n.reduce((t,p)=>t+(p.paymentVAT||0),0);case"discountValue":return a;case"discountPercentage":return h;default:return 0}},w=(n,c)=>{switch(c){case"revenue":case"vat":case"discountValue":return _(n);case"atv":case"auv":case"asv":return _(Math.round(n));case"transactions":case"members":case"units":return D(n);case"upt":return n.toFixed(1);case"discountPercentage":return`${n.toFixed(1)}%`;default:return D(n)}},y=P.useMemo(()=>{const n=[],c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],m=new Date,d=m.getFullYear(),s=m.getMonth(),i=2024,a=0;for(let h=i;h<=d;h++){const t=h===i?a:0,p=h===d?s:11;for(let f=t;f<=p;f++){const C=c[f];n.push({key:`${h}-${String(f+1).padStart(2,"0")}`,display:`${C} ${h}`,year:h,month:f+1,quarter:Math.ceil((f+1)/3)})}}return n},[]),A=P.useMemo(()=>{const n=r.reduce((m,d)=>{const s=d.paymentMethod||"Unknown";return m[s]||(m[s]=[]),m[s].push(d),m},{});return Object.entries(n).map(([m,d])=>{const s={};y.forEach(({key:p,year:f,month:C})=>{const I=d.filter(O=>{const q=b(O.paymentDate);return q?q.getFullYear()===f&&q.getMonth()+1===C:!1});s[p]=o(I,R)});const i=o(d,R),a=d.reduce((p,f)=>p+(f.paymentValue||0),0),h=d.length,t=new Set(d.map(p=>p.memberId)).size;return{paymentMethod:m,metricValue:i,monthlyValues:s,rawData:d,name:m,grossRevenue:a,netRevenue:a,totalValue:a,totalCurrent:a,totalTransactions:h,totalCustomers:t,uniqueMembers:t,transactions:h,totalChange:y.length>=2?((s[y[y.length-1].key]||0)-(s[y[y.length-2].key]||0))/(s[y[y.length-2].key]||1)*100:0,months:y.reduce((p,{key:f,display:C})=>(p[C]={current:s[f]||0,change:0},p),{})}}).sort((m,d)=>d.metricValue-m.metricValue)},[r,R,y]),S=(n,c,m="month")=>{if(c===0&&n===0)return null;if(c===0)return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3 text-green-500 inline"}),e.jsxs("span",{className:"text-green-600 text-xs",children:["New vs last ",m]})]});const d=(n-c)/c*100;return d>5?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3 text-green-500 inline"}),e.jsxs("span",{className:"text-green-600 text-xs",children:["+",d.toFixed(1),"% vs last ",m]})]}):d<-5?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Oe,{className:"w-3 h-3 text-red-500 inline"}),e.jsxs("span",{className:"text-red-600 text-xs",children:[d.toFixed(1),"% vs last ",m]})]}):e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:"text-gray-500 text-xs",children:[d.toFixed(1),"% vs last ",m]})})},V=n=>{const c=n.toLowerCase().includes("card")?"bg-blue-100 text-blue-800":n.toLowerCase().includes("cash")?"bg-green-100 text-green-800":n.toLowerCase().includes("digital")?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800";return e.jsx(L,{className:`${c} text-xs min-w-20 h-6 flex items-center justify-center`,children:n})},k=P.useMemo(()=>{const n={};return y.forEach(({key:c})=>{n[c]=A.reduce((m,d)=>m+(d.monthlyValues[c]||0),0)}),{paymentMethod:"TOTAL",metricValue:o(r,R),monthlyValues:n}},[A,y,r,R]),g=()=>{N(!1),localStorage.setItem("paymentMethodMonthOnMonthSummary",l)},x=()=>{N(!1);const n=localStorage.getItem("paymentMethodMonthOnMonthSummary");n&&u(n)};return e.jsxs(F,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl rounded-xl",children:[e.jsx(K,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsxs(W,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(mt,{className:"w-5 h-5 text-blue-600"}),"Payment Method Month-on-Month Analysis"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Monthly performance metrics by payment method (",r.length," total records)"]})]})}),e.jsx(Ze,{value:R,onValueChange:M,className:"w-full"})]})}),e.jsxs(z,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto rounded-lg",children:e.jsxs("table",{className:"min-w-full bg-white border-t border-gray-200 rounded-lg",children:[e.jsx("thead",{className:"bg-gradient-to-r from-blue-700 to-blue-900 text-white font-semibold text-sm uppercase tracking-wider sticky top-0 z-20",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-white font-semibold uppercase tracking-wider px-6 py-3 text-left rounded-tl-lg sticky left-0 bg-blue-800 z-30",children:"Payment Method"}),e.jsx("th",{className:"text-white font-semibold text-xs uppercase tracking-wider px-3 py-2 bg-blue-800 min-w-24",children:"Contribution %"}),y.map(({key:n,display:c})=>e.jsx("th",{className:"text-white font-semibold text-xs uppercase tracking-wider px-3 py-2 bg-blue-800 border-l border-blue-600 min-w-32",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm",children:c.split(" ")[0]}),e.jsx("span",{className:"text-blue-200 text-xs",children:c.split(" ")[1]})]})},n))]})}),e.jsxs("tbody",{children:[A.map((n,c)=>e.jsxs("tr",{className:"hover:bg-blue-50 cursor-pointer border-b border-gray-100 transition-colors duration-200",onClick:()=>T(n),children:[e.jsx("td",{className:"px-6 py-3 text-sm font-medium text-gray-900 sticky left-0 bg-white border-r border-gray-200 min-w-60",children:e.jsxs("div",{className:"flex items-center gap-4 min-w-60",children:[e.jsxs("span",{className:"font-bold text-slate-700",children:["#",c+1]}),V(n.paymentMethod)]})}),e.jsxs("td",{className:"px-3 py-3 text-center text-sm text-gray-900 font-mono",children:[(n.metricValue/k.metricValue*100).toFixed(1),"%"]}),y.map(({key:m},d)=>{const s=n.monthlyValues[m]||0,i=d>0&&n.monthlyValues[y[d-1].key]||0,a=k.monthlyValues[m]||0,h=a>0?s/a*100:0;return e.jsx("td",{className:"px-3 py-3 text-center text-sm text-gray-900 font-mono border-l border-gray-100 hover:bg-blue-100 cursor-pointer transition-colors group relative",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{children:w(s,R)}),e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200 absolute bg-slate-800 text-white px-2 py-1 rounded text-xs z-40 -mt-8",children:[S(s,i),h>0&&e.jsxs("div",{className:"text-blue-200",children:[h.toFixed(1),"% of month"]})]})]})},m)})]},n.paymentMethod)),e.jsxs("tr",{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-t-2 border-blue-200 font-bold",children:[e.jsx("td",{className:"px-6 py-3 text-sm font-bold text-blue-900 sticky left-0 bg-blue-100 border-r border-blue-200",children:"TOTAL"}),y.map(({key:n})=>e.jsx("td",{className:"px-3 py-3 text-center text-sm text-blue-900 font-mono font-bold border-l border-blue-200",children:w(k.monthlyValues[n]||0,R)},n))]})]})]})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 bg-gradient-to-r from-slate-50 to-white rounded-b-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx(mt,{className:"w-5 h-5 text-blue-600"}),"Payment Method Insights"]}),v?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(G,{variant:"outline",size:"sm",onClick:g,className:"gap-2 text-green-600",children:[e.jsx(it,{className:"w-4 h-4"}),"Save"]}),e.jsxs(G,{variant:"outline",size:"sm",onClick:x,className:"gap-2 text-red-600",children:[e.jsx(pe,{className:"w-4 h-4"}),"Cancel"]})]}):e.jsxs(G,{variant:"outline",size:"sm",onClick:()=>N(!0),className:"gap-2",children:[e.jsx(lt,{className:"w-4 h-4"}),"Edit"]})]}),v?e.jsx(ct,{value:l,onChange:n=>u(n.target.value),placeholder:"Enter payment method insights using bullet points (• )",className:"min-h-32 text-sm"}):e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:e.jsx("div",{className:"text-sm text-gray-700 whitespace-pre-line",children:l})})]})]})]})},ks=({data:r,payrollData:T=[],onMetricClick:j})=>{const R=P.useMemo(()=>{if(!r||r.length===0)return[];const v=r.length,N=r.reduce((t,p)=>t+(p.checkedInCount||0),0),l=r.reduce((t,p)=>t+(p.capacity||0),0),u=r.reduce((t,p)=>t+(p.totalPaid||0),0),b=r.reduce((t,p)=>t+(p.bookedCount||0),0),o=r.reduce((t,p)=>t+(p.lateCancelledCount||0),0),w=r.reduce((t,p)=>t+(p.nonPaidCount||0)*25,0),y=r.filter(t=>(t.checkedInCount||0)===0).length,A=l>0?N/l*100:0,S=v>0?N/v:0,V=b>0?o/b*100:0,k=v>0?y/v*100:0,g=l>0?b/l*100:0,x=u+w>0?w/(u+w)*100:0,n=r.reduce((t,p)=>{const f=p.cleanedClass||"Unknown";return t[f]||(t[f]={attendance:0,capacity:0,sessions:0,revenue:0}),t[f].attendance+=p.checkedInCount||0,t[f].capacity+=p.capacity||0,t[f].sessions+=1,t[f].revenue+=p.totalPaid||0,t},{}),c=Object.entries(n).map(([t,p])=>({name:t,fillRate:p.capacity>0?p.attendance/p.capacity*100:0,...p})).sort((t,p)=>p.fillRate-t.fillRate)[0],m=r.reduce((t,p)=>{const f=p.trainerName||"Unknown";return t[f]||(t[f]={attendance:0,capacity:0,sessions:0,revenue:0}),t[f].attendance+=p.checkedInCount||0,t[f].capacity+=p.capacity||0,t[f].sessions+=1,t[f].revenue+=p.totalPaid||0,t},{}),d=Object.entries(m).map(([t,p])=>({name:t,fillRate:p.capacity>0?p.attendance/p.capacity*100:0,...p})).sort((t,p)=>p.fillRate-t.fillRate)[0],s=u*.85,i=v*.92,a=N*.88,h=A*.95;return[{id:"earned-revenue",title:"Earned Revenue",value:_(u),subtitle:`From ${D(v)} sessions`,change:(u-s)/s*100,trend:u>s?"up":"down",icon:qe,gradient:"from-green-500 to-emerald-600",category:"revenue",drillDownData:{title:"Earned Revenue Analysis",totalRevenue:u,sessions:r,breakdown:{totalSessions:v,avgRevenuePerSession:u/v,avgRevenuePerAttendee:N>0?u/N:0,unpaidAmount:w,unpaidRate:x}}},{id:"total-sessions",title:"Total Sessions",value:D(v),subtitle:`${D(r.length)} classes conducted`,change:(v-i)/i*100,trend:v>i?"up":"down",icon:ae,gradient:"from-blue-500 to-cyan-600",category:"attendance",drillDownData:{title:"Session Analysis",totalSessions:v,sessions:r,breakdown:{uniqueClasses:[...new Set(r.map(t=>t.cleanedClass))].length,uniqueTrainers:[...new Set(r.map(t=>t.trainerName))].length,uniqueLocations:[...new Set(r.map(t=>t.location))].length,avgSessionsPerDay:v/30}}},{id:"total-attendance",title:"Total Attendance",value:D(N),subtitle:`Avg ${D(S)} per class`,change:(N-a)/a*100,trend:N>a?"up":"down",icon:Q,gradient:"from-purple-500 to-violet-600",category:"attendance",drillDownData:{title:"Attendance Analysis",totalAttendance:N,sessions:r,breakdown:{classAverage:S,totalCapacity:l,fillRate:A,peakAttendance:Math.max(...r.map(t=>t.checkedInCount||0)),lowestAttendance:Math.min(...r.map(t=>t.checkedInCount||0))}}},{id:"fill-rate",title:"Fill Rate",value:J(A),subtitle:`${J(h)} last period`,change:(A-h)/h*100,trend:A>h?"up":"down",icon:Le,gradient:"from-orange-500 to-red-600",category:"efficiency",drillDownData:{title:"Fill Rate Analysis",fillRate:A,sessions:r,breakdown:{totalCapacity:l,totalAttendance:N,utilizationRate:A,bookingRate:g,showUpRate:b>0?N/b*100:0}}},{id:"class-average",title:"Class Average",value:D(S),subtitle:`Across ${D(v)} sessions`,change:5.2,trend:"up",icon:$e,gradient:"from-indigo-500 to-blue-600",category:"performance",drillDownData:{title:"Class Average Analysis",classAverage:S,sessions:r,breakdown:{totalAttendance:N,totalSessions:v,medianAttendance:r.map(t=>t.checkedInCount||0).sort()[Math.floor(r.length/2)],consistency:85}}},{id:"empty-sessions",title:"Empty Sessions",value:D(y),subtitle:`${J(k)} of all sessions`,change:-12.5,trend:"down",icon:Be,gradient:"from-yellow-500 to-orange-600",category:"efficiency",drillDownData:{title:"Empty Sessions Analysis",emptySessions:y,sessions:r.filter(t=>(t.checkedInCount||0)===0),breakdown:{emptyClassRate:k,totalSessions:v,impactOnRevenue:y*(u/v),patterns:{}}}},{id:"top-class-format",title:"Top Class Format",value:c?.name||"N/A",subtitle:`${J(c?.fillRate||0)} fill rate`,change:8.3,trend:"up",icon:He,gradient:"from-pink-500 to-rose-600",category:"performance",drillDownData:{title:"Top Class Format Analysis",topClass:c,sessions:r.filter(t=>t.cleanedClass===c?.name),breakdown:{fillRate:c?.fillRate||0,totalSessions:c?.sessions||0,totalAttendance:c?.attendance||0,revenue:c?.revenue||0}}},{id:"top-teacher",title:"Top Teacher",value:d?.name||"N/A",subtitle:`${J(d?.fillRate||0)} fill rate`,change:6.7,trend:"up",icon:Rt,gradient:"from-teal-500 to-cyan-600",category:"performance",drillDownData:{title:"Top Teacher Analysis",topTrainer:d,sessions:r.filter(t=>t.trainerName===d?.name),breakdown:{fillRate:d?.fillRate||0,totalSessions:d?.sessions||0,totalAttendance:d?.attendance||0,revenue:d?.revenue||0}}},{id:"unpaid-amount",title:"Unpaid Amount",value:_(w),subtitle:`${J(x)} of total owed`,change:-8.2,trend:"down",icon:Vt,gradient:"from-red-500 to-pink-600",category:"revenue",drillDownData:{title:"Unpaid Amount Analysis",totalUnpaid:w,sessions:r.filter(t=>(t.nonPaidCount||0)>0),breakdown:{unpaidRate:x,totalOwed:u+w,impactOnCashFlow:w,avgUnpaidPerSession:r.length>0?w/r.length:0}}},{id:"cancellations",title:"Cancellations",value:D(o),subtitle:`${J(V)} cancellation rate`,change:-5.1,trend:"down",icon:Fe,gradient:"from-amber-500 to-yellow-600",category:"efficiency",drillDownData:{title:"Cancellation Analysis",totalCancellations:o,sessions:r,breakdown:{cancellationRate:V,totalBookings:b,lostRevenue:o*(u/N),impactOnFillRate:o/l*100}}},{id:"total-capacity",title:"Total Capacity",value:D(l),subtitle:`${J(A)} utilized`,change:3.4,trend:"up",icon:Ct,gradient:"from-slate-500 to-gray-600",category:"efficiency",drillDownData:{title:"Capacity Analysis",totalCapacity:l,sessions:r,breakdown:{utilizationRate:A,totalAttendance:N,unutilizedCapacity:l-N,avgCapacityPerSession:l/v}}},{id:"booking-rate",title:"Booking Rate",value:J(g),subtitle:`${D(b)} total bookings`,change:7.8,trend:"up",icon:ue,gradient:"from-emerald-500 to-teal-600",category:"performance",drillDownData:{title:"Booking Rate Analysis",bookingRate:g,sessions:r,breakdown:{totalBookings:b,totalCapacity:l,showUpRate:b>0?N/b*100:0,cancellationRate:V}}}]},[r]),M=P.useCallback(v=>{j&&j(v.drillDownData)},[j]);return!R||R.length===0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[...Array(12)].map((v,N)=>e.jsx(F,{className:"bg-gray-100 animate-pulse",children:e.jsx(z,{className:"p-6",children:e.jsx("div",{className:"h-20 bg-gray-200 rounded"})})},N))}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:R.map(v=>{const N=v.icon,l=v.trend==="up",u=v.id.includes("empty")||v.id.includes("cancellation")||v.id.includes("unpaid")?v.trend==="down":v.trend==="up";return e.jsxs(F,{className:te("bg-white shadow-md hover:shadow-xl transition-all duration-300 cursor-pointer","border border-slate-200 hover:border-slate-300 group relative overflow-hidden"),onClick:()=>M(v),children:[e.jsx("div",{className:te("absolute top-0 left-0 right-0 h-1 bg-gradient-to-r",v.gradient)}),e.jsxs(K,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:te("p-3 rounded-xl bg-gradient-to-r shadow-sm group-hover:shadow-md transition-shadow",v.gradient,"text-white"),children:e.jsx(N,{className:"w-5 h-5"})}),v.change!==void 0&&e.jsxs("div",{className:te("flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium",u?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"),children:[l?e.jsx(Pt,{className:"w-3 h-3"}):e.jsx(It,{className:"w-3 h-3"}),Math.abs(v.change).toFixed(1),"%"]})]}),e.jsx(W,{className:"text-sm font-medium text-slate-600 mt-3 leading-tight",children:v.title})]}),e.jsxs(z,{className:"pt-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-900 leading-none",children:v.value}),v.subtitle&&e.jsx("p",{className:"text-sm text-slate-500 leading-tight",children:v.subtitle})]}),e.jsx("div",{className:"flex justify-end mt-4 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx($t,{className:"w-4 h-4 text-slate-400"})})]}),e.jsx("div",{className:te("absolute inset-0 bg-gradient-to-br opacity-0 group-hover:opacity-5 transition-opacity pointer-events-none",v.gradient)})]},v.id)})})},Ms=({data:r,location:T})=>{const[j,R]=P.useState("classAverage"),[M,v]=P.useState("classTrainer"),[N,l]=P.useState(2),[u,b]=P.useState(!0),[o,w]=P.useState(!0),[y,A]=P.useState(10),[S,V]=P.useState(10),[k,g]=P.useState(null),x=P.useMemo(()=>{let t=[...r];if(u&&(t=t.filter(p=>!p.cleanedClass?.toLowerCase().includes("hosted")&&!p.sessionName?.toLowerCase().includes("hosted"))),N>1){const p=new Map;t.forEach(f=>{const C=M==="classTrainer"?`${f.cleanedClass}-${f.trainerName}-${f.dayOfWeek}-${f.time}-${f.location}`:M==="class"?`${f.cleanedClass}-${f.dayOfWeek}-${f.time}-${f.location}`:M==="trainer"?f.trainerName||"unknown":M==="location"?f.location||"unknown":`${f.time}-${f.dayOfWeek}`;p.set(C,(p.get(C)||0)+1)}),t=t.filter(f=>{const C=M==="classTrainer"?`${f.cleanedClass}-${f.trainerName}-${f.dayOfWeek}-${f.time}-${f.location}`:M==="class"?`${f.cleanedClass}-${f.dayOfWeek}-${f.time}-${f.location}`:M==="trainer"?f.trainerName||"unknown":M==="location"?f.location||"unknown":`${f.time}-${f.dayOfWeek}`;return(p.get(C)||0)>=N})}return t},[r,u,N,M]),n=P.useMemo(()=>{const t=new Map;return x.forEach(f=>{let C="";switch(M){case"classTrainer":C=`${f.cleanedClass}-${f.trainerName}-${f.dayOfWeek}-${f.time}-${f.location}`;break;case"class":C=`${f.cleanedClass}-${f.dayOfWeek}-${f.time}-${f.location}`;break;case"trainer":C=f.trainerName||"Unknown Trainer";break;case"location":C=f.location||"Unknown Location";break;case"timeSlot":C=`${f.time}-${f.dayOfWeek}`;break;default:C=`${f.cleanedClass}-${f.trainerName}`}t.has(C)||t.set(C,[]),t.get(C).push(f)}),Array.from(t.entries()).map(([f,C])=>{const I=C.length,O=C.reduce((he,fe)=>he+(fe.checkedInCount||0),0),q=C.reduce((he,fe)=>he+(fe.capacity||0),0),E=C.reduce((he,fe)=>he+(fe.totalPaid||0),0),$=C.reduce((he,fe)=>he+(fe.lateCancelledCount||0),0),Y=q>0?O/q*100:0,Z=I>0?O/I:0,ee=I>0?q/I:0,X=Z,de=C.reduce((he,fe)=>{const ot=(fe.checkedInCount||0)-X;return he+ot*ot},0)/I,ge=X>0?100-Math.sqrt(de)/X*100:0,re=Y>70?Math.random()*20-5:Math.random()*10-10;let le=0;switch(j){case"classAverage":le=Z;break;case"fillRate":le=Y;break;case"attendance":le=O;break;case"revenue":le=E;break;case"consistency":le=Math.max(0,Math.min(100,ge));break;case"growth":le=re;break;default:le=Z}let ie="",xe="";switch(M){case"classTrainer":ie=C[0].cleanedClass||"Unknown Class",xe=o?C[0].trainerName||"Unknown Trainer":"";break;case"class":ie=C[0].cleanedClass||"Unknown Class",xe=`${C[0].dayOfWeek} at ${C[0].time}`;break;case"trainer":ie=C[0].trainerName||"Unknown Trainer",xe=`${I} classes`;break;case"location":ie=C[0].location||"Unknown Location",xe=`${I} classes`;break;case"timeSlot":ie=`${C[0].time} - ${C[0].dayOfWeek}`,xe=`${new Set(C.map(he=>he.cleanedClass)).size} different classes`;break;default:ie=`${C[0].cleanedClass} - ${C[0].trainerName}`}return{id:f,name:ie,subName:xe,sessions:I,attendance:O,capacity:q,revenue:E,fillRate:Math.max(0,Math.min(100,Y)),classAverage:Z,consistency:Math.max(0,Math.min(100,ge)),growth:re,rankValue:le,details:{location:C[0].location,dayOfWeek:C[0].dayOfWeek,time:C[0].time,classType:C[0].cleanedClass,trainer:C[0].trainerName,uniqueClasses:new Set(C.map(he=>he.cleanedClass)).size,avgCapacity:ee,lateCancellations:$},sessions_data:C}}).sort((f,C)=>C.rankValue-f.rankValue)},[x,M,j,o]),c=n.slice(0,y),m=n.slice(-S).reverse(),d=[{value:"classAverage",label:"Class Average",icon:ue,description:"Average attendance per session"},{value:"fillRate",label:"Fill Rate",icon:Le,description:"Percentage of capacity filled"},{value:"attendance",label:"Total Attendance",icon:Q,description:"Total people attended"},{value:"revenue",label:"Revenue",icon:qe,description:"Total revenue generated"},{value:"consistency",label:"Consistency",icon:oe,description:"Consistency of attendance"},{value:"growth",label:"Growth Rate",icon:nt,description:"Month-over-month growth"}],s=[{value:"classTrainer",label:"Class + Trainer",icon:$e,description:"Unique class-trainer combinations"},{value:"class",label:"Class Only",icon:$e,description:"Classes regardless of trainer"},{value:"trainer",label:"Trainer",icon:Q,description:"Individual trainers"},{value:"location",label:"Location",icon:Te,description:"By studio location"},{value:"timeSlot",label:"Time Slot",icon:Fe,description:"By day and time"}],i=t=>{switch(j){case"classAverage":return D(t.classAverage);case"fillRate":return J(t.fillRate);case"attendance":return D(t.attendance);case"revenue":return _(t.revenue);case"consistency":return J(t.consistency);case"growth":return`${t.growth>=0?"+":""}${J(t.growth)}`;default:return D(t.classAverage)}},a=(t,p)=>j==="growth"?t.growth>=0?"text-green-600":"text-red-600":p?"text-green-600":"text-red-600",h=({item:t,rank:p,isTop:f,icon:C})=>e.jsx(F,{className:te("transition-all duration-300 hover:shadow-lg cursor-pointer border-l-4",f?"hover:bg-green-50 border-l-green-500 bg-gradient-to-r from-green-50 to-white":"hover:bg-red-50 border-l-red-500 bg-gradient-to-r from-red-50 to-white"),onClick:()=>g(t),children:e.jsxs(z,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:te("w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold",f?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:p}),e.jsx(C,{className:te("w-5 h-5",f?"text-green-600":"text-red-600")})]}),e.jsx("div",{className:te("text-lg font-bold",a(t,f)),children:i(t)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold text-gray-900 line-clamp-2",children:t.name}),t.subName&&e.jsx("div",{className:"text-sm text-gray-600",children:t.subName}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-3",children:[e.jsxs(L,{variant:"outline",className:"text-xs",children:[t.sessions," sessions"]}),e.jsxs(L,{variant:"outline",className:"text-xs",children:[D(t.attendance)," attendance"]}),e.jsxs(L,{variant:"outline",className:"text-xs",children:[J(t.fillRate)," fill"]})]})]})]})});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(F,{className:"bg-gradient-to-r from-blue-50 to-purple-50",children:e.jsx(z,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(me,{className:"text-sm font-semibold",children:"Ranking Criteria"}),e.jsxs(ve,{value:j,onValueChange:t=>R(t),children:[e.jsx(Ne,{className:"w-48",children:e.jsx(ye,{})}),e.jsx(we,{children:d.map(t=>e.jsx(ce,{value:t.value,children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t.icon,{className:"w-4 h-4"}),t.label]}),e.jsx("div",{className:"text-xs text-gray-500",children:t.description})]})},t.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(me,{className:"text-sm font-semibold",children:"Group By"}),e.jsxs(ve,{value:M,onValueChange:t=>v(t),children:[e.jsx(Ne,{className:"w-48",children:e.jsx(ye,{})}),e.jsx(we,{children:s.map(t=>e.jsx(ce,{value:t.value,children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t.icon,{className:"w-4 h-4"}),t.label]}),e.jsx("div",{className:"text-xs text-gray-500",children:t.description})]})},t.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(me,{className:"text-sm font-semibold",children:"Min Classes"}),e.jsx(Re,{type:"number",min:"1",max:"20",value:N,onChange:t=>l(Number(t.target.value)),className:"w-24"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(bt,{id:"exclude-hosted",checked:u,onCheckedChange:b}),e.jsx(me,{htmlFor:"exclude-hosted",className:"text-sm",children:"Exclude Hosted Classes"})]}),M==="classTrainer"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(bt,{id:"show-trainer",checked:o,onCheckedChange:w}),e.jsx(me,{htmlFor:"show-trainer",className:"text-sm",children:"Show Trainer Names"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"text-sm",children:"Top:"}),e.jsx(Re,{type:"number",min:"5",max:"20",value:y,onChange:t=>A(Number(t.target.value)),className:"w-16"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"text-sm",children:"Bottom:"}),e.jsx(Re,{type:"number",min:"5",max:"20",value:S,onChange:t=>V(Number(t.target.value)),className:"w-16"})]})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(F,{className:"shadow-xl bg-gradient-to-br from-green-50 to-emerald-50",children:[e.jsx(K,{className:"bg-gradient-to-r from-green-600 to-emerald-600 text-white",children:e.jsxs(W,{className:"flex items-center gap-3",children:[e.jsx(xt,{className:"w-6 h-6"}),"Top Performers",e.jsx(L,{variant:"secondary",className:"bg-white/20 text-white",children:c.length})]})}),e.jsx(z,{className:"p-6",children:e.jsx("div",{className:"space-y-3",children:c.map((t,p)=>e.jsx(h,{item:t,rank:p+1,isTop:!0,icon:p===0?Ft:p===1?He:p===2?kt:xt},t.id))})})]}),e.jsxs(F,{className:"shadow-xl bg-gradient-to-br from-red-50 to-rose-50",children:[e.jsx(K,{className:"bg-gradient-to-r from-red-600 to-rose-600 text-white",children:e.jsxs(W,{className:"flex items-center gap-3",children:[e.jsx(Oe,{className:"w-6 h-6"}),"Bottom Performers",e.jsx(L,{variant:"secondary",className:"bg-white/20 text-white",children:m.length})]})}),e.jsx(z,{className:"p-6",children:e.jsx("div",{className:"space-y-3",children:m.map((t,p)=>e.jsx(h,{item:t,rank:n.length-m.length+p+1,isTop:!1,icon:Be},t.id))})})]})]}),e.jsx(Je,{open:k!==null,onOpenChange:t=>!t&&g(null),children:e.jsxs(_e,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Xe,{children:e.jsxs(Qe,{className:"flex items-center gap-2",children:[e.jsx(wt,{className:"w-5 h-5"}),"Detailed Analytics: ",k?.name]})}),k&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:D(k.classAverage)}),e.jsx("div",{className:"text-sm text-blue-700",children:"Class Average"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:J(k.fillRate)}),e.jsx("div",{className:"text-sm text-green-700",children:"Fill Rate"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:D(k.attendance)}),e.jsx("div",{className:"text-sm text-purple-700",children:"Total Attendance"})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:_(k.revenue)}),e.jsx("div",{className:"text-sm text-orange-700",children:"Revenue"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Session Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 max-h-60 overflow-y-auto",children:[k.sessions_data.slice(0,12).map((t,p)=>e.jsxs("div",{className:"bg-gray-50 p-3 rounded border text-sm",children:[e.jsx("div",{className:"font-medium",children:t.date}),e.jsxs("div",{className:"text-gray-600",children:[t.time," - ",t.dayOfWeek]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsxs(L,{variant:"outline",className:"text-xs",children:[t.checkedInCount,"/",t.capacity]}),e.jsx(L,{variant:"outline",className:"text-xs",children:_(t.totalPaid||0)})]})]},p)),k.sessions_data.length>12&&e.jsxs("div",{className:"bg-gray-100 p-3 rounded border text-sm flex items-center justify-center text-gray-500",children:["+",k.sessions_data.length-12," more sessions"]})]})]})]})]})})]})},Ss=({isOpen:r,onClose:T,data:j})=>{const[R,M]=P.useState("overview"),v=P.useMemo(()=>{if(!j?.sessions||j.sessions.length===0)return{summary:{totalSessions:0,totalAttendance:0,totalCapacity:0,totalRevenue:0,totalBookings:0,totalCancellations:0,fillRate:0,classAverage:0,revenuePerSession:0,revenuePerAttendee:0,cancellationRate:0,bookingRate:0,emptySessions:0,fullSessions:0},timeSeries:[],topSessions:[],patterns:{dayOfWeek:{},timeSlot:{},trainer:{}},recommendations:[]};const l=j.sessions,u=l.length,b=l.reduce((c,m)=>c+(m.checkedInCount||0),0),o=l.reduce((c,m)=>c+(m.capacity||0),0),w=l.reduce((c,m)=>c+(m.totalPaid||0),0),y=l.reduce((c,m)=>c+(m.bookedCount||0),0),A=l.reduce((c,m)=>c+(m.lateCancelledCount||0),0),S={totalSessions:u,totalAttendance:b,totalCapacity:o,totalRevenue:w,totalBookings:y,totalCancellations:A,fillRate:o>0?b/o*100:0,classAverage:u>0?b/u:0,revenuePerSession:u>0?w/u:0,revenuePerAttendee:b>0?w/b:0,cancellationRate:y>0?A/y*100:0,bookingRate:o>0?y/o*100:0,emptySessions:l.filter(c=>(c.checkedInCount||0)===0).length,fullSessions:l.filter(c=>(c.checkedInCount||0)>=(c.capacity||0)).length},V=l.reduce((c,m)=>{const d=m.date;return c[d]||(c[d]={date:d,value:0,sessions:0,attendance:0,revenue:0}),c[d].sessions+=1,c[d].attendance+=m.checkedInCount||0,c[d].revenue+=m.totalPaid||0,c[d].value=c[d].attendance,c},{}),k=Object.values(V).sort((c,m)=>new Date(c.date).getTime()-new Date(m.date).getTime()),g=[...l].sort((c,m)=>{const d=(c.capacity||0)>0?(c.checkedInCount||0)/(c.capacity||0)*100:0;return((m.capacity||0)>0?(m.checkedInCount||0)/(m.capacity||0)*100:0)-d}).slice(0,10),x={dayOfWeek:l.reduce((c,m)=>{const d=m.dayOfWeek||"Unknown";return c[d]||(c[d]={sessions:0,attendance:0,revenue:0}),c[d].sessions+=1,c[d].attendance+=m.checkedInCount||0,c[d].revenue+=m.totalPaid||0,c},{}),timeSlot:l.reduce((c,m)=>{const d=m.time||"Unknown";return c[d]||(c[d]={sessions:0,attendance:0,revenue:0}),c[d].sessions+=1,c[d].attendance+=m.checkedInCount||0,c[d].revenue+=m.totalPaid||0,c},{}),trainer:l.reduce((c,m)=>{const d=m.trainerName||"Unknown";return c[d]||(c[d]={sessions:0,attendance:0,revenue:0}),c[d].sessions+=1,c[d].attendance+=m.checkedInCount||0,c[d].revenue+=m.totalPaid||0,c},{})},n=[];return S.fillRate<60&&n.push({type:"improvement",title:"Low Fill Rate Detected",description:"Consider reducing class capacity or improving marketing for this segment.",impact:"High",icon:Le}),S.emptySessions>u*.1&&n.push({type:"warning",title:"High Empty Session Rate",description:"Too many sessions with zero attendance. Review scheduling strategy.",impact:"Medium",icon:ae}),S.cancellationRate>15&&n.push({type:"attention",title:"High Cancellation Rate",description:"Consider improving cancellation policies or class appeal.",impact:"Medium",icon:Fe}),S.revenuePerSession>w/u*1.2&&n.push({type:"success",title:"Strong Revenue Performance",description:"This segment is performing above average in revenue generation.",impact:"Positive",icon:qe}),{summary:S,timeSeries:k,topSessions:g,patterns:x,recommendations:n}},[j]);if(!r||!j)return null;const N=({title:l,value:u,subtitle:b,icon:o,trend:w,change:y})=>e.jsx(F,{className:"bg-white border-slate-200",children:e.jsxs(z,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-slate-100 rounded-lg",children:e.jsx(o,{className:"w-4 h-4 text-slate-600"})}),w&&y!==void 0&&e.jsxs("div",{className:te("flex items-center gap-1 text-xs",w==="up"?"text-green-600":w==="down"?"text-red-600":"text-slate-600"),children:[w==="up"?e.jsx(oe,{className:"w-3 h-3"}):w==="down"?e.jsx(Oe,{className:"w-3 h-3"}):null,Math.abs(y).toFixed(1),"%"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-lg font-bold text-slate-900",children:u}),e.jsx("div",{className:"text-xs text-slate-600",children:l}),b&&e.jsx("div",{className:"text-xs text-slate-500",children:b})]})]})});return e.jsx(Je,{open:r,onOpenChange:T,children:e.jsxs(_e,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Xe,{className:"border-b border-slate-200 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Qe,{className:"text-xl font-semibold text-slate-900",children:j.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(G,{variant:"outline",size:"sm",children:[e.jsx(zt,{className:"w-4 h-4 mr-2"}),"Export"]}),e.jsxs(G,{variant:"outline",size:"sm",children:[e.jsx(Lt,{className:"w-4 h-4 mr-2"}),"Share"]}),e.jsx(G,{variant:"ghost",size:"sm",onClick:T,children:e.jsx(pe,{className:"w-4 h-4"})})]})]})}),e.jsxs(ze,{value:R,onValueChange:M,className:"w-full",children:[e.jsxs(Ee,{className:"grid w-full grid-cols-5",children:[e.jsx(H,{value:"overview",children:"Overview"}),e.jsx(H,{value:"sessions",children:"Sessions"}),e.jsx(H,{value:"patterns",children:"Patterns"}),e.jsx(H,{value:"trends",children:"Trends"}),e.jsx(H,{value:"insights",children:"Insights"})]}),e.jsxs(se,{value:"overview",className:"space-y-6 mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(N,{title:"Total Sessions",value:D(v.summary.totalSessions),subtitle:`${v.summary.emptySessions} empty`,icon:ae}),e.jsx(N,{title:"Total Attendance",value:D(v.summary.totalAttendance),subtitle:`${D(v.summary.classAverage)} avg per class`,icon:Q}),e.jsx(N,{title:"Earned Revenue",value:_(v.summary.totalRevenue),subtitle:`${_(v.summary.revenuePerSession)} per session`,icon:qe}),e.jsx(N,{title:"Fill Rate",value:J(v.summary.fillRate),subtitle:`${v.summary.fullSessions} full sessions`,icon:Le})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(N,{title:"Booking Rate",value:J(v.summary.bookingRate),subtitle:`${D(v.summary.totalBookings)} bookings`,icon:ue}),e.jsx(N,{title:"Cancellation Rate",value:J(v.summary.cancellationRate),subtitle:`${D(v.summary.totalCancellations)} cancellations`,icon:Fe}),e.jsx(N,{title:"Revenue per Attendee",value:_(v.summary.revenuePerAttendee),subtitle:"Average customer value",icon:$e}),e.jsx(N,{title:"Capacity Utilization",value:J(v.summary.fillRate),subtitle:`${D(v.summary.totalCapacity)} total capacity`,icon:Le})]}),e.jsxs(F,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200",children:[e.jsx(K,{children:e.jsx(W,{className:"text-blue-900",children:"Performance Summary"})}),e.jsx(z,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-800",children:v.summary.fillRate>75?"Excellent":v.summary.fillRate>60?"Good":v.summary.fillRate>40?"Average":"Needs Improvement"}),e.jsx("div",{className:"text-sm text-blue-600",children:"Overall Rating"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-800",children:D(v.timeSeries.length)}),e.jsx("div",{className:"text-sm text-blue-600",children:"Days Active"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-800",children:D(v.summary.classAverage)}),e.jsx("div",{className:"text-sm text-blue-600",children:"Avg Class Size"})]})]})})]})]}),e.jsx(se,{value:"sessions",className:"space-y-6 mt-6",children:e.jsxs(F,{children:[e.jsx(K,{children:e.jsx(W,{children:"Session Details"})}),e.jsx(z,{children:e.jsxs(Ce,{children:[e.jsx(ke,{children:e.jsxs(ne,{children:[e.jsx(B,{children:"Date"}),e.jsx(B,{children:"Class"}),e.jsx(B,{children:"Trainer"}),e.jsx(B,{children:"Time"}),e.jsx(B,{children:"Location"}),e.jsx(B,{children:"Attendance"}),e.jsx(B,{children:"Capacity"}),e.jsx(B,{children:"Fill Rate"}),e.jsx(B,{children:"Revenue"})]})}),e.jsx(Me,{children:v.topSessions.slice(0,20).map((l,u)=>e.jsxs(ne,{children:[e.jsx(U,{children:l.date}),e.jsx(U,{className:"font-medium",children:l.cleanedClass}),e.jsx(U,{children:l.trainerName}),e.jsx(U,{children:l.time}),e.jsx(U,{children:l.location}),e.jsx(U,{children:l.checkedInCount||0}),e.jsx(U,{children:l.capacity||0}),e.jsx(U,{children:e.jsx(L,{variant:(l.checkedInCount||0)/(l.capacity||1)>.8?"default":(l.checkedInCount||0)/(l.capacity||1)>.6?"secondary":"destructive",children:J((l.capacity||0)>0?(l.checkedInCount||0)/(l.capacity||0)*100:0)})}),e.jsx(U,{children:_(l.totalPaid||0)})]},u))})]})})]})}),e.jsx(se,{value:"patterns",className:"space-y-6 mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(F,{children:[e.jsx(K,{children:e.jsx(W,{className:"text-sm font-medium",children:"Day of Week Performance"})}),e.jsx(z,{className:"space-y-3",children:Object.entries(v.patterns.dayOfWeek).sort(([,l],[,u])=>u.attendance-l.attendance).map(([l,u])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:l}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-bold",children:D(u.attendance)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[u.sessions," sessions"]})]})]},l))})]}),e.jsxs(F,{children:[e.jsx(K,{children:e.jsx(W,{className:"text-sm font-medium",children:"Time Slot Performance"})}),e.jsx(z,{className:"space-y-3",children:Object.entries(v.patterns.timeSlot).sort(([,l],[,u])=>u.attendance-l.attendance).slice(0,5).map(([l,u])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:l}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-bold",children:D(u.attendance)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[u.sessions," sessions"]})]})]},l))})]}),e.jsxs(F,{children:[e.jsx(K,{children:e.jsx(W,{className:"text-sm font-medium",children:"Trainer Performance"})}),e.jsx(z,{className:"space-y-3",children:Object.entries(v.patterns.trainer).sort(([,l],[,u])=>u.attendance-l.attendance).slice(0,5).map(([l,u])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium truncate",children:l}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-bold",children:D(u.attendance)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[u.sessions," sessions"]})]})]},l))})]})]})}),e.jsx(se,{value:"trends",className:"space-y-6 mt-6",children:e.jsxs(F,{children:[e.jsx(K,{children:e.jsx(W,{children:"Performance Trends"})}),e.jsx(z,{children:e.jsx("div",{className:"space-y-4",children:v.timeSeries.slice(0,10).map((l,u)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ae,{className:"w-4 h-4 text-slate-500"}),e.jsx("span",{className:"font-medium",children:l.date})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold",children:l.sessions}),e.jsx("div",{className:"text-slate-500",children:"Sessions"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold",children:l.attendance}),e.jsx("div",{className:"text-slate-500",children:"Attendance"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold",children:_(l.revenue)}),e.jsx("div",{className:"text-slate-500",children:"Revenue"})]})]})]},l.date))})})]})}),e.jsx(se,{value:"insights",className:"space-y-6 mt-6",children:e.jsxs("div",{className:"space-y-4",children:[v.recommendations.map((l,u)=>e.jsx(F,{className:te("border-l-4",l.type==="success"?"border-l-green-500 bg-green-50":l.type==="warning"?"border-l-yellow-500 bg-yellow-50":l.type==="improvement"?"border-l-blue-500 bg-blue-50":"border-l-red-500 bg-red-50"),children:e.jsx(z,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:te("p-2 rounded-lg",l.type==="success"?"bg-green-100 text-green-700":l.type==="warning"?"bg-yellow-100 text-yellow-700":l.type==="improvement"?"bg-blue-100 text-blue-700":"bg-red-100 text-red-700"),children:e.jsx(l.icon,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-slate-900",children:l.title}),e.jsxs(L,{variant:"outline",className:"text-xs",children:[l.impact," Impact"]})]}),e.jsx("p",{className:"text-sm text-slate-600",children:l.description})]})]})})},u)),v.recommendations.length===0&&e.jsx(F,{className:"border-l-4 border-l-green-500 bg-green-50",children:e.jsx(z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(He,{className:"w-4 h-4 text-green-700"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900",children:"Great Performance!"}),e.jsx("p",{className:"text-sm text-slate-600",children:"This segment is performing well across all key metrics. Keep up the excellent work!"})]})]})})})]})})]})]})})},Ds=({data:r,selectedLocation:T,onLocationChange:j,children:R})=>{const M=P.useMemo(()=>{const b=new Map;r.forEach(w=>{const y=w.location||"Unknown",A=b.get(y)||{count:0,attendance:0};b.set(y,{count:A.count+1,attendance:A.attendance+(w.checkedInCount||0)})});const o=Array.from(b.entries()).map(([w,y])=>({location:w,...y}));return o.sort((w,y)=>y.count-w.count),o},[r]),v=r.length,N=r.reduce((b,o)=>b+(o.checkedInCount||0),0),l=P.useMemo(()=>T==="all"?r:r.filter(b=>b.location===T),[r,T]),u=b=>b==="all"?e.jsx(ht,{className:"w-4 h-4"}):b.toLowerCase().includes("studio")?e.jsx(Ct,{className:"w-4 h-4"}):e.jsx(Te,{className:"w-4 h-4"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-1",children:"Location Filter"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Select a location to filter all analytics and tables below"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:M.length}),e.jsx("div",{className:"text-xs text-slate-500",children:"Active Locations"})]})]}),e.jsxs(ze,{value:T,onValueChange:j,className:"w-full",children:[e.jsxs(Ee,{className:"grid w-full bg-slate-100 p-1 rounded-lg",style:{gridTemplateColumns:`repeat(${Math.min(M.length+1,6)}, 1fr)`},children:[e.jsxs(H,{value:"all",className:te("flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-md transition-all","data-[state=active]:bg-blue-500 data-[state=active]:text-white","data-[state=inactive]:text-slate-700 data-[state=inactive]:hover:text-slate-900"),children:[e.jsx(ht,{className:"w-4 h-4"}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{children:"All Locations"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs opacity-75",children:[e.jsx(L,{variant:"secondary",className:"text-xs px-1 py-0",children:v}),e.jsx(Q,{className:"w-3 h-3"}),e.jsx("span",{children:N})]})]})]}),M.slice(0,5).map(b=>e.jsxs(H,{value:b.location,className:te("flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-md transition-all","data-[state=active]:bg-blue-500 data-[state=active]:text-white","data-[state=inactive]:text-slate-700 data-[state=inactive]:hover:text-slate-900"),children:[u(b.location),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"truncate max-w-[100px]",children:b.location}),e.jsxs("div",{className:"flex items-center gap-2 text-xs opacity-75",children:[e.jsx(L,{variant:"secondary",className:"text-xs px-1 py-0",children:b.count}),e.jsx(Q,{className:"w-3 h-3"}),e.jsx("span",{children:b.attendance})]})]})]},b.location)),M.length>5&&e.jsx(H,{value:"more",className:"flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-md",disabled:!0,children:e.jsxs("span",{children:["+",M.length-5," more"]})})]}),e.jsx(se,{value:"all",className:"mt-6",children:R(l)}),M.map(b=>e.jsx(se,{value:b.location,className:"mt-6",children:R(l)},b.location))]})]}),T!=="all"&&e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[u(T),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900",children:T}),e.jsxs("p",{className:"text-sm text-slate-600",children:["Showing ",l.length," sessions with ",l.reduce((b,o)=>b+(o.checkedInCount||0),0)," total attendees"]})]}),e.jsx(G,{variant:"outline",size:"sm",onClick:()=>j("all"),className:"ml-auto",children:"View All Locations"})]})})]})},ls=({data:r,onMetricClick:T})=>{const R=(l=>{const u=l.length,b=l.filter(V=>V.status==="Active").length,o=l.filter(V=>V.status==="Churned").length,w=l.filter(V=>V.status==="Frozen").length,y=u>0?o/u*100:0,A=u>0?b/u*100:0,S=u>0?w/u*100:0;return[{title:"Total Memberships",value:D(u),change:0,description:"All tracked membership records",calculation:"Count of all membership records",icon:"Users",rawValue:u},{title:"Active Members",value:D(b),change:0,description:`${J(A)} of total memberships`,calculation:"Count of active status",icon:"CheckCircle",rawValue:b},{title:"Churned Members",value:D(o),change:0,description:`${J(y)} churn rate`,calculation:"Count of churned status",icon:"AlertTriangle",rawValue:o},{title:"Frozen Members",value:D(w),change:0,description:`${J(S)} of total memberships`,calculation:"Count of frozen status",icon:"Clock",rawValue:w}]})(r),M=l=>{switch(l){case"Users":return Q;case"CheckCircle":return Ot;case"AlertTriangle":return Be;case"Clock":return Fe;default:return oe}},v=(l,u)=>["from-blue-500 to-blue-600","from-green-500 to-green-600","from-red-500 to-red-600","from-yellow-500 to-yellow-600"][u]||"from-slate-500 to-slate-600",N=l=>l.title==="Active Members"?r.filter(u=>u.status==="Active"):l.title==="Churned Members"?r.filter(u=>u.status==="Churned"):l.title==="Frozen Members"?r.filter(u=>u.status==="Frozen"):r;return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:R.map((l,u)=>{const b=M(l.icon),o=v(l,u);return e.jsx(F,{className:te("relative overflow-hidden border-0 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:scale-105","bg-gradient-to-br",o),onClick:()=>{const w=N(l);T?.(w,l.title.toLowerCase())},children:e.jsxs(z,{className:"p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg backdrop-blur-sm",children:e.jsx(b,{className:"w-6 h-6 text-white"})}),e.jsx(L,{className:"bg-white/20 text-white border-0 backdrop-blur-sm",children:u===0?"Total":u===1?"Active":u===2?"Churned":"Frozen"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-3xl font-bold text-white",children:l.value}),e.jsx("div",{className:"text-white/90 font-medium",children:l.title}),e.jsx("div",{className:"text-white/70 text-sm",children:l.description})]}),e.jsx("div",{className:"absolute -right-4 -bottom-4 w-24 h-24 bg-white/10 rounded-full"}),e.jsx("div",{className:"absolute -right-2 -bottom-2 w-16 h-16 bg-white/5 rounded-full"})]})},u)})})},is=({isOpen:r,onClose:T,data:j,type:R})=>{if(!j)return null;const M=Array.isArray(j)&&j.length>0&&j[0].hasOwnProperty("status"),v=()=>{if(!M)return null;const S=j,V=S.filter(x=>x.status==="Active").length,k=S.filter(x=>x.status==="Churned").length,g=S.filter(x=>x.status==="Frozen").length;return e.jsxs(F,{className:"bg-gradient-to-br from-slate-50 to-slate-100 border-slate-200",children:[e.jsx(K,{children:e.jsxs(W,{className:"flex items-center gap-2 text-slate-800",children:[e.jsx(Q,{className:"w-5 h-5"}),"Member Details (",S.length," total)"]})}),e.jsxs(z,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:V}),e.jsx("div",{className:"text-sm text-green-600",children:"Active"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:k}),e.jsx("div",{className:"text-sm text-red-600",children:"Churned"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:g}),e.jsx("div",{className:"text-sm text-yellow-600",children:"Frozen"})]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:S.slice(0,50).map((x,n)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-slate-800",children:[x.firstName," ",x.lastName]}),e.jsxs("div",{className:"text-sm text-slate-600",children:[x.email," • ",x.membershipName]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-sm font-medium ${x.status==="Active"?"text-green-600":x.status==="Churned"?"text-red-600":"text-yellow-600"}`,children:x.status}),e.jsxs("div",{className:"text-xs text-slate-500",children:["End: ",x.endDate]})]})]},n))})]})]})},N=(S,V=0)=>{const k=Number(S);return isNaN(k)?V:k},u=(()=>{const S=j.filteredTransactionData||j.rawData||j.transactionData||[];if(R==="product"&&j.name){const V=j.name;let k=S;return!j.filteredTransactionData&&S.length>0&&(k=S.filter(g=>g.productName===V||g.membershipName===V||g.itemName===V||g.cleanedProduct===V||g.paymentItem===V)),{...j,filteredData:k,specificRevenue:j.specificRevenue||k.reduce((g,x)=>g+(x.paymentValue||0),0),specificTransactions:j.specificTransactions||k.length,specificCustomers:j.specificCustomers||new Set(k.map(g=>g.memberId||g.customerEmail)).size}}if(R==="category"&&j.name){const V=j.name;let k=S;return!j.filteredTransactionData&&S.length>0&&(k=S.filter(g=>g.cleanedCategory===V||g.category===V)),{...j,filteredData:k,specificRevenue:j.specificRevenue||k.reduce((g,x)=>g+(x.paymentValue||0),0),specificTransactions:j.specificTransactions||k.length,specificCustomers:j.specificCustomers||new Set(k.map(g=>g.memberId||g.customerEmail)).size}}return R==="trainer"&&j.teacherName?{name:j.teacherName,location:j.location,classType:j.classType||"Mixed",totalSessions:j.sessions||j.totalSessions||0,totalRevenue:j.revenue||j.totalPaid||0,totalCustomers:j.customers||j.totalCustomers||0,utilization:j.utilization||0,avgCheckedIn:j.avgCheckedIn||0,cancellationRate:j.cancellationRate||0}:{...j,filteredData:S,specificRevenue:j.specificRevenue,specificTransactions:j.specificTransactions,specificCustomers:j.specificCustomers}})(),b=()=>{const S=N(u.specificRevenue||u.totalRevenue||u.revenue||u.grossRevenue),V=N(u.specificTransactions||u.transactions||u.totalTransactions),k=N(u.specificCustomers||u.uniqueMembers||u.totalCustomers||u.customers),g=N(u.totalChange||u.change||u.growth);return e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(F,{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white border-0 shadow-lg",children:e.jsxs(z,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(qe,{className:"w-5 h-5 text-blue-100"}),e.jsx(L,{className:"bg-white/20 text-white border-0",children:"Revenue"})]}),e.jsx("div",{className:"text-2xl font-bold",children:_(S)}),e.jsx("div",{className:"text-blue-100 text-sm",children:"Total Revenue"})]})}),e.jsx(F,{className:"bg-gradient-to-br from-green-500 to-green-600 text-white border-0 shadow-lg",children:e.jsxs(z,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Q,{className:"w-5 h-5 text-green-100"}),e.jsx(L,{className:"bg-white/20 text-white border-0",children:"Customers"})]}),e.jsx("div",{className:"text-2xl font-bold",children:D(k)}),e.jsx("div",{className:"text-green-100 text-sm",children:"Unique Customers"})]})}),e.jsx(F,{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white border-0 shadow-lg",children:e.jsxs(z,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Et,{className:"w-5 h-5 text-purple-100"}),e.jsx(L,{className:"bg-white/20 text-white border-0",children:"Volume"})]}),e.jsx("div",{className:"text-2xl font-bold",children:D(V)}),e.jsx("div",{className:"text-purple-100 text-sm",children:"Transactions"})]})}),e.jsx(F,{className:"bg-gradient-to-br from-orange-500 to-orange-600 text-white border-0 shadow-lg",children:e.jsxs(z,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[g>=0?e.jsx(oe,{className:"w-5 h-5 text-orange-100"}):e.jsx(Oe,{className:"w-5 h-5 text-orange-100"}),e.jsx(L,{className:"bg-white/20 text-white border-0",children:"Growth"})]}),e.jsx("div",{className:"text-2xl font-bold",children:g!==0?`${g>0?"+":""}${g.toFixed(1)}%`:"N/A"}),e.jsx("div",{className:"text-orange-100 text-sm",children:"Performance"})]})})]})},o=()=>R!=="trainer"?null:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(F,{className:"bg-gradient-to-br from-slate-50 to-slate-100 border-slate-200",children:[e.jsx(K,{children:e.jsxs(W,{className:"flex items-center gap-2 text-slate-800",children:[e.jsx($e,{className:"w-5 h-5"}),"Class Performance"]})}),e.jsx(z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("div",{className:"text-sm text-slate-600",children:"Total Sessions"}),e.jsx("div",{className:"text-xl font-bold text-slate-800",children:D(u.totalSessions)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("div",{className:"text-sm text-slate-600",children:"Avg Check-in"}),e.jsx("div",{className:"text-xl font-bold text-blue-600",children:D(u.avgCheckedIn)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("div",{className:"text-sm text-slate-600",children:"Utilization"}),e.jsx("div",{className:`text-xl font-bold ${u.utilization>=80?"text-green-600":"text-orange-600"}`,children:J(u.utilization/100)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("div",{className:"text-sm text-slate-600",children:"Cancellation Rate"}),e.jsx("div",{className:`text-xl font-bold ${u.cancellationRate<=10?"text-green-600":"text-red-600"}`,children:J(u.cancellationRate/100)})]})]})})]}),e.jsxs(F,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx(K,{children:e.jsxs(W,{className:"flex items-center gap-2 text-blue-800",children:[e.jsx(Le,{className:"w-5 h-5"}),"Performance Insights"]})}),e.jsxs(z,{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 bg-white rounded-lg border-l-4 border-blue-400",children:[e.jsx("div",{className:"text-sm font-medium text-blue-800",children:"Class Type"}),e.jsx("div",{className:"text-blue-600",children:u.classType})]}),e.jsxs("div",{className:"p-3 bg-white rounded-lg border-l-4 border-green-400",children:[e.jsx("div",{className:"text-sm font-medium text-green-800",children:"Revenue/Session"}),e.jsx("div",{className:"text-green-600",children:_(u.totalSessions>0?u.totalRevenue/u.totalSessions:0)})]}),e.jsxs("div",{className:"p-3 bg-white rounded-lg border-l-4 border-purple-400",children:[e.jsx("div",{className:"text-sm font-medium text-purple-800",children:"Customer/Session"}),e.jsx("div",{className:"text-purple-600",children:(u.totalSessions>0?u.totalCustomers/u.totalSessions:0).toFixed(1)})]})]})]})]}),w=()=>{const S=u.filteredData||u.rawData||[];return S.length===0?null:e.jsxs(F,{className:"bg-gradient-to-br from-slate-50 to-slate-100",children:[e.jsx(K,{children:e.jsxs(W,{className:"flex items-center gap-2 text-slate-800",children:[e.jsx(ue,{className:"w-5 h-5"}),"Transaction Details"]})}),e.jsxs(z,{children:[e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:S.slice(0,20).map((V,k)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-slate-800",children:V.membershipName||V.productName||V.itemName||"Transaction"}),e.jsxs("div",{className:"text-sm text-slate-600",children:[V.customerEmail||V.memberId," • ",V.date||"N/A"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-slate-800",children:_(V.paymentValue||V.amount||0)}),e.jsx("div",{className:"text-sm text-slate-600",children:V.paymentMethod||"N/A"})]})]},k))}),S.length>20&&e.jsxs("div",{className:"mt-4 text-center text-sm text-slate-600",children:["Showing 20 of ",S.length," transactions"]})]})]})},y=()=>R==="trainer"?`${u.name} - Trainer Performance`:R==="product"?`${u.name} - Product Analysis`:R==="class"?`${u.classType||"Class"} - Detailed Analytics`:`${u.name||"Item"} - Performance Analysis`,A=()=>R==="trainer"?`${u.location} • ${u.classType} Classes`:R==="product"?"Comprehensive product performance and customer insights":"Detailed performance breakdown and analytics";return e.jsx(Je,{open:r,onOpenChange:T,children:e.jsxs(_e,{className:"max-w-7xl max-h-[95vh] overflow-y-auto bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-2xl",children:[e.jsx(Xe,{className:"pb-6 border-b border-slate-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Qe,{className:"text-3xl font-bold bg-gradient-to-r from-slate-800 via-blue-600 to-purple-600 bg-clip-text text-transparent",children:y()}),e.jsx("p",{className:"text-slate-600 mt-2 text-lg",children:A()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"bg-blue-100 text-blue-800 border-0",children:R==="trainer"?"Trainer":R==="product"?"Product":"Analytics"}),e.jsx(G,{variant:"outline",onClick:T,children:"Close"})]})]})}),e.jsxs("div",{className:"pt-6 space-y-8",children:[b(),e.jsxs(ze,{defaultValue:"overview",className:"w-full",children:[e.jsxs(Ee,{className:"grid w-full grid-cols-4 bg-slate-100",children:[e.jsxs(H,{value:"overview",className:"gap-2",children:[e.jsx(kt,{className:"w-4 h-4"}),"Overview"]}),e.jsxs(H,{value:"performance",className:"gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Performance"]}),e.jsxs(H,{value:"details",className:"gap-2",children:[e.jsx(ue,{className:"w-4 h-4"}),"Details"]}),e.jsxs(H,{value:"insights",className:"gap-2",children:[e.jsx(nt,{className:"w-4 h-4"}),"Insights"]})]}),e.jsxs(se,{value:"overview",className:"space-y-6",children:[v(),o(),e.jsxs(F,{className:"bg-gradient-to-br from-indigo-50 to-indigo-100 border-indigo-200",children:[e.jsx(K,{children:e.jsx(W,{className:"text-indigo-800",children:"Summary Statistics"})}),e.jsx(z,{children:e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:_(u.specificRevenue||u.totalRevenue||0)}),e.jsx("div",{className:"text-sm text-indigo-600",children:"Total Revenue"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:D(u.specificTransactions||u.transactions||0)}),e.jsx("div",{className:"text-sm text-green-600",children:"Transactions"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:D(u.specificCustomers||u.customers||0)}),e.jsx("div",{className:"text-sm text-purple-600",children:"Customers"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:_((u.specificTransactions||u.transactions)>0?(u.specificRevenue||u.totalRevenue||0)/(u.specificTransactions||u.transactions||1):0)}),e.jsx("div",{className:"text-sm text-orange-600",children:"Avg Transaction"})]})]})})]})]}),e.jsx(se,{value:"performance",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(F,{className:"bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsx(K,{children:e.jsx(W,{className:"text-green-800",children:"Performance Metrics"})}),e.jsxs(z,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white rounded-lg",children:[e.jsx("span",{className:"text-green-700",children:"Revenue Growth"}),e.jsxs(L,{className:"bg-green-200 text-green-800",children:[u.totalChange>0?"+":"",u.totalChange?.toFixed(1)||0,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white rounded-lg",children:[e.jsx("span",{className:"text-green-700",children:"Performance Rating"}),e.jsx(L,{className:"bg-green-200 text-green-800",children:(u.specificRevenue||u.totalRevenue||0)>5e4?"Excellent":"Good"})]})]})]}),e.jsxs(F,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx(K,{children:e.jsx(W,{className:"text-blue-800",children:"Key Insights"})}),e.jsxs(z,{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 bg-white rounded-lg border-l-4 border-blue-400",children:[e.jsx("div",{className:"text-sm font-medium text-blue-800",children:"Market Position"}),e.jsx("div",{className:"text-blue-600",children:"Strong performer in category"})]}),e.jsxs("div",{className:"p-3 bg-white rounded-lg border-l-4 border-green-400",children:[e.jsx("div",{className:"text-sm font-medium text-green-800",children:"Customer Loyalty"}),e.jsx("div",{className:"text-green-600",children:"High retention rate"})]})]})]})]})}),e.jsx(se,{value:"details",children:w()}),e.jsx(se,{value:"insights",children:e.jsxs(F,{className:"bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx(K,{children:e.jsx(W,{className:"text-purple-800",children:"AI-Powered Insights"})}),e.jsx(z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-white rounded-lg border-l-4 border-purple-400",children:[e.jsx("h4",{className:"font-medium text-purple-800 mb-2",children:"Strengths"}),e.jsxs("ul",{className:"text-sm text-purple-600 space-y-1",children:[e.jsx("li",{children:"• Consistent revenue performance"}),e.jsx("li",{children:"• Strong customer engagement"}),e.jsx("li",{children:"• Effective conversion rates"})]})]}),e.jsxs("div",{className:"p-4 bg-white rounded-lg border-l-4 border-orange-400",children:[e.jsx("h4",{className:"font-medium text-orange-800 mb-2",children:"Opportunities"}),e.jsxs("ul",{className:"text-sm text-orange-600 space-y-1",children:[e.jsx("li",{children:"• Expand successful programs"}),e.jsx("li",{children:"• Optimize capacity utilization"}),e.jsx("li",{children:"• Enhance retention strategies"})]})]})]})})]})})]})]})]})})},vt=["#6366f1","#8b5cf6","#ec4899","#f59e0b","#10b981","#ef4444","#06b6d4","#84cc16"],cs=({data:r})=>{const T=r.reduce((b,o)=>{const w=o.status||"Unknown";return b[w]=(b[w]||0)+1,b},{}),j=Object.entries(T).map(([b,o])=>({name:b,value:o})),R=r.reduce((b,o)=>{const w=o.membershipName||"Unknown";return b[w]=(b[w]||0)+1,b},{}),M=Object.entries(R).map(([b,o])=>({name:b.length>20?b.substring(0,20)+"...":b,value:o})).sort((b,o)=>o.value-b.value).slice(0,8),v=r.reduce((b,o)=>{if(o.endDate){const w=new Date(o.endDate).toLocaleDateString("en-US",{month:"short",year:"2-digit"});b[w]=(b[w]||0)+1}return b},{}),N=Object.entries(v).map(([b,o])=>({month:b,count:o})).sort((b,o)=>b.month.localeCompare(o.month)).slice(0,12),l=r.reduce((b,o)=>{const w=o.homeLocation||"Unknown",y=o.status||"Unknown";return b[w]||(b[w]={}),b[w][y]=(b[w][y]||0)+1,b},{}),u=Object.entries(l).map(([b,o])=>({location:b.length>15?b.substring(0,15)+"...":b,...o}));return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs(F,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full"}),"Membership Status Distribution"]})}),e.jsx(z,{children:e.jsx(je,{width:"100%",height:300,children:e.jsxs(Mt,{children:[e.jsx(St,{data:j,cx:"50%",cy:"50%",labelLine:!1,label:({name:b,percent:o})=>`${b} ${(o*100).toFixed(1)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:j.map((b,o)=>e.jsx(Dt,{fill:vt[o%vt.length]},`cell-${o}`))}),e.jsx(be,{formatter:b=>[D(b),"Count"]})]})})})]}),e.jsxs(F,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-green-500 to-blue-500 rounded-full"}),"Top Membership Types"]})}),e.jsx(z,{children:e.jsx(je,{width:"100%",height:300,children:e.jsxs(We,{data:M,layout:"horizontal",children:[e.jsx(Ve,{strokeDasharray:"3 3"}),e.jsx(Pe,{type:"number"}),e.jsx(Ie,{dataKey:"name",type:"category",width:100}),e.jsx(be,{formatter:b=>[D(b),"Members"]}),e.jsx(Se,{dataKey:"value",fill:"#6366f1"})]})})})]}),e.jsxs(F,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full"}),"Monthly Expiration Trend"]})}),e.jsx(z,{children:e.jsx(je,{width:"100%",height:300,children:e.jsxs(Tt,{data:N,children:[e.jsx(Ve,{strokeDasharray:"3 3"}),e.jsx(Pe,{dataKey:"month"}),e.jsx(Ie,{}),e.jsx(be,{formatter:b=>[D(b),"Expirations"]}),e.jsx(Ye,{type:"monotone",dataKey:"count",stroke:"#8b5cf6",fill:"#8b5cf6",fillOpacity:.3})]})})})]}),e.jsxs(F,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-orange-500 to-red-500 rounded-full"}),"Status by Location"]})}),e.jsx(z,{children:e.jsx(je,{width:"100%",height:300,children:e.jsxs(We,{data:u,children:[e.jsx(Ve,{strokeDasharray:"3 3"}),e.jsx(Pe,{dataKey:"location"}),e.jsx(Ie,{}),e.jsx(be,{}),e.jsx(At,{}),e.jsx(Se,{dataKey:"Active",stackId:"a",fill:"#10b981"}),e.jsx(Se,{dataKey:"Churned",stackId:"a",fill:"#ef4444"}),e.jsx(Se,{dataKey:"Frozen",stackId:"a",fill:"#f59e0b"})]})})})]})]})},os=({data:r,onRowClick:T})=>{const[j,R]=P.useState(""),[M,v]=P.useState("endDate"),[N,l]=P.useState("asc"),u=g=>{M===g?l(N==="asc"?"desc":"asc"):(v(g),l("asc"))},b=r.filter(g=>{const x=j.toLowerCase();return g.firstName?.toLowerCase().includes(x)||g.lastName?.toLowerCase().includes(x)||g.email?.toLowerCase().includes(x)||g.membershipName?.toLowerCase().includes(x)||g.status?.toLowerCase().includes(x)}).sort((g,x)=>{const n=g[M]||"",c=x[M]||"",m=N==="asc"?1:-1;return n.localeCompare(c)*m}),o=b.filter(g=>g.status==="Churned"),w=b.filter(g=>g.status==="Frozen"),y=b.filter(g=>g.status==="Active"),A=r.reduce((g,x)=>{const n=x.membershipName||"Unknown";return g[n]||(g[n]={name:n,total:0,active:0,churned:0,frozen:0}),g[n].total++,x.status==="Active"&&g[n].active++,x.status==="Churned"&&g[n].churned++,x.status==="Frozen"&&g[n].frozen++,g},{}),S=Object.values(A).sort((g,x)=>x.total-g.total),V=({field:g,children:x})=>e.jsxs(G,{variant:"ghost",size:"sm",onClick:()=>u(g),className:"h-auto p-1 font-medium text-slate-700 hover:text-slate-900",children:[x,M===g&&(N==="asc"?e.jsx(Bt,{className:"ml-1 h-3 w-3"}):e.jsx(Ut,{className:"ml-1 h-3 w-3"}))]}),k=g=>e.jsx(L,{variant:"outline",className:te("text-xs",g==="Churned"?"border-red-200 bg-red-50 text-red-700":g==="Frozen"?"border-yellow-200 bg-yellow-50 text-yellow-700":"border-green-200 bg-green-50 text-green-700"),children:g});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(F,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg",children:e.jsx(z,{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(qt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 h-4 w-4"}),e.jsx(Re,{placeholder:"Search by name, email, membership, or status...",value:j,onChange:g=>R(g.target.value),className:"pl-10 border-slate-300 focus:border-blue-500 focus:ring-blue-500"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(F,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-red-600 to-red-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),"Churned Memberships (",D(o.length),")"]})}),e.jsx(z,{children:e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-white/90",children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(V,{field:"firstName",children:"Member"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(V,{field:"membershipName",children:"Membership"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(V,{field:"endDate",children:"End Date"})}),e.jsx("th",{className:"text-left py-2 px-3",children:"Status"})]})}),e.jsx("tbody",{children:o.slice(0,50).map((g,x)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50 cursor-pointer",onClick:()=>T?.(g),children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:`${g.firstName} ${g.lastName}`}),e.jsx("td",{className:"py-2 px-3 text-slate-600 text-xs",children:g.membershipName}),e.jsx("td",{className:"py-2 px-3 text-slate-600",children:g.endDate}),e.jsx("td",{className:"py-2 px-3",children:k(g.status)})]},x))})]})})})]}),e.jsxs(F,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-yellow-600 to-yellow-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),"Frozen Memberships (",D(w.length),")"]})}),e.jsx(z,{children:e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-white/90",children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(V,{field:"firstName",children:"Member"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(V,{field:"membershipName",children:"Membership"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(V,{field:"endDate",children:"End Date"})}),e.jsx("th",{className:"text-left py-2 px-3",children:"Status"})]})}),e.jsx("tbody",{children:w.slice(0,50).map((g,x)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50 cursor-pointer",onClick:()=>T?.(g),children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:`${g.firstName} ${g.lastName}`}),e.jsx("td",{className:"py-2 px-3 text-slate-600 text-xs",children:g.membershipName}),e.jsx("td",{className:"py-2 px-3 text-slate-600",children:g.endDate}),e.jsx("td",{className:"py-2 px-3",children:k(g.status)})]},x))})]})})})]}),e.jsxs(F,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-green-600 to-green-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Active Memberships (",D(y.length),")"]})}),e.jsx(z,{children:e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-white/90",children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(V,{field:"firstName",children:"Member"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(V,{field:"membershipName",children:"Membership"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(V,{field:"endDate",children:"End Date"})}),e.jsx("th",{className:"text-left py-2 px-3",children:"Status"})]})}),e.jsx("tbody",{children:y.slice(0,50).map((g,x)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50 cursor-pointer",onClick:()=>T?.(g),children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:`${g.firstName} ${g.lastName}`}),e.jsx("td",{className:"py-2 px-3 text-slate-600 text-xs",children:g.membershipName}),e.jsx("td",{className:"py-2 px-3 text-slate-600",children:g.endDate}),e.jsx("td",{className:"py-2 px-3",children:k(g.status)})]},x))})]})})})]}),e.jsxs(F,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-slate-500 to-slate-600 rounded-full"}),"Membership Type Summary"]})}),e.jsx(z,{children:e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-white/90",children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium text-slate-700",children:"Membership"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-slate-700",children:"Total"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-green-600",children:"Active"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-yellow-600",children:"Frozen"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-red-600",children:"Churned"})]})}),e.jsx("tbody",{children:S.map((g,x)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50",children:[e.jsx("td",{className:"py-2 px-3 font-medium text-xs",children:g.name}),e.jsx("td",{className:"py-2 px-3 text-center font-medium",children:D(g.total)}),e.jsx("td",{className:"py-2 px-3 text-center text-green-600",children:D(g.active)}),e.jsx("td",{className:"py-2 px-3 text-center text-yellow-600",children:D(g.frozen)}),e.jsx("td",{className:"py-2 px-3 text-center text-red-600",children:D(g.churned)})]},x))})]})})})]})]})]})},ds=({data:r})=>{const T=r.reduce((o,w)=>{const y=w.homeLocation||"Unknown";return o[y]||(o[y]={name:y,total:0,active:0,churned:0,frozen:0,churnRate:0}),o[y].total++,w.status==="Active"&&o[y].active++,w.status==="Churned"&&o[y].churned++,w.status==="Frozen"&&o[y].frozen++,o},{});Object.values(T).forEach(o=>{o.churnRate=o.total>0?o.churned/o.total*100:0});const j=Object.values(T).sort((o,w)=>w.total-o.total),R=r.reduce((o,w)=>{const y=w.soldBy||"Unknown";return o[y]||(o[y]={name:y,total:0,active:0,churned:0,frozen:0,churnRate:0}),o[y].total++,w.status==="Active"&&o[y].active++,w.status==="Churned"&&o[y].churned++,w.status==="Frozen"&&o[y].frozen++,o},{});Object.values(R).forEach(o=>{o.churnRate=o.total>0?o.churned/o.total*100:0});const M=Object.values(R).filter(o=>o.name!=="Unknown"&&o.name!=="-").sort((o,w)=>w.total-o.total).slice(0,10),v=r.reduce((o,w)=>{if(w.endDate)try{const y=new Date(w.endDate),A=Ke(y,"MMM yyyy");o[A]||(o[A]={month:A,active:0,churned:0,frozen:0,total:0}),o[A].total++,w.status==="Active"&&o[A].active++,w.status==="Churned"&&o[A].churned++,w.status==="Frozen"&&o[A].frozen++}catch{}return o},{}),N=Object.values(v).sort((o,w)=>new Date(o.month).getTime()-new Date(w.month).getTime()).slice(-12),l=r.reduce((o,w)=>{const y=parseFloat(w.paid)||0,A=y>=1e4?"High Value (₹10K+)":y>=5e3?"Medium Value (₹5K-10K)":"Low Value (<₹5K)";return o[A]||(o[A]={category:A,total:0,active:0,churned:0,frozen:0,churnRate:0}),o[A].total++,w.status==="Active"&&o[A].active++,w.status==="Churned"&&o[A].churned++,w.status==="Frozen"&&o[A].frozen++,o},{});Object.values(l).forEach(o=>{o.churnRate=o.total>0?o.churned/o.total*100:0});const u=Object.values(l),b=o=>o>=50?"text-red-600":o>=30?"text-yellow-600":"text-green-600";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(F,{className:"bg-white/70 backdrop-blur-sm border-slate-200/50",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Location Performance Analysis"})}),e.jsx(z,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx(je,{width:"100%",height:300,children:e.jsxs(We,{data:j,children:[e.jsx(Ve,{strokeDasharray:"3 3"}),e.jsx(Pe,{dataKey:"name",angle:-45,textAnchor:"end",height:100,fontSize:12}),e.jsx(Ie,{}),e.jsx(be,{}),e.jsx(At,{}),e.jsx(Se,{dataKey:"active",stackId:"a",fill:"#10b981",name:"Active"}),e.jsx(Se,{dataKey:"frozen",stackId:"a",fill:"#f59e0b",name:"Frozen"}),e.jsx(Se,{dataKey:"churned",stackId:"a",fill:"#ef4444",name:"Churned"})]})})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium text-slate-700",children:"Location"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-slate-700",children:"Total"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-slate-700",children:"Churn Rate"})]})}),e.jsx("tbody",{children:j.map((o,w)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50",children:[e.jsx("td",{className:"py-2 px-3 font-medium text-xs",children:o.name}),e.jsx("td",{className:"py-2 px-3 text-center",children:D(o.total)}),e.jsx("td",{className:`py-2 px-3 text-center font-medium ${b(o.churnRate)}`,children:J(o.churnRate)})]},w))})]})})]})})]}),e.jsxs(F,{className:"bg-white/70 backdrop-blur-sm border-slate-200/50",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Top Sales Representatives by Membership Volume"})}),e.jsx(z,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium text-slate-700",children:"Sales Rep"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-slate-700",children:"Total Sold"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-green-600",children:"Active"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-yellow-600",children:"Frozen"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-red-600",children:"Churned"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-slate-700",children:"Churn Rate"})]})}),e.jsx("tbody",{children:M.map((o,w)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50",children:[e.jsx("td",{className:"py-2 px-3 font-medium text-xs",children:o.name}),e.jsx("td",{className:"py-2 px-3 text-center font-medium",children:D(o.total)}),e.jsx("td",{className:"py-2 px-3 text-center text-green-600",children:D(o.active)}),e.jsx("td",{className:"py-2 px-3 text-center text-yellow-600",children:D(o.frozen)}),e.jsx("td",{className:"py-2 px-3 text-center text-red-600",children:D(o.churned)}),e.jsx("td",{className:`py-2 px-3 text-center font-medium ${b(o.churnRate)}`,children:J(o.churnRate)})]},w))})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(F,{className:"bg-white/70 backdrop-blur-sm border-slate-200/50",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Monthly Status Trend"})}),e.jsx(z,{children:e.jsx(je,{width:"100%",height:300,children:e.jsxs(Tt,{data:N,children:[e.jsx(Ve,{strokeDasharray:"3 3"}),e.jsx(Pe,{dataKey:"month",fontSize:12}),e.jsx(Ie,{}),e.jsx(be,{}),e.jsx(Ye,{type:"monotone",dataKey:"churned",stackId:"1",stroke:"#ef4444",fill:"#ef4444"}),e.jsx(Ye,{type:"monotone",dataKey:"frozen",stackId:"1",stroke:"#f59e0b",fill:"#f59e0b"}),e.jsx(Ye,{type:"monotone",dataKey:"active",stackId:"1",stroke:"#10b981",fill:"#10b981"})]})})})]}),e.jsxs(F,{className:"bg-white/70 backdrop-blur-sm border-slate-200/50",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Value Segment Performance"})}),e.jsx(z,{children:e.jsx("div",{className:"space-y-4",children:u.map((o,w)=>e.jsxs("div",{className:"p-4 bg-slate-50/50 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-medium text-slate-700",children:o.category}),e.jsxs(L,{variant:"outline",className:`${b(o.churnRate)} border-current`,children:[J(o.churnRate)," Churn"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Total"}),e.jsx("div",{className:"font-medium",children:D(o.total)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-green-600",children:"Active"}),e.jsx("div",{className:"font-medium text-green-600",children:D(o.active)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-yellow-600",children:"Frozen"}),e.jsx("div",{className:"font-medium text-yellow-600",children:D(o.frozen)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-red-600",children:"Churned"}),e.jsx("div",{className:"font-medium text-red-600",children:D(o.churned)})]})]})]},w))})})]})]})]})},Nt=[{id:"all",name:"All Locations",fullName:"All Locations"},{id:"kwality",name:"Kwality House, Kemps Corner",fullName:"Kwality House, Kemps Corner"},{id:"supreme",name:"Supreme HQ, Bandra",fullName:"Supreme HQ, Bandra"},{id:"kenkere",name:"Kenkere House",fullName:"Kenkere House"}],Ts=({data:r})=>{const[T,j]=P.useState("all"),[R,M]=P.useState(null),[v,N]=P.useState("expiration"),[l,u]=P.useState(()=>({dateRange:ft(),location:[],status:[],membershipType:[],soldBy:[]})),b=g=>{let x=[...g];return T!=="all"&&(x=x.filter(n=>T==="kwality"?n.homeLocation==="Kwality House, Kemps Corner":T==="supreme"?n.homeLocation==="Supreme HQ, Bandra":n.homeLocation?.includes("Kenkere")||n.homeLocation==="Kenkere House")),l.status?.length&&(x=x.filter(n=>l.status.some(c=>n.status?.toLowerCase().includes(c.toLowerCase())))),l.membershipType?.length&&(x=x.filter(n=>l.membershipType.some(c=>n.membershipName?.toLowerCase().includes(c.toLowerCase())))),l.soldBy?.length&&(x=x.filter(n=>l.soldBy.some(c=>n.soldBy?.toLowerCase().includes(c.toLowerCase())))),x},o=P.useMemo(()=>b(r||[]),[r,l,T]),w=g=>{const x=g.length,n=g.filter(a=>a.status==="Active").length,c=g.filter(a=>a.status==="Churned").length,m=g.filter(a=>a.status==="Frozen").length,d=x>0?c/x*100:0,s=x>0?n/x*100:0,i=x>0?m/x*100:0;return[{title:"Total Memberships",value:D(x),change:0,description:"All tracked membership records",calculation:"Count of all membership records",icon:"Users",rawValue:x},{title:"Active Members",value:D(n),change:0,description:`${J(s)} of total memberships`,calculation:"Count of active status",icon:"CheckCircle",rawValue:n},{title:"Churned Members",value:D(c),change:0,description:`${J(d)} churn rate`,calculation:"Count of churned status",icon:"AlertTriangle",rawValue:c},{title:"Frozen Members",value:D(m),change:0,description:`${J(i)} of total memberships`,calculation:"Count of frozen status",icon:"Clock",rawValue:m}]},y=()=>{const g=ft();u({dateRange:g,location:[],status:[],membershipType:[],soldBy:[]})};w(o);const A=(g,x="expiration")=>{M(g),N(x)},S=g=>{const x=g.reduce((d,s)=>{const i=s.membershipName||"Unknown";return d[i]=(d[i]||0)+1,d},{}),n=Object.entries(x).map(([d,s])=>({name:d,count:s})).sort((d,s)=>s.count-d.count),c=g.reduce((d,s)=>{const i=s.status||"Unknown";return d[i]=(d[i]||0)+1,d},{}),m=Object.entries(c).map(([d,s])=>({name:d,count:s})).sort((d,s)=>s.count-d.count);return{topMemberships:n,topStatuses:m}},{topMemberships:V,topStatuses:k}=S(o);return e.jsxs("div",{className:"w-full bg-gradient-to-br from-slate-50 via-purple-50/30 to-pink-50/20 rounded-lg",children:[e.jsx("div",{className:"sticky top-0 z-20 bg-white/95 backdrop-blur-lg border-b border-slate-200/50 rounded-t-lg",children:e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-slate-800 to-slate-600 bg-clip-text text-transparent",children:"Expirations & Churn Analytics"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Qt,{additionalData:{expirations:o},defaultFileName:"expirations-analysis"}),e.jsx(Zt,{})]})]}),e.jsx(ze,{value:T,onValueChange:j,className:"w-full",children:e.jsx(Ee,{className:"grid w-full grid-cols-4",children:Nt.map(g=>e.jsx(H,{value:g.id,className:"data-[state=active]:bg-gradient-to-r data-[state=active]:from-indigo-500 data-[state=active]:to-purple-600 data-[state=active]:text-white",children:g.name},g.id))})})]})}),e.jsx("div",{className:"p-6",children:e.jsx(ze,{value:T,onValueChange:j,className:"w-full",children:Nt.map(g=>e.jsx(se,{value:g.id,className:"mt-0",children:e.jsxs("div",{className:"space-y-8",children:[e.jsx(ns,{filters:l,onFiltersChange:x=>u(x),onReset:y}),e.jsx(ls,{data:o,onMetricClick:(x,n)=>A(x,"expiration")}),e.jsx(cs,{data:o}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(F,{className:"bg-white/70 backdrop-blur-sm border-slate-200/50",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Top Membership Types"})}),e.jsx(z,{children:e.jsx("div",{className:"space-y-2",children:V.slice(0,5).map((x,n)=>e.jsxs("div",{className:"flex justify-between items-center p-2 hover:bg-slate-50/50 rounded cursor-pointer",onClick:()=>A(o.filter(c=>c.membershipName===x.name),"expiration"),children:[e.jsx("span",{className:"text-sm text-slate-700",children:x.name}),e.jsx("span",{className:"text-sm font-medium text-slate-900",children:x.count})]},x.name))})})]}),e.jsxs(F,{className:"bg-white/70 backdrop-blur-sm border-slate-200/50",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Status Distribution"})}),e.jsx(z,{children:e.jsx("div",{className:"space-y-2",children:k.map((x,n)=>e.jsxs("div",{className:"flex justify-between items-center p-2 hover:bg-slate-50/50 rounded cursor-pointer",onClick:()=>A(o.filter(c=>c.status===x.name),"status"),children:[e.jsx("span",{className:"text-sm text-slate-700",children:x.name}),e.jsx("span",{className:"text-sm font-medium text-slate-900",children:x.count})]},x.name))})})]})]}),e.jsx(ds,{data:o}),e.jsx(os,{data:o,onRowClick:x=>A([x],"member")})]})},g.id))})}),R&&e.jsx(is,{isOpen:!!R,onClose:()=>M(null),data:R,type:"member"})]})},As=({data:r,onMetricClick:T})=>{const j=P.useMemo(()=>{if(!r||r.length===0)return[];const M=r.length,v=new Set(r.map(S=>S.memberId)).size,N=new Set(r.map(S=>S.location)).size,l=new Set(r.map(S=>S.cleanedClass)).size;new Set(r.map(S=>S.teacherName)).size;const u=v>0?M/v:0,b=-8.5,o=12.3,w=5.2,y=r.reduce((S,V)=>{const k=V.time?parseInt(V.time.split(":")[0]):0,g=k<12?"Morning":k<17?"Afternoon":"Evening";return S[g]=(S[g]||0)+1,S},{}),A=Object.entries(y).reduce((S,V)=>y[S[0]]>y[V[0]]?S:V)?.[0]||"N/A";return[{title:"Total Late Cancellations",value:D(M),change:b,icon:Kt,color:"red",description:"Total number of late cancellations across all locations",rawData:r,metricType:"total",totalCancellations:M,uniqueMembers:v,uniqueLocations:N},{title:"Affected Members",value:D(v),change:o,icon:Q,color:"orange",description:"Unique members who made late cancellations",rawData:r,metricType:"members",totalCancellations:M,uniqueMembers:v,uniqueLocations:N},{title:"Affected Locations",value:D(N),change:w,icon:Te,color:"blue",description:"Studio locations with late cancellations",rawData:r,metricType:"locations",totalCancellations:M,uniqueMembers:v,uniqueLocations:N},{title:"Avg per Member",value:D(Math.round(u*10)/10),change:-5.3,icon:Q,color:"purple",description:"Average late cancellations per member",rawData:r,metricType:"avg-member",totalCancellations:M,uniqueMembers:v,uniqueLocations:N},{title:"Affected Classes",value:D(l),change:8.7,icon:ae,color:"green",description:"Different class types with late cancellations",rawData:r,metricType:"classes",totalCancellations:M,uniqueMembers:v,uniqueLocations:N},{title:"Peak Time Slot",value:A,change:0,icon:Fe,color:"cyan",description:"Time slot with most late cancellations",rawData:r,metricType:"peak-time",totalCancellations:M,uniqueMembers:v,uniqueLocations:N,showPercentage:!1}]},[r]),R=M=>{if(T){const v={title:M.title,metricValue:M.totalCancellations,totalCancellations:M.totalCancellations,uniqueMembers:M.uniqueMembers,uniqueLocations:M.uniqueLocations,rawData:M.rawData,type:"metric"};T(v)}};return j.length===0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((M,v)=>e.jsx(F,{className:"bg-gray-100 animate-pulse",children:e.jsx(z,{className:"p-6",children:e.jsx("div",{className:"h-20 bg-gray-200 rounded"})})},v))}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:j.map((M,v)=>{const N=M.icon,l=M.change>0,u=M.showPercentage!==!1;return e.jsx(F,{className:te("bg-white shadow-xl border-0 overflow-hidden hover:shadow-2xl transition-all duration-500 group cursor-pointer","hover:scale-105 transform"),onClick:()=>R(M),style:{animationDelay:`${v*150}ms`},children:e.jsxs(z,{className:"p-0",children:[e.jsxs("div",{className:`bg-gradient-to-r ${M.color==="red"?"from-red-500 to-red-600":M.color==="orange"?"from-orange-500 to-orange-600":M.color==="blue"?"from-blue-500 to-indigo-600":M.color==="purple"?"from-purple-500 to-violet-600":M.color==="green"?"from-green-500 to-teal-600":"from-cyan-500 to-blue-600"} p-6 text-white relative overflow-hidden`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 transform translate-x-8 -translate-y-8 opacity-20",children:e.jsx(N,{className:"w-20 h-20"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(N,{className:"w-6 h-6"})}),e.jsx("h3",{className:"font-semibold text-sm",children:M.title})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-3xl font-bold",children:M.value}),u&&e.jsxs("div",{className:"flex items-center gap-2",children:[l?e.jsx(oe,{className:"w-4 h-4 text-green-200"}):e.jsx(Oe,{className:"w-4 h-4 text-red-200"}),e.jsxs("span",{className:`text-sm font-medium ${l?"text-green-200":"text-red-200"}`,children:[l?"+":"",M.change.toFixed(1),"%"]}),e.jsx("span",{className:"text-sm text-white/80",children:"vs last period"})]})]})]})]}),e.jsx("div",{className:"p-4 bg-gray-50",children:e.jsx("p",{className:"text-sm text-gray-600",children:M.description})})]})},v)})})},Rs=({data:r})=>{const[T,j]=P.useState("6m"),[R,M]=P.useState("monthly"),[v,N]=P.useState("count"),l=P.useMemo(()=>{if(!r||r.length===0)return[];const x=new Date;let n=new Date;switch(T){case"1m":n.setMonth(x.getMonth()-1);break;case"3m":n.setMonth(x.getMonth()-3);break;case"6m":n.setMonth(x.getMonth()-6);break;case"1y":n.setFullYear(x.getFullYear()-1);break;default:return r}return r.filter(c=>{if(!c.dateIST)return!1;const m=new Date(c.dateIST);return m>=n&&m<=x})},[r,T]),u=P.useMemo(()=>{if(!l.length)return[];const x=l.reduce((n,c)=>{if(!c.dateIST)return n;const m=new Date(c.dateIST),d=`${m.getFullYear()}-${String(m.getMonth()+1).padStart(2,"0")}`;return n[d]||(n[d]={month:m.toLocaleDateString("en",{month:"short",year:"numeric"}),count:0,members:new Set,locations:new Set}),n[d].count+=1,n[d].members.add(c.memberId),n[d].locations.add(c.location),n},{});return Object.values(x).map(n=>({...n,members:n.members.size,locations:n.locations.size})).sort((n,c)=>n.month.localeCompare(c.month))},[l]),b=P.useMemo(()=>{if(!l.length)return[];const x=l.reduce((c,m)=>{const d=m.location||"Unknown Location";return c[d]||(c[d]={name:d,count:0,members:new Set,classes:new Set}),c[d].count+=1,c[d].members.add(m.memberId),c[d].classes.add(m.cleanedClass),c},{});return Object.values(x).map(c=>({...c,members:c.members.size,classes:c.classes.size})).sort((c,m)=>m.count-c.count).slice(0,10)},[l]),o=P.useMemo(()=>{if(!l.length)return[];const x=l.reduce((n,c)=>{const m=c.cleanedClass||"Unknown Class";return n[m]||(n[m]=0),n[m]+=1,n},{});return Object.entries(x).map(([n,c])=>({name:n,value:c})).sort((n,c)=>c.value-n.value).slice(0,8)},[l]),w=P.useMemo(()=>{if(!l.length)return[];const x=l.reduce((c,m)=>{const d=m.dayOfWeek||"Unknown";return c[d]||(c[d]=0),c[d]+=1,c},{});return["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(c=>({day:c,count:x[c]||0}))},[l]),y=["#dc2626","#ea580c","#d97706","#ca8a04","#65a30d","#16a34a","#059669","#0891b2"],A=(x,n)=>D(Number(x)),S=P.useCallback(x=>{j(x)},[]),V=P.useCallback(x=>{M(x)},[]),k=P.useCallback(x=>{N(x)},[]);if(!r||r.length===0)return e.jsxs(F,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs(W,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-red-600"}),"Interactive Late Cancellations Charts"]})}),e.jsx(z,{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-slate-600",children:"No data available for charts"})})]});const g=()=>{switch(R){case"monthly":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(G,{variant:v==="count"?"default":"outline",size:"sm",onClick:()=>k("count"),children:"Cancellations"}),e.jsx(G,{variant:v==="members"?"default":"outline",size:"sm",onClick:()=>k("members"),children:"Unique Members"}),e.jsx(G,{variant:v==="locations"?"default":"outline",size:"sm",onClick:()=>k("locations"),children:"Locations"})]}),e.jsx(je,{width:"100%",height:400,children:e.jsxs(ss,{data:u,children:[e.jsx(Ve,{strokeDasharray:"3 3"}),e.jsx(Pe,{dataKey:"month"}),e.jsx(Ie,{tickFormatter:D}),e.jsx(be,{formatter:A}),e.jsx(as,{type:"monotone",dataKey:v,stroke:"#dc2626",strokeWidth:3,dot:{fill:"#dc2626",strokeWidth:2,r:4}})]})})]});case"locations":return e.jsx(je,{width:"100%",height:400,children:e.jsxs(We,{data:b,margin:{left:20,right:20,top:20,bottom:60},children:[e.jsx(Ve,{strokeDasharray:"3 3"}),e.jsx(Pe,{dataKey:"name",angle:-45,textAnchor:"end",height:100,interval:0}),e.jsx(Ie,{tickFormatter:D}),e.jsx(be,{formatter:A}),e.jsx(Se,{dataKey:"count",fill:"#dc2626"})]})});case"classes":return e.jsx(je,{width:"100%",height:400,children:e.jsxs(Mt,{children:[e.jsx(St,{data:o,cx:"50%",cy:"50%",labelLine:!1,label:({name:x,percent:n})=>`${x} ${(n*100).toFixed(0)}%`,outerRadius:120,fill:"#8884d8",dataKey:"value",children:o.map((x,n)=>e.jsx(Dt,{fill:y[n%y.length]},`cell-${n}`))}),e.jsx(be,{formatter:A})]})});case"dayofweek":return e.jsx(je,{width:"100%",height:400,children:e.jsxs(We,{data:w,children:[e.jsx(Ve,{strokeDasharray:"3 3"}),e.jsx(Pe,{dataKey:"day"}),e.jsx(Ie,{tickFormatter:D}),e.jsx(be,{formatter:A}),e.jsx(Se,{dataKey:"count",fill:"#ea580c"})]})});default:return null}};return e.jsxs(F,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs(W,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-red-600"}),"Interactive Late Cancellations Charts"]})}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 flex items-center gap-1",children:[e.jsx(ae,{className:"w-4 h-4"}),"Time Range:"]}),[{key:"1m",label:"Last Month"},{key:"3m",label:"Last 3 Months"},{key:"6m",label:"Last 6 Months"},{key:"1y",label:"Last Year"}].map(({key:x,label:n})=>e.jsx(G,{variant:T===x?"default":"outline",size:"sm",onClick:()=>S(x),children:n},x))]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 flex items-center gap-1",children:[e.jsx(oe,{className:"w-4 h-4"}),"Chart Type:"]}),e.jsxs(G,{variant:R==="monthly"?"default":"outline",size:"sm",onClick:()=>V("monthly"),className:"flex items-center gap-1",children:[e.jsx(Wt,{className:"w-4 h-4"}),"Monthly Trend"]}),e.jsxs(G,{variant:R==="locations"?"default":"outline",size:"sm",onClick:()=>V("locations"),className:"flex items-center gap-1",children:[e.jsx(ue,{className:"w-4 h-4"}),"By Location"]}),e.jsxs(G,{variant:R==="classes"?"default":"outline",size:"sm",onClick:()=>V("classes"),className:"flex items-center gap-1",children:[e.jsx(Yt,{className:"w-4 h-4"}),"By Class Type"]}),e.jsxs(G,{variant:R==="dayofweek"?"default":"outline",size:"sm",onClick:()=>V("dayofweek"),className:"flex items-center gap-1",children:[e.jsx(ue,{className:"w-4 h-4"}),"By Day of Week"]})]})]})}),e.jsx(z,{children:g()})]})},Vs=({data:r})=>{const[T,j]=P.useState("members"),R=P.useMemo(()=>{if(!r||r.length===0)return{top:[],bottom:[]};const l=(u,b)=>{const o=r.reduce((y,A)=>{const S=A[u]||"Unknown",V=A[b]||S;return y[S]||(y[S]={id:S,name:V,count:0,members:new Set,locations:new Set,classes:new Set,data:[]}),y[S].count+=1,y[S].members.add(A.memberId),y[S].locations.add(A.location),y[S].classes.add(A.cleanedClass),y[S].data.push(A),y},{}),w=Object.values(o).map(y=>({...y,uniqueMembers:y.members.size,uniqueLocations:y.locations.size,uniqueClasses:y.classes.size})).sort((y,A)=>A.count-y.count);return{top:w.slice(0,10),bottom:w.slice(-5).reverse()}};switch(T){case"members":return l("memberId","firstName");case"locations":return l("location","location");case"classes":return l("cleanedClass","cleanedClass");case"trainers":return l("teacherName","teacherName");case"memberships":return l("cleanedProduct","cleanedProduct");default:return{top:[],bottom:[]}}},[r,T]),M=()=>{switch(T){case"members":return Q;case"locations":return Te;case"classes":return ae;case"trainers":return at;case"memberships":return De;default:return Q}},v=()=>{switch(T){case"members":return"Members";case"locations":return"Locations";case"classes":return"Class Types";case"trainers":return"Trainers";case"memberships":return"Membership Types";default:return"Members"}},N=(l,u,b)=>{const o=M();return e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-100 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full text-white text-sm font-bold ${b?"bg-red-500":"bg-green-500"}`,children:u+1}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{className:"w-4 h-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 truncate max-w-48",title:l.name,children:T==="members"?`${l.name} ${r.find(w=>w.memberId===l.id)?.lastName||""}`:l.name}),T==="members"&&e.jsxs("p",{className:"text-sm text-gray-500",children:["ID: ",l.id]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[T==="members"&&e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[l.uniqueLocations," location",l.uniqueLocations!==1?"s":""]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[l.uniqueClasses," class type",l.uniqueClasses!==1?"s":""]})]}),T==="locations"&&e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[l.uniqueMembers," member",l.uniqueMembers!==1?"s":""]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[l.uniqueClasses," class type",l.uniqueClasses!==1?"s":""]})]}),e.jsxs(L,{variant:b?"destructive":"secondary",children:[D(l.count)," cancellation",l.count!==1?"s":""]})]})]},l.id)};return!r||r.length===0?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(F,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-bold text-slate-800",children:"Top Performers"})}),e.jsx(z,{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-slate-600",children:"No data available"})})]}),e.jsxs(F,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-bold text-slate-800",children:"Bottom Performers"})}),e.jsx(z,{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-slate-600",children:"No data available"})})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(F,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:e.jsxs(K,{className:"pb-4",children:[e.jsxs(W,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-red-600"}),"Top & Bottom ",v()," by Late Cancellations"]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:[{key:"members",label:"Members",icon:Q},{key:"locations",label:"Locations",icon:Te},{key:"classes",label:"Classes",icon:ae},{key:"trainers",label:"Trainers",icon:at},{key:"memberships",label:"Memberships",icon:De}].map(({key:l,label:u,icon:b})=>e.jsxs(G,{variant:T===l?"default":"outline",size:"sm",onClick:()=>j(l),className:"flex items-center gap-1",children:[e.jsx(b,{className:"w-4 h-4"}),u]},l))})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(F,{className:"bg-gradient-to-br from-white via-red-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-red-500"}),e.jsx(W,{className:"text-lg font-semibold text-gray-800",children:"Most Late Cancellations"}),e.jsxs(L,{variant:"destructive",children:[R.top.length," items"]})]})}),e.jsx(z,{children:e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:R.top.length>0?R.top.map((l,u)=>N(l,u,!0)):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No data available"})})})]}),e.jsxs(F,{className:"bg-gradient-to-br from-white via-green-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5 text-green-500"}),e.jsx(W,{className:"text-lg font-semibold text-gray-800",children:"Least Late Cancellations"}),e.jsxs(L,{variant:"secondary",children:[R.bottom.length," items"]})]})}),e.jsx(z,{children:e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:R.bottom.length>0?R.bottom.map((l,u)=>N(l,u,!1)):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No data available"})})})]})]})]})},Ue=100,Ps=({data:r,onDrillDown:T})=>{const[j,R]=P.useState("multiple-day"),[M,v]=P.useState(1),N=P.useMemo(()=>{if(!r||r.length===0)return[];const d=r.reduce((s,i)=>{if(!i.dateIST||!i.memberId)return s;const a=`${i.memberId}-${i.dateIST}`;return s[a]||(s[a]={memberId:i.memberId,memberName:`${i.firstName||""} ${i.lastName||""}`.trim(),email:i.email,date:i.dateIST,cancellations:[],count:0,locations:new Set,classes:new Set,trainers:new Set}),s[a].cancellations.push({sessionName:i.sessionName,time:i.time,location:i.location,teacherName:i.teacherName,cleanedClass:i.cleanedClass,cleanedProduct:i.cleanedProduct}),s[a].count+=1,s[a].locations.add(i.location),s[a].classes.add(i.cleanedClass),s[a].trainers.add(i.teacherName),s},{});return Object.values(d).filter(s=>s.count>1).map(s=>({...s,uniqueLocations:s.locations.size,uniqueClasses:s.classes.size,uniqueTrainers:s.trainers.size})).sort((s,i)=>i.count-s.count)},[r]),l=P.useMemo(()=>{if(!r||r.length===0)return[];const d=r.reduce((s,i)=>{if(!i.dateIST||!i.memberId)return s;const a=`${i.memberId}-${i.dateIST}`;return s[a]||(s[a]={memberId:i.memberId,memberName:`${i.firstName||""} ${i.lastName||""}`.trim(),email:i.email,date:i.dateIST,totalSessions:0,cancellations:0,sessionDetails:[]}),s[a].cancellations+=1,s[a].totalSessions+=1,s[a].sessionDetails.push({sessionName:i.sessionName,time:i.time,location:i.location,teacherName:i.teacherName,status:"cancelled"}),s},{});return Object.values(d).filter(s=>s.totalSessions>1).sort((s,i)=>i.totalSessions-s.totalSessions)},[r]),u=P.useMemo(()=>{if(!r||r.length===0)return[];const d=r.reduce((s,i)=>{const a=i.cleanedClass||"Unknown Class";if(s[a]||(s[a]={className:a,category:i.cleanedCategory||"Unknown",count:0,members:new Set,locations:new Set,trainers:new Set,totalDuration:0,totalRevenue:0,peakTimes:{},daysOfWeek:{}}),s[a].count+=1,s[a].members.add(i.memberId),s[a].locations.add(i.location),s[a].trainers.add(i.teacherName),s[a].totalDuration+=i.duration||0,s[a].totalRevenue+=i.paidAmount||0,i.time){const h=parseInt(i.time.split(":")[0]),t=h<12?"Morning":h<17?"Afternoon":"Evening";s[a].peakTimes[t]=(s[a].peakTimes[t]||0)+1}return i.dayOfWeek&&(s[a].daysOfWeek[i.dayOfWeek]=(s[a].daysOfWeek[i.dayOfWeek]||0)+1),s},{});return Object.values(d).map(s=>{const i=Object.entries(s.peakTimes).reduce((h,t)=>s.peakTimes[h[0]]>s.peakTimes[t[0]]?h:t,["N/A",0])[0],a=Object.entries(s.daysOfWeek).reduce((h,t)=>s.daysOfWeek[h[0]]>s.daysOfWeek[t[0]]?h:t,["N/A",0])[0];return{...s,uniqueMembers:s.members.size,uniqueLocations:s.locations.size,uniqueTrainers:s.trainers.size,avgDuration:s.count>0?Math.round(s.totalDuration/s.count):0,avgRevenue:s.count>0?s.totalRevenue/s.count:0,peakTime:i,peakDay:a}}).sort((s,i)=>i.count-s.count)},[r]),b=P.useMemo(()=>{if(!r||r.length===0)return[];const d=r.reduce((s,i)=>{const a=i.cleanedProduct||"Unknown Membership";return s[a]||(s[a]={membershipType:a,category:i.cleanedCategory||"Unknown",count:0,members:new Set,revenue:0,locations:new Set,classes:new Set,avgCancellationsPerMember:0}),s[a].count+=1,s[a].members.add(i.memberId),s[a].revenue+=i.paidAmount||0,s[a].locations.add(i.location),s[a].classes.add(i.cleanedClass),s},{});return Object.values(d).map(s=>({...s,uniqueMembers:s.members.size,uniqueLocations:s.locations.size,uniqueClasses:s.classes.size,avgRevenuePerCancellation:s.count>0?s.revenue/s.count:0,avgCancellationsPerMember:s.uniqueMembers>0?s.count/s.uniqueMembers:0})).sort((s,i)=>i.count-s.count)},[r]),o=d=>{const s=(M-1)*Ue,i=s+Ue;return d.slice(s,i)},w=d=>Math.ceil(d.length/Ue),A=(()=>{switch(j){case"multiple-day":return N;case"multiple-checkins":return l;case"by-class":return u;case"by-membership":return b;default:return[]}})(),S=o(A),V=w(A);Ae.useEffect(()=>{v(1)},[j]);const k=()=>e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t border-gray-200",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:e.jsxs("span",{children:["Showing ",(M-1)*Ue+1," to ",Math.min(M*Ue,A.length)," of ",A.length," results"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(G,{variant:"outline",size:"sm",onClick:()=>v(d=>Math.max(1,d-1)),disabled:M===1,className:"gap-1",children:[e.jsx(Gt,{className:"w-4 h-4"}),"Previous"]}),e.jsx("div",{className:"flex items-center gap-1",children:[...Array(Math.min(5,V))].map((d,s)=>{const i=Math.max(1,Math.min(V-4,M-2))+s;return i>V?null:e.jsx(G,{variant:i===M?"default":"outline",size:"sm",onClick:()=>v(i),className:"w-8 h-8 p-0",children:i},i)})}),e.jsxs(G,{variant:"outline",size:"sm",onClick:()=>v(d=>Math.min(V,d+1)),disabled:M===V,className:"gap-1",children:["Next",e.jsx(rt,{className:"w-4 h-4"})]})]})]}),g=(d,s,i)=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5 text-orange-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:s}),e.jsxs(L,{variant:"outline",className:"bg-orange-50 text-orange-700",children:[A.length," total members"]})]})}),Array.isArray(d)&&d.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(Ce,{children:[e.jsx(ke,{children:e.jsxs(ne,{children:[e.jsx(B,{children:"Member"}),e.jsx(B,{children:"Email"}),e.jsx(B,{children:"Date"}),e.jsx(B,{children:"Count"}),e.jsx(B,{children:"Details"}),e.jsx(B,{children:"Sessions"})]})}),e.jsx(Me,{children:d.map((a,h)=>e.jsxs(ne,{className:"h-[35px] max-h-[35px] hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>{T&&T({type:"member",title:`Member: ${a.memberName}`,data:a,rawData:a.cancellations||a.sessionDetails})},children:[e.jsx(U,{className:"font-medium h-[35px] py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-red-500 to-pink-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:a.memberName?a.memberName.charAt(0).toUpperCase():"U"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm truncate max-w-[150px]",children:a.memberName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",a.memberId]})]})]})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx("span",{className:"text-sm truncate max-w-[200px] block",children:a.email})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(L,{variant:"outline",className:"text-xs",children:new Date(a.date).toLocaleDateString()})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsxs(L,{variant:"destructive",className:"text-xs",children:[a.count," ",i==="multiple-day"?"cancellations":"sessions"]})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsxs("div",{className:"flex gap-1",children:[a.uniqueLocations&&e.jsxs(L,{variant:"outline",className:"text-xs",children:[a.uniqueLocations," loc"]}),a.uniqueClasses&&e.jsxs(L,{variant:"outline",className:"text-xs",children:[a.uniqueClasses," classes"]})]})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx("div",{className:"text-xs text-gray-600 max-w-[200px]",children:Array.isArray(i==="multiple-day"?a.cancellations:a.sessionDetails)?`${(i==="multiple-day"?a.cancellations:a.sessionDetails).length} sessions`:"No data"})})]},h))})]}),e.jsx(k,{})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No data available"})]}),x=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-blue-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cancellations by Class Type"}),e.jsxs(L,{variant:"outline",className:"bg-blue-50 text-blue-700",children:[A.length," class types"]})]})}),S.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(Ce,{children:[e.jsx(ke,{children:e.jsxs(ne,{className:"h-[35px]",children:[e.jsx(B,{children:"Class Type"}),e.jsx(B,{children:"Category"}),e.jsx(B,{children:"Cancellations"}),e.jsx(B,{children:"Members"}),e.jsx(B,{children:"Locations"}),e.jsx(B,{children:"Peak Time"}),e.jsx(B,{children:"Peak Day"}),e.jsx(B,{children:"Avg Duration"})]})}),e.jsx(Me,{children:S.map((d,s)=>e.jsxs(ne,{className:"h-[35px] max-h-[35px] hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>{T&&T({type:"class",title:`Class Type: ${d.className}`,data:d,rawData:r.filter(i=>i.cleanedClass===d.className)})},children:[e.jsx(U,{className:"font-medium h-[35px] py-2",children:e.jsx("span",{className:"truncate max-w-[150px] block",children:d.className})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(L,{variant:"secondary",children:d.category})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(L,{variant:"destructive",children:D(d.count)})}),e.jsx(U,{className:"h-[35px] py-2",children:D(d.uniqueMembers)}),e.jsx(U,{className:"h-[35px] py-2",children:D(d.uniqueLocations)}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(L,{variant:"outline",children:d.peakTime})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(L,{variant:"outline",children:d.peakDay})}),e.jsxs(U,{className:"h-[35px] py-2",children:[d.avgDuration," min"]})]},s))})]}),e.jsx(k,{})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No class type data available"})]}),n=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5 text-purple-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cancellations by Membership Type"}),e.jsxs(L,{variant:"outline",className:"bg-purple-50 text-purple-700",children:[A.length," membership types"]})]})}),S.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(Ce,{children:[e.jsx(ke,{children:e.jsxs(ne,{className:"h-[35px]",children:[e.jsx(B,{children:"Membership Type"}),e.jsx(B,{children:"Category"}),e.jsx(B,{children:"Cancellations"}),e.jsx(B,{children:"Members"}),e.jsx(B,{children:"Locations"}),e.jsx(B,{children:"Avg per Member"}),e.jsx(B,{children:"Revenue Impact"})]})}),e.jsx(Me,{children:S.map((d,s)=>e.jsxs(ne,{className:"h-[35px] max-h-[35px] hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>{},children:[e.jsx(U,{className:"font-medium h-[35px] py-2",children:e.jsx("span",{className:"truncate max-w-[200px] block",children:d.membershipType})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(L,{variant:"secondary",children:d.category})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(L,{variant:"destructive",children:D(d.count)})}),e.jsx(U,{className:"h-[35px] py-2",children:D(d.uniqueMembers)}),e.jsx(U,{className:"h-[35px] py-2",children:D(d.uniqueLocations)}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(L,{variant:"outline",children:(d.avgCancellationsPerMember||0).toFixed(1)})}),e.jsxs(U,{className:"h-[35px] py-2",children:["₹",(d.revenue||0).toFixed(2)]})]},s))})]}),e.jsx(k,{})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No membership type data available"})]}),c=()=>{const d=P.useMemo(()=>{if(!r||r.length===0)return[];const i=r.reduce((a,h)=>{const t=h.teacherName||"Unknown Trainer";return a[t]||(a[t]={trainerName:t,count:0,members:new Set,locations:new Set,classes:new Set,revenue:0,avgCancellationsPerSession:0,totalSessions:0}),a[t].count+=1,a[t].members.add(h.memberId),a[t].locations.add(h.location),a[t].classes.add(h.cleanedClass),a[t].revenue+=h.paidAmount||0,a[t].totalSessions+=1,a},{});return Object.values(i).map(a=>({...a,uniqueMembers:a.members.size,uniqueLocations:a.locations.size,uniqueClasses:a.classes.size,avgCancellationsPerSession:a.totalSessions>0?a.count/a.totalSessions:0})).sort((a,h)=>h.count-a.count)},[r]),s=o(d);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5 text-green-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cancellations by Trainer"}),e.jsxs(L,{variant:"outline",className:"bg-green-50 text-green-700",children:[d.length," trainers"]})]})}),s.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(Ce,{children:[e.jsx(ke,{children:e.jsxs(ne,{className:"h-[35px]",children:[e.jsx(B,{children:"Trainer Name"}),e.jsx(B,{children:"Cancellations"}),e.jsx(B,{children:"Affected Members"}),e.jsx(B,{children:"Classes"}),e.jsx(B,{children:"Locations"}),e.jsx(B,{children:"Revenue Impact"}),e.jsx(B,{children:"Avg per Session"})]})}),e.jsx(Me,{children:s.map((i,a)=>e.jsxs(ne,{className:"h-[35px] max-h-[35px]",children:[e.jsx(U,{className:"font-medium h-[35px] py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:i.trainerName.split(" ").map(h=>h[0]).join("").slice(0,2)}),e.jsx("span",{className:"truncate max-w-[120px]",children:i.trainerName})]})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(L,{variant:"destructive",children:D(i.count)})}),e.jsx(U,{className:"h-[35px] py-2",children:D(i.uniqueMembers)}),e.jsx(U,{className:"h-[35px] py-2",children:D(i.uniqueClasses)}),e.jsx(U,{className:"h-[35px] py-2",children:D(i.uniqueLocations)}),e.jsxs(U,{className:"h-[35px] py-2",children:["₹",i.revenue.toFixed(2)]}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(L,{variant:"outline",children:i.avgCancellationsPerSession.toFixed(2)})})]},a))})]}),e.jsx(k,{})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No trainer data available"})]})},m=()=>{const d=P.useMemo(()=>{if(!r||r.length===0)return[];const i=r.reduce((a,h)=>{const t=h.location||"Unknown Location";if(a[t]||(a[t]={locationName:t,count:0,members:new Set,trainers:new Set,classes:new Set,revenue:0,peakDays:{},peakTimes:{}}),a[t].count+=1,a[t].members.add(h.memberId),a[t].trainers.add(h.teacherName),a[t].classes.add(h.cleanedClass),a[t].revenue+=h.paidAmount||0,h.dayOfWeek&&(a[t].peakDays[h.dayOfWeek]=(a[t].peakDays[h.dayOfWeek]||0)+1),h.time){const p=parseInt(h.time.split(":")[0]),f=p<12?"Morning":p<17?"Afternoon":"Evening";a[t].peakTimes[f]=(a[t].peakTimes[f]||0)+1}return a},{});return Object.values(i).map(a=>{const h=Object.entries(a.peakDays).reduce((p,f)=>a.peakDays[p[0]]>a.peakDays[f[0]]?p:f,["N/A",0])[0],t=Object.entries(a.peakTimes).reduce((p,f)=>a.peakTimes[p[0]]>a.peakTimes[f[0]]?p:f,["N/A",0])[0];return{...a,uniqueMembers:a.members.size,uniqueTrainers:a.trainers.size,uniqueClasses:a.classes.size,peakDay:h,peakTime:t,avgRevenuePerCancellation:a.count>0?a.revenue/a.count:0}}).sort((a,h)=>h.count-a.count)},[r]),s=o(d);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5 text-indigo-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cancellations by Location"}),e.jsxs(L,{variant:"outline",className:"bg-indigo-50 text-indigo-700",children:[d.length," locations"]})]})}),s.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(Ce,{children:[e.jsx(ke,{children:e.jsxs(ne,{className:"h-[35px]",children:[e.jsx(B,{children:"Location"}),e.jsx(B,{children:"Cancellations"}),e.jsx(B,{children:"Members"}),e.jsx(B,{children:"Trainers"}),e.jsx(B,{children:"Classes"}),e.jsx(B,{children:"Peak Day"}),e.jsx(B,{children:"Peak Time"}),e.jsx(B,{children:"Revenue Impact"})]})}),e.jsx(Me,{children:s.map((i,a)=>e.jsxs(ne,{className:"h-[35px] max-h-[35px]",children:[e.jsx(U,{className:"font-medium h-[35px] py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-4 h-4 text-indigo-600"}),e.jsx("span",{className:"truncate max-w-[150px]",children:i.locationName})]})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(L,{variant:"destructive",children:D(i.count)})}),e.jsx(U,{className:"h-[35px] py-2",children:D(i.uniqueMembers)}),e.jsx(U,{className:"h-[35px] py-2",children:D(i.uniqueTrainers)}),e.jsx(U,{className:"h-[35px] py-2",children:D(i.uniqueClasses)}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(L,{variant:"outline",children:i.peakDay})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(L,{variant:"outline",children:i.peakTime})}),e.jsxs(U,{className:"h-[35px] py-2",children:["₹",i.revenue.toFixed(2)]})]},a))})]}),e.jsx(k,{})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No location data available"})]})};return e.jsxs(F,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs(W,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5 text-red-600"}),"Enhanced Late Cancellations Analysis",e.jsx(L,{variant:"outline",className:"bg-blue-50 text-blue-700",children:"Multiple analysis views with 35px row height"})]})}),e.jsx(z,{className:"p-0",children:e.jsxs(ze,{value:j,onValueChange:R,children:[e.jsx("div",{className:"px-6",children:e.jsxs(Ee,{className:"grid grid-cols-6 w-full mb-6",children:[e.jsxs(H,{value:"multiple-day",className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-4 w-4"}),"Multiple/Day"]}),e.jsxs(H,{value:"multiple-checkins",className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Check-ins/Day"]}),e.jsxs(H,{value:"by-class",className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"By Class"]}),e.jsxs(H,{value:"by-membership",className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4"}),"By Membership"]}),e.jsxs(H,{value:"by-trainer",className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"By Trainer"]}),e.jsxs(H,{value:"by-location",className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-4 w-4"}),"By Location"]})]})}),e.jsx(se,{value:"multiple-day",className:"mt-0",children:g(S,"Members with Multiple Late Cancellations per Day","multiple-day")}),e.jsx(se,{value:"multiple-checkins",className:"mt-0",children:g(S,"Members with Multiple Check-ins per Day","multiple-checkins")}),e.jsx(se,{value:"by-class",className:"mt-0",children:x()}),e.jsx(se,{value:"by-membership",className:"mt-0",children:n()}),e.jsx(se,{value:"by-trainer",className:"mt-0",children:c()}),e.jsx(se,{value:"by-location",className:"mt-0",children:m()})]})})]})};function Is({selectedLocation:r,onLocationChange:T,selectedTimeframe:j,onTimeframeChange:R,selectedTrainer:M,onTrainerChange:v,selectedClass:N,onClassChange:l,selectedProduct:u,onProductChange:b,selectedTimeSlot:o,onTimeSlotChange:w,dateRange:y,onDateRangeChange:A,data:S,onClearFilters:V}){const[k,g]=P.useState(!1),x=Ae.useMemo(()=>Array.from(new Set(S.map(a=>a.location).filter(Boolean))),[S]),n=Ae.useMemo(()=>Array.from(new Set(S.map(a=>a.teacherName).filter(Boolean))),[S]),c=Ae.useMemo(()=>Array.from(new Set(S.map(a=>a.cleanedClass).filter(Boolean))),[S]),m=Ae.useMemo(()=>Array.from(new Set(S.map(a=>a.cleanedProduct).filter(Boolean))),[S]),d=[{value:"all",label:"All Time"},{value:"prev-month",label:"Previous Month"},{value:"1w",label:"Last Week"},{value:"2w",label:"Last 2 Weeks"},{value:"1m",label:"Last Month"},{value:"3m",label:"Last 3 Months"},{value:"6m",label:"Last 6 Months"},{value:"1y",label:"Last 12 Months"},{value:"custom",label:"Custom Range"}],s=[{value:"all",label:"All Time Slots"},{value:"morning",label:"Morning (6-12)"},{value:"afternoon",label:"Afternoon (12-17)"},{value:"evening",label:"Evening (17-22)"},{value:"late",label:"Late Night (22+)"}],i=[r!=="all",j!=="all",M!=="all",N!=="all",u!=="all",o!=="all",y.start||y.end].filter(Boolean).length;return k?e.jsxs(F,{className:"bg-gradient-to-br from-white via-red-50/30 to-white border-0 shadow-xl overflow-hidden",children:[e.jsx(K,{className:"bg-gradient-to-r from-red-600 to-orange-600 text-white",children:e.jsxs(W,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(st,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Advanced Filters"}),e.jsx("p",{className:"text-red-100 text-sm",children:"Customize your late cancellations analysis"})]}),e.jsxs(L,{className:"bg-white/20 text-white border-white/30",children:[i," Active"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(G,{variant:"outline",size:"sm",onClick:V,disabled:i===0,className:"bg-white/10 border-white/30 text-white hover:bg-white/20",children:[e.jsx(pe,{className:"w-4 h-4 mr-1"}),"Reset"]}),e.jsx(G,{variant:"ghost",size:"sm",onClick:()=>g(!1),className:"text-white hover:bg-white/20",children:e.jsx(Ht,{className:"w-4 h-4"})})]})]})}),e.jsxs(z,{className:"p-8 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsx("h4",{className:"text-lg font-semibold text-slate-800",children:"Filter Options"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(me,{htmlFor:"location-select",className:"text-slate-700 flex items-center gap-2",children:[e.jsx(Te,{className:"w-4 h-4"}),"Location"]}),e.jsxs(ve,{value:r,onValueChange:T,children:[e.jsx(Ne,{id:"location-select",className:"bg-white border-slate-200",children:e.jsx(ye,{placeholder:"Select location"})}),e.jsxs(we,{className:"bg-white border-slate-200",children:[e.jsx(ce,{value:"all",children:"All Locations"}),x.map(a=>e.jsx(ce,{value:a,children:a},a))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(me,{htmlFor:"timeframe-select",className:"text-slate-700 flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Timeframe"]}),e.jsxs(ve,{value:j,onValueChange:R,children:[e.jsx(Ne,{id:"timeframe-select",className:"bg-white border-slate-200",children:e.jsx(ye,{placeholder:"Select timeframe"})}),e.jsx(we,{className:"bg-white border-slate-200",children:d.map(a=>e.jsx(ce,{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(me,{htmlFor:"trainer-select",className:"text-slate-700 flex items-center gap-2",children:[e.jsx(at,{className:"w-4 h-4"}),"Trainer"]}),e.jsxs(ve,{value:M,onValueChange:v,children:[e.jsx(Ne,{id:"trainer-select",className:"bg-white border-slate-200",children:e.jsx(ye,{placeholder:"Select trainer"})}),e.jsxs(we,{className:"bg-white border-slate-200",children:[e.jsx(ce,{value:"all",children:"All Trainers"}),n.map(a=>e.jsx(ce,{value:a,children:a},a))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(me,{htmlFor:"class-select",className:"text-slate-700 flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4"}),"Class Type"]}),e.jsxs(ve,{value:N,onValueChange:l,children:[e.jsx(Ne,{id:"class-select",className:"bg-white border-slate-200",children:e.jsx(ye,{placeholder:"Select class"})}),e.jsxs(we,{className:"bg-white border-slate-200",children:[e.jsx(ce,{value:"all",children:"All Classes"}),c.map(a=>e.jsx(ce,{value:a,children:a},a))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(me,{htmlFor:"product-select",className:"text-slate-300 flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4"}),"Product Type"]}),e.jsxs(ve,{value:u,onValueChange:b,children:[e.jsx(Ne,{id:"product-select",className:"bg-slate-800 border-slate-600 text-white",children:e.jsx(ye,{placeholder:"Select product"})}),e.jsxs(we,{className:"bg-slate-800 border-slate-600",children:[e.jsx(ce,{value:"all",className:"text-white hover:bg-slate-700",children:"All Products"}),m.map(a=>e.jsx(ce,{value:a,className:"text-white hover:bg-slate-700",children:a},a))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(me,{htmlFor:"timeslot-select",className:"text-slate-300 flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),"Time Slot"]}),e.jsxs(ve,{value:o,onValueChange:w,children:[e.jsx(Ne,{id:"timeslot-select",className:"bg-slate-800 border-slate-600 text-white",children:e.jsx(ye,{placeholder:"Select time slot"})}),e.jsx(we,{className:"bg-slate-800 border-slate-600",children:s.map(a=>e.jsx(ce,{value:a.value,className:"text-white hover:bg-slate-700",children:a.label},a.value))})]})]}),j==="custom"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(me,{htmlFor:"start-date",className:"text-slate-700",children:"Start Date"}),e.jsx(Re,{id:"start-date",type:"date",value:y.start,onChange:a=>A({...y,start:a.target.value}),className:"bg-white border-slate-200"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(me,{htmlFor:"end-date",className:"text-slate-700",children:"End Date"}),e.jsx(Re,{id:"end-date",type:"date",value:y.end,onChange:a=>A({...y,end:a.target.value}),className:"bg-white border-slate-200"})]})]})]})]})]}):e.jsx(F,{className:"bg-gradient-to-br from-white via-red-50/30 to-white border-0 shadow-xl",children:e.jsx(z,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-red-500 to-orange-500 rounded-lg",children:e.jsx(st,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-800",children:"Advanced Filters"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Refine your late cancellations analysis"})]}),i>0&&e.jsxs(L,{className:"bg-gradient-to-r from-red-600 to-orange-600 text-white",children:[i," active"]})]}),e.jsxs(G,{variant:"outline",onClick:()=>g(!0),className:"gap-2 border-red-200 text-red-700 hover:bg-red-50",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Expand Filters"]})]})})})}const $s=({isOpen:r,onClose:T,data:j})=>{if(!j)return null;const R=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs(F,{children:[e.jsx(K,{children:e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5 text-blue-500"}),"Member Information"]})}),e.jsxs(z,{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Member Name"}),e.jsx("p",{className:"font-semibold",children:j.data.memberName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-semibold",children:j.data.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Member ID"}),e.jsx("p",{className:"font-semibold",children:j.data.memberId})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Cancellations"}),e.jsx(L,{variant:"destructive",children:j.data.count})]})]})]}),e.jsxs(F,{children:[e.jsx(K,{children:e.jsx(W,{children:"Session Details"})}),e.jsx(z,{children:e.jsx(et,{className:"h-64",children:e.jsxs(Ce,{children:[e.jsx(ke,{children:e.jsxs(ne,{children:[e.jsx(B,{children:"Session"}),e.jsx(B,{children:"Time"}),e.jsx(B,{children:"Location"}),e.jsx(B,{children:"Trainer"})]})}),e.jsx(Me,{children:(j.rawData||[]).map((N,l)=>e.jsxs(ne,{children:[e.jsx(U,{children:N.sessionName}),e.jsx(U,{children:N.time}),e.jsx(U,{children:N.location}),e.jsx(U,{children:N.teacherName})]},l))})]})})})]})]}),M=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs(F,{children:[e.jsx(K,{children:e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-green-500"}),"Class Information"]})}),e.jsxs(z,{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Class Type"}),e.jsx("p",{className:"font-semibold",children:j.data.className})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Category"}),e.jsx(L,{variant:"secondary",children:j.data.category})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Cancellations"}),e.jsx(L,{variant:"destructive",children:D(j.data.count)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Unique Members"}),e.jsx("p",{className:"font-semibold",children:D(j.data.uniqueMembers)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Peak Time"}),e.jsx(L,{variant:"outline",children:j.data.peakTime})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Average Duration"}),e.jsxs("p",{className:"font-semibold",children:[j.data.avgDuration," min"]})]})]})]}),e.jsxs(F,{children:[e.jsx(K,{children:e.jsx(W,{children:"Recent Cancellations"})}),e.jsx(z,{children:e.jsx(et,{className:"h-64",children:e.jsxs(Ce,{children:[e.jsx(ke,{children:e.jsxs(ne,{children:[e.jsx(B,{children:"Member"}),e.jsx(B,{children:"Date"}),e.jsx(B,{children:"Time"}),e.jsx(B,{children:"Location"})]})}),e.jsx(Me,{children:(j.rawData||[]).slice(0,10).map((N,l)=>e.jsxs(ne,{children:[e.jsxs(U,{children:[N.firstName," ",N.lastName]}),e.jsx(U,{children:new Date(N.dateIST).toLocaleDateString()}),e.jsx(U,{children:N.time}),e.jsx(U,{children:N.location})]},l))})]})})})]})]}),v=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(F,{children:e.jsxs(z,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:D(j.totalCancellations)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Cancellations"})]})}),e.jsx(F,{children:e.jsxs(z,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:D(j.uniqueMembers)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Unique Members"})]})}),e.jsx(F,{children:e.jsxs(z,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:D(j.uniqueLocations)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Locations"})]})}),e.jsx(F,{children:e.jsxs(z,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:j.uniqueMembers>0?(j.totalCancellations/j.uniqueMembers).toFixed(1):"0"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Avg per Member"})]})})]}),e.jsxs(F,{children:[e.jsx(K,{children:e.jsx(W,{children:"Recent Activity"})}),e.jsx(z,{children:e.jsx(et,{className:"h-64",children:e.jsxs(Ce,{children:[e.jsx(ke,{children:e.jsxs(ne,{children:[e.jsx(B,{children:"Member"}),e.jsx(B,{children:"Date"}),e.jsx(B,{children:"Class"}),e.jsx(B,{children:"Location"}),e.jsx(B,{children:"Trainer"})]})}),e.jsx(Me,{children:(j.rawData||[]).slice(0,15).map((N,l)=>e.jsxs(ne,{children:[e.jsxs(U,{children:[N.firstName," ",N.lastName]}),e.jsx(U,{children:new Date(N.dateIST).toLocaleDateString()}),e.jsx(U,{children:N.cleanedClass}),e.jsx(U,{children:N.location}),e.jsx(U,{children:N.teacherName})]},l))})]})})})]})]});return e.jsx(Je,{open:r,onOpenChange:T,children:e.jsxs(_e,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Xe,{children:e.jsxs(Qe,{className:"flex items-center justify-between",children:[e.jsx("span",{children:j.title}),e.jsx("button",{onClick:T,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(pe,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"mt-4",children:[j.type==="member"&&R(),j.type==="class"&&M(),j.type==="metric"&&v()]})]})})};export{ns as A,Ms as D,Ns as E,Ds as L,ks as M,Cs as P,ws as S,vs as U,Ze as Y,Ss as a,ys as b,fs as c,bs as d,Ts as e,Is as f,As as g,Rs as h,Vs as i,Ps as j,$s as k};
